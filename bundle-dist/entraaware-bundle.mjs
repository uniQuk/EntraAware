#!/usr/bin/env node
var Cw=Object.create;var ec=Object.defineProperty;var _w=Object.getOwnPropertyDescriptor;var Aw=Object.getOwnPropertyNames;var Sw=Object.getPrototypeOf,ww=Object.prototype.hasOwnProperty;var ie=(r=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(r,{get:(e,t)=>(typeof require<"u"?require:e)[t]}):r)(function(r){if(typeof require<"u")return require.apply(this,arguments);throw Error('Dynamic require of "'+r+'" is not supported')});var Bt=(r,e)=>()=>(r&&(e=r(r=0)),e);var T=(r,e)=>()=>(e||r((e={exports:{}}).exports,e),e.exports),ze=(r,e)=>{for(var t in e)ec(r,t,{get:e[t],enumerable:!0})},tg=(r,e,t,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of Aw(e))!ww.call(r,i)&&i!==t&&ec(r,i,{get:()=>e[i],enumerable:!(n=_w(e,i))||n.enumerable});return r};var qi=(r,e,t)=>(t=r!=null?Cw(Sw(r)):{},tg(e||!r||!r.__esModule?ec(t,"default",{value:r,enumerable:!0}):t,r)),_e=r=>tg(ec({},"__esModule",{value:!0}),r);var Ee={};ze(Ee,{__addDisposableResource:()=>Hy,__assign:()=>Dc,__asyncDelegator:()=>xy,__asyncGenerator:()=>cs,__asyncValues:()=>Hc,__await:()=>vt,__awaiter:()=>wy,__classPrivateFieldGet:()=>Dy,__classPrivateFieldIn:()=>Uy,__classPrivateFieldSet:()=>Ly,__createBinding:()=>Uc,__decorate:()=>Ey,__disposeResources:()=>Fy,__esDecorate:()=>vy,__exportStar:()=>Iy,__extends:()=>gy,__generator:()=>Ry,__importDefault:()=>My,__importStar:()=>Ny,__makeTemplateObject:()=>Py,__metadata:()=>Sy,__param:()=>Ty,__propKey:()=>_y,__read:()=>ff,__rest:()=>yy,__rewriteRelativeImportExtension:()=>$y,__runInitializers:()=>Cy,__setFunctionName:()=>Ay,__spread:()=>by,__spreadArray:()=>ky,__spreadArrays:()=>Oy,__values:()=>Lc,default:()=>kI});function gy(r,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");uf(r,e);function t(){this.constructor=r}r.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}function yy(r,e){var t={};for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&e.indexOf(n)<0&&(t[n]=r[n]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,n=Object.getOwnPropertySymbols(r);i<n.length;i++)e.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(r,n[i])&&(t[n[i]]=r[n[i]]);return t}function Ey(r,e,t,n){var i=arguments.length,o=i<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(r,e,t,n);else for(var a=r.length-1;a>=0;a--)(s=r[a])&&(o=(i<3?s(o):i>3?s(e,t,o):s(e,t))||o);return i>3&&o&&Object.defineProperty(e,t,o),o}function Ty(r,e){return function(t,n){e(t,n,r)}}function vy(r,e,t,n,i,o){function s(P){if(P!==void 0&&typeof P!="function")throw new TypeError("Function expected");return P}for(var a=n.kind,c=a==="getter"?"get":a==="setter"?"set":"value",l=!e&&r?n.static?r:r.prototype:null,u=e||(l?Object.getOwnPropertyDescriptor(l,n.name):{}),d,h=!1,p=t.length-1;p>=0;p--){var m={};for(var y in n)m[y]=y==="access"?{}:n[y];for(var y in n.access)m.access[y]=n.access[y];m.addInitializer=function(P){if(h)throw new TypeError("Cannot add initializers after decoration has completed");o.push(s(P||null))};var A=(0,t[p])(a==="accessor"?{get:u.get,set:u.set}:u[c],m);if(a==="accessor"){if(A===void 0)continue;if(A===null||typeof A!="object")throw new TypeError("Object expected");(d=s(A.get))&&(u.get=d),(d=s(A.set))&&(u.set=d),(d=s(A.init))&&i.unshift(d)}else(d=s(A))&&(a==="field"?i.unshift(d):u[c]=d)}l&&Object.defineProperty(l,n.name,u),h=!0}function Cy(r,e,t){for(var n=arguments.length>2,i=0;i<e.length;i++)t=n?e[i].call(r,t):e[i].call(r);return n?t:void 0}function _y(r){return typeof r=="symbol"?r:"".concat(r)}function Ay(r,e,t){return typeof e=="symbol"&&(e=e.description?"[".concat(e.description,"]"):""),Object.defineProperty(r,"name",{configurable:!0,value:t?"".concat(t," ",e):e})}function Sy(r,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(r,e)}function wy(r,e,t,n){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(u){try{l(n.next(u))}catch(d){s(d)}}function c(u){try{l(n.throw(u))}catch(d){s(d)}}function l(u){u.done?o(u.value):i(u.value).then(a,c)}l((n=n.apply(r,e||[])).next())})}function Ry(r,e){var t={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},n,i,o,s=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return s.next=a(0),s.throw=a(1),s.return=a(2),typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function a(l){return function(u){return c([l,u])}}function c(l){if(n)throw new TypeError("Generator is already executing.");for(;s&&(s=0,l[0]&&(t=0)),t;)try{if(n=1,i&&(o=l[0]&2?i.return:l[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,l[1])).done)return o;switch(i=0,o&&(l=[l[0]&2,o.value]),l[0]){case 0:case 1:o=l;break;case 4:return t.label++,{value:l[1],done:!1};case 5:t.label++,i=l[1],l=[0];continue;case 7:l=t.ops.pop(),t.trys.pop();continue;default:if(o=t.trys,!(o=o.length>0&&o[o.length-1])&&(l[0]===6||l[0]===2)){t=0;continue}if(l[0]===3&&(!o||l[1]>o[0]&&l[1]<o[3])){t.label=l[1];break}if(l[0]===6&&t.label<o[1]){t.label=o[1],o=l;break}if(o&&t.label<o[2]){t.label=o[2],t.ops.push(l);break}o[2]&&t.ops.pop(),t.trys.pop();continue}l=e.call(r,t)}catch(u){l=[6,u],i=0}finally{n=o=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}function Iy(r,e){for(var t in r)t!=="default"&&!Object.prototype.hasOwnProperty.call(e,t)&&Uc(e,r,t)}function Lc(r){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&r[e],n=0;if(t)return t.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&n>=r.length&&(r=void 0),{value:r&&r[n++],done:!r}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function ff(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),i,o=[],s;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)o.push(i.value)}catch(a){s={error:a}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(s)throw s.error}}return o}function by(){for(var r=[],e=0;e<arguments.length;e++)r=r.concat(ff(arguments[e]));return r}function Oy(){for(var r=0,e=0,t=arguments.length;e<t;e++)r+=arguments[e].length;for(var n=Array(r),i=0,e=0;e<t;e++)for(var o=arguments[e],s=0,a=o.length;s<a;s++,i++)n[i]=o[s];return n}function ky(r,e,t){if(t||arguments.length===2)for(var n=0,i=e.length,o;n<i;n++)(o||!(n in e))&&(o||(o=Array.prototype.slice.call(e,0,n)),o[n]=e[n]);return r.concat(o||Array.prototype.slice.call(e))}function vt(r){return this instanceof vt?(this.v=r,this):new vt(r)}function cs(r,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=t.apply(r,e||[]),i,o=[];return i=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),a("next"),a("throw"),a("return",s),i[Symbol.asyncIterator]=function(){return this},i;function s(p){return function(m){return Promise.resolve(m).then(p,d)}}function a(p,m){n[p]&&(i[p]=function(y){return new Promise(function(A,P){o.push([p,y,A,P])>1||c(p,y)})},m&&(i[p]=m(i[p])))}function c(p,m){try{l(n[p](m))}catch(y){h(o[0][3],y)}}function l(p){p.value instanceof vt?Promise.resolve(p.value.v).then(u,d):h(o[0][2],p)}function u(p){c("next",p)}function d(p){c("throw",p)}function h(p,m){p(m),o.shift(),o.length&&c(o[0][0],o[0][1])}}function xy(r){var e,t;return e={},n("next"),n("throw",function(i){throw i}),n("return"),e[Symbol.iterator]=function(){return this},e;function n(i,o){e[i]=r[i]?function(s){return(t=!t)?{value:vt(r[i](s)),done:!1}:o?o(s):s}:o}}function Hc(r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=r[Symbol.asyncIterator],t;return e?e.call(r):(r=typeof Lc=="function"?Lc(r):r[Symbol.iterator](),t={},n("next"),n("throw"),n("return"),t[Symbol.asyncIterator]=function(){return this},t);function n(o){t[o]=r[o]&&function(s){return new Promise(function(a,c){s=r[o](s),i(a,c,s.done,s.value)})}}function i(o,s,a,c){Promise.resolve(c).then(function(l){o({value:l,done:a})},s)}}function Py(r,e){return Object.defineProperty?Object.defineProperty(r,"raw",{value:e}):r.raw=e,r}function Ny(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t=df(r),n=0;n<t.length;n++)t[n]!=="default"&&Uc(e,r,t[n]);return bI(e,r),e}function My(r){return r&&r.__esModule?r:{default:r}}function Dy(r,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?r!==e||!n:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(r):n?n.value:e.get(r)}function Ly(r,e,t,n,i){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!i)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?r!==e||!i:!e.has(r))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?i.call(r,t):i?i.value=t:e.set(r,t),t}function Uy(r,e){if(e===null||typeof e!="object"&&typeof e!="function")throw new TypeError("Cannot use 'in' operator on non-object");return typeof r=="function"?e===r:r.has(e)}function Hy(r,e,t){if(e!=null){if(typeof e!="object"&&typeof e!="function")throw new TypeError("Object expected.");var n,i;if(t){if(!Symbol.asyncDispose)throw new TypeError("Symbol.asyncDispose is not defined.");n=e[Symbol.asyncDispose]}if(n===void 0){if(!Symbol.dispose)throw new TypeError("Symbol.dispose is not defined.");n=e[Symbol.dispose],t&&(i=n)}if(typeof n!="function")throw new TypeError("Object not disposable.");i&&(n=function(){try{i.call(this)}catch(o){return Promise.reject(o)}}),r.stack.push({value:e,dispose:n,async:t})}else t&&r.stack.push({async:!0});return e}function Fy(r){function e(o){r.error=r.hasError?new OI(o,r.error,"An error was suppressed during disposal."):o,r.hasError=!0}var t,n=0;function i(){for(;t=r.stack.pop();)try{if(!t.async&&n===1)return n=0,r.stack.push(t),Promise.resolve().then(i);if(t.dispose){var o=t.dispose.call(t.value);if(t.async)return n|=2,Promise.resolve(o).then(i,function(s){return e(s),i()})}else n|=1}catch(s){e(s)}if(n===1)return r.hasError?Promise.reject(r.error):Promise.resolve();if(r.hasError)throw r.error}return i()}function $y(r,e){return typeof r=="string"&&/^\.\.?\//.test(r)?r.replace(/\.(tsx)$|((?:\.d)?)((?:\.[^./]+?)?)\.([cm]?)ts$/i,function(t,n,i,o,s){return n?e?".jsx":".js":i&&(!o||!s)?t:i+o+"."+s.toLowerCase()+"js"}):r}var uf,Dc,Uc,bI,df,OI,kI,ge=Bt(()=>{uf=function(r,e){return uf=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])},uf(r,e)};Dc=function(){return Dc=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++){t=arguments[n];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])}return e},Dc.apply(this,arguments)};Uc=Object.create?function(r,e,t,n){n===void 0&&(n=t);var i=Object.getOwnPropertyDescriptor(e,t);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(r,n,i)}:function(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]};bI=Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e},df=function(r){return df=Object.getOwnPropertyNames||function(e){var t=[];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[t.length]=n);return t},df(r)};OI=typeof SuppressedError=="function"?SuppressedError:function(r,e,t){var n=new Error(t);return n.name="SuppressedError",n.error=r,n.suppressed=e,n};kI={__extends:gy,__assign:Dc,__rest:yy,__decorate:Ey,__param:Ty,__esDecorate:vy,__runInitializers:Cy,__propKey:_y,__setFunctionName:Ay,__metadata:Sy,__awaiter:wy,__generator:Ry,__createBinding:Uc,__exportStar:Iy,__values:Lc,__read:ff,__spread:by,__spreadArrays:Oy,__spreadArray:ky,__await:vt,__asyncGenerator:cs,__asyncDelegator:xy,__asyncValues:Hc,__makeTemplateObject:Py,__importStar:Ny,__importDefault:My,__classPrivateFieldGet:Dy,__classPrivateFieldSet:Ly,__classPrivateFieldIn:Uy,__addDisposableResource:Hy,__disposeResources:Fy,__rewriteRelativeImportExtension:$y}});var ls=T(Fc=>{"use strict";Object.defineProperty(Fc,"__esModule",{value:!0});Fc.RequestMethod=void 0;var qy;(function(r){r.GET="GET",r.PATCH="PATCH",r.POST="POST",r.PUT="PUT",r.DELETE="DELETE"})(qy||(Fc.RequestMethod=qy={}))});var jy=T($c=>{"use strict";Object.defineProperty($c,"__esModule",{value:!0});$c.BatchRequestContent=void 0;var Xi=(ge(),_e(Ee)),hf=ls(),xI=function(){function r(e){if(this.requests=new Map,typeof e<"u"){var t=r.requestLimit;if(e.length>t){var n=new Error("Maximum requests limit exceeded, Max allowed number of requests are ".concat(t));throw n.name="Limit Exceeded Error",n}for(var i=0,o=e;i<o.length;i++){var s=o[i];this.addRequest(s)}}}return r.validateDependencies=function(e){var t=function(s){for(var a=s.entries(),c=a.next();!c.done;){var l=c.value[1];if(l.dependsOn!==void 0&&l.dependsOn.length>0)return!1;c=a.next()}return!0},n=function(s){var a=s.entries(),c=a.next(),l=c.value[1];if(l.dependsOn!==void 0&&l.dependsOn.length>0)return!1;var u=c;for(c=a.next();!c.done;){var d=c.value[1];if(d.dependsOn===void 0||d.dependsOn.length!==1||d.dependsOn[0]!==u.value[1].id)return!1;u=c,c=a.next()}return!0},i=function(s){var a=s.entries(),c=a.next(),l=c.value[1],u;if(l.dependsOn===void 0||l.dependsOn.length===0)u=l.id;else if(l.dependsOn.length===1){var d=l.dependsOn[0];if(d!==l.id&&s.has(d))u=d;else return!1}else return!1;for(c=a.next();!c.done;){var h=c.value[1];if((h.dependsOn===void 0||h.dependsOn.length===0)&&u!==h.id||h.dependsOn!==void 0&&h.dependsOn.length!==0&&(h.dependsOn.length===1&&(h.id===u||h.dependsOn[0]!==u)||h.dependsOn.length>1))return!1;c=a.next()}return!0};if(e.size===0){var o=new Error("Empty requests map, Please provide at least one request.");throw o.name="Empty Requests Error",o}return t(e)||n(e)||i(e)},r.getRequestData=function(e){return Xi.__awaiter(this,void 0,void 0,function(){var t,n,i,o;return Xi.__generator(this,function(s){switch(s.label){case 0:return t={url:""},n=new RegExp("^https?://"),t.url=n.test(e.url)?"/"+e.url.split(/.*?\/\/.*?\//)[1]:e.url,t.method=e.method,i={},e.headers.forEach(function(a,c){i[c]=a}),Object.keys(i).length&&(t.headers=i),e.method===hf.RequestMethod.PATCH||e.method===hf.RequestMethod.POST||e.method===hf.RequestMethod.PUT?(o=t,[4,r.getRequestBody(e)]):[3,2];case 1:o.body=s.sent(),s.label=2;case 2:return[2,t]}})})},r.getRequestBody=function(e){return Xi.__awaiter(this,void 0,void 0,function(){var t,n,i,o,s,a,c,l;return Xi.__generator(this,function(u){switch(u.label){case 0:t=!1,u.label=1;case 1:return u.trys.push([1,3,,4]),i=e.clone(),[4,i.json()];case 2:return n=u.sent(),t=!0,[3,4];case 3:return o=u.sent(),[3,4];case 4:if(t)return[3,12];u.label=5;case 5:return u.trys.push([5,11,,12]),typeof Blob<"u"?[4,e.blob()]:[3,8];case 6:return s=u.sent(),a=new FileReader,[4,new Promise(function(d){a.addEventListener("load",function(){var h=a.result,p=new RegExp("^s*data:(.+?/.+?(;.+?=.+?)*)?(;base64)?,(.*)s*$"),m=p.exec(h);d(m[4])},!1),a.readAsDataURL(s)})];case 7:return n=u.sent(),[3,10];case 8:return typeof Buffer<"u"?[4,e.buffer()]:[3,10];case 9:c=u.sent(),n=c.toString("base64"),u.label=10;case 10:return t=!0,[3,12];case 11:return l=u.sent(),[3,12];case 12:return[2,n]}})})},r.prototype.addRequest=function(e){var t=r.requestLimit;if(e.id===""){var n=new Error("Id for a request is empty, Please provide an unique id");throw n.name="Empty Id For Request",n}if(this.requests.size===t){var n=new Error("Maximum requests limit exceeded, Max allowed number of requests are ".concat(t));throw n.name="Limit Exceeded Error",n}if(this.requests.has(e.id)){var n=new Error("Adding request with duplicate id ".concat(e.id,", Make the id of the requests unique"));throw n.name="Duplicate RequestId Error",n}return this.requests.set(e.id,e),e.id},r.prototype.removeRequest=function(e){for(var t=this.requests.delete(e),n=this.requests.entries(),i=n.next();!i.done;){var o=i.value[1].dependsOn;if(typeof o<"u"){var s=o.indexOf(e);s!==-1&&o.splice(s,1),o.length===0&&delete i.value[1].dependsOn}i=n.next()}return t},r.prototype.getContent=function(){return Xi.__awaiter(this,void 0,void 0,function(){var e,t,n,i,a,a,o,s,a;return Xi.__generator(this,function(c){switch(c.label){case 0:if(e=[],t={requests:e},n=this.requests.entries(),i=n.next(),i.done)throw a=new Error("No requests added yet, Please add at least one request."),a.name="Empty Payload",a;if(!r.validateDependencies(this.requests))throw a=new Error(`Invalid dependency found, Dependency should be:
1. Parallel - no individual request states a dependency in the dependsOn property.
2. Serial - all individual requests depend on the previous individual request.
3. Same - all individual requests that state a dependency in the dependsOn property, state the same dependency.`),a.name="Invalid Dependency",a;c.label=1;case 1:return i.done?[3,3]:(o=i.value[1],[4,r.getRequestData(o.request)]);case 2:if(s=c.sent(),s.body!==void 0&&(s.headers===void 0||s.headers["content-type"]===void 0))throw a=new Error("Content-type header is not mentioned for request #".concat(o.id,", For request having body, Content-type header should be mentioned")),a.name="Invalid Content-type header",a;return s.id=o.id,o.dependsOn!==void 0&&o.dependsOn.length>0&&(s.dependsOn=o.dependsOn),e.push(s),i=n.next(),[3,1];case 3:return t.requests=e,[2,t]}})})},r.prototype.addDependency=function(e,t){if(!this.requests.has(e)){var n=new Error("Dependent ".concat(e," does not exists, Please check the id"));throw n.name="Invalid Dependent",n}if(typeof t<"u"&&!this.requests.has(t)){var n=new Error("Dependency ".concat(t," does not exists, Please check the id"));throw n.name="Invalid Dependency",n}if(typeof t<"u"){var i=this.requests.get(e);if(i.dependsOn===void 0&&(i.dependsOn=[]),i.dependsOn.indexOf(t)!==-1){var n=new Error("Dependency ".concat(t," is already added for the request ").concat(e));throw n.name="Duplicate Dependency",n}i.dependsOn.push(t)}else{for(var o=this.requests.entries(),s=void 0,a=o.next();!a.done&&a.value[1].id!==e;)s=a,a=o.next();if(typeof s<"u"){var c=s.value[0];if(a.value[1].dependsOn===void 0&&(a.value[1].dependsOn=[]),a.value[1].dependsOn.indexOf(c)!==-1){var n=new Error("Dependency ".concat(c," is already added for the request ").concat(e));throw n.name="Duplicate Dependency",n}a.value[1].dependsOn.push(c)}else{var n=new Error("Can't add dependency ".concat(t,", There is only a dependent request in the batch"));throw n.name="Invalid Dependency Addition",n}}},r.prototype.removeDependency=function(e,t){var n=this.requests.get(e);if(typeof n>"u"||n.dependsOn===void 0||n.dependsOn.length===0)return!1;if(typeof t<"u"){var i=n.dependsOn.indexOf(t);return i===-1?!1:(n.dependsOn.splice(i,1),!0)}else return delete n.dependsOn,!0},r.requestLimit=20,r}();$c.BatchRequestContent=xI});var By=T(qc=>{"use strict";Object.defineProperty(qc,"__esModule",{value:!0});qc.BatchResponseContent=void 0;var PI=(ge(),_e(Ee)),NI=function(){function r(e){this.responses=new Map,this.update(e)}return r.prototype.createResponseObject=function(e){var t=e.body,n={};if(n.status=e.status,e.statusText!==void 0&&(n.statusText=e.statusText),n.headers=e.headers,n.headers!==void 0&&n.headers["Content-Type"]!==void 0&&n.headers["Content-Type"].split(";")[0]==="application/json"){var i=JSON.stringify(t);return new Response(i,n)}return new Response(t,n)},r.prototype.update=function(e){this.nextLink=e["@odata.nextLink"];for(var t=e.responses,n=0,i=t.length;n<i;n++)this.responses.set(t[n].id,this.createResponseObject(t[n]))},r.prototype.getResponseById=function(e){return this.responses.get(e)},r.prototype.getResponses=function(){return this.responses},r.prototype.getResponsesIterator=function(){var e,t;return PI.__generator(this,function(n){switch(n.label){case 0:e=this.responses.entries(),t=e.next(),n.label=1;case 1:return t.done?[3,3]:[4,t.value];case 2:return n.sent(),t=e.next(),[3,1];case 3:return[2]}})},r}();qc.BatchResponseContent=NI});var pf=T(Zr=>{"use strict";Object.defineProperty(Zr,"__esModule",{value:!0});Zr.GRAPH_URLS=Zr.GRAPH_BASE_URL=Zr.GRAPH_API_VERSION=void 0;Zr.GRAPH_API_VERSION="v1.0";Zr.GRAPH_BASE_URL="https://graph.microsoft.com/";Zr.GRAPH_URLS=new Set(["graph.microsoft.com","graph.microsoft.us","dod-graph.microsoft.us","graph.microsoft.de","microsoftgraph.chinacloudapi.cn","canary.graph.microsoft.com"])});var Rr=T(jc=>{"use strict";Object.defineProperty(jc,"__esModule",{value:!0});jc.GraphClientError=void 0;var MI=(ge(),_e(Ee)),DI=function(r){MI.__extends(e,r);function e(t){var n=r.call(this,t)||this;return Object.setPrototypeOf(n,e.prototype),n}return e.setGraphClientError=function(t){var n;return t instanceof Error?n=t:(n=new e,n.customError=t),n},e}(Error);jc.GraphClientError=DI});var Bc=T(Mt=>{"use strict";Object.defineProperty(Mt,"__esModule",{value:!0});Mt.isCustomHost=Mt.isGraphURL=Mt.serializeContent=Mt.urlJoin=Mt.oDataQueryNames=void 0;var LI=pf(),UI=Rr();Mt.oDataQueryNames=["$select","$expand","$orderby","$filter","$top","$skip","$skipToken","$count"];var HI=function(r){var e=function(o){return o.replace(/\/+$/,"")},t=function(o){return o.replace(/^\/+/,"")},n=function(o,s){return[e(o),t(s)].join("/")},i=Array.prototype.slice.call(r);return i.reduce(n)};Mt.urlJoin=HI;var FI=function(r){var e=r&&r.constructor&&r.constructor.name;if(e==="Buffer"||e==="Blob"||e==="File"||e==="FormData"||typeof r=="string")return r;if(e==="ArrayBuffer")r=Buffer.from(r);else if(e==="Int8Array"||e==="Int16Array"||e==="Int32Array"||e==="Uint8Array"||e==="Uint16Array"||e==="Uint32Array"||e==="Uint8ClampedArray"||e==="Float32Array"||e==="Float64Array"||e==="DataView")r=Buffer.from(r.buffer);else try{r=JSON.stringify(r)}catch{throw new Error("Unable to stringify the content")}return r};Mt.serializeContent=FI;var $I=function(r){return zy(r)};Mt.isGraphURL=$I;var qI=function(r,e){return e.forEach(function(t){return jI(t)}),zy(r,e)};Mt.isCustomHost=qI;var zy=function(r,e){if(e===void 0&&(e=LI.GRAPH_URLS),r=r.toLowerCase(),r.indexOf("https://")!==-1){r=r.replace("https://","");var t=r.indexOf(":"),n=r.indexOf("/"),i="";if(n!==-1)return t!==-1&&t<n?(i=r.substring(0,t),e.has(i)):(i=r.substring(0,n),e.has(i))}return!1},jI=function(r){if(r.indexOf("/")!==-1)throw new UI.GraphClientError("Please add only hosts or hostnames to the CustomHosts config. If the url is `http://example.com:3000/`, host is `example:3000`")}});var Xr=T(zc=>{"use strict";Object.defineProperty(zc,"__esModule",{value:!0});zc.MiddlewareControl=void 0;var BI=function(){function r(e){e===void 0&&(e=[]),this.middlewareOptions=new Map;for(var t=0,n=e;t<n.length;t++){var i=n[t],o=i.constructor;this.middlewareOptions.set(o,i)}}return r.prototype.getMiddlewareOptions=function(e){return this.middlewareOptions.get(e)},r.prototype.setMiddlewareOptions=function(e,t){this.middlewareOptions.set(e,t)},r}();zc.MiddlewareControl=BI});var Qi=T(Dt=>{"use strict";Object.defineProperty(Dt,"__esModule",{value:!0});Dt.cloneRequestWithNewUrl=Dt.appendRequestHeader=Dt.setRequestHeader=Dt.getRequestHeader=Dt.generateUUID=void 0;var Gy=(ge(),_e(Ee)),zI=function(){for(var r="",e=0;e<32;e++)(e===8||e===12||e===16||e===20)&&(r+="-"),r+=Math.floor(Math.random()*16).toString(16);return r};Dt.generateUUID=zI;var GI=function(r,e,t){var n=null;if(typeof Request<"u"&&r instanceof Request)n=r.headers.get(t);else if(typeof e<"u"&&e.headers!==void 0)if(typeof Headers<"u"&&e.headers instanceof Headers)n=e.headers.get(t);else if(e.headers instanceof Array){for(var i=e.headers,o=0,s=i.length;o<s;o++)if(i[o][0]===t){n=i[o][1];break}}else e.headers[t]!==void 0&&(n=e.headers[t]);return n};Dt.getRequestHeader=GI;var VI=function(r,e,t,n){var i,o;if(typeof Request<"u"&&r instanceof Request)r.headers.set(t,n);else if(typeof e<"u")if(e.headers===void 0)e.headers=new Headers((i={},i[t]=n,i));else if(typeof Headers<"u"&&e.headers instanceof Headers)e.headers.set(t,n);else if(e.headers instanceof Array){for(var s=0,a=e.headers.length;s<a;s++){var c=e.headers[s];if(c[0]===t){c[1]=n;break}}s===a&&e.headers.push([t,n])}else Object.assign(e.headers,(o={},o[t]=n,o))};Dt.setRequestHeader=VI;var KI=function(r,e,t,n){var i,o;typeof Request<"u"&&r instanceof Request?r.headers.append(t,n):typeof e<"u"&&(e.headers===void 0?e.headers=new Headers((i={},i[t]=n,i)):typeof Headers<"u"&&e.headers instanceof Headers?e.headers.append(t,n):e.headers instanceof Array?e.headers.push([t,n]):e.headers===void 0?e.headers=(o={},o[t]=n,o):e.headers[t]===void 0?e.headers[t]=n:e.headers[t]+=", ".concat(n))};Dt.appendRequestHeader=KI;var YI=function(r,e){return Gy.__awaiter(void 0,void 0,void 0,function(){var t,n,i,o,s,a,c,l,u,d,h,p,m;return Gy.__generator(this,function(y){switch(y.label){case 0:return e.headers.get("Content-Type")?[4,e.blob()]:[3,2];case 1:return n=y.sent(),[3,4];case 2:return[4,Promise.resolve(void 0)];case 3:n=y.sent(),y.label=4;case 4:return t=n,i=e.method,o=e.headers,s=e.referrer,a=e.referrerPolicy,c=e.mode,l=e.credentials,u=e.cache,d=e.redirect,h=e.integrity,p=e.keepalive,m=e.signal,[2,new Request(r,{method:i,headers:o,body:t,referrer:s,referrerPolicy:a,mode:c,credentials:l,cache:u,redirect:d,integrity:h,keepalive:p,signal:m})]}})})};Dt.cloneRequestWithNewUrl=YI});var mf=T(Gc=>{"use strict";Object.defineProperty(Gc,"__esModule",{value:!0});Gc.AuthenticationHandlerOptions=void 0;var WI=function(){function r(e,t){this.authenticationProvider=e,this.authenticationProviderOptions=t}return r}();Gc.AuthenticationHandlerOptions=WI});var eo=T(Ji=>{"use strict";Object.defineProperty(Ji,"__esModule",{value:!0});Ji.TelemetryHandlerOptions=Ji.FeatureUsageFlag=void 0;var Vy=Xr(),gf;(function(r){r[r.NONE=0]="NONE",r[r.REDIRECT_HANDLER_ENABLED=1]="REDIRECT_HANDLER_ENABLED",r[r.RETRY_HANDLER_ENABLED=2]="RETRY_HANDLER_ENABLED",r[r.AUTHENTICATION_HANDLER_ENABLED=4]="AUTHENTICATION_HANDLER_ENABLED"})(gf||(Ji.FeatureUsageFlag=gf={}));var ZI=function(){function r(){this.featureUsage=gf.NONE}return r.updateFeatureUsageFlag=function(e,t){var n;e.middlewareControl instanceof Vy.MiddlewareControl?n=e.middlewareControl.getMiddlewareOptions(r):e.middlewareControl=new Vy.MiddlewareControl,typeof n>"u"&&(n=new r,e.middlewareControl.setMiddlewareOptions(r,n)),n.setFeatureUsage(t)},r.prototype.setFeatureUsage=function(e){this.featureUsage=this.featureUsage|e},r.prototype.getFeatureUsage=function(){return this.featureUsage.toString(16)},r}();Ji.TelemetryHandlerOptions=ZI});var Kc=T(Vc=>{"use strict";Object.defineProperty(Vc,"__esModule",{value:!0});Vc.AuthenticationHandler=void 0;var Ky=(ge(),_e(Ee)),Yy=Bc(),XI=Xr(),QI=Qi(),JI=mf(),Wy=eo(),eb=function(){function r(e){this.authenticationProvider=e}return r.prototype.execute=function(e){return Ky.__awaiter(this,void 0,void 0,function(){var t,n,i,o,s,a;return Ky.__generator(this,function(c){switch(c.label){case 0:return t=typeof e.request=="string"?e.request:e.request.url,(0,Yy.isGraphURL)(t)||e.customHosts&&(0,Yy.isCustomHost)(t,e.customHosts)?(n=void 0,e.middlewareControl instanceof XI.MiddlewareControl&&(n=e.middlewareControl.getMiddlewareOptions(JI.AuthenticationHandlerOptions)),i=void 0,o=void 0,n&&(i=n.authenticationProvider,o=n.authenticationProviderOptions),i||(i=this.authenticationProvider),[4,i.getAccessToken(o)]):[3,2];case 1:return s=c.sent(),a="Bearer ".concat(s),(0,QI.appendRequestHeader)(e.request,e.options,r.AUTHORIZATION_HEADER,a),Wy.TelemetryHandlerOptions.updateFeatureUsageFlag(e,Wy.FeatureUsageFlag.AUTHENTICATION_HANDLER_ENABLED),[3,3];case 2:e.options.headers&&delete e.options.headers[r.AUTHORIZATION_HEADER],c.label=3;case 3:return[4,this.nextMiddleware.execute(e)];case 4:return[2,c.sent()]}})})},r.prototype.setNext=function(e){this.nextMiddleware=e},r.AUTHORIZATION_HEADER="Authorization",r}();Vc.AuthenticationHandler=eb});var Wc=T(Yc=>{"use strict";Object.defineProperty(Yc,"__esModule",{value:!0});Yc.HTTPMessageHandler=void 0;var Zy=(ge(),_e(Ee)),tb=function(){function r(){}return r.prototype.execute=function(e){return Zy.__awaiter(this,void 0,void 0,function(){var t;return Zy.__generator(this,function(n){switch(n.label){case 0:return t=e,[4,fetch(e.request,e.options)];case 1:return t.response=n.sent(),[2]}})})},r}();Yc.HTTPMessageHandler=tb});var us=T(Zc=>{"use strict";Object.defineProperty(Zc,"__esModule",{value:!0});Zc.RetryHandlerOptions=void 0;var rb=function(){function r(e,t,n){if(e===void 0&&(e=r.DEFAULT_DELAY),t===void 0&&(t=r.DEFAULT_MAX_RETRIES),n===void 0&&(n=r.defaultShouldRetry),e>r.MAX_DELAY&&t>r.MAX_MAX_RETRIES){var i=new Error("Delay and MaxRetries should not be more than ".concat(r.MAX_DELAY," and ").concat(r.MAX_MAX_RETRIES));throw i.name="MaxLimitExceeded",i}else if(e>r.MAX_DELAY){var i=new Error("Delay should not be more than ".concat(r.MAX_DELAY));throw i.name="MaxLimitExceeded",i}else if(t>r.MAX_MAX_RETRIES){var i=new Error("MaxRetries should not be more than ".concat(r.MAX_MAX_RETRIES));throw i.name="MaxLimitExceeded",i}else if(e<0&&t<0){var i=new Error("Delay and MaxRetries should not be negative");throw i.name="MinExpectationNotMet",i}else if(e<0){var i=new Error("Delay should not be negative");throw i.name="MinExpectationNotMet",i}else if(t<0){var i=new Error("MaxRetries should not be negative");throw i.name="MinExpectationNotMet",i}this.delay=Math.min(e,r.MAX_DELAY),this.maxRetries=Math.min(t,r.MAX_MAX_RETRIES),this.shouldRetry=n}return r.prototype.getMaxDelay=function(){return r.MAX_DELAY},r.DEFAULT_DELAY=3,r.DEFAULT_MAX_RETRIES=3,r.MAX_DELAY=180,r.MAX_MAX_RETRIES=10,r.defaultShouldRetry=function(){return!0},r}();Zc.RetryHandlerOptions=rb});var Qc=T(Xc=>{"use strict";Object.defineProperty(Xc,"__esModule",{value:!0});Xc.RetryHandler=void 0;var to=(ge(),_e(Ee)),yf=ls(),nb=Xr(),Xy=Qi(),Qy=us(),Jy=eo(),ib=function(){function r(e){e===void 0&&(e=new Qy.RetryHandlerOptions),this.options=e}return r.prototype.isRetry=function(e){return r.RETRY_STATUS_CODES.indexOf(e.status)!==-1},r.prototype.isBuffered=function(e,t){var n=typeof e=="string"?t.method:e.method,i=n===yf.RequestMethod.PUT||n===yf.RequestMethod.PATCH||n===yf.RequestMethod.POST;if(i){var o=(0,Xy.getRequestHeader)(e,t,"Content-Type")==="application/octet-stream";if(o)return!1}return!0},r.prototype.getDelay=function(e,t,n){var i=function(){return Number(Math.random().toFixed(3))},o=e.headers!==void 0?e.headers.get(r.RETRY_AFTER_HEADER):null,s;return o!==null?Number.isNaN(Number(o))?s=Math.round((new Date(o).getTime()-Date.now())/1e3):s=Number(o):s=t>=2?this.getExponentialBackOffTime(t)+n+i():n+i(),Math.min(s,this.options.getMaxDelay()+i())},r.prototype.getExponentialBackOffTime=function(e){return Math.round(1/2*(Math.pow(2,e)-1))},r.prototype.sleep=function(e){return to.__awaiter(this,void 0,void 0,function(){var t;return to.__generator(this,function(n){return t=e*1e3,[2,new Promise(function(i){return setTimeout(i,t)})]})})},r.prototype.getOptions=function(e){var t;return e.middlewareControl instanceof nb.MiddlewareControl&&(t=e.middlewareControl.getMiddlewareOptions(this.options.constructor)),typeof t>"u"&&(t=Object.assign(new Qy.RetryHandlerOptions,this.options)),t},r.prototype.executeWithRetry=function(e,t,n){return to.__awaiter(this,void 0,void 0,function(){var i;return to.__generator(this,function(o){switch(o.label){case 0:return[4,this.nextMiddleware.execute(e)];case 1:return o.sent(),t<n.maxRetries&&this.isRetry(e.response)&&this.isBuffered(e.request,e.options)&&n.shouldRetry(n.delay,t,e.request,e.options,e.response)?(++t,(0,Xy.setRequestHeader)(e.request,e.options,r.RETRY_ATTEMPT_HEADER,t.toString()),i=this.getDelay(e.response,t,n.delay),[4,this.sleep(i)]):[3,4];case 2:return o.sent(),[4,this.executeWithRetry(e,t,n)];case 3:return[2,o.sent()];case 4:return[2]}})})},r.prototype.execute=function(e){return to.__awaiter(this,void 0,void 0,function(){var t,n;return to.__generator(this,function(i){switch(i.label){case 0:return t=0,n=this.getOptions(e),Jy.TelemetryHandlerOptions.updateFeatureUsageFlag(e,Jy.FeatureUsageFlag.RETRY_HANDLER_ENABLED),[4,this.executeWithRetry(e,t,n)];case 1:return[2,i.sent()]}})})},r.prototype.setNext=function(e){this.nextMiddleware=e},r.RETRY_STATUS_CODES=[429,503,504],r.RETRY_ATTEMPT_HEADER="Retry-Attempt",r.RETRY_AFTER_HEADER="Retry-After",r}();Xc.RetryHandler=ib});var ds=T(Jc=>{"use strict";Object.defineProperty(Jc,"__esModule",{value:!0});Jc.RedirectHandlerOptions=void 0;var ob=function(){function r(e,t){if(e===void 0&&(e=r.DEFAULT_MAX_REDIRECTS),t===void 0&&(t=r.defaultShouldRedirect),e>r.MAX_MAX_REDIRECTS){var n=new Error("MaxRedirects should not be more than ".concat(r.MAX_MAX_REDIRECTS));throw n.name="MaxLimitExceeded",n}if(e<0){var n=new Error("MaxRedirects should not be negative");throw n.name="MinExpectationNotMet",n}this.maxRedirects=e,this.shouldRedirect=t}return r.DEFAULT_MAX_REDIRECTS=5,r.MAX_MAX_REDIRECTS=20,r.defaultShouldRedirect=function(){return!0},r}();Jc.RedirectHandlerOptions=ob});var tl=T(el=>{"use strict";Object.defineProperty(el,"__esModule",{value:!0});el.RedirectHandler=void 0;var ro=(ge(),_e(Ee)),sb=ls(),ab=Xr(),cb=Qi(),Ef=ds(),eE=eo(),lb=function(){function r(e){e===void 0&&(e=new Ef.RedirectHandlerOptions),this.options=e}return r.prototype.isRedirect=function(e){return r.REDIRECT_STATUS_CODES.indexOf(e.status)!==-1},r.prototype.hasLocationHeader=function(e){return e.headers.has(r.LOCATION_HEADER)},r.prototype.getLocationHeader=function(e){return e.headers.get(r.LOCATION_HEADER)},r.prototype.isRelativeURL=function(e){return e.indexOf("://")===-1},r.prototype.shouldDropAuthorizationHeader=function(e,t){var n=/^[A-Za-z].+?:\/\/.+?(?=\/|$)/,i=n.exec(e),o,s;i!==null&&(o=i[0]);var a=n.exec(t);return a!==null&&(s=a[0]),typeof o<"u"&&typeof s<"u"&&o!==s},r.prototype.updateRequestUrl=function(e,t){return ro.__awaiter(this,void 0,void 0,function(){var n,i;return ro.__generator(this,function(o){switch(o.label){case 0:return n=t,typeof t.request!="string"?[3,1]:(i=e,[3,3]);case 1:return[4,(0,cb.cloneRequestWithNewUrl)(e,t.request)];case 2:i=o.sent(),o.label=3;case 3:return n.request=i,[2]}})})},r.prototype.getOptions=function(e){var t;return e.middlewareControl instanceof ab.MiddlewareControl&&(t=e.middlewareControl.getMiddlewareOptions(Ef.RedirectHandlerOptions)),typeof t>"u"&&(t=Object.assign(new Ef.RedirectHandlerOptions,this.options)),t},r.prototype.executeWithRedirect=function(e,t,n){return ro.__awaiter(this,void 0,void 0,function(){var i,o;return ro.__generator(this,function(s){switch(s.label){case 0:return[4,this.nextMiddleware.execute(e)];case 1:return s.sent(),i=e.response,t<n.maxRedirects&&this.isRedirect(i)&&this.hasLocationHeader(i)&&n.shouldRedirect(i)?(++t,i.status!==r.STATUS_CODE_SEE_OTHER?[3,2]:(e.options.method=sb.RequestMethod.GET,delete e.options.body,[3,4])):[3,6];case 2:return o=this.getLocationHeader(i),!this.isRelativeURL(o)&&this.shouldDropAuthorizationHeader(i.url,o)&&delete e.options.headers[r.AUTHORIZATION_HEADER],[4,this.updateRequestUrl(o,e)];case 3:s.sent(),s.label=4;case 4:return[4,this.executeWithRedirect(e,t,n)];case 5:return s.sent(),[3,7];case 6:return[2];case 7:return[2]}})})},r.prototype.execute=function(e){return ro.__awaiter(this,void 0,void 0,function(){var t,n;return ro.__generator(this,function(i){switch(i.label){case 0:return t=0,n=this.getOptions(e),e.options.redirect=r.MANUAL_REDIRECT,eE.TelemetryHandlerOptions.updateFeatureUsageFlag(e,eE.FeatureUsageFlag.REDIRECT_HANDLER_ENABLED),[4,this.executeWithRedirect(e,t,n)];case 1:return[2,i.sent()]}})})},r.prototype.setNext=function(e){this.nextMiddleware=e},r.REDIRECT_STATUS_CODES=[301,302,303,307,308],r.STATUS_CODE_SEE_OTHER=303,r.LOCATION_HEADER="Location",r.AUTHORIZATION_HEADER="Authorization",r.MANUAL_REDIRECT="manual",r}();el.RedirectHandler=lb});var tE=T(rl=>{"use strict";Object.defineProperty(rl,"__esModule",{value:!0});rl.PACKAGE_VERSION=void 0;rl.PACKAGE_VERSION="3.0.7"});var ol=T(il=>{"use strict";Object.defineProperty(il,"__esModule",{value:!0});il.TelemetryHandler=void 0;var rE=(ge(),_e(Ee)),nE=Bc(),ub=tE(),db=Xr(),nl=Qi(),fb=eo(),hb=function(){function r(){}return r.prototype.execute=function(e){return rE.__awaiter(this,void 0,void 0,function(){var t,n,i,o,s;return rE.__generator(this,function(a){switch(a.label){case 0:return t=typeof e.request=="string"?e.request:e.request.url,(0,nE.isGraphURL)(t)||e.customHosts&&(0,nE.isCustomHost)(t,e.customHosts)?(n=(0,nl.getRequestHeader)(e.request,e.options,r.CLIENT_REQUEST_ID_HEADER),n||(n=(0,nl.generateUUID)(),(0,nl.setRequestHeader)(e.request,e.options,r.CLIENT_REQUEST_ID_HEADER,n)),i="".concat(r.PRODUCT_NAME,"/").concat(ub.PACKAGE_VERSION),o=void 0,e.middlewareControl instanceof db.MiddlewareControl&&(o=e.middlewareControl.getMiddlewareOptions(fb.TelemetryHandlerOptions)),o&&(s=o.getFeatureUsage(),i+=" (".concat(r.FEATURE_USAGE_STRING,"=").concat(s,")")),(0,nl.appendRequestHeader)(e.request,e.options,r.SDK_VERSION_HEADER,i)):(delete e.options.headers[r.CLIENT_REQUEST_ID_HEADER],delete e.options.headers[r.SDK_VERSION_HEADER]),[4,this.nextMiddleware.execute(e)];case 1:return[2,a.sent()]}})})},r.prototype.setNext=function(e){this.nextMiddleware=e},r.CLIENT_REQUEST_ID_HEADER="client-request-id",r.SDK_VERSION_HEADER="SdkVersion",r.PRODUCT_NAME="graph-js",r.FEATURE_USAGE_STRING="featureUsage",r}();il.TelemetryHandler=hb});var iE=T(sl=>{"use strict";Object.defineProperty(sl,"__esModule",{value:!0});sl.MiddlewareFactory=void 0;var pb=Kc(),mb=Wc(),gb=ds(),yb=us(),Eb=tl(),Tb=Qc(),vb=ol(),Cb=function(){return typeof process=="object"&&typeof ie=="function"},_b=function(){function r(){}return r.getDefaultMiddlewareChain=function(e){var t=[],n=new pb.AuthenticationHandler(e),i=new Tb.RetryHandler(new yb.RetryHandlerOptions),o=new vb.TelemetryHandler,s=new mb.HTTPMessageHandler;if(t.push(n),t.push(i),Cb()){var a=new Eb.RedirectHandler(new gb.RedirectHandlerOptions);t.push(a)}return t.push(o),t.push(s),t},r}();sl.MiddlewareFactory=_b});var cl=T(al=>{"use strict";Object.defineProperty(al,"__esModule",{value:!0});al.ChaosStrategy=void 0;var oE;(function(r){r[r.MANUAL=0]="MANUAL",r[r.RANDOM=1]="RANDOM"})(oE||(al.ChaosStrategy=oE={}))});var Tf=T(ll=>{"use strict";Object.defineProperty(ll,"__esModule",{value:!0});ll.ChaosHandlerOptions=void 0;var Ab=cl(),Sb=function(){function r(e,t,n,i,o,s){if(e===void 0&&(e=Ab.ChaosStrategy.RANDOM),t===void 0&&(t="Some error Happened"),this.chaosStrategy=e,this.statusCode=n,this.statusMessage=t,this.chaosPercentage=i!==void 0?i:10,this.responseBody=o,this.headers=s,this.chaosPercentage>100)throw new Error("Error Pecentage can not be more than 100")}return r}();ll.ChaosHandlerOptions=Sb});var sE=T(no=>{"use strict";Object.defineProperty(no,"__esModule",{value:!0});no.httpStatusCode=no.methodStatusCode=void 0;no.methodStatusCode={GET:[429,500,502,503,504],POST:[429,500,502,503,504,507],PUT:[429,500,502,503,504,507],PATCH:[429,500,502,503,504],DELETE:[429,500,502,503,504,507]};no.httpStatusCode={100:"Continue",101:"Switching Protocols",102:"Processing",103:"Early Hints",200:"OK",201:"Created",202:"Accepted",203:"Non-Authoritative Information",204:"No Content",205:"Reset Content",206:"Partial Content",207:"Multi-Status",208:"Already Reported",226:"IM Used",300:"Multiple Choices",301:"Moved Permanently",302:"Found",303:"See Other",304:"Not Modified",305:"Use Proxy",307:"Temporary Redirect",308:"Permanent Redirect",400:"Bad Request",401:"Unauthorized",402:"Payment Required",403:"Forbidden",404:"Not Found",405:"Method Not Allowed",406:"Not Acceptable",407:"Proxy Authentication Required",408:"Request Timeout",409:"Conflict",410:"Gone",411:"Length Required",412:"Precondition Failed",413:"Payload Too Large",414:"URI Too Long",415:"Unsupported Media Type",416:"Range Not Satisfiable",417:"Expectation Failed",421:"Misdirected Request",422:"Unprocessable Entity",423:"Locked",424:"Failed Dependency",425:"Too Early",426:"Upgrade Required",428:"Precondition Required",429:"Too Many Requests",431:"Request Header Fields Too Large",451:"Unavailable For Legal Reasons",500:"Internal Server Error",501:"Not Implemented",502:"Bad Gateway",503:"Service Unavailable",504:"Gateway Timeout",505:"HTTP Version Not Supported",506:"Variant Also Negotiates",507:"Insufficient Storage",508:"Loop Detected",510:"Not Extended",511:"Network Authentication Required"}});var lE=T(dl=>{"use strict";Object.defineProperty(dl,"__esModule",{value:!0});dl.ChaosHandler=void 0;var ul=(ge(),_e(Ee)),wb=Xr(),Rb=Qi(),aE=sE(),vf=Tf(),cE=cl(),Ib=function(){function r(e,t){e===void 0&&(e=new vf.ChaosHandlerOptions),this.options=e,this.manualMap=t}return r.prototype.createResponseHeaders=function(e,t,n){var i=e.headers?new Headers(e.headers):new Headers;return i.append("Cache-Control","no-store"),i.append("request-id",t),i.append("client-request-id",t),i.append("x-ms-ags-diagnostic",""),i.append("Date",n),i.append("Strict-Transport-Security",""),e.statusCode===429&&i.append("retry-after","3"),i},r.prototype.createResponseBody=function(e,t,n){if(e.responseBody)return e.responseBody;var i;if(e.statusCode>=400){var o=aE.httpStatusCode[e.statusCode],s=e.statusMessage;i={error:{code:o,message:s,innerError:{"request-id":t,date:n}}}}else i={};return i},r.prototype.createResponse=function(e,t){var n=t.request,i=(0,Rb.generateUUID)(),o=new Date,s=this.createResponseHeaders(e,i,o.toString()),a=this.createResponseBody(e,i,o.toString()),c={url:n,status:e.statusCode,statusText:e.statusMessage,headers:s};t.response=new Response(typeof a=="string"?a:JSON.stringify(a),c)},r.prototype.sendRequest=function(e,t){return ul.__awaiter(this,void 0,void 0,function(){return ul.__generator(this,function(n){switch(n.label){case 0:return this.setStatusCode(e,t.request,t.options.method),e.chaosStrategy===cE.ChaosStrategy.MANUAL&&!this.nextMiddleware||Math.floor(Math.random()*100)<e.chaosPercentage?(this.createResponse(e,t),[3,3]):[3,1];case 1:return this.nextMiddleware?[4,this.nextMiddleware.execute(t)]:[3,3];case 2:n.sent(),n.label=3;case 3:return[2]}})})},r.prototype.getRandomStatusCode=function(e){var t=aE.methodStatusCode[e];return t[Math.floor(Math.random()*t.length)]},r.prototype.getRelativeURL=function(e){var t=/https?:\/\/graph\.microsoft\.com\/[^/]+(.+?)(\?|$)/,n;return t.exec(e)!==null&&(n=t.exec(e)[1]),n},r.prototype.setStatusCode=function(e,t,n){var i=this;if(e.chaosStrategy===cE.ChaosStrategy.MANUAL){if(e.statusCode===void 0){var o=this.getRelativeURL(t);this.manualMap.get(o)!==void 0?this.manualMap.get(o).get(n)!==void 0&&(e.statusCode=this.manualMap.get(o).get(n)):this.manualMap.forEach(function(s,a){var c=new RegExp(a+"$");c.test(o)&&i.manualMap.get(a).get(n)!==void 0&&(e.statusCode=i.manualMap.get(a).get(n))})}}else e.statusCode=this.getRandomStatusCode(n)},r.prototype.getOptions=function(e){var t;return e.middlewareControl instanceof wb.MiddlewareControl&&(t=e.middlewareControl.getMiddlewareOptions(vf.ChaosHandlerOptions)),typeof t>"u"&&(t=Object.assign(new vf.ChaosHandlerOptions,this.options)),t},r.prototype.execute=function(e){return ul.__awaiter(this,void 0,void 0,function(){var t;return ul.__generator(this,function(n){switch(n.label){case 0:return t=this.getOptions(e),[4,this.sendRequest(t,e)];case 1:return[2,n.sent()]}})})},r.prototype.setNext=function(e){this.nextMiddleware=e},r}();dl.ChaosHandler=Ib});var fs=T(fl=>{"use strict";Object.defineProperty(fl,"__esModule",{value:!0});fl.ResponseType=void 0;var uE;(function(r){r.ARRAYBUFFER="arraybuffer",r.BLOB="blob",r.DOCUMENT="document",r.JSON="json",r.RAW="raw",r.STREAM="stream",r.TEXT="text"})(uE||(fl.ResponseType=uE={}))});var _f=T(io=>{"use strict";Object.defineProperty(io,"__esModule",{value:!0});io.GraphResponseHandler=io.DocumentType=void 0;var hl=(ge(),_e(Ee)),Hn=fs(),Cf;(function(r){r.TEXT_HTML="text/html",r.TEXT_XML="text/xml",r.APPLICATION_XML="application/xml",r.APPLICATION_XHTML="application/xhtml+xml"})(Cf||(io.DocumentType=Cf={}));var pl;(function(r){r.TEXT_PLAIN="text/plain",r.APPLICATION_JSON="application/json"})(pl||(pl={}));var ml;(function(r){r.DOCUMENT="^(text\\/(html|xml))|(application\\/(xml|xhtml\\+xml))$",r.IMAGE="^image\\/.+"})(ml||(ml={}));var bb=function(){function r(){}return r.parseDocumentResponse=function(e,t){return typeof DOMParser<"u"?new Promise(function(n,i){e.text().then(function(o){try{var s=new DOMParser,a=s.parseFromString(o,t);n(a)}catch(c){i(c)}})}):Promise.resolve(e.body)},r.convertResponse=function(e,t){return hl.__awaiter(this,void 0,void 0,function(){var n,i,o,s;return hl.__generator(this,function(a){switch(a.label){case 0:if(e.status===204)return[2,Promise.resolve()];switch(i=e.headers.get("Content-type"),o=t,o){case Hn.ResponseType.ARRAYBUFFER:return[3,1];case Hn.ResponseType.BLOB:return[3,3];case Hn.ResponseType.DOCUMENT:return[3,5];case Hn.ResponseType.JSON:return[3,7];case Hn.ResponseType.STREAM:return[3,9];case Hn.ResponseType.TEXT:return[3,11]}return[3,13];case 1:return[4,e.arrayBuffer()];case 2:return n=a.sent(),[3,24];case 3:return[4,e.blob()];case 4:return n=a.sent(),[3,24];case 5:return[4,r.parseDocumentResponse(e,Cf.TEXT_XML)];case 6:return n=a.sent(),[3,24];case 7:return[4,e.json()];case 8:return n=a.sent(),[3,24];case 9:return[4,Promise.resolve(e.body)];case 10:return n=a.sent(),[3,24];case 11:return[4,e.text()];case 12:return n=a.sent(),[3,24];case 13:return i===null?[3,22]:(s=i.split(";")[0],new RegExp(ml.DOCUMENT).test(s)?[4,r.parseDocumentResponse(e,s)]:[3,15]);case 14:return n=a.sent(),[3,21];case 15:return new RegExp(ml.IMAGE).test(s)?(n=e.blob(),[3,21]):[3,16];case 16:return s!==pl.TEXT_PLAIN?[3,18]:[4,e.text()];case 17:return n=a.sent(),[3,21];case 18:return s!==pl.APPLICATION_JSON?[3,20]:[4,e.json()];case 19:return n=a.sent(),[3,21];case 20:n=Promise.resolve(e.body),a.label=21;case 21:return[3,23];case 22:n=Promise.resolve(e.body),a.label=23;case 23:return[3,24];case 24:return[2,n]}})})},r.getResponse=function(e,t,n){return hl.__awaiter(this,void 0,void 0,function(){var i;return hl.__generator(this,function(o){switch(o.label){case 0:return t!==Hn.ResponseType.RAW?[3,1]:[2,Promise.resolve(e)];case 1:return[4,r.convertResponse(e,t)];case 2:if(i=o.sent(),e.ok)if(typeof n=="function")n(null,i);else return[2,i];else throw i;o.label=3;case 3:return[2]}})})},r}();io.GraphResponseHandler=bb});var Af=T(gl=>{"use strict";Object.defineProperty(gl,"__esModule",{value:!0});gl.Range=void 0;var Ob=function(){function r(e,t){e===void 0&&(e=-1),t===void 0&&(t=-1),this.minValue=e,this.maxValue=t}return r}();gl.Range=Ob});var Sf=T(yl=>{"use strict";Object.defineProperty(yl,"__esModule",{value:!0});yl.UploadResult=void 0;var kb=function(){function r(e,t){this._location=t,this._responseBody=e}return Object.defineProperty(r.prototype,"location",{get:function(){return this._location},set:function(e){this._location=e},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"responseBody",{get:function(){return this._responseBody},set:function(e){this._responseBody=e},enumerable:!1,configurable:!0}),r.CreateUploadResult=function(e,t){return new r(e,t.get("location"))},r}();yl.UploadResult=kb});var Rf=T(Tl=>{"use strict";Object.defineProperty(Tl,"__esModule",{value:!0});Tl.LargeFileUploadTask=void 0;var st=(ge(),_e(Ee)),wf=Rr(),xb=_f(),dE=fs(),El=Af(),Pb=Sf(),Nb=function(){function r(e,t,n,i){if(i===void 0&&(i={}),this.DEFAULT_FILE_SIZE=5*1024*1024,this.client=e,t.sliceFile)this.file=t;else throw new wf.GraphClientError("Please pass the FileUpload object, StreamUpload object or any custom implementation of the FileObject interface");this.file=t,i.rangeSize||(i.rangeSize=this.DEFAULT_FILE_SIZE),this.options=i,this.uploadSession=n,this.nextRange=new El.Range(0,this.options.rangeSize-1)}return r.createUploadSession=function(e,t,n,i){return i===void 0&&(i={}),st.__awaiter(this,void 0,void 0,function(){var o,s;return st.__generator(this,function(a){switch(a.label){case 0:return[4,e.api(t).headers(i).post(n)];case 1:return o=a.sent(),s={url:o.uploadUrl,expiry:new Date(o.expirationDateTime),isCancelled:!1},[2,s]}})})},r.prototype.parseRange=function(e){var t=e[0];if(typeof t>"u"||t==="")return new El.Range;var n=t.split("-"),i=parseInt(n[0],10),o=parseInt(n[1],10);return Number.isNaN(o)&&(o=this.file.size-1),new El.Range(i,o)},r.prototype.updateTaskStatus=function(e){this.uploadSession.expiry=new Date(e.expirationDateTime),this.nextRange=this.parseRange(e.nextExpectedRanges)},r.prototype.getNextRange=function(){if(this.nextRange.minValue===-1)return this.nextRange;var e=this.nextRange.minValue,t=e+this.options.rangeSize-1;return t>=this.file.size&&(t=this.file.size-1),new El.Range(e,t)},r.prototype.sliceFile=function(e){if(console.warn("The LargeFileUploadTask.sliceFile() function has been deprecated and moved into the FileObject interface."),this.file.content instanceof ArrayBuffer||this.file.content instanceof Blob||this.file.content instanceof Uint8Array)return this.file.content.slice(e.minValue,e.maxValue+1);throw new wf.GraphClientError("The LargeFileUploadTask.sliceFile() function expects only Blob, ArrayBuffer or Uint8Array file content. Please note that the sliceFile() function is deprecated.")},r.prototype.upload=function(){return st.__awaiter(this,void 0,void 0,function(){var e,t,n,i,o,s,a;return st.__generator(this,function(c){switch(c.label){case 0:e=this.options&&this.options.uploadEventHandlers,c.label=1;case 1:if(this.uploadSession.isCancelled)return[3,5];if(t=this.getNextRange(),t.maxValue===-1)throw n=new Error("Task with which you are trying to upload is already completed, Please check for your uploaded file"),n.name="Invalid Session",n;return[4,this.file.sliceFile(t)];case 2:return i=c.sent(),[4,this.uploadSliceGetRawResponse(i,t,this.file.size)];case 3:if(o=c.sent(),!o)throw new wf.GraphClientError("Something went wrong! Large file upload slice response is null.");return[4,xb.GraphResponseHandler.getResponse(o)];case 4:return s=c.sent(),o.status===201||o.status===200&&s.id?(this.reportProgress(e,t),[2,Pb.UploadResult.CreateUploadResult(s,o.headers)]):(a={expirationDateTime:s.expirationDateTime||s.ExpirationDateTime,nextExpectedRanges:s.NextExpectedRanges||s.nextExpectedRanges},this.updateTaskStatus(a),this.reportProgress(e,t),[3,1]);case 5:return[2]}})})},r.prototype.reportProgress=function(e,t){e&&e.progress&&e.progress(t,e.extraCallbackParam)},r.prototype.uploadSlice=function(e,t,n){return st.__awaiter(this,void 0,void 0,function(){return st.__generator(this,function(i){switch(i.label){case 0:return[4,this.client.api(this.uploadSession.url).headers({"Content-Length":"".concat(t.maxValue-t.minValue+1),"Content-Range":"bytes ".concat(t.minValue,"-").concat(t.maxValue,"/").concat(n),"Content-Type":"application/octet-stream"}).put(e)];case 1:return[2,i.sent()]}})})},r.prototype.uploadSliceGetRawResponse=function(e,t,n){return st.__awaiter(this,void 0,void 0,function(){return st.__generator(this,function(i){switch(i.label){case 0:return[4,this.client.api(this.uploadSession.url).headers({"Content-Length":"".concat(t.maxValue-t.minValue+1),"Content-Range":"bytes ".concat(t.minValue,"-").concat(t.maxValue,"/").concat(n),"Content-Type":"application/octet-stream"}).responseType(dE.ResponseType.RAW).put(e)];case 1:return[2,i.sent()]}})})},r.prototype.cancel=function(){return st.__awaiter(this,void 0,void 0,function(){var e;return st.__generator(this,function(t){switch(t.label){case 0:return[4,this.client.api(this.uploadSession.url).responseType(dE.ResponseType.RAW).delete()];case 1:return e=t.sent(),e.status===204&&(this.uploadSession.isCancelled=!0),[2,e]}})})},r.prototype.getStatus=function(){return st.__awaiter(this,void 0,void 0,function(){var e;return st.__generator(this,function(t){switch(t.label){case 0:return[4,this.client.api(this.uploadSession.url).get()];case 1:return e=t.sent(),this.updateTaskStatus(e),[2,e]}})})},r.prototype.resume=function(){return st.__awaiter(this,void 0,void 0,function(){return st.__generator(this,function(e){switch(e.label){case 0:return[4,this.getStatus()];case 1:return e.sent(),[4,this.upload()];case 2:return[2,e.sent()]}})})},r.prototype.getUploadSession=function(){return this.uploadSession},r}();Tl.LargeFileUploadTask=Nb});var If=T(vl=>{"use strict";Object.defineProperty(vl,"__esModule",{value:!0});vl.FileUpload=void 0;var Mb=Rr(),Db=function(){function r(e,t,n){if(this.content=e,this.name=t,this.size=n,!e||!t||!n)throw new Mb.GraphClientError("Please provide the upload content, name of the file and size of the file")}return r.prototype.sliceFile=function(e){return this.content.slice(e.minValue,e.maxValue+1)},r}();vl.FileUpload=Db});var bf=T(Cl=>{"use strict";Object.defineProperty(Cl,"__esModule",{value:!0});Cl.getValidRangeSize=void 0;var Lb=5*1024*1024,Ub=function(r){return r>320*1024&&(r=Math.floor(r/(320*1024))*320*1024),r},Hb=function(r){r===void 0&&(r=Lb);var e=60*1024*1024;return r>e&&(r=e),Ub(r)};Cl.getValidRangeSize=Hb});var hE=T(_l=>{"use strict";Object.defineProperty(_l,"__esModule",{value:!0});_l.OneDriveLargeFileUploadTask=void 0;var Ir=(ge(),_e(Ee)),fE=Rr(),Fb=If(),$b=Rf(),qb=bf(),jb=function(r){Ir.__extends(e,r);function e(t,n,i,o){return r.call(this,t,n,i,o)||this}return e.constructCreateSessionUrl=function(t,n){return n===void 0&&(n=e.DEFAULT_UPLOAD_PATH),t=t.trim(),n=n.trim(),n===""&&(n="/"),n[0]!=="/"&&(n="/".concat(n)),n[n.length-1]!=="/"&&(n="".concat(n,"/")),"/me/drive/root:".concat(n.split("/").map(function(i){return encodeURIComponent(i)}).join("/")).concat(encodeURIComponent(t),":/createUploadSession")},e.getFileInfo=function(t,n){var i,o;if(typeof Blob<"u"&&t instanceof Blob)i=new File([t],n),o=i.size;else if(typeof File<"u"&&t instanceof File)i=t,o=i.size;else if(typeof Uint8Array<"u"&&t instanceof Uint8Array){var s=t;o=s.byteLength,i=s.buffer.slice(s.byteOffset,s.byteOffset+s.byteLength)}return{content:i,size:o}},e.create=function(t,n,i){return Ir.__awaiter(this,void 0,void 0,function(){var o,s,a;return Ir.__generator(this,function(c){if(!t||!n||!i)throw new fE.GraphClientError("Please provide the Graph client instance, file object and OneDriveLargeFileUploadOptions value");return o=i.fileName,s=e.getFileInfo(n,o),a=new Fb.FileUpload(s.content,o,s.size),[2,this.createTaskWithFileObject(t,a,i)]})})},e.createTaskWithFileObject=function(t,n,i){return Ir.__awaiter(this,void 0,void 0,function(){var o,s,a,c;return Ir.__generator(this,function(l){switch(l.label){case 0:if(!t||!n||!i)throw new fE.GraphClientError("Please provide the Graph client instance, FileObject interface implementation and OneDriveLargeFileUploadOptions value");return o=i.uploadSessionURL?i.uploadSessionURL:e.constructCreateSessionUrl(i.fileName,i.path),s={fileName:i.fileName,fileDescription:i.fileDescription,conflictBehavior:i.conflictBehavior},[4,e.createUploadSession(t,o,s)];case 1:return a=l.sent(),c=(0,qb.getValidRangeSize)(i.rangeSize),[2,new e(t,n,a,{rangeSize:c,uploadEventHandlers:i.uploadEventHandlers})]}})})},e.createUploadSession=function(t,n,i){return Ir.__awaiter(this,void 0,void 0,function(){var o;return Ir.__generator(this,function(s){return o={item:{"@microsoft.graph.conflictBehavior":i?.conflictBehavior||"rename",name:i?.fileName,description:i?.fileDescription}},[2,r.createUploadSession.call(this,t,n,o)]})})},e.prototype.commit=function(t,n){return n===void 0&&(n="rename"),Ir.__awaiter(this,void 0,void 0,function(){var i;return Ir.__generator(this,function(o){switch(o.label){case 0:return i={name:this.file.name,"@microsoft.graph.conflictBehavior":n,"@microsoft.graph.sourceUrl":this.uploadSession.url},[4,this.client.api(t).put(i)];case 1:return[2,o.sent()]}})})},e.DEFAULT_UPLOAD_PATH="/",e}($b.LargeFileUploadTask);_l.OneDriveLargeFileUploadTask=jb});var mE=T(Al=>{"use strict";Object.defineProperty(Al,"__esModule",{value:!0});Al.StreamUpload=void 0;var pE=(ge(),_e(Ee)),hs=Rr(),Bb=function(){function r(e,t,n){if(this.content=e,this.name=t,this.size=n,!e||!t||!n)throw new hs.GraphClientError("Please provide the Readable Stream content, name of the file and size of the file")}return r.prototype.sliceFile=function(e){return pE.__awaiter(this,void 0,void 0,function(){var t,n,i,o,s,a,c;return pE.__generator(this,function(l){switch(l.label){case 0:if(t=e.maxValue-e.minValue+1,n=[],this.previousSlice){if(e.minValue<this.previousSlice.range.minValue)throw new hs.GraphClientError("An error occurred while uploading the stream. Please restart the stream upload from the first byte of the file.");if(e.minValue<this.previousSlice.range.maxValue){if(i=this.previousSlice.range.minValue,o=this.previousSlice.range.maxValue,e.minValue===i&&e.maxValue===o)return[2,this.previousSlice.fileSlice];if(e.maxValue===o)return[2,this.previousSlice.fileSlice.slice(e.minValue,e.maxValue+1)];n.push(this.previousSlice.fileSlice.slice(e.minValue,o+1)),t=e.maxValue-o}}return this.content&&this.content.readable?this.content.readableLength>=t?(n.push(this.content.read(t)),[3,3]):[3,1]:[3,4];case 1:return a=(s=n).push,[4,this.readNBytesFromStream(t)];case 2:a.apply(s,[l.sent()]),l.label=3;case 3:return[3,5];case 4:throw new hs.GraphClientError("Stream is not readable.");case 5:return c=Buffer.concat(n),this.previousSlice={fileSlice:c,range:e},[2,c]}})})},r.prototype.readNBytesFromStream=function(e){var t=this;return new Promise(function(n,i){var o=[],s=e,a=0;t.content.on("end",function(){if(s>0)return i(new hs.GraphClientError("Stream ended before reading required range size"))}),t.content.on("readable",function(){for(var c;a<e&&(c=t.content.read(s))!==null;)a+=c.length,o.push(c),s>0&&(s=e-a);if(a===e)return n(Buffer.concat(o));if(!t.content||!t.content.readable)return i(new hs.GraphClientError("Error encountered while reading the stream during the upload"))})})},r}();Al.StreamUpload=Bb});var gE=T(Sl=>{"use strict";Object.defineProperty(Sl,"__esModule",{value:!0});Sl.PageIterator=void 0;var oo=(ge(),_e(Ee)),zb=function(){function r(e,t,n,i){this.client=e,this.collection=t.value,this.nextLink=t["@odata.nextLink"],this.deltaLink=t["@odata.deltaLink"],this.callback=n,this.cursor=0,this.complete=!1,this.requestOptions=i}return r.prototype.iterationHelper=function(){if(this.collection===void 0)return!1;for(var e=!0;e&&this.cursor<this.collection.length;){var t=this.collection[this.cursor];e=this.callback(t),this.cursor++}return e},r.prototype.fetchAndUpdateNextPageData=function(){return oo.__awaiter(this,void 0,void 0,function(){var e,t;return oo.__generator(this,function(n){switch(n.label){case 0:return e=this.client.api(this.nextLink),this.requestOptions&&(this.requestOptions.headers&&(e=e.headers(this.requestOptions.headers)),this.requestOptions.middlewareOptions&&(e=e.middlewareOptions(this.requestOptions.middlewareOptions)),this.requestOptions.options&&(e=e.options(this.requestOptions.options))),[4,e.get()];case 1:return t=n.sent(),this.collection=t.value,this.cursor=0,this.nextLink=t["@odata.nextLink"],this.deltaLink=t["@odata.deltaLink"],[2]}})})},r.prototype.getDeltaLink=function(){return this.deltaLink},r.prototype.iterate=function(){return oo.__awaiter(this,void 0,void 0,function(){var e;return oo.__generator(this,function(t){switch(t.label){case 0:e=this.iterationHelper(),t.label=1;case 1:return e?this.nextLink===void 0?[3,3]:[4,this.fetchAndUpdateNextPageData()]:[3,5];case 2:return t.sent(),e=this.iterationHelper(),[3,4];case 3:e=!1,t.label=4;case 4:return[3,1];case 5:return this.nextLink===void 0&&this.cursor>=this.collection.length&&(this.complete=!0),[2]}})})},r.prototype.resume=function(){return oo.__awaiter(this,void 0,void 0,function(){return oo.__generator(this,function(e){return[2,this.iterate()]})})},r.prototype.isComplete=function(){return this.complete},r}();Sl.PageIterator=zb});var Of=T(Rl=>{"use strict";Object.defineProperty(Rl,"__esModule",{value:!0});Rl.CustomAuthenticationProvider=void 0;var wl=(ge(),_e(Ee)),yE=Rr(),Gb=function(){function r(e){this.provider=e}return r.prototype.getAccessToken=function(){return wl.__awaiter(this,void 0,void 0,function(){var e=this;return wl.__generator(this,function(t){return[2,new Promise(function(n,i){e.provider(function(o,s){return wl.__awaiter(e,void 0,void 0,function(){var a,c;return wl.__generator(this,function(l){switch(l.label){case 0:return s?(n(s),[3,3]):[3,1];case 1:return o||(a="Access token is undefined or empty.						Please provide a valid token.						For more help - https://github.com/microsoftgraph/msgraph-sdk-javascript/blob/dev/docs/CustomAuthenticationProvider.md",o=new yE.GraphClientError(a)),[4,yE.GraphClientError.setGraphClientError(o)];case 2:c=l.sent(),i(c),l.label=3;case 3:return[2]}})})})})]})})},r}();Rl.CustomAuthenticationProvider=Gb});var kf=T(Il=>{"use strict";Object.defineProperty(Il,"__esModule",{value:!0});Il.GraphError=void 0;var Vb=(ge(),_e(Ee)),Kb=function(r){Vb.__extends(e,r);function e(t,n,i){t===void 0&&(t=-1);var o=r.call(this,n||i&&i.message)||this;return Object.setPrototypeOf(o,e.prototype),o.statusCode=t,o.code=null,o.requestId=null,o.date=new Date,o.body=null,o.stack=i?i.stack:o.stack,o}return e}(Error);Il.GraphError=Kb});var TE=T(bl=>{"use strict";Object.defineProperty(bl,"__esModule",{value:!0});bl.GraphErrorHandler=void 0;var EE=(ge(),_e(Ee)),xf=kf(),Yb=function(){function r(){}return r.constructError=function(e,t,n){var i=new xf.GraphError(t,"",e);return e.name!==void 0&&(i.code=e.name),i.body=e.toString(),i.date=new Date,i.headers=n?.headers,i},r.constructErrorFromResponse=function(e,t,n){var i=e.error,o=new xf.GraphError(t,i.message);return o.code=i.code,i.innerError!==void 0&&(o.requestId=i.innerError["request-id"],o.date=new Date(i.innerError.date)),o.body=JSON.stringify(i),o.headers=n?.headers,o},r.getError=function(e,t,n,i){return e===void 0&&(e=null),t===void 0&&(t=-1),EE.__awaiter(this,void 0,void 0,function(){var o;return EE.__generator(this,function(s){if(e&&e.error?o=r.constructErrorFromResponse(e,t,i):e instanceof Error?o=r.constructError(e,t,i):(o=new xf.GraphError(t),o.body=e),typeof n=="function")n(o,null);else return[2,o];return[2]})})},r}();bl.GraphErrorHandler=Yb});var Pf=T(Ol=>{"use strict";Object.defineProperty(Ol,"__esModule",{value:!0});Ol.GraphRequest=void 0;var fe=(ge(),_e(Ee)),Wb=Rr(),Zb=TE(),ps=Bc(),Xb=_f(),Qb=Xr(),Fn=ls(),Jb=fs(),eO=function(){function r(e,t,n){var i=this;this.parsePath=function(o){if(o.indexOf("https://")!==-1){o=o.replace("https://","");var s=o.indexOf("/");s!==-1&&(i.urlComponents.host="https://"+o.substring(0,s),o=o.substring(s+1,o.length));var a=o.indexOf("/");a!==-1&&(i.urlComponents.version=o.substring(0,a),o=o.substring(a+1,o.length))}o.charAt(0)==="/"&&(o=o.substr(1));var c=o.indexOf("?");if(c===-1)i.urlComponents.path=o;else{i.urlComponents.path=o.substr(0,c);for(var l=o.substring(c+1,o.length).split("&"),u=0,d=l;u<d.length;u++){var h=d[u];i.parseQueryParameter(h)}}},this.httpClient=e,this.config=t,this.urlComponents={host:this.config.baseUrl,version:this.config.defaultVersion,oDataQueryParams:{},otherURLQueryParams:{},otherURLQueryOptions:[]},this._headers={},this._options={},this._middlewareOptions=[],this.parsePath(n)}return r.prototype.addCsvQueryParameter=function(e,t,n){this.urlComponents.oDataQueryParams[e]=this.urlComponents.oDataQueryParams[e]?this.urlComponents.oDataQueryParams[e]+",":"";var i=[];n.length>1&&typeof t=="string"?i=Array.prototype.slice.call(n):typeof t=="string"?i.push(t):i=i.concat(t),this.urlComponents.oDataQueryParams[e]+=i.join(",")},r.prototype.buildFullUrl=function(){var e=(0,ps.urlJoin)([this.urlComponents.host,this.urlComponents.version,this.urlComponents.path])+this.createQueryString();return this.config.debugLogging&&console.log(e),e},r.prototype.createQueryString=function(){var e=this.urlComponents,t=[];if(Object.keys(e.oDataQueryParams).length!==0)for(var n in e.oDataQueryParams)Object.prototype.hasOwnProperty.call(e.oDataQueryParams,n)&&t.push(n+"="+e.oDataQueryParams[n]);if(Object.keys(e.otherURLQueryParams).length!==0)for(var n in e.otherURLQueryParams)Object.prototype.hasOwnProperty.call(e.otherURLQueryParams,n)&&t.push(n+"="+e.otherURLQueryParams[n]);if(e.otherURLQueryOptions.length!==0)for(var i=0,o=e.otherURLQueryOptions;i<o.length;i++){var s=o[i];t.push(s)}return t.length>0?"?"+t.join("&"):""},r.prototype.parseQueryParameter=function(e){if(typeof e=="string")if(e.charAt(0)==="?"&&(e=e.substring(1)),e.indexOf("&")!==-1)for(var t=e.split("&"),n=0,i=t;n<i.length;n++){var o=i[n];this.parseQueryParamenterString(o)}else this.parseQueryParamenterString(e);else if(e.constructor===Object)for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&this.setURLComponentsQueryParamater(s,e[s]);return this},r.prototype.parseQueryParamenterString=function(e){if(this.isValidQueryKeyValuePair(e)){var t=e.indexOf("="),n=e.substring(0,t),i=e.substring(t+1);this.setURLComponentsQueryParamater(n,i)}else this.urlComponents.otherURLQueryOptions.push(e)},r.prototype.setURLComponentsQueryParamater=function(e,t){if(ps.oDataQueryNames.indexOf(e)!==-1){var n=this.urlComponents.oDataQueryParams[e],i=n&&(e==="$expand"||e==="$select"||e==="$orderby");this.urlComponents.oDataQueryParams[e]=i?n+","+t:t}else this.urlComponents.otherURLQueryParams[e]=t},r.prototype.isValidQueryKeyValuePair=function(e){var t=e.indexOf("=");if(t===-1)return!1;var n=e.indexOf("(");return!(n!==-1&&e.indexOf("(")<t)},r.prototype.updateRequestOptions=function(e){var t=fe.__assign({},e.headers);if(this.config.fetchOptions!==void 0){var n=fe.__assign({},this.config.fetchOptions);Object.assign(e,n),typeof this.config.fetchOptions.headers!==void 0&&(e.headers=fe.__assign({},this.config.fetchOptions.headers))}Object.assign(e,this._options),e.headers!==void 0&&Object.assign(t,e.headers),Object.assign(t,this._headers),e.headers=t},r.prototype.send=function(e,t,n){var i;return fe.__awaiter(this,void 0,void 0,function(){var o,s,a,c,l,u,d,h;return fe.__generator(this,function(p){switch(p.label){case 0:s=new Qb.MiddlewareControl(this._middlewareOptions),this.updateRequestOptions(t),a=(i=this.config)===null||i===void 0?void 0:i.customHosts,p.label=1;case 1:return p.trys.push([1,4,,6]),[4,this.httpClient.sendRequest({request:e,options:t,middlewareControl:s,customHosts:a})];case 2:return c=p.sent(),o=c.response,[4,Xb.GraphResponseHandler.getResponse(o,this._responseType,n)];case 3:return l=p.sent(),[2,l];case 4:if(u=p.sent(),u instanceof Wb.GraphClientError)throw u;return d=void 0,o&&(d=o.status),[4,Zb.GraphErrorHandler.getError(u,d,n,o)];case 5:throw h=p.sent(),h;case 6:return[2]}})})},r.prototype.setHeaderContentType=function(){if(!this._headers){this.header("Content-Type","application/json");return}for(var e=Object.keys(this._headers),t=0,n=e;t<n.length;t++){var i=n[t];if(i.toLowerCase()==="content-type")return}this.header("Content-Type","application/json")},r.prototype.header=function(e,t){return this._headers[e]=t,this},r.prototype.headers=function(e){for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(this._headers[t]=e[t]);return this},r.prototype.option=function(e,t){return this._options[e]=t,this},r.prototype.options=function(e){for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(this._options[t]=e[t]);return this},r.prototype.middlewareOptions=function(e){return this._middlewareOptions=e,this},r.prototype.version=function(e){return this.urlComponents.version=e,this},r.prototype.responseType=function(e){return this._responseType=e,this},r.prototype.select=function(e){return this.addCsvQueryParameter("$select",e,arguments),this},r.prototype.expand=function(e){return this.addCsvQueryParameter("$expand",e,arguments),this},r.prototype.orderby=function(e){return this.addCsvQueryParameter("$orderby",e,arguments),this},r.prototype.filter=function(e){return this.urlComponents.oDataQueryParams.$filter=e,this},r.prototype.search=function(e){return this.urlComponents.oDataQueryParams.$search=e,this},r.prototype.top=function(e){return this.urlComponents.oDataQueryParams.$top=e,this},r.prototype.skip=function(e){return this.urlComponents.oDataQueryParams.$skip=e,this},r.prototype.skipToken=function(e){return this.urlComponents.oDataQueryParams.$skipToken=e,this},r.prototype.count=function(e){return e===void 0&&(e=!0),this.urlComponents.oDataQueryParams.$count=e.toString(),this},r.prototype.query=function(e){return this.parseQueryParameter(e)},r.prototype.get=function(e){return fe.__awaiter(this,void 0,void 0,function(){var t,n,i;return fe.__generator(this,function(o){switch(o.label){case 0:return t=this.buildFullUrl(),n={method:Fn.RequestMethod.GET},[4,this.send(t,n,e)];case 1:return i=o.sent(),[2,i]}})})},r.prototype.post=function(e,t){return fe.__awaiter(this,void 0,void 0,function(){var n,i,o;return fe.__generator(this,function(s){switch(s.label){case 0:return n=this.buildFullUrl(),i={method:Fn.RequestMethod.POST,body:(0,ps.serializeContent)(e)},o=e&&e.constructor&&e.constructor.name,o==="FormData"?i.headers={}:(this.setHeaderContentType(),i.headers=this._headers),[4,this.send(n,i,t)];case 1:return[2,s.sent()]}})})},r.prototype.create=function(e,t){return fe.__awaiter(this,void 0,void 0,function(){return fe.__generator(this,function(n){switch(n.label){case 0:return[4,this.post(e,t)];case 1:return[2,n.sent()]}})})},r.prototype.put=function(e,t){return fe.__awaiter(this,void 0,void 0,function(){var n,i;return fe.__generator(this,function(o){switch(o.label){case 0:return n=this.buildFullUrl(),this.setHeaderContentType(),i={method:Fn.RequestMethod.PUT,body:(0,ps.serializeContent)(e)},[4,this.send(n,i,t)];case 1:return[2,o.sent()]}})})},r.prototype.patch=function(e,t){return fe.__awaiter(this,void 0,void 0,function(){var n,i;return fe.__generator(this,function(o){switch(o.label){case 0:return n=this.buildFullUrl(),this.setHeaderContentType(),i={method:Fn.RequestMethod.PATCH,body:(0,ps.serializeContent)(e)},[4,this.send(n,i,t)];case 1:return[2,o.sent()]}})})},r.prototype.update=function(e,t){return fe.__awaiter(this,void 0,void 0,function(){return fe.__generator(this,function(n){switch(n.label){case 0:return[4,this.patch(e,t)];case 1:return[2,n.sent()]}})})},r.prototype.delete=function(e){return fe.__awaiter(this,void 0,void 0,function(){var t,n;return fe.__generator(this,function(i){switch(i.label){case 0:return t=this.buildFullUrl(),n={method:Fn.RequestMethod.DELETE},[4,this.send(t,n,e)];case 1:return[2,i.sent()]}})})},r.prototype.del=function(e){return fe.__awaiter(this,void 0,void 0,function(){return fe.__generator(this,function(t){switch(t.label){case 0:return[4,this.delete(e)];case 1:return[2,t.sent()]}})})},r.prototype.getStream=function(e){return fe.__awaiter(this,void 0,void 0,function(){var t,n;return fe.__generator(this,function(i){switch(i.label){case 0:return t=this.buildFullUrl(),n={method:Fn.RequestMethod.GET},this.responseType(Jb.ResponseType.STREAM),[4,this.send(t,n,e)];case 1:return[2,i.sent()]}})})},r.prototype.putStream=function(e,t){return fe.__awaiter(this,void 0,void 0,function(){var n,i;return fe.__generator(this,function(o){switch(o.label){case 0:return n=this.buildFullUrl(),i={method:Fn.RequestMethod.PUT,headers:{"Content-Type":"application/octet-stream"},body:e},[4,this.send(n,i,t)];case 1:return[2,o.sent()]}})})},r}();Ol.GraphRequest=eO});var Nf=T(kl=>{"use strict";Object.defineProperty(kl,"__esModule",{value:!0});kl.HTTPClient=void 0;var vE=(ge(),_e(Ee)),tO=function(){function r(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if(!e||!e.length){var n=new Error;throw n.name="InvalidMiddlewareChain",n.message="Please provide a default middleware chain or custom middleware chain",n}this.setMiddleware.apply(this,e)}return r.prototype.setMiddleware=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];e.length>1?this.parseMiddleWareArray(e):this.middleware=e[0]},r.prototype.parseMiddleWareArray=function(e){e.forEach(function(t,n){n<e.length-1&&t.setNext(e[n+1])}),this.middleware=e[0]},r.prototype.sendRequest=function(e){return vE.__awaiter(this,void 0,void 0,function(){var t;return vE.__generator(this,function(n){switch(n.label){case 0:if(typeof e.request=="string"&&e.options===void 0)throw t=new Error,t.name="InvalidRequestOptions",t.message="Unable to execute the middleware, Please provide valid options for a request",t;return[4,this.middleware.execute(e)];case 1:return n.sent(),[2,e]}})})},r}();kl.HTTPClient=tO});var _E=T(xl=>{"use strict";Object.defineProperty(xl,"__esModule",{value:!0});xl.HTTPClientFactory=void 0;var rO=(ge(),_e(Ee)),CE=Nf(),nO=Kc(),iO=Wc(),oO=ds(),sO=us(),aO=tl(),cO=Qc(),lO=ol(),uO=function(){return typeof process=="object"&&typeof ie=="function"},dO=function(){function r(){}return r.createWithAuthenticationProvider=function(e){var t=new nO.AuthenticationHandler(e),n=new cO.RetryHandler(new sO.RetryHandlerOptions),i=new lO.TelemetryHandler,o=new iO.HTTPMessageHandler;if(t.setNext(n),uO()){var s=new aO.RedirectHandler(new oO.RedirectHandlerOptions);n.setNext(s),s.setNext(i)}else n.setNext(i);return i.setNext(o),r.createWithMiddleware(t)},r.createWithMiddleware=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return new(CE.HTTPClient.bind.apply(CE.HTTPClient,rO.__spreadArray([void 0],e,!1)))},r}();xl.HTTPClientFactory=dO});var AE=T(Pl=>{"use strict";Object.defineProperty(Pl,"__esModule",{value:!0});Pl.validatePolyFilling=void 0;var fO=function(){if(typeof Promise>"u"&&typeof fetch>"u"){var r=new Error("Library cannot function without Promise and fetch. So, please provide polyfill for them.");throw r.name="PolyFillNotAvailable",r}else if(typeof Promise>"u"){var r=new Error("Library cannot function without Promise. So, please provide polyfill for it.");throw r.name="PolyFillNotAvailable",r}else if(typeof fetch>"u"){var r=new Error("Library cannot function without fetch. So, please provide polyfill for it.");throw r.name="PolyFillNotAvailable",r}return!0};Pl.validatePolyFilling=fO});var RE=T(Nl=>{"use strict";Object.defineProperty(Nl,"__esModule",{value:!0});Nl.Client=void 0;var hO=(ge(),_e(Ee)),SE=pf(),pO=Of(),mO=Pf(),wE=Nf(),gO=_E(),yO=AE(),EO=function(){function r(e){this.config={baseUrl:SE.GRAPH_BASE_URL,debugLogging:!1,defaultVersion:SE.GRAPH_API_VERSION},(0,yO.validatePolyFilling)();for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(this.config[t]=e[t]);var n;if(e.authProvider!==void 0&&e.middleware!==void 0){var i=new Error;throw i.name="AmbiguityInInitialization",i.message="Unable to Create Client, Please provide either authentication provider for default middleware chain or custom middleware chain not both",i}else if(e.authProvider!==void 0)n=gO.HTTPClientFactory.createWithAuthenticationProvider(e.authProvider);else if(e.middleware!==void 0)n=new(wE.HTTPClient.bind.apply(wE.HTTPClient,hO.__spreadArray([void 0],[].concat(e.middleware),!1)));else{var i=new Error;throw i.name="InvalidMiddlewareChain",i.message="Unable to Create Client, Please provide either authentication provider for default middleware chain or custom middleware chain",i}this.httpClient=n}return r.init=function(e){var t={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=n==="authProvider"?new pO.CustomAuthenticationProvider(e[n]):e[n]);return r.initWithMiddleware(t)},r.initWithMiddleware=function(e){return new r(e)},r.prototype.api=function(e){return new mO.GraphRequest(this.httpClient,this.config,e)},r}();Nl.Client=EO});var bE=T(N=>{"use strict";Object.defineProperty(N,"__esModule",{value:!0});N.ResponseType=N.GraphRequest=N.GraphClientError=N.GraphError=N.CustomAuthenticationProvider=N.Client=N.PageIterator=N.Range=N.UploadResult=N.FileUpload=N.StreamUpload=N.getValidRangeSize=N.OneDriveLargeFileUploadTask=N.LargeFileUploadTask=N.ChaosHandler=N.ChaosStrategy=N.ChaosHandlerOptions=N.TelemetryHandlerOptions=N.FeatureUsageFlag=N.RedirectHandlerOptions=N.RetryHandlerOptions=N.AuthenticationHandlerOptions=N.MiddlewareFactory=N.TelemetryHandler=N.RedirectHandler=N.RetryHandler=N.HTTPMessageHandler=N.AuthenticationHandler=N.BatchResponseContent=N.BatchRequestContent=void 0;var TO=jy();Object.defineProperty(N,"BatchRequestContent",{enumerable:!0,get:function(){return TO.BatchRequestContent}});var vO=By();Object.defineProperty(N,"BatchResponseContent",{enumerable:!0,get:function(){return vO.BatchResponseContent}});var CO=Kc();Object.defineProperty(N,"AuthenticationHandler",{enumerable:!0,get:function(){return CO.AuthenticationHandler}});var _O=Wc();Object.defineProperty(N,"HTTPMessageHandler",{enumerable:!0,get:function(){return _O.HTTPMessageHandler}});var AO=Qc();Object.defineProperty(N,"RetryHandler",{enumerable:!0,get:function(){return AO.RetryHandler}});var SO=tl();Object.defineProperty(N,"RedirectHandler",{enumerable:!0,get:function(){return SO.RedirectHandler}});var wO=ol();Object.defineProperty(N,"TelemetryHandler",{enumerable:!0,get:function(){return wO.TelemetryHandler}});var RO=iE();Object.defineProperty(N,"MiddlewareFactory",{enumerable:!0,get:function(){return RO.MiddlewareFactory}});var IO=mf();Object.defineProperty(N,"AuthenticationHandlerOptions",{enumerable:!0,get:function(){return IO.AuthenticationHandlerOptions}});var bO=us();Object.defineProperty(N,"RetryHandlerOptions",{enumerable:!0,get:function(){return bO.RetryHandlerOptions}});var OO=ds();Object.defineProperty(N,"RedirectHandlerOptions",{enumerable:!0,get:function(){return OO.RedirectHandlerOptions}});var IE=eo();Object.defineProperty(N,"FeatureUsageFlag",{enumerable:!0,get:function(){return IE.FeatureUsageFlag}});Object.defineProperty(N,"TelemetryHandlerOptions",{enumerable:!0,get:function(){return IE.TelemetryHandlerOptions}});var kO=Tf();Object.defineProperty(N,"ChaosHandlerOptions",{enumerable:!0,get:function(){return kO.ChaosHandlerOptions}});var xO=cl();Object.defineProperty(N,"ChaosStrategy",{enumerable:!0,get:function(){return xO.ChaosStrategy}});var PO=lE();Object.defineProperty(N,"ChaosHandler",{enumerable:!0,get:function(){return PO.ChaosHandler}});var NO=Rf();Object.defineProperty(N,"LargeFileUploadTask",{enumerable:!0,get:function(){return NO.LargeFileUploadTask}});var MO=hE();Object.defineProperty(N,"OneDriveLargeFileUploadTask",{enumerable:!0,get:function(){return MO.OneDriveLargeFileUploadTask}});var DO=bf();Object.defineProperty(N,"getValidRangeSize",{enumerable:!0,get:function(){return DO.getValidRangeSize}});var LO=mE();Object.defineProperty(N,"StreamUpload",{enumerable:!0,get:function(){return LO.StreamUpload}});var UO=If();Object.defineProperty(N,"FileUpload",{enumerable:!0,get:function(){return UO.FileUpload}});var HO=Sf();Object.defineProperty(N,"UploadResult",{enumerable:!0,get:function(){return HO.UploadResult}});var FO=Af();Object.defineProperty(N,"Range",{enumerable:!0,get:function(){return FO.Range}});var $O=gE();Object.defineProperty(N,"PageIterator",{enumerable:!0,get:function(){return $O.PageIterator}});var qO=RE();Object.defineProperty(N,"Client",{enumerable:!0,get:function(){return qO.Client}});var jO=Of();Object.defineProperty(N,"CustomAuthenticationProvider",{enumerable:!0,get:function(){return jO.CustomAuthenticationProvider}});var BO=kf();Object.defineProperty(N,"GraphError",{enumerable:!0,get:function(){return BO.GraphError}});var zO=Rr();Object.defineProperty(N,"GraphClientError",{enumerable:!0,get:function(){return zO.GraphClientError}});var GO=Pf();Object.defineProperty(N,"GraphRequest",{enumerable:!0,get:function(){return GO.GraphRequest}});var VO=fs();Object.defineProperty(N,"ResponseType",{enumerable:!0,get:function(){return VO.ResponseType}})});var ch=T((OG,ET)=>{var fo=1e3,ho=fo*60,po=ho*60,zn=po*24,F0=zn*7,$0=zn*365.25;ET.exports=function(r,e){e=e||{};var t=typeof r;if(t==="string"&&r.length>0)return q0(r);if(t==="number"&&isFinite(r))return e.long?B0(r):j0(r);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(r))};function q0(r){if(r=String(r),!(r.length>100)){var e=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(r);if(e){var t=parseFloat(e[1]),n=(e[2]||"ms").toLowerCase();switch(n){case"years":case"year":case"yrs":case"yr":case"y":return t*$0;case"weeks":case"week":case"w":return t*F0;case"days":case"day":case"d":return t*zn;case"hours":case"hour":case"hrs":case"hr":case"h":return t*po;case"minutes":case"minute":case"mins":case"min":case"m":return t*ho;case"seconds":case"second":case"secs":case"sec":case"s":return t*fo;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return t;default:return}}}}function j0(r){var e=Math.abs(r);return e>=zn?Math.round(r/zn)+"d":e>=po?Math.round(r/po)+"h":e>=ho?Math.round(r/ho)+"m":e>=fo?Math.round(r/fo)+"s":r+"ms"}function B0(r){var e=Math.abs(r);return e>=zn?Xl(r,e,zn,"day"):e>=po?Xl(r,e,po,"hour"):e>=ho?Xl(r,e,ho,"minute"):e>=fo?Xl(r,e,fo,"second"):r+" ms"}function Xl(r,e,t,n){var i=e>=t*1.5;return Math.round(r/t)+" "+n+(i?"s":"")}});var lh=T((kG,TT)=>{function z0(r){t.debug=t,t.default=t,t.coerce=c,t.disable=s,t.enable=i,t.enabled=a,t.humanize=ch(),t.destroy=l,Object.keys(r).forEach(u=>{t[u]=r[u]}),t.names=[],t.skips=[],t.formatters={};function e(u){let d=0;for(let h=0;h<u.length;h++)d=(d<<5)-d+u.charCodeAt(h),d|=0;return t.colors[Math.abs(d)%t.colors.length]}t.selectColor=e;function t(u){let d,h=null,p,m;function y(...A){if(!y.enabled)return;let P=y,D=Number(new Date),U=D-(d||D);P.diff=U,P.prev=d,P.curr=D,d=D,A[0]=t.coerce(A[0]),typeof A[0]!="string"&&A.unshift("%O");let H=0;A[0]=A[0].replace(/%([a-zA-Z%])/g,(b,S)=>{if(b==="%%")return"%";H++;let L=t.formatters[S];if(typeof L=="function"){let ee=A[H];b=L.call(P,ee),A.splice(H,1),H--}return b}),t.formatArgs.call(P,A),(P.log||t.log).apply(P,A)}return y.namespace=u,y.useColors=t.useColors(),y.color=t.selectColor(u),y.extend=n,y.destroy=t.destroy,Object.defineProperty(y,"enabled",{enumerable:!0,configurable:!1,get:()=>h!==null?h:(p!==t.namespaces&&(p=t.namespaces,m=t.enabled(u)),m),set:A=>{h=A}}),typeof t.init=="function"&&t.init(y),y}function n(u,d){let h=t(this.namespace+(typeof d>"u"?":":d)+u);return h.log=this.log,h}function i(u){t.save(u),t.namespaces=u,t.names=[],t.skips=[];let d=(typeof u=="string"?u:"").trim().replace(" ",",").split(",").filter(Boolean);for(let h of d)h[0]==="-"?t.skips.push(h.slice(1)):t.names.push(h)}function o(u,d){let h=0,p=0,m=-1,y=0;for(;h<u.length;)if(p<d.length&&(d[p]===u[h]||d[p]==="*"))d[p]==="*"?(m=p,y=h,p++):(h++,p++);else if(m!==-1)p=m+1,y++,h=y;else return!1;for(;p<d.length&&d[p]==="*";)p++;return p===d.length}function s(){let u=[...t.names,...t.skips.map(d=>"-"+d)].join(",");return t.enable(""),u}function a(u){for(let d of t.skips)if(o(u,d))return!1;for(let d of t.names)if(o(u,d))return!0;return!1}function c(u){return u instanceof Error?u.stack||u.message:u}function l(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return t.enable(t.load()),t}TT.exports=z0});var vT=T((wt,Ql)=>{wt.formatArgs=V0;wt.save=K0;wt.load=Y0;wt.useColors=G0;wt.storage=W0();wt.destroy=(()=>{let r=!1;return()=>{r||(r=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})();wt.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function G0(){if(typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs))return!0;if(typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;let r;return typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&(r=navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/))&&parseInt(r[1],10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function V0(r){if(r[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+r[0]+(this.useColors?"%c ":" ")+"+"+Ql.exports.humanize(this.diff),!this.useColors)return;let e="color: "+this.color;r.splice(1,0,e,"color: inherit");let t=0,n=0;r[0].replace(/%[a-zA-Z%]/g,i=>{i!=="%%"&&(t++,i==="%c"&&(n=t))}),r.splice(n,0,e)}wt.log=console.debug||console.log||(()=>{});function K0(r){try{r?wt.storage.setItem("debug",r):wt.storage.removeItem("debug")}catch{}}function Y0(){let r;try{r=wt.storage.getItem("debug")}catch{}return!r&&typeof process<"u"&&"env"in process&&(r=process.env.DEBUG),r}function W0(){try{return localStorage}catch{}}Ql.exports=lh()(wt);var{formatters:Z0}=Ql.exports;Z0.j=function(r){try{return JSON.stringify(r)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}});var _T=T((De,eu)=>{var X0=ie("tty"),Jl=ie("util");De.init=ik;De.log=tk;De.formatArgs=J0;De.save=rk;De.load=nk;De.useColors=Q0;De.destroy=Jl.deprecate(()=>{},"Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.");De.colors=[6,2,3,4,5,1];try{let r=ie("supports-color");r&&(r.stderr||r).level>=2&&(De.colors=[20,21,26,27,32,33,38,39,40,41,42,43,44,45,56,57,62,63,68,69,74,75,76,77,78,79,80,81,92,93,98,99,112,113,128,129,134,135,148,149,160,161,162,163,164,165,166,167,168,169,170,171,172,173,178,179,184,185,196,197,198,199,200,201,202,203,204,205,206,207,208,209,214,215,220,221])}catch{}De.inspectOpts=Object.keys(process.env).filter(r=>/^debug_/i.test(r)).reduce((r,e)=>{let t=e.substring(6).toLowerCase().replace(/_([a-z])/g,(i,o)=>o.toUpperCase()),n=process.env[e];return/^(yes|on|true|enabled)$/i.test(n)?n=!0:/^(no|off|false|disabled)$/i.test(n)?n=!1:n==="null"?n=null:n=Number(n),r[t]=n,r},{});function Q0(){return"colors"in De.inspectOpts?!!De.inspectOpts.colors:X0.isatty(process.stderr.fd)}function J0(r){let{namespace:e,useColors:t}=this;if(t){let n=this.color,i="\x1B[3"+(n<8?n:"8;5;"+n),o=`  ${i};1m${e} \x1B[0m`;r[0]=o+r[0].split(`
`).join(`
`+o),r.push(i+"m+"+eu.exports.humanize(this.diff)+"\x1B[0m")}else r[0]=ek()+e+" "+r[0]}function ek(){return De.inspectOpts.hideDate?"":new Date().toISOString()+" "}function tk(...r){return process.stderr.write(Jl.formatWithOptions(De.inspectOpts,...r)+`
`)}function rk(r){r?process.env.DEBUG=r:delete process.env.DEBUG}function nk(){return process.env.DEBUG}function ik(r){r.inspectOpts={};let e=Object.keys(De.inspectOpts);for(let t=0;t<e.length;t++)r.inspectOpts[e[t]]=De.inspectOpts[e[t]]}eu.exports=lh()(De);var{formatters:CT}=eu.exports;CT.o=function(r){return this.inspectOpts.colors=this.useColors,Jl.inspect(r,this.inspectOpts).split(`
`).map(e=>e.trim()).join(" ")};CT.O=function(r){return this.inspectOpts.colors=this.useColors,Jl.inspect(r,this.inspectOpts)}});var tu=T((xG,uh)=>{typeof process>"u"||process.type==="renderer"||process.browser===!0||process.__nwjs?uh.exports=vT():uh.exports=_T()});var wT=T(lt=>{"use strict";var ok=lt&&lt.__createBinding||(Object.create?function(r,e,t,n){n===void 0&&(n=t);var i=Object.getOwnPropertyDescriptor(e,t);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(r,n,i)}:function(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]}),sk=lt&&lt.__setModuleDefault||(Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e}),AT=lt&&lt.__importStar||function(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)t!=="default"&&Object.prototype.hasOwnProperty.call(r,t)&&ok(e,r,t);return sk(e,r),e};Object.defineProperty(lt,"__esModule",{value:!0});lt.req=lt.json=lt.toBuffer=void 0;var ak=AT(ie("http")),ck=AT(ie("https"));async function ST(r){let e=0,t=[];for await(let n of r)e+=n.length,t.push(n);return Buffer.concat(t,e)}lt.toBuffer=ST;async function lk(r){let t=(await ST(r)).toString("utf8");try{return JSON.parse(t)}catch(n){let i=n;throw i.message+=` (input: ${t})`,i}}lt.json=lk;function uk(r,e={}){let n=((typeof r=="string"?r:r.href).startsWith("https:")?ck:ak).request(r,e),i=new Promise((o,s)=>{n.once("response",o).once("error",s).end()});return n.then=i.then.bind(i),n}lt.req=uk});var fh=T(Rt=>{"use strict";var IT=Rt&&Rt.__createBinding||(Object.create?function(r,e,t,n){n===void 0&&(n=t);var i=Object.getOwnPropertyDescriptor(e,t);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(r,n,i)}:function(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]}),dk=Rt&&Rt.__setModuleDefault||(Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e}),bT=Rt&&Rt.__importStar||function(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)t!=="default"&&Object.prototype.hasOwnProperty.call(r,t)&&IT(e,r,t);return dk(e,r),e},fk=Rt&&Rt.__exportStar||function(r,e){for(var t in r)t!=="default"&&!Object.prototype.hasOwnProperty.call(e,t)&&IT(e,r,t)};Object.defineProperty(Rt,"__esModule",{value:!0});Rt.Agent=void 0;var hk=bT(ie("net")),RT=bT(ie("http")),pk=ie("https");fk(wT(),Rt);var cr=Symbol("AgentBaseInternalState"),dh=class extends RT.Agent{constructor(e){super(e),this[cr]={}}isSecureEndpoint(e){if(e){if(typeof e.secureEndpoint=="boolean")return e.secureEndpoint;if(typeof e.protocol=="string")return e.protocol==="https:"}let{stack:t}=new Error;return typeof t!="string"?!1:t.split(`
`).some(n=>n.indexOf("(https.js:")!==-1||n.indexOf("node:https:")!==-1)}incrementSockets(e){if(this.maxSockets===1/0&&this.maxTotalSockets===1/0)return null;this.sockets[e]||(this.sockets[e]=[]);let t=new hk.Socket({writable:!1});return this.sockets[e].push(t),this.totalSocketCount++,t}decrementSockets(e,t){if(!this.sockets[e]||t===null)return;let n=this.sockets[e],i=n.indexOf(t);i!==-1&&(n.splice(i,1),this.totalSocketCount--,n.length===0&&delete this.sockets[e])}getName(e){return(typeof e.secureEndpoint=="boolean"?e.secureEndpoint:this.isSecureEndpoint(e))?pk.Agent.prototype.getName.call(this,e):super.getName(e)}createSocket(e,t,n){let i={...t,secureEndpoint:this.isSecureEndpoint(t)},o=this.getName(i),s=this.incrementSockets(o);Promise.resolve().then(()=>this.connect(e,i)).then(a=>{if(this.decrementSockets(o,s),a instanceof RT.Agent)try{return a.addRequest(e,i)}catch(c){return n(c)}this[cr].currentSocket=a,super.createSocket(e,t,n)},a=>{this.decrementSockets(o,s),n(a)})}createConnection(){let e=this[cr].currentSocket;if(this[cr].currentSocket=void 0,!e)throw new Error("No socket was returned in the `connect()` function");return e}get defaultPort(){return this[cr].defaultPort??(this.protocol==="https:"?443:80)}set defaultPort(e){this[cr]&&(this[cr].defaultPort=e)}get protocol(){return this[cr].protocol??(this.isSecureEndpoint()?"https:":"http:")}set protocol(e){this[cr]&&(this[cr].protocol=e)}};Rt.Agent=dh});var OT=T(mo=>{"use strict";var mk=mo&&mo.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(mo,"__esModule",{value:!0});mo.parseProxyResponse=void 0;var gk=mk(tu()),ru=(0,gk.default)("https-proxy-agent:parse-proxy-response");function yk(r){return new Promise((e,t)=>{let n=0,i=[];function o(){let u=r.read();u?l(u):r.once("readable",o)}function s(){r.removeListener("end",a),r.removeListener("error",c),r.removeListener("readable",o)}function a(){s(),ru("onend"),t(new Error("Proxy connection ended before receiving CONNECT response"))}function c(u){s(),ru("onerror %o",u),t(u)}function l(u){i.push(u),n+=u.length;let d=Buffer.concat(i,n),h=d.indexOf(`\r
\r
`);if(h===-1){ru("have not received end of HTTP headers yet..."),o();return}let p=d.slice(0,h).toString("ascii").split(`\r
`),m=p.shift();if(!m)return r.destroy(),t(new Error("No header received from proxy CONNECT response"));let y=m.split(" "),A=+y[1],P=y.slice(2).join(" "),D={};for(let U of p){if(!U)continue;let H=U.indexOf(":");if(H===-1)return r.destroy(),t(new Error(`Invalid header from proxy CONNECT response: "${U}"`));let w=U.slice(0,H).toLowerCase(),b=U.slice(H+1).trimStart(),S=D[w];typeof S=="string"?D[w]=[S,b]:Array.isArray(S)?S.push(b):D[w]=b}ru("got proxy server response: %o %o",m,D),s(),e({connect:{statusCode:A,statusText:P,headers:D},buffered:d})}r.on("error",c),r.on("end",a),o()})}mo.parseProxyResponse=yk});var DT=T(Lt=>{"use strict";var Ek=Lt&&Lt.__createBinding||(Object.create?function(r,e,t,n){n===void 0&&(n=t);var i=Object.getOwnPropertyDescriptor(e,t);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(r,n,i)}:function(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]}),Tk=Lt&&Lt.__setModuleDefault||(Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e}),NT=Lt&&Lt.__importStar||function(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)t!=="default"&&Object.prototype.hasOwnProperty.call(r,t)&&Ek(e,r,t);return Tk(e,r),e},MT=Lt&&Lt.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(Lt,"__esModule",{value:!0});Lt.HttpsProxyAgent=void 0;var nu=NT(ie("net")),kT=NT(ie("tls")),vk=MT(ie("assert")),Ck=MT(tu()),_k=fh(),Ak=ie("url"),Sk=OT(),vs=(0,Ck.default)("https-proxy-agent"),xT=r=>r.servername===void 0&&r.host&&!nu.isIP(r.host)?{...r,servername:r.host}:r,iu=class extends _k.Agent{constructor(e,t){super(t),this.options={path:void 0},this.proxy=typeof e=="string"?new Ak.URL(e):e,this.proxyHeaders=t?.headers??{},vs("Creating new HttpsProxyAgent instance: %o",this.proxy.href);let n=(this.proxy.hostname||this.proxy.host).replace(/^\[|\]$/g,""),i=this.proxy.port?parseInt(this.proxy.port,10):this.proxy.protocol==="https:"?443:80;this.connectOpts={ALPNProtocols:["http/1.1"],...t?PT(t,"headers"):null,host:n,port:i}}async connect(e,t){let{proxy:n}=this;if(!t.host)throw new TypeError('No "host" provided');let i;n.protocol==="https:"?(vs("Creating `tls.Socket`: %o",this.connectOpts),i=kT.connect(xT(this.connectOpts))):(vs("Creating `net.Socket`: %o",this.connectOpts),i=nu.connect(this.connectOpts));let o=typeof this.proxyHeaders=="function"?this.proxyHeaders():{...this.proxyHeaders},s=nu.isIPv6(t.host)?`[${t.host}]`:t.host,a=`CONNECT ${s}:${t.port} HTTP/1.1\r
`;if(n.username||n.password){let h=`${decodeURIComponent(n.username)}:${decodeURIComponent(n.password)}`;o["Proxy-Authorization"]=`Basic ${Buffer.from(h).toString("base64")}`}o.Host=`${s}:${t.port}`,o["Proxy-Connection"]||(o["Proxy-Connection"]=this.keepAlive?"Keep-Alive":"close");for(let h of Object.keys(o))a+=`${h}: ${o[h]}\r
`;let c=(0,Sk.parseProxyResponse)(i);i.write(`${a}\r
`);let{connect:l,buffered:u}=await c;if(e.emit("proxyConnect",l),this.emit("proxyConnect",l,e),l.statusCode===200)return e.once("socket",wk),t.secureEndpoint?(vs("Upgrading socket connection to TLS"),kT.connect({...PT(xT(t),"host","path","port"),socket:i})):i;i.destroy();let d=new nu.Socket({writable:!1});return d.readable=!0,e.once("socket",h=>{vs("Replaying proxy buffer for failed request"),(0,vk.default)(h.listenerCount("data")>0),h.push(u),h.push(null)}),d}};iu.protocols=["http","https"];Lt.HttpsProxyAgent=iu;function wk(r){r.resume()}function PT(r,...e){let t={},n;for(n in r)e.includes(n)||(t[n]=r[n]);return t}});var HT=T(Ut=>{"use strict";var Rk=Ut&&Ut.__createBinding||(Object.create?function(r,e,t,n){n===void 0&&(n=t);var i=Object.getOwnPropertyDescriptor(e,t);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(r,n,i)}:function(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]}),Ik=Ut&&Ut.__setModuleDefault||(Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e}),UT=Ut&&Ut.__importStar||function(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)t!=="default"&&Object.prototype.hasOwnProperty.call(r,t)&&Rk(e,r,t);return Ik(e,r),e},bk=Ut&&Ut.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(Ut,"__esModule",{value:!0});Ut.HttpProxyAgent=void 0;var Ok=UT(ie("net")),kk=UT(ie("tls")),xk=bk(tu()),Pk=ie("events"),Nk=fh(),LT=ie("url"),go=(0,xk.default)("http-proxy-agent"),ou=class extends Nk.Agent{constructor(e,t){super(t),this.proxy=typeof e=="string"?new LT.URL(e):e,this.proxyHeaders=t?.headers??{},go("Creating new HttpProxyAgent instance: %o",this.proxy.href);let n=(this.proxy.hostname||this.proxy.host).replace(/^\[|\]$/g,""),i=this.proxy.port?parseInt(this.proxy.port,10):this.proxy.protocol==="https:"?443:80;this.connectOpts={...t?Mk(t,"headers"):null,host:n,port:i}}addRequest(e,t){e._header=null,this.setRequestProps(e,t),super.addRequest(e,t)}setRequestProps(e,t){let{proxy:n}=this,i=t.secureEndpoint?"https:":"http:",o=e.getHeader("host")||"localhost",s=`${i}//${o}`,a=new LT.URL(e.path,s);t.port!==80&&(a.port=String(t.port)),e.path=String(a);let c=typeof this.proxyHeaders=="function"?this.proxyHeaders():{...this.proxyHeaders};if(n.username||n.password){let l=`${decodeURIComponent(n.username)}:${decodeURIComponent(n.password)}`;c["Proxy-Authorization"]=`Basic ${Buffer.from(l).toString("base64")}`}c["Proxy-Connection"]||(c["Proxy-Connection"]=this.keepAlive?"Keep-Alive":"close");for(let l of Object.keys(c)){let u=c[l];u&&e.setHeader(l,u)}}async connect(e,t){e._header=null,e.path.includes("://")||this.setRequestProps(e,t);let n,i;go("Regenerating stored HTTP header string for request"),e._implicitHeader(),e.outputData&&e.outputData.length>0&&(go("Patching connection write() output buffer with updated header"),n=e.outputData[0].data,i=n.indexOf(`\r
\r
`)+4,e.outputData[0].data=e._header+n.substring(i),go("Output buffer: %o",e.outputData[0].data));let o;return this.proxy.protocol==="https:"?(go("Creating `tls.Socket`: %o",this.connectOpts),o=kk.connect(this.connectOpts)):(go("Creating `net.Socket`: %o",this.connectOpts),o=Ok.connect(this.connectOpts)),await(0,Pk.once)(o,"connect"),o}};ou.protocols=["http","https"];Ut.HttpProxyAgent=ou;function Mk(r,...e){let t={},n;for(n in r)e.includes(n)||(t[n]=r[n]);return t}});var ZT=T(au=>{"use strict";Object.defineProperty(au,"__esModule",{value:!0});au.state=void 0;au.state={instrumenterImplementation:void 0}});var av=T(hu=>{"use strict";Object.defineProperty(hu,"__esModule",{value:!0});hu.state=void 0;hu.state={operationRequestMap:new WeakMap}});var Fo=T((Xp,aC)=>{var id=ie("buffer"),Tr=id.Buffer;function sC(r,e){for(var t in r)e[t]=r[t]}Tr.from&&Tr.alloc&&Tr.allocUnsafe&&Tr.allocUnsafeSlow?aC.exports=id:(sC(id,Xp),Xp.Buffer=Di);function Di(r,e,t){return Tr(r,e,t)}Di.prototype=Object.create(Tr.prototype);sC(Tr,Di);Di.from=function(r,e,t){if(typeof r=="number")throw new TypeError("Argument must not be a number");return Tr(r,e,t)};Di.alloc=function(r,e,t){if(typeof r!="number")throw new TypeError("Argument must be a number");var n=Tr(r);return e!==void 0?typeof t=="string"?n.fill(e,t):n.fill(e):n.fill(0),n};Di.allocUnsafe=function(r){if(typeof r!="number")throw new TypeError("Argument must be a number");return Tr(r)};Di.allocUnsafeSlow=function(r){if(typeof r!="number")throw new TypeError("Argument must be a number");return id.SlowBuffer(r)}});var Qp=T((d5,cC)=>{var od=Fo().Buffer,ZP=ie("stream"),XP=ie("util");function sd(r){if(this.buffer=null,this.writable=!0,this.readable=!0,!r)return this.buffer=od.alloc(0),this;if(typeof r.pipe=="function")return this.buffer=od.alloc(0),r.pipe(this),this;if(r.length||typeof r=="object")return this.buffer=r,this.writable=!1,process.nextTick(function(){this.emit("end",r),this.readable=!1,this.emit("close")}.bind(this)),this;throw new TypeError("Unexpected data type ("+typeof r+")")}XP.inherits(sd,ZP);sd.prototype.write=function(e){this.buffer=od.concat([this.buffer,od.from(e)]),this.emit("data",e)};sd.prototype.end=function(e){e&&this.write(e),this.emit("end",e),this.emit("close"),this.writable=!1,this.readable=!1};cC.exports=sd});var uC=T((f5,lC)=>{"use strict";var ka=ie("buffer").Buffer,Jp=ie("buffer").SlowBuffer;lC.exports=ad;function ad(r,e){if(!ka.isBuffer(r)||!ka.isBuffer(e)||r.length!==e.length)return!1;for(var t=0,n=0;n<r.length;n++)t|=r[n]^e[n];return t===0}ad.install=function(){ka.prototype.equal=Jp.prototype.equal=function(e){return ad(this,e)}};var QP=ka.prototype.equal,JP=Jp.prototype.equal;ad.restore=function(){ka.prototype.equal=QP,Jp.prototype.equal=JP}});var fC=T((h5,dC)=>{"use strict";function em(r){var e=(r/8|0)+(r%8===0?0:1);return e}var eN={ES256:em(256),ES384:em(384),ES512:em(521)};function tN(r){var e=eN[r];if(e)return e;throw new Error('Unknown algorithm "'+r+'"')}dC.exports=tN});var TC=T((p5,EC)=>{"use strict";var cd=Fo().Buffer,pC=fC(),ld=128,mC=0,rN=32,nN=16,iN=2,gC=nN|rN|mC<<6,ud=iN|mC<<6;function oN(r){return r.replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function yC(r){if(cd.isBuffer(r))return r;if(typeof r=="string")return cd.from(r,"base64");throw new TypeError("ECDSA signature must be a Base64 string or a Buffer")}function sN(r,e){r=yC(r);var t=pC(e),n=t+1,i=r.length,o=0;if(r[o++]!==gC)throw new Error('Could not find expected "seq"');var s=r[o++];if(s===(ld|1)&&(s=r[o++]),i-o<s)throw new Error('"seq" specified length of "'+s+'", only "'+(i-o)+'" remaining');if(r[o++]!==ud)throw new Error('Could not find expected "int" for "r"');var a=r[o++];if(i-o-2<a)throw new Error('"r" specified length of "'+a+'", only "'+(i-o-2)+'" available');if(n<a)throw new Error('"r" specified length of "'+a+'", max of "'+n+'" is acceptable');var c=o;if(o+=a,r[o++]!==ud)throw new Error('Could not find expected "int" for "s"');var l=r[o++];if(i-o!==l)throw new Error('"s" specified length of "'+l+'", expected "'+(i-o)+'"');if(n<l)throw new Error('"s" specified length of "'+l+'", max of "'+n+'" is acceptable');var u=o;if(o+=l,o!==i)throw new Error('Expected to consume entire buffer, but "'+(i-o)+'" bytes remain');var d=t-a,h=t-l,p=cd.allocUnsafe(d+a+h+l);for(o=0;o<d;++o)p[o]=0;r.copy(p,o,c+Math.max(-d,0),c+a),o=t;for(var m=o;o<m+h;++o)p[o]=0;return r.copy(p,o,u+Math.max(-h,0),u+l),p=p.toString("base64"),p=oN(p),p}function hC(r,e,t){for(var n=0;e+n<t&&r[e+n]===0;)++n;var i=r[e+n]>=ld;return i&&--n,n}function aN(r,e){r=yC(r);var t=pC(e),n=r.length;if(n!==t*2)throw new TypeError('"'+e+'" signatures must be "'+t*2+'" bytes, saw "'+n+'"');var i=hC(r,0,t),o=hC(r,t,r.length),s=t-i,a=t-o,c=2+s+1+1+a,l=c<ld,u=cd.allocUnsafe((l?2:3)+c),d=0;return u[d++]=gC,l?u[d++]=c:(u[d++]=ld|1,u[d++]=c&255),u[d++]=ud,u[d++]=s,i<0?(u[d++]=0,d+=r.copy(u,d,0,t)):d+=r.copy(u,d,i,t),u[d++]=ud,u[d++]=a,o<0?(u[d++]=0,r.copy(u,d,t)):r.copy(u,d,t+o),u}EC.exports={derToJose:sN,joseToDer:aN}});var nm=T((m5,bC)=>{var cN=uC(),qo=Fo().Buffer,vr=ie("crypto"),CC=TC(),vC=ie("util"),lN=`"%s" is not a valid algorithm.
  Supported algorithms are:
  "HS256", "HS384", "HS512", "RS256", "RS384", "RS512", "PS256", "PS384", "PS512", "ES256", "ES384", "ES512" and "none".`,xa="secret must be a string or buffer",$o="key must be a string or a buffer",uN="key must be a string, a buffer or an object",tm=typeof vr.createPublicKey=="function";tm&&($o+=" or a KeyObject",xa+="or a KeyObject");function _C(r){if(!qo.isBuffer(r)&&typeof r!="string"&&(!tm||typeof r!="object"||typeof r.type!="string"||typeof r.asymmetricKeyType!="string"||typeof r.export!="function"))throw Qt($o)}function AC(r){if(!qo.isBuffer(r)&&typeof r!="string"&&typeof r!="object")throw Qt(uN)}function dN(r){if(!qo.isBuffer(r)){if(typeof r=="string")return r;if(!tm||typeof r!="object"||r.type!=="secret"||typeof r.export!="function")throw Qt(xa)}}function rm(r){return r.replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function SC(r){r=r.toString();var e=4-r.length%4;if(e!==4)for(var t=0;t<e;++t)r+="=";return r.replace(/\-/g,"+").replace(/_/g,"/")}function Qt(r){var e=[].slice.call(arguments,1),t=vC.format.bind(vC,r).apply(null,e);return new TypeError(t)}function fN(r){return qo.isBuffer(r)||typeof r=="string"}function Pa(r){return fN(r)||(r=JSON.stringify(r)),r}function wC(r){return function(t,n){dN(n),t=Pa(t);var i=vr.createHmac("sha"+r,n),o=(i.update(t),i.digest("base64"));return rm(o)}}function hN(r){return function(t,n,i){var o=wC(r)(t,i);return cN(qo.from(n),qo.from(o))}}function RC(r){return function(t,n){AC(n),t=Pa(t);var i=vr.createSign("RSA-SHA"+r),o=(i.update(t),i.sign(n,"base64"));return rm(o)}}function IC(r){return function(t,n,i){_C(i),t=Pa(t),n=SC(n);var o=vr.createVerify("RSA-SHA"+r);return o.update(t),o.verify(i,n,"base64")}}function pN(r){return function(t,n){AC(n),t=Pa(t);var i=vr.createSign("RSA-SHA"+r),o=(i.update(t),i.sign({key:n,padding:vr.constants.RSA_PKCS1_PSS_PADDING,saltLength:vr.constants.RSA_PSS_SALTLEN_DIGEST},"base64"));return rm(o)}}function mN(r){return function(t,n,i){_C(i),t=Pa(t),n=SC(n);var o=vr.createVerify("RSA-SHA"+r);return o.update(t),o.verify({key:i,padding:vr.constants.RSA_PKCS1_PSS_PADDING,saltLength:vr.constants.RSA_PSS_SALTLEN_DIGEST},n,"base64")}}function gN(r){var e=RC(r);return function(){var n=e.apply(null,arguments);return n=CC.derToJose(n,"ES"+r),n}}function yN(r){var e=IC(r);return function(n,i,o){i=CC.joseToDer(i,"ES"+r).toString("base64");var s=e(n,i,o);return s}}function EN(){return function(){return""}}function TN(){return function(e,t){return t===""}}bC.exports=function(e){var t={hs:wC,rs:RC,ps:pN,es:gN,none:EN},n={hs:hN,rs:IC,ps:mN,es:yN,none:TN},i=e.match(/^(RS|PS|ES|HS)(256|384|512)$|^(none)$/i);if(!i)throw Qt(lN,e);var o=(i[1]||i[3]).toLowerCase(),s=i[2];return{sign:t[o](s),verify:n[o](s)}}});var im=T((g5,OC)=>{var vN=ie("buffer").Buffer;OC.exports=function(e){return typeof e=="string"?e:typeof e=="number"||vN.isBuffer(e)?e.toString():JSON.stringify(e)}});var DC=T((y5,MC)=>{var CN=Fo().Buffer,kC=Qp(),_N=nm(),AN=ie("stream"),xC=im(),om=ie("util");function PC(r,e){return CN.from(r,e).toString("base64").replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function SN(r,e,t){t=t||"utf8";var n=PC(xC(r),"binary"),i=PC(xC(e),t);return om.format("%s.%s",n,i)}function NC(r){var e=r.header,t=r.payload,n=r.secret||r.privateKey,i=r.encoding,o=_N(e.alg),s=SN(e,t,i),a=o.sign(s,n);return om.format("%s.%s",s,a)}function dd(r){var e=r.secret||r.privateKey||r.key,t=new kC(e);this.readable=!0,this.header=r.header,this.encoding=r.encoding,this.secret=this.privateKey=this.key=t,this.payload=new kC(r.payload),this.secret.once("close",function(){!this.payload.writable&&this.readable&&this.sign()}.bind(this)),this.payload.once("close",function(){!this.secret.writable&&this.readable&&this.sign()}.bind(this))}om.inherits(dd,AN);dd.prototype.sign=function(){try{var e=NC({header:this.header,payload:this.payload.buffer,secret:this.secret.buffer,encoding:this.encoding});return this.emit("done",e),this.emit("data",e),this.emit("end"),this.readable=!1,e}catch(t){this.readable=!1,this.emit("error",t),this.emit("close")}};dd.sign=NC;MC.exports=dd});var GC=T((E5,zC)=>{var UC=Fo().Buffer,LC=Qp(),wN=nm(),RN=ie("stream"),HC=im(),IN=ie("util"),bN=/^[a-zA-Z0-9\-_]+?\.[a-zA-Z0-9\-_]+?\.([a-zA-Z0-9\-_]+)?$/;function ON(r){return Object.prototype.toString.call(r)==="[object Object]"}function kN(r){if(ON(r))return r;try{return JSON.parse(r)}catch{return}}function FC(r){var e=r.split(".",1)[0];return kN(UC.from(e,"base64").toString("binary"))}function xN(r){return r.split(".",2).join(".")}function $C(r){return r.split(".")[2]}function PN(r,e){e=e||"utf8";var t=r.split(".")[1];return UC.from(t,"base64").toString(e)}function qC(r){return bN.test(r)&&!!FC(r)}function jC(r,e,t){if(!e){var n=new Error("Missing algorithm parameter for jws.verify");throw n.code="MISSING_ALGORITHM",n}r=HC(r);var i=$C(r),o=xN(r),s=wN(e);return s.verify(o,i,t)}function BC(r,e){if(e=e||{},r=HC(r),!qC(r))return null;var t=FC(r);if(!t)return null;var n=PN(r);return(t.typ==="JWT"||e.json)&&(n=JSON.parse(n,e.encoding)),{header:t,payload:n,signature:$C(r)}}function jo(r){r=r||{};var e=r.secret||r.publicKey||r.key,t=new LC(e);this.readable=!0,this.algorithm=r.algorithm,this.encoding=r.encoding,this.secret=this.publicKey=this.key=t,this.signature=new LC(r.signature),this.secret.once("close",function(){!this.signature.writable&&this.readable&&this.verify()}.bind(this)),this.signature.once("close",function(){!this.secret.writable&&this.readable&&this.verify()}.bind(this))}IN.inherits(jo,RN);jo.prototype.verify=function(){try{var e=jC(this.signature.buffer,this.algorithm,this.key.buffer),t=BC(this.signature.buffer,this.encoding);return this.emit("done",e,t),this.emit("data",e),this.emit("end"),this.readable=!1,e}catch(n){this.readable=!1,this.emit("error",n),this.emit("close")}};jo.decode=BC;jo.isValid=qC;jo.verify=jC;zC.exports=jo});var hd=T(En=>{var VC=DC(),fd=GC(),NN=["HS256","HS384","HS512","RS256","RS384","RS512","PS256","PS384","PS512","ES256","ES384","ES512"];En.ALGORITHMS=NN;En.sign=VC.sign;En.verify=fd.verify;En.decode=fd.decode;En.isValid=fd.isValid;En.createSign=function(e){return new VC(e)};En.createVerify=function(e){return new fd(e)}});var sm=T((v5,KC)=>{var MN=hd();KC.exports=function(r,e){e=e||{};var t=MN.decode(r,e);if(!t)return null;var n=t.payload;if(typeof n=="string")try{var i=JSON.parse(n);i!==null&&typeof i=="object"&&(n=i)}catch{}return e.complete===!0?{header:t.header,payload:n,signature:t.signature}:n}});var Na=T((C5,YC)=>{var pd=function(r,e){Error.call(this,r),Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor),this.name="JsonWebTokenError",this.message=r,e&&(this.inner=e)};pd.prototype=Object.create(Error.prototype);pd.prototype.constructor=pd;YC.exports=pd});var am=T((_5,ZC)=>{var WC=Na(),md=function(r,e){WC.call(this,r),this.name="NotBeforeError",this.date=e};md.prototype=Object.create(WC.prototype);md.prototype.constructor=md;ZC.exports=md});var cm=T((A5,QC)=>{var XC=Na(),gd=function(r,e){XC.call(this,r),this.name="TokenExpiredError",this.expiredAt=e};gd.prototype=Object.create(XC.prototype);gd.prototype.constructor=gd;QC.exports=gd});var lm=T((S5,JC)=>{var DN=ch();JC.exports=function(r,e){var t=e||Math.floor(Date.now()/1e3);if(typeof r=="string"){var n=DN(r);return typeof n>"u"?void 0:Math.floor(t+n/1e3)}else return typeof r=="number"?t+r:void 0}});var Ma=T((w5,e_)=>{var LN="2.0.0",UN=Number.MAX_SAFE_INTEGER||9007199254740991,HN=16,FN=250,$N=["major","premajor","minor","preminor","patch","prepatch","prerelease"];e_.exports={MAX_LENGTH:256,MAX_SAFE_COMPONENT_LENGTH:HN,MAX_SAFE_BUILD_LENGTH:FN,MAX_SAFE_INTEGER:UN,RELEASE_TYPES:$N,SEMVER_SPEC_VERSION:LN,FLAG_INCLUDE_PRERELEASE:1,FLAG_LOOSE:2}});var Da=T((R5,t_)=>{var qN=typeof process=="object"&&process.env&&process.env.NODE_DEBUG&&/\bsemver\b/i.test(process.env.NODE_DEBUG)?(...r)=>console.error("SEMVER",...r):()=>{};t_.exports=qN});var Bo=T((Cr,r_)=>{var{MAX_SAFE_COMPONENT_LENGTH:um,MAX_SAFE_BUILD_LENGTH:jN,MAX_LENGTH:BN}=Ma(),zN=Da();Cr=r_.exports={};var GN=Cr.re=[],VN=Cr.safeRe=[],k=Cr.src=[],KN=Cr.safeSrc=[],x=Cr.t={},YN=0,dm="[a-zA-Z0-9-]",WN=[["\\s",1],["\\d",BN],[dm,jN]],ZN=r=>{for(let[e,t]of WN)r=r.split(`${e}*`).join(`${e}{0,${t}}`).split(`${e}+`).join(`${e}{1,${t}}`);return r},K=(r,e,t)=>{let n=ZN(e),i=YN++;zN(r,i,e),x[r]=i,k[i]=e,KN[i]=n,GN[i]=new RegExp(e,t?"g":void 0),VN[i]=new RegExp(n,t?"g":void 0)};K("NUMERICIDENTIFIER","0|[1-9]\\d*");K("NUMERICIDENTIFIERLOOSE","\\d+");K("NONNUMERICIDENTIFIER",`\\d*[a-zA-Z-]${dm}*`);K("MAINVERSION",`(${k[x.NUMERICIDENTIFIER]})\\.(${k[x.NUMERICIDENTIFIER]})\\.(${k[x.NUMERICIDENTIFIER]})`);K("MAINVERSIONLOOSE",`(${k[x.NUMERICIDENTIFIERLOOSE]})\\.(${k[x.NUMERICIDENTIFIERLOOSE]})\\.(${k[x.NUMERICIDENTIFIERLOOSE]})`);K("PRERELEASEIDENTIFIER",`(?:${k[x.NUMERICIDENTIFIER]}|${k[x.NONNUMERICIDENTIFIER]})`);K("PRERELEASEIDENTIFIERLOOSE",`(?:${k[x.NUMERICIDENTIFIERLOOSE]}|${k[x.NONNUMERICIDENTIFIER]})`);K("PRERELEASE",`(?:-(${k[x.PRERELEASEIDENTIFIER]}(?:\\.${k[x.PRERELEASEIDENTIFIER]})*))`);K("PRERELEASELOOSE",`(?:-?(${k[x.PRERELEASEIDENTIFIERLOOSE]}(?:\\.${k[x.PRERELEASEIDENTIFIERLOOSE]})*))`);K("BUILDIDENTIFIER",`${dm}+`);K("BUILD",`(?:\\+(${k[x.BUILDIDENTIFIER]}(?:\\.${k[x.BUILDIDENTIFIER]})*))`);K("FULLPLAIN",`v?${k[x.MAINVERSION]}${k[x.PRERELEASE]}?${k[x.BUILD]}?`);K("FULL",`^${k[x.FULLPLAIN]}$`);K("LOOSEPLAIN",`[v=\\s]*${k[x.MAINVERSIONLOOSE]}${k[x.PRERELEASELOOSE]}?${k[x.BUILD]}?`);K("LOOSE",`^${k[x.LOOSEPLAIN]}$`);K("GTLT","((?:<|>)?=?)");K("XRANGEIDENTIFIERLOOSE",`${k[x.NUMERICIDENTIFIERLOOSE]}|x|X|\\*`);K("XRANGEIDENTIFIER",`${k[x.NUMERICIDENTIFIER]}|x|X|\\*`);K("XRANGEPLAIN",`[v=\\s]*(${k[x.XRANGEIDENTIFIER]})(?:\\.(${k[x.XRANGEIDENTIFIER]})(?:\\.(${k[x.XRANGEIDENTIFIER]})(?:${k[x.PRERELEASE]})?${k[x.BUILD]}?)?)?`);K("XRANGEPLAINLOOSE",`[v=\\s]*(${k[x.XRANGEIDENTIFIERLOOSE]})(?:\\.(${k[x.XRANGEIDENTIFIERLOOSE]})(?:\\.(${k[x.XRANGEIDENTIFIERLOOSE]})(?:${k[x.PRERELEASELOOSE]})?${k[x.BUILD]}?)?)?`);K("XRANGE",`^${k[x.GTLT]}\\s*${k[x.XRANGEPLAIN]}$`);K("XRANGELOOSE",`^${k[x.GTLT]}\\s*${k[x.XRANGEPLAINLOOSE]}$`);K("COERCEPLAIN",`(^|[^\\d])(\\d{1,${um}})(?:\\.(\\d{1,${um}}))?(?:\\.(\\d{1,${um}}))?`);K("COERCE",`${k[x.COERCEPLAIN]}(?:$|[^\\d])`);K("COERCEFULL",k[x.COERCEPLAIN]+`(?:${k[x.PRERELEASE]})?(?:${k[x.BUILD]})?(?:$|[^\\d])`);K("COERCERTL",k[x.COERCE],!0);K("COERCERTLFULL",k[x.COERCEFULL],!0);K("LONETILDE","(?:~>?)");K("TILDETRIM",`(\\s*)${k[x.LONETILDE]}\\s+`,!0);Cr.tildeTrimReplace="$1~";K("TILDE",`^${k[x.LONETILDE]}${k[x.XRANGEPLAIN]}$`);K("TILDELOOSE",`^${k[x.LONETILDE]}${k[x.XRANGEPLAINLOOSE]}$`);K("LONECARET","(?:\\^)");K("CARETTRIM",`(\\s*)${k[x.LONECARET]}\\s+`,!0);Cr.caretTrimReplace="$1^";K("CARET",`^${k[x.LONECARET]}${k[x.XRANGEPLAIN]}$`);K("CARETLOOSE",`^${k[x.LONECARET]}${k[x.XRANGEPLAINLOOSE]}$`);K("COMPARATORLOOSE",`^${k[x.GTLT]}\\s*(${k[x.LOOSEPLAIN]})$|^$`);K("COMPARATOR",`^${k[x.GTLT]}\\s*(${k[x.FULLPLAIN]})$|^$`);K("COMPARATORTRIM",`(\\s*)${k[x.GTLT]}\\s*(${k[x.LOOSEPLAIN]}|${k[x.XRANGEPLAIN]})`,!0);Cr.comparatorTrimReplace="$1$2$3";K("HYPHENRANGE",`^\\s*(${k[x.XRANGEPLAIN]})\\s+-\\s+(${k[x.XRANGEPLAIN]})\\s*$`);K("HYPHENRANGELOOSE",`^\\s*(${k[x.XRANGEPLAINLOOSE]})\\s+-\\s+(${k[x.XRANGEPLAINLOOSE]})\\s*$`);K("STAR","(<|>)?=?\\s*\\*");K("GTE0","^\\s*>=\\s*0\\.0\\.0\\s*$");K("GTE0PRE","^\\s*>=\\s*0\\.0\\.0-0\\s*$")});var yd=T((I5,n_)=>{var XN=Object.freeze({loose:!0}),QN=Object.freeze({}),JN=r=>r?typeof r!="object"?XN:r:QN;n_.exports=JN});var fm=T((b5,s_)=>{var i_=/^[0-9]+$/,o_=(r,e)=>{let t=i_.test(r),n=i_.test(e);return t&&n&&(r=+r,e=+e),r===e?0:t&&!n?-1:n&&!t?1:r<e?-1:1},eM=(r,e)=>o_(e,r);s_.exports={compareIdentifiers:o_,rcompareIdentifiers:eM}});var Ke=T((O5,u_)=>{var Ed=Da(),{MAX_LENGTH:a_,MAX_SAFE_INTEGER:Td}=Ma(),{safeRe:c_,safeSrc:l_,t:vd}=Bo(),tM=yd(),{compareIdentifiers:zo}=fm(),hm=class r{constructor(e,t){if(t=tM(t),e instanceof r){if(e.loose===!!t.loose&&e.includePrerelease===!!t.includePrerelease)return e;e=e.version}else if(typeof e!="string")throw new TypeError(`Invalid version. Must be a string. Got type "${typeof e}".`);if(e.length>a_)throw new TypeError(`version is longer than ${a_} characters`);Ed("SemVer",e,t),this.options=t,this.loose=!!t.loose,this.includePrerelease=!!t.includePrerelease;let n=e.trim().match(t.loose?c_[vd.LOOSE]:c_[vd.FULL]);if(!n)throw new TypeError(`Invalid Version: ${e}`);if(this.raw=e,this.major=+n[1],this.minor=+n[2],this.patch=+n[3],this.major>Td||this.major<0)throw new TypeError("Invalid major version");if(this.minor>Td||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>Td||this.patch<0)throw new TypeError("Invalid patch version");n[4]?this.prerelease=n[4].split(".").map(i=>{if(/^[0-9]+$/.test(i)){let o=+i;if(o>=0&&o<Td)return o}return i}):this.prerelease=[],this.build=n[5]?n[5].split("."):[],this.format()}format(){return this.version=`${this.major}.${this.minor}.${this.patch}`,this.prerelease.length&&(this.version+=`-${this.prerelease.join(".")}`),this.version}toString(){return this.version}compare(e){if(Ed("SemVer.compare",this.version,this.options,e),!(e instanceof r)){if(typeof e=="string"&&e===this.version)return 0;e=new r(e,this.options)}return e.version===this.version?0:this.compareMain(e)||this.comparePre(e)}compareMain(e){return e instanceof r||(e=new r(e,this.options)),zo(this.major,e.major)||zo(this.minor,e.minor)||zo(this.patch,e.patch)}comparePre(e){if(e instanceof r||(e=new r(e,this.options)),this.prerelease.length&&!e.prerelease.length)return-1;if(!this.prerelease.length&&e.prerelease.length)return 1;if(!this.prerelease.length&&!e.prerelease.length)return 0;let t=0;do{let n=this.prerelease[t],i=e.prerelease[t];if(Ed("prerelease compare",t,n,i),n===void 0&&i===void 0)return 0;if(i===void 0)return 1;if(n===void 0)return-1;if(n===i)continue;return zo(n,i)}while(++t)}compareBuild(e){e instanceof r||(e=new r(e,this.options));let t=0;do{let n=this.build[t],i=e.build[t];if(Ed("build compare",t,n,i),n===void 0&&i===void 0)return 0;if(i===void 0)return 1;if(n===void 0)return-1;if(n===i)continue;return zo(n,i)}while(++t)}inc(e,t,n){if(e.startsWith("pre")){if(!t&&n===!1)throw new Error("invalid increment argument: identifier is empty");if(t){let i=new RegExp(`^${this.options.loose?l_[vd.PRERELEASELOOSE]:l_[vd.PRERELEASE]}$`),o=`-${t}`.match(i);if(!o||o[1]!==t)throw new Error(`invalid identifier: ${t}`)}}switch(e){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",t,n);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",t,n);break;case"prepatch":this.prerelease.length=0,this.inc("patch",t,n),this.inc("pre",t,n);break;case"prerelease":this.prerelease.length===0&&this.inc("patch",t,n),this.inc("pre",t,n);break;case"release":if(this.prerelease.length===0)throw new Error(`version ${this.raw} is not a prerelease`);this.prerelease.length=0;break;case"major":(this.minor!==0||this.patch!==0||this.prerelease.length===0)&&this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":(this.patch!==0||this.prerelease.length===0)&&this.minor++,this.patch=0,this.prerelease=[];break;case"patch":this.prerelease.length===0&&this.patch++,this.prerelease=[];break;case"pre":{let i=Number(n)?1:0;if(this.prerelease.length===0)this.prerelease=[i];else{let o=this.prerelease.length;for(;--o>=0;)typeof this.prerelease[o]=="number"&&(this.prerelease[o]++,o=-2);if(o===-1){if(t===this.prerelease.join(".")&&n===!1)throw new Error("invalid increment argument: identifier already exists");this.prerelease.push(i)}}if(t){let o=[t,i];n===!1&&(o=[t]),zo(this.prerelease[0],t)===0?isNaN(this.prerelease[1])&&(this.prerelease=o):this.prerelease=o}break}default:throw new Error(`invalid increment argument: ${e}`)}return this.raw=this.format(),this.build.length&&(this.raw+=`+${this.build.join(".")}`),this}};u_.exports=hm});var Li=T((k5,f_)=>{var d_=Ke(),rM=(r,e,t=!1)=>{if(r instanceof d_)return r;try{return new d_(r,e)}catch(n){if(!t)return null;throw n}};f_.exports=rM});var p_=T((x5,h_)=>{var nM=Li(),iM=(r,e)=>{let t=nM(r,e);return t?t.version:null};h_.exports=iM});var g_=T((P5,m_)=>{var oM=Li(),sM=(r,e)=>{let t=oM(r.trim().replace(/^[=v]+/,""),e);return t?t.version:null};m_.exports=sM});var T_=T((N5,E_)=>{var y_=Ke(),aM=(r,e,t,n,i)=>{typeof t=="string"&&(i=n,n=t,t=void 0);try{return new y_(r instanceof y_?r.version:r,t).inc(e,n,i).version}catch{return null}};E_.exports=aM});var __=T((M5,C_)=>{var v_=Li(),cM=(r,e)=>{let t=v_(r,null,!0),n=v_(e,null,!0),i=t.compare(n);if(i===0)return null;let o=i>0,s=o?t:n,a=o?n:t,c=!!s.prerelease.length;if(!!a.prerelease.length&&!c){if(!a.patch&&!a.minor)return"major";if(a.compareMain(s)===0)return a.minor&&!a.patch?"minor":"patch"}let u=c?"pre":"";return t.major!==n.major?u+"major":t.minor!==n.minor?u+"minor":t.patch!==n.patch?u+"patch":"prerelease"};C_.exports=cM});var S_=T((D5,A_)=>{var lM=Ke(),uM=(r,e)=>new lM(r,e).major;A_.exports=uM});var R_=T((L5,w_)=>{var dM=Ke(),fM=(r,e)=>new dM(r,e).minor;w_.exports=fM});var b_=T((U5,I_)=>{var hM=Ke(),pM=(r,e)=>new hM(r,e).patch;I_.exports=pM});var k_=T((H5,O_)=>{var mM=Li(),gM=(r,e)=>{let t=mM(r,e);return t&&t.prerelease.length?t.prerelease:null};O_.exports=gM});var qt=T((F5,P_)=>{var x_=Ke(),yM=(r,e,t)=>new x_(r,t).compare(new x_(e,t));P_.exports=yM});var M_=T(($5,N_)=>{var EM=qt(),TM=(r,e,t)=>EM(e,r,t);N_.exports=TM});var L_=T((q5,D_)=>{var vM=qt(),CM=(r,e)=>vM(r,e,!0);D_.exports=CM});var Cd=T((j5,H_)=>{var U_=Ke(),_M=(r,e,t)=>{let n=new U_(r,t),i=new U_(e,t);return n.compare(i)||n.compareBuild(i)};H_.exports=_M});var $_=T((B5,F_)=>{var AM=Cd(),SM=(r,e)=>r.sort((t,n)=>AM(t,n,e));F_.exports=SM});var j_=T((z5,q_)=>{var wM=Cd(),RM=(r,e)=>r.sort((t,n)=>wM(n,t,e));q_.exports=RM});var La=T((G5,B_)=>{var IM=qt(),bM=(r,e,t)=>IM(r,e,t)>0;B_.exports=bM});var _d=T((V5,z_)=>{var OM=qt(),kM=(r,e,t)=>OM(r,e,t)<0;z_.exports=kM});var pm=T((K5,G_)=>{var xM=qt(),PM=(r,e,t)=>xM(r,e,t)===0;G_.exports=PM});var mm=T((Y5,V_)=>{var NM=qt(),MM=(r,e,t)=>NM(r,e,t)!==0;V_.exports=MM});var Ad=T((W5,K_)=>{var DM=qt(),LM=(r,e,t)=>DM(r,e,t)>=0;K_.exports=LM});var Sd=T((Z5,Y_)=>{var UM=qt(),HM=(r,e,t)=>UM(r,e,t)<=0;Y_.exports=HM});var gm=T((X5,W_)=>{var FM=pm(),$M=mm(),qM=La(),jM=Ad(),BM=_d(),zM=Sd(),GM=(r,e,t,n)=>{switch(e){case"===":return typeof r=="object"&&(r=r.version),typeof t=="object"&&(t=t.version),r===t;case"!==":return typeof r=="object"&&(r=r.version),typeof t=="object"&&(t=t.version),r!==t;case"":case"=":case"==":return FM(r,t,n);case"!=":return $M(r,t,n);case">":return qM(r,t,n);case">=":return jM(r,t,n);case"<":return BM(r,t,n);case"<=":return zM(r,t,n);default:throw new TypeError(`Invalid operator: ${e}`)}};W_.exports=GM});var X_=T((Q5,Z_)=>{var VM=Ke(),KM=Li(),{safeRe:wd,t:Rd}=Bo(),YM=(r,e)=>{if(r instanceof VM)return r;if(typeof r=="number"&&(r=String(r)),typeof r!="string")return null;e=e||{};let t=null;if(!e.rtl)t=r.match(e.includePrerelease?wd[Rd.COERCEFULL]:wd[Rd.COERCE]);else{let c=e.includePrerelease?wd[Rd.COERCERTLFULL]:wd[Rd.COERCERTL],l;for(;(l=c.exec(r))&&(!t||t.index+t[0].length!==r.length);)(!t||l.index+l[0].length!==t.index+t[0].length)&&(t=l),c.lastIndex=l.index+l[1].length+l[2].length;c.lastIndex=-1}if(t===null)return null;let n=t[2],i=t[3]||"0",o=t[4]||"0",s=e.includePrerelease&&t[5]?`-${t[5]}`:"",a=e.includePrerelease&&t[6]?`+${t[6]}`:"";return KM(`${n}.${i}.${o}${s}${a}`,e)};Z_.exports=YM});var J_=T((J5,Q_)=>{var ym=class{constructor(){this.max=1e3,this.map=new Map}get(e){let t=this.map.get(e);if(t!==void 0)return this.map.delete(e),this.map.set(e,t),t}delete(e){return this.map.delete(e)}set(e,t){if(!this.delete(e)&&t!==void 0){if(this.map.size>=this.max){let i=this.map.keys().next().value;this.delete(i)}this.map.set(e,t)}return this}};Q_.exports=ym});var jt=T((eX,nA)=>{var WM=/\s+/g,Em=class r{constructor(e,t){if(t=XM(t),e instanceof r)return e.loose===!!t.loose&&e.includePrerelease===!!t.includePrerelease?e:new r(e.raw,t);if(e instanceof Tm)return this.raw=e.value,this.set=[[e]],this.formatted=void 0,this;if(this.options=t,this.loose=!!t.loose,this.includePrerelease=!!t.includePrerelease,this.raw=e.trim().replace(WM," "),this.set=this.raw.split("||").map(n=>this.parseRange(n.trim())).filter(n=>n.length),!this.set.length)throw new TypeError(`Invalid SemVer Range: ${this.raw}`);if(this.set.length>1){let n=this.set[0];if(this.set=this.set.filter(i=>!tA(i[0])),this.set.length===0)this.set=[n];else if(this.set.length>1){for(let i of this.set)if(i.length===1&&iD(i[0])){this.set=[i];break}}}this.formatted=void 0}get range(){if(this.formatted===void 0){this.formatted="";for(let e=0;e<this.set.length;e++){e>0&&(this.formatted+="||");let t=this.set[e];for(let n=0;n<t.length;n++)n>0&&(this.formatted+=" "),this.formatted+=t[n].toString().trim()}}return this.formatted}format(){return this.range}toString(){return this.range}parseRange(e){let n=((this.options.includePrerelease&&rD)|(this.options.loose&&nD))+":"+e,i=eA.get(n);if(i)return i;let o=this.options.loose,s=o?pt[tt.HYPHENRANGELOOSE]:pt[tt.HYPHENRANGE];e=e.replace(s,pD(this.options.includePrerelease)),me("hyphen replace",e),e=e.replace(pt[tt.COMPARATORTRIM],JM),me("comparator trim",e),e=e.replace(pt[tt.TILDETRIM],eD),me("tilde trim",e),e=e.replace(pt[tt.CARETTRIM],tD),me("caret trim",e);let a=e.split(" ").map(d=>oD(d,this.options)).join(" ").split(/\s+/).map(d=>hD(d,this.options));o&&(a=a.filter(d=>(me("loose invalid filter",d,this.options),!!d.match(pt[tt.COMPARATORLOOSE])))),me("range list",a);let c=new Map,l=a.map(d=>new Tm(d,this.options));for(let d of l){if(tA(d))return[d];c.set(d.value,d)}c.size>1&&c.has("")&&c.delete("");let u=[...c.values()];return eA.set(n,u),u}intersects(e,t){if(!(e instanceof r))throw new TypeError("a Range is required");return this.set.some(n=>rA(n,t)&&e.set.some(i=>rA(i,t)&&n.every(o=>i.every(s=>o.intersects(s,t)))))}test(e){if(!e)return!1;if(typeof e=="string")try{e=new QM(e,this.options)}catch{return!1}for(let t=0;t<this.set.length;t++)if(mD(this.set[t],e,this.options))return!0;return!1}};nA.exports=Em;var ZM=J_(),eA=new ZM,XM=yd(),Tm=Ua(),me=Da(),QM=Ke(),{safeRe:pt,t:tt,comparatorTrimReplace:JM,tildeTrimReplace:eD,caretTrimReplace:tD}=Bo(),{FLAG_INCLUDE_PRERELEASE:rD,FLAG_LOOSE:nD}=Ma(),tA=r=>r.value==="<0.0.0-0",iD=r=>r.value==="",rA=(r,e)=>{let t=!0,n=r.slice(),i=n.pop();for(;t&&n.length;)t=n.every(o=>i.intersects(o,e)),i=n.pop();return t},oD=(r,e)=>(me("comp",r,e),r=cD(r,e),me("caret",r),r=sD(r,e),me("tildes",r),r=uD(r,e),me("xrange",r),r=fD(r,e),me("stars",r),r),rt=r=>!r||r.toLowerCase()==="x"||r==="*",sD=(r,e)=>r.trim().split(/\s+/).map(t=>aD(t,e)).join(" "),aD=(r,e)=>{let t=e.loose?pt[tt.TILDELOOSE]:pt[tt.TILDE];return r.replace(t,(n,i,o,s,a)=>{me("tilde",r,n,i,o,s,a);let c;return rt(i)?c="":rt(o)?c=`>=${i}.0.0 <${+i+1}.0.0-0`:rt(s)?c=`>=${i}.${o}.0 <${i}.${+o+1}.0-0`:a?(me("replaceTilde pr",a),c=`>=${i}.${o}.${s}-${a} <${i}.${+o+1}.0-0`):c=`>=${i}.${o}.${s} <${i}.${+o+1}.0-0`,me("tilde return",c),c})},cD=(r,e)=>r.trim().split(/\s+/).map(t=>lD(t,e)).join(" "),lD=(r,e)=>{me("caret",r,e);let t=e.loose?pt[tt.CARETLOOSE]:pt[tt.CARET],n=e.includePrerelease?"-0":"";return r.replace(t,(i,o,s,a,c)=>{me("caret",r,i,o,s,a,c);let l;return rt(o)?l="":rt(s)?l=`>=${o}.0.0${n} <${+o+1}.0.0-0`:rt(a)?o==="0"?l=`>=${o}.${s}.0${n} <${o}.${+s+1}.0-0`:l=`>=${o}.${s}.0${n} <${+o+1}.0.0-0`:c?(me("replaceCaret pr",c),o==="0"?s==="0"?l=`>=${o}.${s}.${a}-${c} <${o}.${s}.${+a+1}-0`:l=`>=${o}.${s}.${a}-${c} <${o}.${+s+1}.0-0`:l=`>=${o}.${s}.${a}-${c} <${+o+1}.0.0-0`):(me("no pr"),o==="0"?s==="0"?l=`>=${o}.${s}.${a}${n} <${o}.${s}.${+a+1}-0`:l=`>=${o}.${s}.${a}${n} <${o}.${+s+1}.0-0`:l=`>=${o}.${s}.${a} <${+o+1}.0.0-0`),me("caret return",l),l})},uD=(r,e)=>(me("replaceXRanges",r,e),r.split(/\s+/).map(t=>dD(t,e)).join(" ")),dD=(r,e)=>{r=r.trim();let t=e.loose?pt[tt.XRANGELOOSE]:pt[tt.XRANGE];return r.replace(t,(n,i,o,s,a,c)=>{me("xRange",r,n,i,o,s,a,c);let l=rt(o),u=l||rt(s),d=u||rt(a),h=d;return i==="="&&h&&(i=""),c=e.includePrerelease?"-0":"",l?i===">"||i==="<"?n="<0.0.0-0":n="*":i&&h?(u&&(s=0),a=0,i===">"?(i=">=",u?(o=+o+1,s=0,a=0):(s=+s+1,a=0)):i==="<="&&(i="<",u?o=+o+1:s=+s+1),i==="<"&&(c="-0"),n=`${i+o}.${s}.${a}${c}`):u?n=`>=${o}.0.0${c} <${+o+1}.0.0-0`:d&&(n=`>=${o}.${s}.0${c} <${o}.${+s+1}.0-0`),me("xRange return",n),n})},fD=(r,e)=>(me("replaceStars",r,e),r.trim().replace(pt[tt.STAR],"")),hD=(r,e)=>(me("replaceGTE0",r,e),r.trim().replace(pt[e.includePrerelease?tt.GTE0PRE:tt.GTE0],"")),pD=r=>(e,t,n,i,o,s,a,c,l,u,d,h)=>(rt(n)?t="":rt(i)?t=`>=${n}.0.0${r?"-0":""}`:rt(o)?t=`>=${n}.${i}.0${r?"-0":""}`:s?t=`>=${t}`:t=`>=${t}${r?"-0":""}`,rt(l)?c="":rt(u)?c=`<${+l+1}.0.0-0`:rt(d)?c=`<${l}.${+u+1}.0-0`:h?c=`<=${l}.${u}.${d}-${h}`:r?c=`<${l}.${u}.${+d+1}-0`:c=`<=${c}`,`${t} ${c}`.trim()),mD=(r,e,t)=>{for(let n=0;n<r.length;n++)if(!r[n].test(e))return!1;if(e.prerelease.length&&!t.includePrerelease){for(let n=0;n<r.length;n++)if(me(r[n].semver),r[n].semver!==Tm.ANY&&r[n].semver.prerelease.length>0){let i=r[n].semver;if(i.major===e.major&&i.minor===e.minor&&i.patch===e.patch)return!0}return!1}return!0}});var Ua=T((tX,lA)=>{var Ha=Symbol("SemVer ANY"),_m=class r{static get ANY(){return Ha}constructor(e,t){if(t=iA(t),e instanceof r){if(e.loose===!!t.loose)return e;e=e.value}e=e.trim().split(/\s+/).join(" "),Cm("comparator",e,t),this.options=t,this.loose=!!t.loose,this.parse(e),this.semver===Ha?this.value="":this.value=this.operator+this.semver.version,Cm("comp",this)}parse(e){let t=this.options.loose?oA[sA.COMPARATORLOOSE]:oA[sA.COMPARATOR],n=e.match(t);if(!n)throw new TypeError(`Invalid comparator: ${e}`);this.operator=n[1]!==void 0?n[1]:"",this.operator==="="&&(this.operator=""),n[2]?this.semver=new aA(n[2],this.options.loose):this.semver=Ha}toString(){return this.value}test(e){if(Cm("Comparator.test",e,this.options.loose),this.semver===Ha||e===Ha)return!0;if(typeof e=="string")try{e=new aA(e,this.options)}catch{return!1}return vm(e,this.operator,this.semver,this.options)}intersects(e,t){if(!(e instanceof r))throw new TypeError("a Comparator is required");return this.operator===""?this.value===""?!0:new cA(e.value,t).test(this.value):e.operator===""?e.value===""?!0:new cA(this.value,t).test(e.semver):(t=iA(t),t.includePrerelease&&(this.value==="<0.0.0-0"||e.value==="<0.0.0-0")||!t.includePrerelease&&(this.value.startsWith("<0.0.0")||e.value.startsWith("<0.0.0"))?!1:!!(this.operator.startsWith(">")&&e.operator.startsWith(">")||this.operator.startsWith("<")&&e.operator.startsWith("<")||this.semver.version===e.semver.version&&this.operator.includes("=")&&e.operator.includes("=")||vm(this.semver,"<",e.semver,t)&&this.operator.startsWith(">")&&e.operator.startsWith("<")||vm(this.semver,">",e.semver,t)&&this.operator.startsWith("<")&&e.operator.startsWith(">")))}};lA.exports=_m;var iA=yd(),{safeRe:oA,t:sA}=Bo(),vm=gm(),Cm=Da(),aA=Ke(),cA=jt()});var Fa=T((rX,uA)=>{var gD=jt(),yD=(r,e,t)=>{try{e=new gD(e,t)}catch{return!1}return e.test(r)};uA.exports=yD});var fA=T((nX,dA)=>{var ED=jt(),TD=(r,e)=>new ED(r,e).set.map(t=>t.map(n=>n.value).join(" ").trim().split(" "));dA.exports=TD});var pA=T((iX,hA)=>{var vD=Ke(),CD=jt(),_D=(r,e,t)=>{let n=null,i=null,o=null;try{o=new CD(e,t)}catch{return null}return r.forEach(s=>{o.test(s)&&(!n||i.compare(s)===-1)&&(n=s,i=new vD(n,t))}),n};hA.exports=_D});var gA=T((oX,mA)=>{var AD=Ke(),SD=jt(),wD=(r,e,t)=>{let n=null,i=null,o=null;try{o=new SD(e,t)}catch{return null}return r.forEach(s=>{o.test(s)&&(!n||i.compare(s)===1)&&(n=s,i=new AD(n,t))}),n};mA.exports=wD});var TA=T((sX,EA)=>{var Am=Ke(),RD=jt(),yA=La(),ID=(r,e)=>{r=new RD(r,e);let t=new Am("0.0.0");if(r.test(t)||(t=new Am("0.0.0-0"),r.test(t)))return t;t=null;for(let n=0;n<r.set.length;++n){let i=r.set[n],o=null;i.forEach(s=>{let a=new Am(s.semver.version);switch(s.operator){case">":a.prerelease.length===0?a.patch++:a.prerelease.push(0),a.raw=a.format();case"":case">=":(!o||yA(a,o))&&(o=a);break;case"<":case"<=":break;default:throw new Error(`Unexpected operation: ${s.operator}`)}}),o&&(!t||yA(t,o))&&(t=o)}return t&&r.test(t)?t:null};EA.exports=ID});var CA=T((aX,vA)=>{var bD=jt(),OD=(r,e)=>{try{return new bD(r,e).range||"*"}catch{return null}};vA.exports=OD});var Id=T((cX,wA)=>{var kD=Ke(),SA=Ua(),{ANY:xD}=SA,PD=jt(),ND=Fa(),_A=La(),AA=_d(),MD=Sd(),DD=Ad(),LD=(r,e,t,n)=>{r=new kD(r,n),e=new PD(e,n);let i,o,s,a,c;switch(t){case">":i=_A,o=MD,s=AA,a=">",c=">=";break;case"<":i=AA,o=DD,s=_A,a="<",c="<=";break;default:throw new TypeError('Must provide a hilo val of "<" or ">"')}if(ND(r,e,n))return!1;for(let l=0;l<e.set.length;++l){let u=e.set[l],d=null,h=null;if(u.forEach(p=>{p.semver===xD&&(p=new SA(">=0.0.0")),d=d||p,h=h||p,i(p.semver,d.semver,n)?d=p:s(p.semver,h.semver,n)&&(h=p)}),d.operator===a||d.operator===c||(!h.operator||h.operator===a)&&o(r,h.semver))return!1;if(h.operator===c&&s(r,h.semver))return!1}return!0};wA.exports=LD});var IA=T((lX,RA)=>{var UD=Id(),HD=(r,e,t)=>UD(r,e,">",t);RA.exports=HD});var OA=T((uX,bA)=>{var FD=Id(),$D=(r,e,t)=>FD(r,e,"<",t);bA.exports=$D});var PA=T((dX,xA)=>{var kA=jt(),qD=(r,e,t)=>(r=new kA(r,t),e=new kA(e,t),r.intersects(e,t));xA.exports=qD});var MA=T((fX,NA)=>{var jD=Fa(),BD=qt();NA.exports=(r,e,t)=>{let n=[],i=null,o=null,s=r.sort((u,d)=>BD(u,d,t));for(let u of s)jD(u,e,t)?(o=u,i||(i=u)):(o&&n.push([i,o]),o=null,i=null);i&&n.push([i,null]);let a=[];for(let[u,d]of n)u===d?a.push(u):!d&&u===s[0]?a.push("*"):d?u===s[0]?a.push(`<=${d}`):a.push(`${u} - ${d}`):a.push(`>=${u}`);let c=a.join(" || "),l=typeof e.raw=="string"?e.raw:String(e);return c.length<l.length?c:e}});var $A=T((hX,FA)=>{var DA=jt(),wm=Ua(),{ANY:Sm}=wm,$a=Fa(),Rm=qt(),zD=(r,e,t={})=>{if(r===e)return!0;r=new DA(r,t),e=new DA(e,t);let n=!1;e:for(let i of r.set){for(let o of e.set){let s=VD(i,o,t);if(n=n||s!==null,s)continue e}if(n)return!1}return!0},GD=[new wm(">=0.0.0-0")],LA=[new wm(">=0.0.0")],VD=(r,e,t)=>{if(r===e)return!0;if(r.length===1&&r[0].semver===Sm){if(e.length===1&&e[0].semver===Sm)return!0;t.includePrerelease?r=GD:r=LA}if(e.length===1&&e[0].semver===Sm){if(t.includePrerelease)return!0;e=LA}let n=new Set,i,o;for(let p of r)p.operator===">"||p.operator===">="?i=UA(i,p,t):p.operator==="<"||p.operator==="<="?o=HA(o,p,t):n.add(p.semver);if(n.size>1)return null;let s;if(i&&o){if(s=Rm(i.semver,o.semver,t),s>0)return null;if(s===0&&(i.operator!==">="||o.operator!=="<="))return null}for(let p of n){if(i&&!$a(p,String(i),t)||o&&!$a(p,String(o),t))return null;for(let m of e)if(!$a(p,String(m),t))return!1;return!0}let a,c,l,u,d=o&&!t.includePrerelease&&o.semver.prerelease.length?o.semver:!1,h=i&&!t.includePrerelease&&i.semver.prerelease.length?i.semver:!1;d&&d.prerelease.length===1&&o.operator==="<"&&d.prerelease[0]===0&&(d=!1);for(let p of e){if(u=u||p.operator===">"||p.operator===">=",l=l||p.operator==="<"||p.operator==="<=",i){if(h&&p.semver.prerelease&&p.semver.prerelease.length&&p.semver.major===h.major&&p.semver.minor===h.minor&&p.semver.patch===h.patch&&(h=!1),p.operator===">"||p.operator===">="){if(a=UA(i,p,t),a===p&&a!==i)return!1}else if(i.operator===">="&&!$a(i.semver,String(p),t))return!1}if(o){if(d&&p.semver.prerelease&&p.semver.prerelease.length&&p.semver.major===d.major&&p.semver.minor===d.minor&&p.semver.patch===d.patch&&(d=!1),p.operator==="<"||p.operator==="<="){if(c=HA(o,p,t),c===p&&c!==o)return!1}else if(o.operator==="<="&&!$a(o.semver,String(p),t))return!1}if(!p.operator&&(o||i)&&s!==0)return!1}return!(i&&l&&!o&&s!==0||o&&u&&!i&&s!==0||h||d)},UA=(r,e,t)=>{if(!r)return e;let n=Rm(r.semver,e.semver,t);return n>0?r:n<0||e.operator===">"&&r.operator===">="?e:r},HA=(r,e,t)=>{if(!r)return e;let n=Rm(r.semver,e.semver,t);return n<0?r:n>0||e.operator==="<"&&r.operator==="<="?e:r};FA.exports=zD});var bd=T((pX,BA)=>{var Im=Bo(),qA=Ma(),KD=Ke(),jA=fm(),YD=Li(),WD=p_(),ZD=g_(),XD=T_(),QD=__(),JD=S_(),eL=R_(),tL=b_(),rL=k_(),nL=qt(),iL=M_(),oL=L_(),sL=Cd(),aL=$_(),cL=j_(),lL=La(),uL=_d(),dL=pm(),fL=mm(),hL=Ad(),pL=Sd(),mL=gm(),gL=X_(),yL=Ua(),EL=jt(),TL=Fa(),vL=fA(),CL=pA(),_L=gA(),AL=TA(),SL=CA(),wL=Id(),RL=IA(),IL=OA(),bL=PA(),OL=MA(),kL=$A();BA.exports={parse:YD,valid:WD,clean:ZD,inc:XD,diff:QD,major:JD,minor:eL,patch:tL,prerelease:rL,compare:nL,rcompare:iL,compareLoose:oL,compareBuild:sL,sort:aL,rsort:cL,gt:lL,lt:uL,eq:dL,neq:fL,gte:hL,lte:pL,cmp:mL,coerce:gL,Comparator:yL,Range:EL,satisfies:TL,toComparators:vL,maxSatisfying:CL,minSatisfying:_L,minVersion:AL,validRange:SL,outside:wL,gtr:RL,ltr:IL,intersects:bL,simplifyRange:OL,subset:kL,SemVer:KD,re:Im.re,src:Im.src,tokens:Im.t,SEMVER_SPEC_VERSION:qA.SEMVER_SPEC_VERSION,RELEASE_TYPES:qA.RELEASE_TYPES,compareIdentifiers:jA.compareIdentifiers,rcompareIdentifiers:jA.rcompareIdentifiers}});var GA=T((mX,zA)=>{var xL=bd();zA.exports=xL.satisfies(process.version,">=15.7.0")});var KA=T((gX,VA)=>{var PL=bd();VA.exports=PL.satisfies(process.version,">=16.9.0")});var bm=T((yX,YA)=>{var NL=GA(),ML=KA(),DL={ec:["ES256","ES384","ES512"],rsa:["RS256","PS256","RS384","PS384","RS512","PS512"],"rsa-pss":["PS256","PS384","PS512"]},LL={ES256:"prime256v1",ES384:"secp384r1",ES512:"secp521r1"};YA.exports=function(r,e){if(!r||!e)return;let t=e.asymmetricKeyType;if(!t)return;let n=DL[t];if(!n)throw new Error(`Unknown key type "${t}".`);if(!n.includes(r))throw new Error(`"alg" parameter for "${t}" key type must be one of: ${n.join(", ")}.`);if(NL)switch(t){case"ec":let i=e.asymmetricKeyDetails.namedCurve,o=LL[r];if(i!==o)throw new Error(`"alg" parameter "${r}" requires curve "${o}".`);break;case"rsa-pss":if(ML){let s=parseInt(r.slice(-3),10),{hashAlgorithm:a,mgf1HashAlgorithm:c,saltLength:l}=e.asymmetricKeyDetails;if(a!==`sha${s}`||c!==a)throw new Error(`Invalid key for this operation, its RSA-PSS parameters do not meet the requirements of "alg" ${r}.`);if(l!==void 0&&l>s>>3)throw new Error(`Invalid key for this operation, its RSA-PSS parameter saltLength does not meet the requirements of "alg" ${r}.`)}break}}});var Om=T((EX,WA)=>{var UL=bd();WA.exports=UL.satisfies(process.version,"^6.12.0 || >=8.0.0")});var QA=T((TX,XA)=>{var de=Na(),HL=am(),ZA=cm(),FL=sm(),$L=lm(),qL=bm(),jL=Om(),BL=hd(),{KeyObject:zL,createSecretKey:GL,createPublicKey:VL}=ie("crypto"),km=["RS256","RS384","RS512"],KL=["ES256","ES384","ES512"],xm=["RS256","RS384","RS512"],YL=["HS256","HS384","HS512"];jL&&(km.splice(km.length,0,"PS256","PS384","PS512"),xm.splice(xm.length,0,"PS256","PS384","PS512"));XA.exports=function(r,e,t,n){typeof t=="function"&&!n&&(n=t,t={}),t||(t={}),t=Object.assign({},t);let i;if(n?i=n:i=function(u,d){if(u)throw u;return d},t.clockTimestamp&&typeof t.clockTimestamp!="number")return i(new de("clockTimestamp must be a number"));if(t.nonce!==void 0&&(typeof t.nonce!="string"||t.nonce.trim()===""))return i(new de("nonce must be a non-empty string"));if(t.allowInvalidAsymmetricKeyTypes!==void 0&&typeof t.allowInvalidAsymmetricKeyTypes!="boolean")return i(new de("allowInvalidAsymmetricKeyTypes must be a boolean"));let o=t.clockTimestamp||Math.floor(Date.now()/1e3);if(!r)return i(new de("jwt must be provided"));if(typeof r!="string")return i(new de("jwt must be a string"));let s=r.split(".");if(s.length!==3)return i(new de("jwt malformed"));let a;try{a=FL(r,{complete:!0})}catch(u){return i(u)}if(!a)return i(new de("invalid token"));let c=a.header,l;if(typeof e=="function"){if(!n)return i(new de("verify must be called asynchronous if secret or public key is provided as a callback"));l=e}else l=function(u,d){return d(null,e)};return l(c,function(u,d){if(u)return i(new de("error in secret or public key callback: "+u.message));let h=s[2].trim()!=="";if(!h&&d)return i(new de("jwt signature is required"));if(h&&!d)return i(new de("secret or public key must be provided"));if(!h&&!t.algorithms)return i(new de('please specify "none" in "algorithms" to verify unsigned tokens'));if(d!=null&&!(d instanceof zL))try{d=VL(d)}catch{try{d=GL(typeof d=="string"?Buffer.from(d):d)}catch{return i(new de("secretOrPublicKey is not valid key material"))}}if(t.algorithms||(d.type==="secret"?t.algorithms=YL:["rsa","rsa-pss"].includes(d.asymmetricKeyType)?t.algorithms=xm:d.asymmetricKeyType==="ec"?t.algorithms=KL:t.algorithms=km),t.algorithms.indexOf(a.header.alg)===-1)return i(new de("invalid algorithm"));if(c.alg.startsWith("HS")&&d.type!=="secret")return i(new de(`secretOrPublicKey must be a symmetric key when using ${c.alg}`));if(/^(?:RS|PS|ES)/.test(c.alg)&&d.type!=="public")return i(new de(`secretOrPublicKey must be an asymmetric key when using ${c.alg}`));if(!t.allowInvalidAsymmetricKeyTypes)try{qL(c.alg,d)}catch(y){return i(y)}let p;try{p=BL.verify(r,a.header.alg,d)}catch(y){return i(y)}if(!p)return i(new de("invalid signature"));let m=a.payload;if(typeof m.nbf<"u"&&!t.ignoreNotBefore){if(typeof m.nbf!="number")return i(new de("invalid nbf value"));if(m.nbf>o+(t.clockTolerance||0))return i(new HL("jwt not active",new Date(m.nbf*1e3)))}if(typeof m.exp<"u"&&!t.ignoreExpiration){if(typeof m.exp!="number")return i(new de("invalid exp value"));if(o>=m.exp+(t.clockTolerance||0))return i(new ZA("jwt expired",new Date(m.exp*1e3)))}if(t.audience){let y=Array.isArray(t.audience)?t.audience:[t.audience];if(!(Array.isArray(m.aud)?m.aud:[m.aud]).some(function(D){return y.some(function(U){return U instanceof RegExp?U.test(D):U===D})}))return i(new de("jwt audience invalid. expected: "+y.join(" or ")))}if(t.issuer&&(typeof t.issuer=="string"&&m.iss!==t.issuer||Array.isArray(t.issuer)&&t.issuer.indexOf(m.iss)===-1))return i(new de("jwt issuer invalid. expected: "+t.issuer));if(t.subject&&m.sub!==t.subject)return i(new de("jwt subject invalid. expected: "+t.subject));if(t.jwtid&&m.jti!==t.jwtid)return i(new de("jwt jwtid invalid. expected: "+t.jwtid));if(t.nonce&&m.nonce!==t.nonce)return i(new de("jwt nonce invalid. expected: "+t.nonce));if(t.maxAge){if(typeof m.iat!="number")return i(new de("iat required when maxAge is specified"));let y=$L(t.maxAge,m.iat);if(typeof y>"u")return i(new de('"maxAge" should be a number of seconds or string representing a timespan eg: "1d", "20h", 60'));if(o>=y+(t.clockTolerance||0))return i(new ZA("maxAge exceeded",new Date(y*1e3)))}if(t.complete===!0){let y=a.signature;return i(null,{header:c,payload:m,signature:y})}return i(null,m)})}});var iS=T((vX,nS)=>{var JA=1/0,tS=9007199254740991,WL=17976931348623157e292,eS=NaN,ZL="[object Arguments]",XL="[object Function]",QL="[object GeneratorFunction]",JL="[object String]",eU="[object Symbol]",tU=/^\s+|\s+$/g,rU=/^[-+]0x[0-9a-f]+$/i,nU=/^0b[01]+$/i,iU=/^0o[0-7]+$/i,oU=/^(?:0|[1-9]\d*)$/,sU=parseInt;function aU(r,e){for(var t=-1,n=r?r.length:0,i=Array(n);++t<n;)i[t]=e(r[t],t,r);return i}function cU(r,e,t,n){for(var i=r.length,o=t+(n?1:-1);n?o--:++o<i;)if(e(r[o],o,r))return o;return-1}function lU(r,e,t){if(e!==e)return cU(r,uU,t);for(var n=t-1,i=r.length;++n<i;)if(r[n]===e)return n;return-1}function uU(r){return r!==r}function dU(r,e){for(var t=-1,n=Array(r);++t<r;)n[t]=e(t);return n}function fU(r,e){return aU(e,function(t){return r[t]})}function hU(r,e){return function(t){return r(e(t))}}var Od=Object.prototype,Nm=Od.hasOwnProperty,kd=Od.toString,pU=Od.propertyIsEnumerable,mU=hU(Object.keys,Object),gU=Math.max;function yU(r,e){var t=rS(r)||_U(r)?dU(r.length,String):[],n=t.length,i=!!n;for(var o in r)(e||Nm.call(r,o))&&!(i&&(o=="length"||TU(o,n)))&&t.push(o);return t}function EU(r){if(!vU(r))return mU(r);var e=[];for(var t in Object(r))Nm.call(r,t)&&t!="constructor"&&e.push(t);return e}function TU(r,e){return e=e??tS,!!e&&(typeof r=="number"||oU.test(r))&&r>-1&&r%1==0&&r<e}function vU(r){var e=r&&r.constructor,t=typeof e=="function"&&e.prototype||Od;return r===t}function CU(r,e,t,n){r=Mm(r)?r:PU(r),t=t&&!n?OU(t):0;var i=r.length;return t<0&&(t=gU(i+t,0)),RU(r)?t<=i&&r.indexOf(e,t)>-1:!!i&&lU(r,e,t)>-1}function _U(r){return AU(r)&&Nm.call(r,"callee")&&(!pU.call(r,"callee")||kd.call(r)==ZL)}var rS=Array.isArray;function Mm(r){return r!=null&&wU(r.length)&&!SU(r)}function AU(r){return Dm(r)&&Mm(r)}function SU(r){var e=Pm(r)?kd.call(r):"";return e==XL||e==QL}function wU(r){return typeof r=="number"&&r>-1&&r%1==0&&r<=tS}function Pm(r){var e=typeof r;return!!r&&(e=="object"||e=="function")}function Dm(r){return!!r&&typeof r=="object"}function RU(r){return typeof r=="string"||!rS(r)&&Dm(r)&&kd.call(r)==JL}function IU(r){return typeof r=="symbol"||Dm(r)&&kd.call(r)==eU}function bU(r){if(!r)return r===0?r:0;if(r=kU(r),r===JA||r===-JA){var e=r<0?-1:1;return e*WL}return r===r?r:0}function OU(r){var e=bU(r),t=e%1;return e===e?t?e-t:e:0}function kU(r){if(typeof r=="number")return r;if(IU(r))return eS;if(Pm(r)){var e=typeof r.valueOf=="function"?r.valueOf():r;r=Pm(e)?e+"":e}if(typeof r!="string")return r===0?r:+r;r=r.replace(tU,"");var t=nU.test(r);return t||iU.test(r)?sU(r.slice(2),t?2:8):rU.test(r)?eS:+r}function xU(r){return Mm(r)?yU(r):EU(r)}function PU(r){return r?fU(r,xU(r)):[]}nS.exports=CU});var sS=T((CX,oS)=>{var NU="[object Boolean]",MU=Object.prototype,DU=MU.toString;function LU(r){return r===!0||r===!1||UU(r)&&DU.call(r)==NU}function UU(r){return!!r&&typeof r=="object"}oS.exports=LU});var dS=T((_X,uS)=>{var aS=1/0,HU=17976931348623157e292,cS=NaN,FU="[object Symbol]",$U=/^\s+|\s+$/g,qU=/^[-+]0x[0-9a-f]+$/i,jU=/^0b[01]+$/i,BU=/^0o[0-7]+$/i,zU=parseInt,GU=Object.prototype,VU=GU.toString;function KU(r){return typeof r=="number"&&r==XU(r)}function lS(r){var e=typeof r;return!!r&&(e=="object"||e=="function")}function YU(r){return!!r&&typeof r=="object"}function WU(r){return typeof r=="symbol"||YU(r)&&VU.call(r)==FU}function ZU(r){if(!r)return r===0?r:0;if(r=QU(r),r===aS||r===-aS){var e=r<0?-1:1;return e*HU}return r===r?r:0}function XU(r){var e=ZU(r),t=e%1;return e===e?t?e-t:e:0}function QU(r){if(typeof r=="number")return r;if(WU(r))return cS;if(lS(r)){var e=typeof r.valueOf=="function"?r.valueOf():r;r=lS(e)?e+"":e}if(typeof r!="string")return r===0?r:+r;r=r.replace($U,"");var t=jU.test(r);return t||BU.test(r)?zU(r.slice(2),t?2:8):qU.test(r)?cS:+r}uS.exports=KU});var hS=T((AX,fS)=>{var JU="[object Number]",eH=Object.prototype,tH=eH.toString;function rH(r){return!!r&&typeof r=="object"}function nH(r){return typeof r=="number"||rH(r)&&tH.call(r)==JU}fS.exports=nH});var yS=T((SX,gS)=>{var iH="[object Object]";function oH(r){var e=!1;if(r!=null&&typeof r.toString!="function")try{e=!!(r+"")}catch{}return e}function sH(r,e){return function(t){return r(e(t))}}var aH=Function.prototype,pS=Object.prototype,mS=aH.toString,cH=pS.hasOwnProperty,lH=mS.call(Object),uH=pS.toString,dH=sH(Object.getPrototypeOf,Object);function fH(r){return!!r&&typeof r=="object"}function hH(r){if(!fH(r)||uH.call(r)!=iH||oH(r))return!1;var e=dH(r);if(e===null)return!0;var t=cH.call(e,"constructor")&&e.constructor;return typeof t=="function"&&t instanceof t&&mS.call(t)==lH}gS.exports=hH});var TS=T((wX,ES)=>{var pH="[object String]",mH=Object.prototype,gH=mH.toString,yH=Array.isArray;function EH(r){return!!r&&typeof r=="object"}function TH(r){return typeof r=="string"||!yH(r)&&EH(r)&&gH.call(r)==pH}ES.exports=TH});var SS=T((RX,AS)=>{var vH="Expected a function",vS=1/0,CH=17976931348623157e292,CS=NaN,_H="[object Symbol]",AH=/^\s+|\s+$/g,SH=/^[-+]0x[0-9a-f]+$/i,wH=/^0b[01]+$/i,RH=/^0o[0-7]+$/i,IH=parseInt,bH=Object.prototype,OH=bH.toString;function kH(r,e){var t;if(typeof e!="function")throw new TypeError(vH);return r=DH(r),function(){return--r>0&&(t=e.apply(this,arguments)),r<=1&&(e=void 0),t}}function xH(r){return kH(2,r)}function _S(r){var e=typeof r;return!!r&&(e=="object"||e=="function")}function PH(r){return!!r&&typeof r=="object"}function NH(r){return typeof r=="symbol"||PH(r)&&OH.call(r)==_H}function MH(r){if(!r)return r===0?r:0;if(r=LH(r),r===vS||r===-vS){var e=r<0?-1:1;return e*CH}return r===r?r:0}function DH(r){var e=MH(r),t=e%1;return e===e?t?e-t:e:0}function LH(r){if(typeof r=="number")return r;if(NH(r))return CS;if(_S(r)){var e=typeof r.valueOf=="function"?r.valueOf():r;r=_S(e)?e+"":e}if(typeof r!="string")return r===0?r:+r;r=r.replace(AH,"");var t=wH.test(r);return t||RH.test(r)?IH(r.slice(2),t?2:8):SH.test(r)?CS:+r}AS.exports=xH});var NS=T((IX,PS)=>{var wS=lm(),UH=Om(),HH=bm(),RS=hd(),FH=iS(),xd=sS(),IS=dS(),Lm=hS(),OS=yS(),Tn=TS(),$H=SS(),{KeyObject:qH,createSecretKey:jH,createPrivateKey:BH}=ie("crypto"),kS=["RS256","RS384","RS512","ES256","ES384","ES512","HS256","HS384","HS512","none"];UH&&kS.splice(3,0,"PS256","PS384","PS512");var zH={expiresIn:{isValid:function(r){return IS(r)||Tn(r)&&r},message:'"expiresIn" should be a number of seconds or string representing a timespan'},notBefore:{isValid:function(r){return IS(r)||Tn(r)&&r},message:'"notBefore" should be a number of seconds or string representing a timespan'},audience:{isValid:function(r){return Tn(r)||Array.isArray(r)},message:'"audience" must be a string or array'},algorithm:{isValid:FH.bind(null,kS),message:'"algorithm" must be a valid string enum value'},header:{isValid:OS,message:'"header" must be an object'},encoding:{isValid:Tn,message:'"encoding" must be a string'},issuer:{isValid:Tn,message:'"issuer" must be a string'},subject:{isValid:Tn,message:'"subject" must be a string'},jwtid:{isValid:Tn,message:'"jwtid" must be a string'},noTimestamp:{isValid:xd,message:'"noTimestamp" must be a boolean'},keyid:{isValid:Tn,message:'"keyid" must be a string'},mutatePayload:{isValid:xd,message:'"mutatePayload" must be a boolean'},allowInsecureKeySizes:{isValid:xd,message:'"allowInsecureKeySizes" must be a boolean'},allowInvalidAsymmetricKeyTypes:{isValid:xd,message:'"allowInvalidAsymmetricKeyTypes" must be a boolean'}},GH={iat:{isValid:Lm,message:'"iat" should be a number of seconds'},exp:{isValid:Lm,message:'"exp" should be a number of seconds'},nbf:{isValid:Lm,message:'"nbf" should be a number of seconds'}};function xS(r,e,t,n){if(!OS(t))throw new Error('Expected "'+n+'" to be a plain object.');Object.keys(t).forEach(function(i){let o=r[i];if(!o){if(!e)throw new Error('"'+i+'" is not allowed in "'+n+'"');return}if(!o.isValid(t[i]))throw new Error(o.message)})}function VH(r){return xS(zH,!1,r,"options")}function KH(r){return xS(GH,!0,r,"payload")}var bS={audience:"aud",issuer:"iss",subject:"sub",jwtid:"jti"},YH=["expiresIn","notBefore","noTimestamp","audience","issuer","subject","jwtid"];PS.exports=function(r,e,t,n){typeof t=="function"?(n=t,t={}):t=t||{};let i=typeof r=="object"&&!Buffer.isBuffer(r),o=Object.assign({alg:t.algorithm||"HS256",typ:i?"JWT":void 0,kid:t.keyid},t.header);function s(l){if(n)return n(l);throw l}if(!e&&t.algorithm!=="none")return s(new Error("secretOrPrivateKey must have a value"));if(e!=null&&!(e instanceof qH))try{e=BH(e)}catch{try{e=jH(typeof e=="string"?Buffer.from(e):e)}catch{return s(new Error("secretOrPrivateKey is not valid key material"))}}if(o.alg.startsWith("HS")&&e.type!=="secret")return s(new Error(`secretOrPrivateKey must be a symmetric key when using ${o.alg}`));if(/^(?:RS|PS|ES)/.test(o.alg)){if(e.type!=="private")return s(new Error(`secretOrPrivateKey must be an asymmetric key when using ${o.alg}`));if(!t.allowInsecureKeySizes&&!o.alg.startsWith("ES")&&e.asymmetricKeyDetails!==void 0&&e.asymmetricKeyDetails.modulusLength<2048)return s(new Error(`secretOrPrivateKey has a minimum key size of 2048 bits for ${o.alg}`))}if(typeof r>"u")return s(new Error("payload is required"));if(i){try{KH(r)}catch(l){return s(l)}t.mutatePayload||(r=Object.assign({},r))}else{let l=YH.filter(function(u){return typeof t[u]<"u"});if(l.length>0)return s(new Error("invalid "+l.join(",")+" option for "+typeof r+" payload"))}if(typeof r.exp<"u"&&typeof t.expiresIn<"u")return s(new Error('Bad "options.expiresIn" option the payload already has an "exp" property.'));if(typeof r.nbf<"u"&&typeof t.notBefore<"u")return s(new Error('Bad "options.notBefore" option the payload already has an "nbf" property.'));try{VH(t)}catch(l){return s(l)}if(!t.allowInvalidAsymmetricKeyTypes)try{HH(o.alg,e)}catch(l){return s(l)}let a=r.iat||Math.floor(Date.now()/1e3);if(t.noTimestamp?delete r.iat:i&&(r.iat=a),typeof t.notBefore<"u"){try{r.nbf=wS(t.notBefore,a)}catch(l){return s(l)}if(typeof r.nbf>"u")return s(new Error('"notBefore" should be a number of seconds or string representing a timespan eg: "1d", "20h", 60'))}if(typeof t.expiresIn<"u"&&typeof r=="object"){try{r.exp=wS(t.expiresIn,a)}catch(l){return s(l)}if(typeof r.exp>"u")return s(new Error('"expiresIn" should be a number of seconds or string representing a timespan eg: "1d", "20h", 60'))}Object.keys(bS).forEach(function(l){let u=bS[l];if(typeof t[l]<"u"){if(typeof r[u]<"u")return s(new Error('Bad "options.'+l+'" option. The payload already has an "'+u+'" property.'));r[u]=t[l]}});let c=t.encoding||"utf8";if(typeof n=="function")n=n&&$H(n),RS.createSign({header:o,privateKey:e,payload:r,encoding:c}).once("error",n).once("done",function(l){if(!t.allowInsecureKeySizes&&/^(?:RS|PS)/.test(o.alg)&&l.length<256)return n(new Error(`secretOrPrivateKey has a minimum key size of 2048 bits for ${o.alg}`));n(null,l)});else{let l=RS.sign({header:o,payload:r,secret:e,encoding:c});if(!t.allowInsecureKeySizes&&/^(?:RS|PS)/.test(o.alg)&&l.length<256)throw new Error(`secretOrPrivateKey has a minimum key size of 2048 bits for ${o.alg}`);return l}}});var DS=T((bX,MS)=>{MS.exports={decode:sm(),verify:QA(),sign:NS(),JsonWebTokenError:Na(),NotBeforeError:am(),TokenExpiredError:cm()}});import KS from"node:fs";function vF(){try{return KS.statSync("/.dockerenv"),!0}catch{return!1}}function CF(){try{return KS.readFileSync("/proc/self/cgroup","utf8").includes("docker")}catch{return!1}}function Bm(){return jm===void 0&&(jm=vF()||CF()),jm}var jm,YS=Bt(()=>{});import _F from"node:fs";function Xo(){return zm===void 0&&(zm=AF()||Bm()),zm}var zm,AF,Gm=Bt(()=>{YS();AF=()=>{try{return _F.statSync("/run/.containerenv"),!0}catch{return!1}}});import ZS from"node:process";import SF from"node:os";import wF from"node:fs";var WS,Za,XS=Bt(()=>{Gm();WS=()=>{if(ZS.platform!=="linux")return!1;if(SF.release().toLowerCase().includes("microsoft"))return!Xo();try{return wF.readFileSync("/proc/version","utf8").toLowerCase().includes("microsoft")?!Xo():!1}catch{return!1}},Za=ZS.env.__IS_WSL_TEST__?WS:WS()});function Hi(r,e,t){let n=i=>Object.defineProperty(r,e,{value:i,enumerable:!0,writable:!0});return Object.defineProperty(r,e,{configurable:!0,enumerable:!0,get(){let i=t();return n(i),i},set(i){n(i)}}),r}var QS=Bt(()=>{});import{promisify as RF}from"node:util";import IF from"node:process";import{execFile as bF}from"node:child_process";async function Vm(){if(IF.platform!=="darwin")throw new Error("macOS only");let{stdout:r}=await OF("defaults",["read","com.apple.LaunchServices/com.apple.launchservices.secure","LSHandlers"]);return/LSHandlerRoleAll = "(?!-)(?<id>[^"]+?)";\s+?LSHandlerURLScheme = (?:http|https);/.exec(r)?.groups.id??"com.apple.Safari"}var OF,JS=Bt(()=>{OF=RF(bF)});import kF from"node:process";import{promisify as xF}from"node:util";import{execFile as PF,execFileSync as K8}from"node:child_process";async function ew(r,{humanReadableOutput:e=!0}={}){if(kF.platform!=="darwin")throw new Error("macOS only");let t=e?[]:["-ss"],{stdout:n}=await NF("osascript",["-e",r,t]);return n.trim()}var NF,tw=Bt(()=>{NF=xF(PF)});async function Km(r){return ew(`tell application "Finder" to set app_path to application file id "${r}" as string
tell application "System Events" to get value of property list item "CFBundleName" of property list file (app_path & ":Contents:Info.plist")`)}var rw=Bt(()=>{tw()});import{promisify as MF}from"node:util";import{execFile as DF}from"node:child_process";async function Ym(r=LF){let{stdout:e}=await r("reg",["QUERY"," HKEY_CURRENT_USER\\Software\\Microsoft\\Windows\\Shell\\Associations\\UrlAssociations\\http\\UserChoice","/v","ProgId"]),t=/ProgId\s*REG_SZ\s*(?<id>\S+)/.exec(e);if(!t)throw new jd(`Cannot find Windows browser in stdout: ${JSON.stringify(e)}`);let{id:n}=t.groups,i=UF[n];if(!i)throw new jd(`Unknown browser ID: ${n}`);return i}var LF,UF,jd,nw=Bt(()=>{LF=MF(DF),UF={AppXq0fevzme2pys62n3e0fbqa7peapykr8v:{name:"Edge",id:"com.microsoft.edge.old"},MSEdgeDHTML:{name:"Edge",id:"com.microsoft.edge"},MSEdgeHTM:{name:"Edge",id:"com.microsoft.edge"},"IE.HTTP":{name:"Internet Explorer",id:"com.microsoft.ie"},FirefoxURL:{name:"Firefox",id:"org.mozilla.firefox"},ChromeHTML:{name:"Chrome",id:"com.google.chrome"},BraveHTML:{name:"Brave",id:"com.brave.Browser"},BraveBHTML:{name:"Brave Beta",id:"com.brave.Browser.beta"},BraveSSHTM:{name:"Brave Nightly",id:"com.brave.Browser.nightly"}},jd=class extends Error{}});import{promisify as HF}from"node:util";import Wm from"node:process";import{execFile as FF}from"node:child_process";async function Zm(){if(Wm.platform==="darwin"){let r=await Vm();return{name:await Km(r),id:r}}if(Wm.platform==="linux"){let{stdout:r}=await $F("xdg-mime",["query","default","x-scheme-handler/http"]),e=r.trim();return{name:qF(e.replace(/.desktop$/,"").replace("-"," ")),id:e}}if(Wm.platform==="win32")return Ym();throw new Error("Only macOS, Linux, and Windows are supported")}var $F,qF,iw=Bt(()=>{JS();rw();nw();$F=HF(FF),qF=r=>r.toLowerCase().replaceAll(/(?:^|\s|-)\S/g,e=>e.toUpperCase())});var dw={};ze(dw,{apps:()=>Fi,default:()=>YF,openApp:()=>KF});import Bd from"node:process";import{Buffer as jF}from"node:buffer";import lw from"node:path";import{fileURLToPath as BF}from"node:url";import zF from"node:child_process";import Xm,{constants as uw}from"node:fs/promises";function cw(r){if(typeof r=="string"||Array.isArray(r))return r;let{[sw]:e}=r;if(!e)throw new Error(`${sw} is not supported`);return e}function Jm({[Qo]:r},{wsl:e}){if(e&&Za)return cw(e);if(!r)throw new Error(`${Qo} is not supported`);return cw(r)}var Qm,ow,Qo,sw,GF,aw,Xa,VF,KF,Fi,YF,fw=Bt(()=>{XS();QS();iw();Gm();Qm=lw.dirname(BF(import.meta.url)),ow=lw.join(Qm,"xdg-open"),{platform:Qo,arch:sw}=Bd,GF=(()=>{let r="/mnt/",e;return async function(){if(e)return e;let t="/etc/wsl.conf",n=!1;try{await Xm.access(t,uw.F_OK),n=!0}catch{}if(!n)return r;let i=await Xm.readFile(t,{encoding:"utf8"}),o=/(?<!#.*)root\s*=\s*(?<mountPoint>.*)/g.exec(i);return o?(e=o.groups.mountPoint.trim(),e=e.endsWith("/")?e:`${e}/`,e):r}})(),aw=async(r,e)=>{let t;for(let n of r)try{return await e(n)}catch(i){t=i}throw t},Xa=async r=>{if(r={wait:!1,background:!1,newInstance:!1,allowNonzeroExitCode:!1,...r},Array.isArray(r.app))return aw(r.app,a=>Xa({...r,app:a}));let{name:e,arguments:t=[]}=r.app??{};if(t=[...t],Array.isArray(e))return aw(e,a=>Xa({...r,app:{name:a,arguments:t}}));if(e==="browser"||e==="browserPrivate"){let a={"com.google.chrome":"chrome","google-chrome.desktop":"chrome","org.mozilla.firefox":"firefox","firefox.desktop":"firefox","com.microsoft.msedge":"edge","com.microsoft.edge":"edge","com.microsoft.edgemac":"edge","microsoft-edge.desktop":"edge"},c={chrome:"--incognito",firefox:"--private-window",edge:"--inPrivate"},l=await Zm();if(l.id in a){let u=a[l.id];return e==="browserPrivate"&&t.push(c[u]),Xa({...r,app:{name:Fi[u],arguments:t}})}throw new Error(`${l.name} is not supported as a default browser`)}let n,i=[],o={};if(Qo==="darwin")n="open",r.wait&&i.push("--wait-apps"),r.background&&i.push("--background"),r.newInstance&&i.push("--new"),e&&i.push("-a",e);else if(Qo==="win32"||Za&&!Xo()&&!e){let a=await GF();n=Za?`${a}c/Windows/System32/WindowsPowerShell/v1.0/powershell.exe`:`${Bd.env.SYSTEMROOT||Bd.env.windir||"C:\\Windows"}\\System32\\WindowsPowerShell\\v1.0\\powershell`,i.push("-NoProfile","-NonInteractive","-ExecutionPolicy","Bypass","-EncodedCommand"),Za||(o.windowsVerbatimArguments=!0);let c=["Start"];r.wait&&c.push("-Wait"),e?(c.push(`"\`"${e}\`""`),r.target&&t.push(r.target)):r.target&&c.push(`"${r.target}"`),t.length>0&&(t=t.map(l=>`"\`"${l}\`""`),c.push("-ArgumentList",t.join(","))),r.target=jF.from(c.join(" "),"utf16le").toString("base64")}else{if(e)n=e;else{let a=!Qm||Qm==="/",c=!1;try{await Xm.access(ow,uw.X_OK),c=!0}catch{}n=Bd.versions.electron??(Qo==="android"||a||!c)?"xdg-open":ow}t.length>0&&i.push(...t),r.wait||(o.stdio="ignore",o.detached=!0)}Qo==="darwin"&&t.length>0&&i.push("--args",...t),r.target&&i.push(r.target);let s=zF.spawn(n,i,o);return r.wait?new Promise((a,c)=>{s.once("error",c),s.once("close",l=>{if(!r.allowNonzeroExitCode&&l>0){c(new Error(`Exited with code ${l}`));return}a(s)})}):(s.unref(),s)},VF=(r,e)=>{if(typeof r!="string")throw new TypeError("Expected a `target`");return Xa({...e,target:r})},KF=(r,e)=>{if(typeof r!="string"&&!Array.isArray(r))throw new TypeError("Expected a valid `name`");let{arguments:t=[]}=e??{};if(t!=null&&!Array.isArray(t))throw new TypeError("Expected `appArguments` as Array type");return Xa({...e,app:{name:r,arguments:t}})};Fi={};Hi(Fi,"chrome",()=>Jm({darwin:"google chrome",win32:"chrome",linux:["google-chrome","google-chrome-stable","chromium"]},{wsl:{ia32:"/mnt/c/Program Files (x86)/Google/Chrome/Application/chrome.exe",x64:["/mnt/c/Program Files/Google/Chrome/Application/chrome.exe","/mnt/c/Program Files (x86)/Google/Chrome/Application/chrome.exe"]}}));Hi(Fi,"firefox",()=>Jm({darwin:"firefox",win32:"C:\\Program Files\\Mozilla Firefox\\firefox.exe",linux:"firefox"},{wsl:"/mnt/c/Program Files/Mozilla Firefox/firefox.exe"}));Hi(Fi,"edge",()=>Jm({darwin:"microsoft edge",win32:"msedge",linux:["microsoft-edge","microsoft-edge-dev"]},{wsl:"/mnt/c/Program Files (x86)/Microsoft/Edge/Application/msedge.exe"}));Hi(Fi,"browser",()=>"browser");Hi(Fi,"browserPrivate",()=>"browserPrivate");YF=VF});var oe;(function(r){r.assertEqual=i=>i;function e(i){}r.assertIs=e;function t(i){throw new Error}r.assertNever=t,r.arrayToEnum=i=>{let o={};for(let s of i)o[s]=s;return o},r.getValidEnumValues=i=>{let o=r.objectKeys(i).filter(a=>typeof i[i[a]]!="number"),s={};for(let a of o)s[a]=i[a];return r.objectValues(s)},r.objectValues=i=>r.objectKeys(i).map(function(o){return i[o]}),r.objectKeys=typeof Object.keys=="function"?i=>Object.keys(i):i=>{let o=[];for(let s in i)Object.prototype.hasOwnProperty.call(i,s)&&o.push(s);return o},r.find=(i,o)=>{for(let s of i)if(o(s))return s},r.isInteger=typeof Number.isInteger=="function"?i=>Number.isInteger(i):i=>typeof i=="number"&&isFinite(i)&&Math.floor(i)===i;function n(i,o=" | "){return i.map(s=>typeof s=="string"?`'${s}'`:s).join(o)}r.joinValues=n,r.jsonStringifyReplacer=(i,o)=>typeof o=="bigint"?o.toString():o})(oe||(oe={}));var Kd;(function(r){r.mergeShapes=(e,t)=>({...e,...t})})(Kd||(Kd={}));var O=oe.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),Ar=r=>{switch(typeof r){case"undefined":return O.undefined;case"string":return O.string;case"number":return isNaN(r)?O.nan:O.number;case"boolean":return O.boolean;case"function":return O.function;case"bigint":return O.bigint;case"symbol":return O.symbol;case"object":return Array.isArray(r)?O.array:r===null?O.null:r.then&&typeof r.then=="function"&&r.catch&&typeof r.catch=="function"?O.promise:typeof Map<"u"&&r instanceof Map?O.map:typeof Set<"u"&&r instanceof Set?O.set:typeof Date<"u"&&r instanceof Date?O.date:O.object;default:return O.unknown}},C=oe.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]),Rw=r=>JSON.stringify(r,null,2).replace(/"([^"]+)":/g,"$1:"),yt=class r extends Error{get errors(){return this.issues}constructor(e){super(),this.issues=[],this.addIssue=n=>{this.issues=[...this.issues,n]},this.addIssues=(n=[])=>{this.issues=[...this.issues,...n]};let t=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,t):this.__proto__=t,this.name="ZodError",this.issues=e}format(e){let t=e||function(o){return o.message},n={_errors:[]},i=o=>{for(let s of o.issues)if(s.code==="invalid_union")s.unionErrors.map(i);else if(s.code==="invalid_return_type")i(s.returnTypeError);else if(s.code==="invalid_arguments")i(s.argumentsError);else if(s.path.length===0)n._errors.push(t(s));else{let a=n,c=0;for(;c<s.path.length;){let l=s.path[c];c===s.path.length-1?(a[l]=a[l]||{_errors:[]},a[l]._errors.push(t(s))):a[l]=a[l]||{_errors:[]},a=a[l],c++}}};return i(this),n}static assert(e){if(!(e instanceof r))throw new Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,oe.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(e=t=>t.message){let t={},n=[];for(let i of this.issues)i.path.length>0?(t[i.path[0]]=t[i.path[0]]||[],t[i.path[0]].push(e(i))):n.push(e(i));return{formErrors:n,fieldErrors:t}}get formErrors(){return this.flatten()}};yt.create=r=>new yt(r);var zi=(r,e)=>{let t;switch(r.code){case C.invalid_type:r.received===O.undefined?t="Required":t=`Expected ${r.expected}, received ${r.received}`;break;case C.invalid_literal:t=`Invalid literal value, expected ${JSON.stringify(r.expected,oe.jsonStringifyReplacer)}`;break;case C.unrecognized_keys:t=`Unrecognized key(s) in object: ${oe.joinValues(r.keys,", ")}`;break;case C.invalid_union:t="Invalid input";break;case C.invalid_union_discriminator:t=`Invalid discriminator value. Expected ${oe.joinValues(r.options)}`;break;case C.invalid_enum_value:t=`Invalid enum value. Expected ${oe.joinValues(r.options)}, received '${r.received}'`;break;case C.invalid_arguments:t="Invalid function arguments";break;case C.invalid_return_type:t="Invalid function return type";break;case C.invalid_date:t="Invalid date";break;case C.invalid_string:typeof r.validation=="object"?"includes"in r.validation?(t=`Invalid input: must include "${r.validation.includes}"`,typeof r.validation.position=="number"&&(t=`${t} at one or more positions greater than or equal to ${r.validation.position}`)):"startsWith"in r.validation?t=`Invalid input: must start with "${r.validation.startsWith}"`:"endsWith"in r.validation?t=`Invalid input: must end with "${r.validation.endsWith}"`:oe.assertNever(r.validation):r.validation!=="regex"?t=`Invalid ${r.validation}`:t="Invalid";break;case C.too_small:r.type==="array"?t=`Array must contain ${r.exact?"exactly":r.inclusive?"at least":"more than"} ${r.minimum} element(s)`:r.type==="string"?t=`String must contain ${r.exact?"exactly":r.inclusive?"at least":"over"} ${r.minimum} character(s)`:r.type==="number"?t=`Number must be ${r.exact?"exactly equal to ":r.inclusive?"greater than or equal to ":"greater than "}${r.minimum}`:r.type==="date"?t=`Date must be ${r.exact?"exactly equal to ":r.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(r.minimum))}`:t="Invalid input";break;case C.too_big:r.type==="array"?t=`Array must contain ${r.exact?"exactly":r.inclusive?"at most":"less than"} ${r.maximum} element(s)`:r.type==="string"?t=`String must contain ${r.exact?"exactly":r.inclusive?"at most":"under"} ${r.maximum} character(s)`:r.type==="number"?t=`Number must be ${r.exact?"exactly":r.inclusive?"less than or equal to":"less than"} ${r.maximum}`:r.type==="bigint"?t=`BigInt must be ${r.exact?"exactly":r.inclusive?"less than or equal to":"less than"} ${r.maximum}`:r.type==="date"?t=`Date must be ${r.exact?"exactly":r.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(r.maximum))}`:t="Invalid input";break;case C.custom:t="Invalid input";break;case C.invalid_intersection_types:t="Intersection results could not be merged";break;case C.not_multiple_of:t=`Number must be a multiple of ${r.multipleOf}`;break;case C.not_finite:t="Number must be finite";break;default:t=e.defaultError,oe.assertNever(r)}return{message:t}},og=zi;function Iw(r){og=r}function tc(){return og}var rc=r=>{let{data:e,path:t,errorMaps:n,issueData:i}=r,o=[...t,...i.path||[]],s={...i,path:o};if(i.message!==void 0)return{...i,path:o,message:i.message};let a="",c=n.filter(l=>!!l).slice().reverse();for(let l of c)a=l(s,{data:e,defaultError:a}).message;return{...i,path:o,message:a}},bw=[];function R(r,e){let t=tc(),n=rc({issueData:e,data:r.data,path:r.path,errorMaps:[r.common.contextualErrorMap,r.schemaErrorMap,t,t===zi?void 0:zi].filter(i=>!!i)});r.common.issues.push(n)}var Ge=class r{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(e,t){let n=[];for(let i of t){if(i.status==="aborted")return q;i.status==="dirty"&&e.dirty(),n.push(i.value)}return{status:e.value,value:n}}static async mergeObjectAsync(e,t){let n=[];for(let i of t){let o=await i.key,s=await i.value;n.push({key:o,value:s})}return r.mergeObjectSync(e,n)}static mergeObjectSync(e,t){let n={};for(let i of t){let{key:o,value:s}=i;if(o.status==="aborted"||s.status==="aborted")return q;o.status==="dirty"&&e.dirty(),s.status==="dirty"&&e.dirty(),o.value!=="__proto__"&&(typeof s.value<"u"||i.alwaysSet)&&(n[o.value]=s.value)}return{status:e.value,value:n}}},q=Object.freeze({status:"aborted"}),Bi=r=>({status:"dirty",value:r}),Ye=r=>({status:"valid",value:r}),Yd=r=>r.status==="aborted",Wd=r=>r.status==="dirty",_n=r=>r.status==="valid",ns=r=>typeof Promise<"u"&&r instanceof Promise;function nc(r,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?r!==e||!n:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(r):n?n.value:e.get(r)}function sg(r,e,t,n,i){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!i)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?r!==e||!i:!e.has(r))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?i.call(r,t):i?i.value=t:e.set(r,t),t}var M;(function(r){r.errToObj=e=>typeof e=="string"?{message:e}:e||{},r.toString=e=>typeof e=="string"?e:e?.message})(M||(M={}));var ts,rs,Nt=class{constructor(e,t,n,i){this._cachedPath=[],this.parent=e,this.data=t,this._path=n,this._key=i}get path(){return this._cachedPath.length||(this._key instanceof Array?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}},rg=(r,e)=>{if(_n(e))return{success:!0,data:e.value};if(!r.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;let t=new yt(r.common.issues);return this._error=t,this._error}}};function Y(r){if(!r)return{};let{errorMap:e,invalid_type_error:t,required_error:n,description:i}=r;if(e&&(t||n))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return e?{errorMap:e,description:i}:{errorMap:(s,a)=>{var c,l;let{message:u}=r;return s.code==="invalid_enum_value"?{message:u??a.defaultError}:typeof a.data>"u"?{message:(c=u??n)!==null&&c!==void 0?c:a.defaultError}:s.code!=="invalid_type"?{message:a.defaultError}:{message:(l=u??t)!==null&&l!==void 0?l:a.defaultError}},description:i}}var z=class{get description(){return this._def.description}_getType(e){return Ar(e.data)}_getOrReturnCtx(e,t){return t||{common:e.parent.common,data:e.data,parsedType:Ar(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new Ge,ctx:{common:e.parent.common,data:e.data,parsedType:Ar(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){let t=this._parse(e);if(ns(t))throw new Error("Synchronous parse encountered promise.");return t}_parseAsync(e){let t=this._parse(e);return Promise.resolve(t)}parse(e,t){let n=this.safeParse(e,t);if(n.success)return n.data;throw n.error}safeParse(e,t){var n;let i={common:{issues:[],async:(n=t?.async)!==null&&n!==void 0?n:!1,contextualErrorMap:t?.errorMap},path:t?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Ar(e)},o=this._parseSync({data:e,path:i.path,parent:i});return rg(i,o)}"~validate"(e){var t,n;let i={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Ar(e)};if(!this["~standard"].async)try{let o=this._parseSync({data:e,path:[],parent:i});return _n(o)?{value:o.value}:{issues:i.common.issues}}catch(o){!((n=(t=o?.message)===null||t===void 0?void 0:t.toLowerCase())===null||n===void 0)&&n.includes("encountered")&&(this["~standard"].async=!0),i.common={issues:[],async:!0}}return this._parseAsync({data:e,path:[],parent:i}).then(o=>_n(o)?{value:o.value}:{issues:i.common.issues})}async parseAsync(e,t){let n=await this.safeParseAsync(e,t);if(n.success)return n.data;throw n.error}async safeParseAsync(e,t){let n={common:{issues:[],contextualErrorMap:t?.errorMap,async:!0},path:t?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Ar(e)},i=this._parse({data:e,path:n.path,parent:n}),o=await(ns(i)?i:Promise.resolve(i));return rg(n,o)}refine(e,t){let n=i=>typeof t=="string"||typeof t>"u"?{message:t}:typeof t=="function"?t(i):t;return this._refinement((i,o)=>{let s=e(i),a=()=>o.addIssue({code:C.custom,...n(i)});return typeof Promise<"u"&&s instanceof Promise?s.then(c=>c?!0:(a(),!1)):s?!0:(a(),!1)})}refinement(e,t){return this._refinement((n,i)=>e(n)?!0:(i.addIssue(typeof t=="function"?t(n,i):t),!1))}_refinement(e){return new Et({schema:this,typeName:_.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:t=>this["~validate"](t)}}optional(){return it.create(this,this._def)}nullable(){return tr.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return wr.create(this)}promise(){return Wr.create(this,this._def)}or(e){return On.create([this,e],this._def)}and(e){return kn.create(this,e,this._def)}transform(e){return new Et({...Y(this._def),schema:this,typeName:_.ZodEffects,effect:{type:"transform",transform:e}})}default(e){let t=typeof e=="function"?e:()=>e;return new Dn({...Y(this._def),innerType:this,defaultValue:t,typeName:_.ZodDefault})}brand(){return new is({typeName:_.ZodBranded,type:this,...Y(this._def)})}catch(e){let t=typeof e=="function"?e:()=>e;return new Ln({...Y(this._def),innerType:this,catchValue:t,typeName:_.ZodCatch})}describe(e){let t=this.constructor;return new t({...this._def,description:e})}pipe(e){return os.create(this,e)}readonly(){return Un.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}},Ow=/^c[^\s-]{8,}$/i,kw=/^[0-9a-z]+$/,xw=/^[0-9A-HJKMNP-TV-Z]{26}$/i,Pw=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,Nw=/^[a-z0-9_-]{21}$/i,Mw=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,Dw=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,Lw=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,Uw="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$",Vd,Hw=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,Fw=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,$w=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,qw=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,jw=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,Bw=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,ag="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",zw=new RegExp(`^${ag}$`);function cg(r){let e="([01]\\d|2[0-3]):[0-5]\\d:[0-5]\\d";return r.precision?e=`${e}\\.\\d{${r.precision}}`:r.precision==null&&(e=`${e}(\\.\\d+)?`),e}function Gw(r){return new RegExp(`^${cg(r)}$`)}function lg(r){let e=`${ag}T${cg(r)}`,t=[];return t.push(r.local?"Z?":"Z"),r.offset&&t.push("([+-]\\d{2}:?\\d{2})"),e=`${e}(${t.join("|")})`,new RegExp(`^${e}$`)}function Vw(r,e){return!!((e==="v4"||!e)&&Hw.test(r)||(e==="v6"||!e)&&$w.test(r))}function Kw(r,e){if(!Mw.test(r))return!1;try{let[t]=r.split("."),n=t.replace(/-/g,"+").replace(/_/g,"/").padEnd(t.length+(4-t.length%4)%4,"="),i=JSON.parse(atob(n));return!(typeof i!="object"||i===null||!i.typ||!i.alg||e&&i.alg!==e)}catch{return!1}}function Yw(r,e){return!!((e==="v4"||!e)&&Fw.test(r)||(e==="v6"||!e)&&qw.test(r))}var Kr=class r extends z{_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==O.string){let o=this._getOrReturnCtx(e);return R(o,{code:C.invalid_type,expected:O.string,received:o.parsedType}),q}let n=new Ge,i;for(let o of this._def.checks)if(o.kind==="min")e.data.length<o.value&&(i=this._getOrReturnCtx(e,i),R(i,{code:C.too_small,minimum:o.value,type:"string",inclusive:!0,exact:!1,message:o.message}),n.dirty());else if(o.kind==="max")e.data.length>o.value&&(i=this._getOrReturnCtx(e,i),R(i,{code:C.too_big,maximum:o.value,type:"string",inclusive:!0,exact:!1,message:o.message}),n.dirty());else if(o.kind==="length"){let s=e.data.length>o.value,a=e.data.length<o.value;(s||a)&&(i=this._getOrReturnCtx(e,i),s?R(i,{code:C.too_big,maximum:o.value,type:"string",inclusive:!0,exact:!0,message:o.message}):a&&R(i,{code:C.too_small,minimum:o.value,type:"string",inclusive:!0,exact:!0,message:o.message}),n.dirty())}else if(o.kind==="email")Lw.test(e.data)||(i=this._getOrReturnCtx(e,i),R(i,{validation:"email",code:C.invalid_string,message:o.message}),n.dirty());else if(o.kind==="emoji")Vd||(Vd=new RegExp(Uw,"u")),Vd.test(e.data)||(i=this._getOrReturnCtx(e,i),R(i,{validation:"emoji",code:C.invalid_string,message:o.message}),n.dirty());else if(o.kind==="uuid")Pw.test(e.data)||(i=this._getOrReturnCtx(e,i),R(i,{validation:"uuid",code:C.invalid_string,message:o.message}),n.dirty());else if(o.kind==="nanoid")Nw.test(e.data)||(i=this._getOrReturnCtx(e,i),R(i,{validation:"nanoid",code:C.invalid_string,message:o.message}),n.dirty());else if(o.kind==="cuid")Ow.test(e.data)||(i=this._getOrReturnCtx(e,i),R(i,{validation:"cuid",code:C.invalid_string,message:o.message}),n.dirty());else if(o.kind==="cuid2")kw.test(e.data)||(i=this._getOrReturnCtx(e,i),R(i,{validation:"cuid2",code:C.invalid_string,message:o.message}),n.dirty());else if(o.kind==="ulid")xw.test(e.data)||(i=this._getOrReturnCtx(e,i),R(i,{validation:"ulid",code:C.invalid_string,message:o.message}),n.dirty());else if(o.kind==="url")try{new URL(e.data)}catch{i=this._getOrReturnCtx(e,i),R(i,{validation:"url",code:C.invalid_string,message:o.message}),n.dirty()}else o.kind==="regex"?(o.regex.lastIndex=0,o.regex.test(e.data)||(i=this._getOrReturnCtx(e,i),R(i,{validation:"regex",code:C.invalid_string,message:o.message}),n.dirty())):o.kind==="trim"?e.data=e.data.trim():o.kind==="includes"?e.data.includes(o.value,o.position)||(i=this._getOrReturnCtx(e,i),R(i,{code:C.invalid_string,validation:{includes:o.value,position:o.position},message:o.message}),n.dirty()):o.kind==="toLowerCase"?e.data=e.data.toLowerCase():o.kind==="toUpperCase"?e.data=e.data.toUpperCase():o.kind==="startsWith"?e.data.startsWith(o.value)||(i=this._getOrReturnCtx(e,i),R(i,{code:C.invalid_string,validation:{startsWith:o.value},message:o.message}),n.dirty()):o.kind==="endsWith"?e.data.endsWith(o.value)||(i=this._getOrReturnCtx(e,i),R(i,{code:C.invalid_string,validation:{endsWith:o.value},message:o.message}),n.dirty()):o.kind==="datetime"?lg(o).test(e.data)||(i=this._getOrReturnCtx(e,i),R(i,{code:C.invalid_string,validation:"datetime",message:o.message}),n.dirty()):o.kind==="date"?zw.test(e.data)||(i=this._getOrReturnCtx(e,i),R(i,{code:C.invalid_string,validation:"date",message:o.message}),n.dirty()):o.kind==="time"?Gw(o).test(e.data)||(i=this._getOrReturnCtx(e,i),R(i,{code:C.invalid_string,validation:"time",message:o.message}),n.dirty()):o.kind==="duration"?Dw.test(e.data)||(i=this._getOrReturnCtx(e,i),R(i,{validation:"duration",code:C.invalid_string,message:o.message}),n.dirty()):o.kind==="ip"?Vw(e.data,o.version)||(i=this._getOrReturnCtx(e,i),R(i,{validation:"ip",code:C.invalid_string,message:o.message}),n.dirty()):o.kind==="jwt"?Kw(e.data,o.alg)||(i=this._getOrReturnCtx(e,i),R(i,{validation:"jwt",code:C.invalid_string,message:o.message}),n.dirty()):o.kind==="cidr"?Yw(e.data,o.version)||(i=this._getOrReturnCtx(e,i),R(i,{validation:"cidr",code:C.invalid_string,message:o.message}),n.dirty()):o.kind==="base64"?jw.test(e.data)||(i=this._getOrReturnCtx(e,i),R(i,{validation:"base64",code:C.invalid_string,message:o.message}),n.dirty()):o.kind==="base64url"?Bw.test(e.data)||(i=this._getOrReturnCtx(e,i),R(i,{validation:"base64url",code:C.invalid_string,message:o.message}),n.dirty()):oe.assertNever(o);return{status:n.value,value:e.data}}_regex(e,t,n){return this.refinement(i=>e.test(i),{validation:t,code:C.invalid_string,...M.errToObj(n)})}_addCheck(e){return new r({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...M.errToObj(e)})}url(e){return this._addCheck({kind:"url",...M.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...M.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...M.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...M.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...M.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...M.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...M.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...M.errToObj(e)})}base64url(e){return this._addCheck({kind:"base64url",...M.errToObj(e)})}jwt(e){return this._addCheck({kind:"jwt",...M.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...M.errToObj(e)})}cidr(e){return this._addCheck({kind:"cidr",...M.errToObj(e)})}datetime(e){var t,n;return typeof e=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:typeof e?.precision>"u"?null:e?.precision,offset:(t=e?.offset)!==null&&t!==void 0?t:!1,local:(n=e?.local)!==null&&n!==void 0?n:!1,...M.errToObj(e?.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return typeof e=="string"?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:typeof e?.precision>"u"?null:e?.precision,...M.errToObj(e?.message)})}duration(e){return this._addCheck({kind:"duration",...M.errToObj(e)})}regex(e,t){return this._addCheck({kind:"regex",regex:e,...M.errToObj(t)})}includes(e,t){return this._addCheck({kind:"includes",value:e,position:t?.position,...M.errToObj(t?.message)})}startsWith(e,t){return this._addCheck({kind:"startsWith",value:e,...M.errToObj(t)})}endsWith(e,t){return this._addCheck({kind:"endsWith",value:e,...M.errToObj(t)})}min(e,t){return this._addCheck({kind:"min",value:e,...M.errToObj(t)})}max(e,t){return this._addCheck({kind:"max",value:e,...M.errToObj(t)})}length(e,t){return this._addCheck({kind:"length",value:e,...M.errToObj(t)})}nonempty(e){return this.min(1,M.errToObj(e))}trim(){return new r({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new r({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new r({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>e.kind==="datetime")}get isDate(){return!!this._def.checks.find(e=>e.kind==="date")}get isTime(){return!!this._def.checks.find(e=>e.kind==="time")}get isDuration(){return!!this._def.checks.find(e=>e.kind==="duration")}get isEmail(){return!!this._def.checks.find(e=>e.kind==="email")}get isURL(){return!!this._def.checks.find(e=>e.kind==="url")}get isEmoji(){return!!this._def.checks.find(e=>e.kind==="emoji")}get isUUID(){return!!this._def.checks.find(e=>e.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(e=>e.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(e=>e.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(e=>e.kind==="cuid2")}get isULID(){return!!this._def.checks.find(e=>e.kind==="ulid")}get isIP(){return!!this._def.checks.find(e=>e.kind==="ip")}get isCIDR(){return!!this._def.checks.find(e=>e.kind==="cidr")}get isBase64(){return!!this._def.checks.find(e=>e.kind==="base64")}get isBase64url(){return!!this._def.checks.find(e=>e.kind==="base64url")}get minLength(){let e=null;for(let t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxLength(){let e=null;for(let t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}};Kr.create=r=>{var e;return new Kr({checks:[],typeName:_.ZodString,coerce:(e=r?.coerce)!==null&&e!==void 0?e:!1,...Y(r)})};function Ww(r,e){let t=(r.toString().split(".")[1]||"").length,n=(e.toString().split(".")[1]||"").length,i=t>n?t:n,o=parseInt(r.toFixed(i).replace(".","")),s=parseInt(e.toFixed(i).replace(".",""));return o%s/Math.pow(10,i)}var An=class r extends z{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==O.number){let o=this._getOrReturnCtx(e);return R(o,{code:C.invalid_type,expected:O.number,received:o.parsedType}),q}let n,i=new Ge;for(let o of this._def.checks)o.kind==="int"?oe.isInteger(e.data)||(n=this._getOrReturnCtx(e,n),R(n,{code:C.invalid_type,expected:"integer",received:"float",message:o.message}),i.dirty()):o.kind==="min"?(o.inclusive?e.data<o.value:e.data<=o.value)&&(n=this._getOrReturnCtx(e,n),R(n,{code:C.too_small,minimum:o.value,type:"number",inclusive:o.inclusive,exact:!1,message:o.message}),i.dirty()):o.kind==="max"?(o.inclusive?e.data>o.value:e.data>=o.value)&&(n=this._getOrReturnCtx(e,n),R(n,{code:C.too_big,maximum:o.value,type:"number",inclusive:o.inclusive,exact:!1,message:o.message}),i.dirty()):o.kind==="multipleOf"?Ww(e.data,o.value)!==0&&(n=this._getOrReturnCtx(e,n),R(n,{code:C.not_multiple_of,multipleOf:o.value,message:o.message}),i.dirty()):o.kind==="finite"?Number.isFinite(e.data)||(n=this._getOrReturnCtx(e,n),R(n,{code:C.not_finite,message:o.message}),i.dirty()):oe.assertNever(o);return{status:i.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,M.toString(t))}gt(e,t){return this.setLimit("min",e,!1,M.toString(t))}lte(e,t){return this.setLimit("max",e,!0,M.toString(t))}lt(e,t){return this.setLimit("max",e,!1,M.toString(t))}setLimit(e,t,n,i){return new r({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:n,message:M.toString(i)}]})}_addCheck(e){return new r({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:M.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:M.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:M.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:M.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:M.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:M.toString(t)})}finite(e){return this._addCheck({kind:"finite",message:M.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:M.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:M.toString(e)})}get minValue(){let e=null;for(let t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(let t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}get isInt(){return!!this._def.checks.find(e=>e.kind==="int"||e.kind==="multipleOf"&&oe.isInteger(e.value))}get isFinite(){let e=null,t=null;for(let n of this._def.checks){if(n.kind==="finite"||n.kind==="int"||n.kind==="multipleOf")return!0;n.kind==="min"?(t===null||n.value>t)&&(t=n.value):n.kind==="max"&&(e===null||n.value<e)&&(e=n.value)}return Number.isFinite(t)&&Number.isFinite(e)}};An.create=r=>new An({checks:[],typeName:_.ZodNumber,coerce:r?.coerce||!1,...Y(r)});var Sn=class r extends z{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce)try{e.data=BigInt(e.data)}catch{return this._getInvalidInput(e)}if(this._getType(e)!==O.bigint)return this._getInvalidInput(e);let n,i=new Ge;for(let o of this._def.checks)o.kind==="min"?(o.inclusive?e.data<o.value:e.data<=o.value)&&(n=this._getOrReturnCtx(e,n),R(n,{code:C.too_small,type:"bigint",minimum:o.value,inclusive:o.inclusive,message:o.message}),i.dirty()):o.kind==="max"?(o.inclusive?e.data>o.value:e.data>=o.value)&&(n=this._getOrReturnCtx(e,n),R(n,{code:C.too_big,type:"bigint",maximum:o.value,inclusive:o.inclusive,message:o.message}),i.dirty()):o.kind==="multipleOf"?e.data%o.value!==BigInt(0)&&(n=this._getOrReturnCtx(e,n),R(n,{code:C.not_multiple_of,multipleOf:o.value,message:o.message}),i.dirty()):oe.assertNever(o);return{status:i.value,value:e.data}}_getInvalidInput(e){let t=this._getOrReturnCtx(e);return R(t,{code:C.invalid_type,expected:O.bigint,received:t.parsedType}),q}gte(e,t){return this.setLimit("min",e,!0,M.toString(t))}gt(e,t){return this.setLimit("min",e,!1,M.toString(t))}lte(e,t){return this.setLimit("max",e,!0,M.toString(t))}lt(e,t){return this.setLimit("max",e,!1,M.toString(t))}setLimit(e,t,n,i){return new r({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:n,message:M.toString(i)}]})}_addCheck(e){return new r({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:M.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:M.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:M.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:M.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:M.toString(t)})}get minValue(){let e=null;for(let t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(let t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}};Sn.create=r=>{var e;return new Sn({checks:[],typeName:_.ZodBigInt,coerce:(e=r?.coerce)!==null&&e!==void 0?e:!1,...Y(r)})};var wn=class extends z{_parse(e){if(this._def.coerce&&(e.data=!!e.data),this._getType(e)!==O.boolean){let n=this._getOrReturnCtx(e);return R(n,{code:C.invalid_type,expected:O.boolean,received:n.parsedType}),q}return Ye(e.data)}};wn.create=r=>new wn({typeName:_.ZodBoolean,coerce:r?.coerce||!1,...Y(r)});var Rn=class r extends z{_parse(e){if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==O.date){let o=this._getOrReturnCtx(e);return R(o,{code:C.invalid_type,expected:O.date,received:o.parsedType}),q}if(isNaN(e.data.getTime())){let o=this._getOrReturnCtx(e);return R(o,{code:C.invalid_date}),q}let n=new Ge,i;for(let o of this._def.checks)o.kind==="min"?e.data.getTime()<o.value&&(i=this._getOrReturnCtx(e,i),R(i,{code:C.too_small,message:o.message,inclusive:!0,exact:!1,minimum:o.value,type:"date"}),n.dirty()):o.kind==="max"?e.data.getTime()>o.value&&(i=this._getOrReturnCtx(e,i),R(i,{code:C.too_big,message:o.message,inclusive:!0,exact:!1,maximum:o.value,type:"date"}),n.dirty()):oe.assertNever(o);return{status:n.value,value:new Date(e.data.getTime())}}_addCheck(e){return new r({...this._def,checks:[...this._def.checks,e]})}min(e,t){return this._addCheck({kind:"min",value:e.getTime(),message:M.toString(t)})}max(e,t){return this._addCheck({kind:"max",value:e.getTime(),message:M.toString(t)})}get minDate(){let e=null;for(let t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e!=null?new Date(e):null}get maxDate(){let e=null;for(let t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e!=null?new Date(e):null}};Rn.create=r=>new Rn({checks:[],coerce:r?.coerce||!1,typeName:_.ZodDate,...Y(r)});var Gi=class extends z{_parse(e){if(this._getType(e)!==O.symbol){let n=this._getOrReturnCtx(e);return R(n,{code:C.invalid_type,expected:O.symbol,received:n.parsedType}),q}return Ye(e.data)}};Gi.create=r=>new Gi({typeName:_.ZodSymbol,...Y(r)});var In=class extends z{_parse(e){if(this._getType(e)!==O.undefined){let n=this._getOrReturnCtx(e);return R(n,{code:C.invalid_type,expected:O.undefined,received:n.parsedType}),q}return Ye(e.data)}};In.create=r=>new In({typeName:_.ZodUndefined,...Y(r)});var bn=class extends z{_parse(e){if(this._getType(e)!==O.null){let n=this._getOrReturnCtx(e);return R(n,{code:C.invalid_type,expected:O.null,received:n.parsedType}),q}return Ye(e.data)}};bn.create=r=>new bn({typeName:_.ZodNull,...Y(r)});var Yr=class extends z{constructor(){super(...arguments),this._any=!0}_parse(e){return Ye(e.data)}};Yr.create=r=>new Yr({typeName:_.ZodAny,...Y(r)});var Sr=class extends z{constructor(){super(...arguments),this._unknown=!0}_parse(e){return Ye(e.data)}};Sr.create=r=>new Sr({typeName:_.ZodUnknown,...Y(r)});var zt=class extends z{_parse(e){let t=this._getOrReturnCtx(e);return R(t,{code:C.invalid_type,expected:O.never,received:t.parsedType}),q}};zt.create=r=>new zt({typeName:_.ZodNever,...Y(r)});var Vi=class extends z{_parse(e){if(this._getType(e)!==O.undefined){let n=this._getOrReturnCtx(e);return R(n,{code:C.invalid_type,expected:O.void,received:n.parsedType}),q}return Ye(e.data)}};Vi.create=r=>new Vi({typeName:_.ZodVoid,...Y(r)});var wr=class r extends z{_parse(e){let{ctx:t,status:n}=this._processInputParams(e),i=this._def;if(t.parsedType!==O.array)return R(t,{code:C.invalid_type,expected:O.array,received:t.parsedType}),q;if(i.exactLength!==null){let s=t.data.length>i.exactLength.value,a=t.data.length<i.exactLength.value;(s||a)&&(R(t,{code:s?C.too_big:C.too_small,minimum:a?i.exactLength.value:void 0,maximum:s?i.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:i.exactLength.message}),n.dirty())}if(i.minLength!==null&&t.data.length<i.minLength.value&&(R(t,{code:C.too_small,minimum:i.minLength.value,type:"array",inclusive:!0,exact:!1,message:i.minLength.message}),n.dirty()),i.maxLength!==null&&t.data.length>i.maxLength.value&&(R(t,{code:C.too_big,maximum:i.maxLength.value,type:"array",inclusive:!0,exact:!1,message:i.maxLength.message}),n.dirty()),t.common.async)return Promise.all([...t.data].map((s,a)=>i.type._parseAsync(new Nt(t,s,t.path,a)))).then(s=>Ge.mergeArray(n,s));let o=[...t.data].map((s,a)=>i.type._parseSync(new Nt(t,s,t.path,a)));return Ge.mergeArray(n,o)}get element(){return this._def.type}min(e,t){return new r({...this._def,minLength:{value:e,message:M.toString(t)}})}max(e,t){return new r({...this._def,maxLength:{value:e,message:M.toString(t)}})}length(e,t){return new r({...this._def,exactLength:{value:e,message:M.toString(t)}})}nonempty(e){return this.min(1,e)}};wr.create=(r,e)=>new wr({type:r,minLength:null,maxLength:null,exactLength:null,typeName:_.ZodArray,...Y(e)});function ji(r){if(r instanceof ot){let e={};for(let t in r.shape){let n=r.shape[t];e[t]=it.create(ji(n))}return new ot({...r._def,shape:()=>e})}else return r instanceof wr?new wr({...r._def,type:ji(r.element)}):r instanceof it?it.create(ji(r.unwrap())):r instanceof tr?tr.create(ji(r.unwrap())):r instanceof er?er.create(r.items.map(e=>ji(e))):r}var ot=class r extends z{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;let e=this._def.shape(),t=oe.objectKeys(e);return this._cached={shape:e,keys:t}}_parse(e){if(this._getType(e)!==O.object){let l=this._getOrReturnCtx(e);return R(l,{code:C.invalid_type,expected:O.object,received:l.parsedType}),q}let{status:n,ctx:i}=this._processInputParams(e),{shape:o,keys:s}=this._getCached(),a=[];if(!(this._def.catchall instanceof zt&&this._def.unknownKeys==="strip"))for(let l in i.data)s.includes(l)||a.push(l);let c=[];for(let l of s){let u=o[l],d=i.data[l];c.push({key:{status:"valid",value:l},value:u._parse(new Nt(i,d,i.path,l)),alwaysSet:l in i.data})}if(this._def.catchall instanceof zt){let l=this._def.unknownKeys;if(l==="passthrough")for(let u of a)c.push({key:{status:"valid",value:u},value:{status:"valid",value:i.data[u]}});else if(l==="strict")a.length>0&&(R(i,{code:C.unrecognized_keys,keys:a}),n.dirty());else if(l!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{let l=this._def.catchall;for(let u of a){let d=i.data[u];c.push({key:{status:"valid",value:u},value:l._parse(new Nt(i,d,i.path,u)),alwaysSet:u in i.data})}}return i.common.async?Promise.resolve().then(async()=>{let l=[];for(let u of c){let d=await u.key,h=await u.value;l.push({key:d,value:h,alwaysSet:u.alwaysSet})}return l}).then(l=>Ge.mergeObjectSync(n,l)):Ge.mergeObjectSync(n,c)}get shape(){return this._def.shape()}strict(e){return M.errToObj,new r({...this._def,unknownKeys:"strict",...e!==void 0?{errorMap:(t,n)=>{var i,o,s,a;let c=(s=(o=(i=this._def).errorMap)===null||o===void 0?void 0:o.call(i,t,n).message)!==null&&s!==void 0?s:n.defaultError;return t.code==="unrecognized_keys"?{message:(a=M.errToObj(e).message)!==null&&a!==void 0?a:c}:{message:c}}}:{}})}strip(){return new r({...this._def,unknownKeys:"strip"})}passthrough(){return new r({...this._def,unknownKeys:"passthrough"})}extend(e){return new r({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new r({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:_.ZodObject})}setKey(e,t){return this.augment({[e]:t})}catchall(e){return new r({...this._def,catchall:e})}pick(e){let t={};return oe.objectKeys(e).forEach(n=>{e[n]&&this.shape[n]&&(t[n]=this.shape[n])}),new r({...this._def,shape:()=>t})}omit(e){let t={};return oe.objectKeys(this.shape).forEach(n=>{e[n]||(t[n]=this.shape[n])}),new r({...this._def,shape:()=>t})}deepPartial(){return ji(this)}partial(e){let t={};return oe.objectKeys(this.shape).forEach(n=>{let i=this.shape[n];e&&!e[n]?t[n]=i:t[n]=i.optional()}),new r({...this._def,shape:()=>t})}required(e){let t={};return oe.objectKeys(this.shape).forEach(n=>{if(e&&!e[n])t[n]=this.shape[n];else{let o=this.shape[n];for(;o instanceof it;)o=o._def.innerType;t[n]=o}}),new r({...this._def,shape:()=>t})}keyof(){return ug(oe.objectKeys(this.shape))}};ot.create=(r,e)=>new ot({shape:()=>r,unknownKeys:"strip",catchall:zt.create(),typeName:_.ZodObject,...Y(e)});ot.strictCreate=(r,e)=>new ot({shape:()=>r,unknownKeys:"strict",catchall:zt.create(),typeName:_.ZodObject,...Y(e)});ot.lazycreate=(r,e)=>new ot({shape:r,unknownKeys:"strip",catchall:zt.create(),typeName:_.ZodObject,...Y(e)});var On=class extends z{_parse(e){let{ctx:t}=this._processInputParams(e),n=this._def.options;function i(o){for(let a of o)if(a.result.status==="valid")return a.result;for(let a of o)if(a.result.status==="dirty")return t.common.issues.push(...a.ctx.common.issues),a.result;let s=o.map(a=>new yt(a.ctx.common.issues));return R(t,{code:C.invalid_union,unionErrors:s}),q}if(t.common.async)return Promise.all(n.map(async o=>{let s={...t,common:{...t.common,issues:[]},parent:null};return{result:await o._parseAsync({data:t.data,path:t.path,parent:s}),ctx:s}})).then(i);{let o,s=[];for(let c of n){let l={...t,common:{...t.common,issues:[]},parent:null},u=c._parseSync({data:t.data,path:t.path,parent:l});if(u.status==="valid")return u;u.status==="dirty"&&!o&&(o={result:u,ctx:l}),l.common.issues.length&&s.push(l.common.issues)}if(o)return t.common.issues.push(...o.ctx.common.issues),o.result;let a=s.map(c=>new yt(c));return R(t,{code:C.invalid_union,unionErrors:a}),q}}get options(){return this._def.options}};On.create=(r,e)=>new On({options:r,typeName:_.ZodUnion,...Y(e)});var _r=r=>r instanceof xn?_r(r.schema):r instanceof Et?_r(r.innerType()):r instanceof Pn?[r.value]:r instanceof Nn?r.options:r instanceof Mn?oe.objectValues(r.enum):r instanceof Dn?_r(r._def.innerType):r instanceof In?[void 0]:r instanceof bn?[null]:r instanceof it?[void 0,..._r(r.unwrap())]:r instanceof tr?[null,..._r(r.unwrap())]:r instanceof is||r instanceof Un?_r(r.unwrap()):r instanceof Ln?_r(r._def.innerType):[],ic=class r extends z{_parse(e){let{ctx:t}=this._processInputParams(e);if(t.parsedType!==O.object)return R(t,{code:C.invalid_type,expected:O.object,received:t.parsedType}),q;let n=this.discriminator,i=t.data[n],o=this.optionsMap.get(i);return o?t.common.async?o._parseAsync({data:t.data,path:t.path,parent:t}):o._parseSync({data:t.data,path:t.path,parent:t}):(R(t,{code:C.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[n]}),q)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(e,t,n){let i=new Map;for(let o of t){let s=_r(o.shape[e]);if(!s.length)throw new Error(`A discriminator value for key \`${e}\` could not be extracted from all schema options`);for(let a of s){if(i.has(a))throw new Error(`Discriminator property ${String(e)} has duplicate value ${String(a)}`);i.set(a,o)}}return new r({typeName:_.ZodDiscriminatedUnion,discriminator:e,options:t,optionsMap:i,...Y(n)})}};function Zd(r,e){let t=Ar(r),n=Ar(e);if(r===e)return{valid:!0,data:r};if(t===O.object&&n===O.object){let i=oe.objectKeys(e),o=oe.objectKeys(r).filter(a=>i.indexOf(a)!==-1),s={...r,...e};for(let a of o){let c=Zd(r[a],e[a]);if(!c.valid)return{valid:!1};s[a]=c.data}return{valid:!0,data:s}}else if(t===O.array&&n===O.array){if(r.length!==e.length)return{valid:!1};let i=[];for(let o=0;o<r.length;o++){let s=r[o],a=e[o],c=Zd(s,a);if(!c.valid)return{valid:!1};i.push(c.data)}return{valid:!0,data:i}}else return t===O.date&&n===O.date&&+r==+e?{valid:!0,data:r}:{valid:!1}}var kn=class extends z{_parse(e){let{status:t,ctx:n}=this._processInputParams(e),i=(o,s)=>{if(Yd(o)||Yd(s))return q;let a=Zd(o.value,s.value);return a.valid?((Wd(o)||Wd(s))&&t.dirty(),{status:t.value,value:a.data}):(R(n,{code:C.invalid_intersection_types}),q)};return n.common.async?Promise.all([this._def.left._parseAsync({data:n.data,path:n.path,parent:n}),this._def.right._parseAsync({data:n.data,path:n.path,parent:n})]).then(([o,s])=>i(o,s)):i(this._def.left._parseSync({data:n.data,path:n.path,parent:n}),this._def.right._parseSync({data:n.data,path:n.path,parent:n}))}};kn.create=(r,e,t)=>new kn({left:r,right:e,typeName:_.ZodIntersection,...Y(t)});var er=class r extends z{_parse(e){let{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==O.array)return R(n,{code:C.invalid_type,expected:O.array,received:n.parsedType}),q;if(n.data.length<this._def.items.length)return R(n,{code:C.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),q;!this._def.rest&&n.data.length>this._def.items.length&&(R(n,{code:C.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),t.dirty());let o=[...n.data].map((s,a)=>{let c=this._def.items[a]||this._def.rest;return c?c._parse(new Nt(n,s,n.path,a)):null}).filter(s=>!!s);return n.common.async?Promise.all(o).then(s=>Ge.mergeArray(t,s)):Ge.mergeArray(t,o)}get items(){return this._def.items}rest(e){return new r({...this._def,rest:e})}};er.create=(r,e)=>{if(!Array.isArray(r))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new er({items:r,typeName:_.ZodTuple,rest:null,...Y(e)})};var oc=class r extends z{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){let{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==O.object)return R(n,{code:C.invalid_type,expected:O.object,received:n.parsedType}),q;let i=[],o=this._def.keyType,s=this._def.valueType;for(let a in n.data)i.push({key:o._parse(new Nt(n,a,n.path,a)),value:s._parse(new Nt(n,n.data[a],n.path,a)),alwaysSet:a in n.data});return n.common.async?Ge.mergeObjectAsync(t,i):Ge.mergeObjectSync(t,i)}get element(){return this._def.valueType}static create(e,t,n){return t instanceof z?new r({keyType:e,valueType:t,typeName:_.ZodRecord,...Y(n)}):new r({keyType:Kr.create(),valueType:e,typeName:_.ZodRecord,...Y(t)})}},Ki=class extends z{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){let{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==O.map)return R(n,{code:C.invalid_type,expected:O.map,received:n.parsedType}),q;let i=this._def.keyType,o=this._def.valueType,s=[...n.data.entries()].map(([a,c],l)=>({key:i._parse(new Nt(n,a,n.path,[l,"key"])),value:o._parse(new Nt(n,c,n.path,[l,"value"]))}));if(n.common.async){let a=new Map;return Promise.resolve().then(async()=>{for(let c of s){let l=await c.key,u=await c.value;if(l.status==="aborted"||u.status==="aborted")return q;(l.status==="dirty"||u.status==="dirty")&&t.dirty(),a.set(l.value,u.value)}return{status:t.value,value:a}})}else{let a=new Map;for(let c of s){let l=c.key,u=c.value;if(l.status==="aborted"||u.status==="aborted")return q;(l.status==="dirty"||u.status==="dirty")&&t.dirty(),a.set(l.value,u.value)}return{status:t.value,value:a}}}};Ki.create=(r,e,t)=>new Ki({valueType:e,keyType:r,typeName:_.ZodMap,...Y(t)});var Yi=class r extends z{_parse(e){let{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==O.set)return R(n,{code:C.invalid_type,expected:O.set,received:n.parsedType}),q;let i=this._def;i.minSize!==null&&n.data.size<i.minSize.value&&(R(n,{code:C.too_small,minimum:i.minSize.value,type:"set",inclusive:!0,exact:!1,message:i.minSize.message}),t.dirty()),i.maxSize!==null&&n.data.size>i.maxSize.value&&(R(n,{code:C.too_big,maximum:i.maxSize.value,type:"set",inclusive:!0,exact:!1,message:i.maxSize.message}),t.dirty());let o=this._def.valueType;function s(c){let l=new Set;for(let u of c){if(u.status==="aborted")return q;u.status==="dirty"&&t.dirty(),l.add(u.value)}return{status:t.value,value:l}}let a=[...n.data.values()].map((c,l)=>o._parse(new Nt(n,c,n.path,l)));return n.common.async?Promise.all(a).then(c=>s(c)):s(a)}min(e,t){return new r({...this._def,minSize:{value:e,message:M.toString(t)}})}max(e,t){return new r({...this._def,maxSize:{value:e,message:M.toString(t)}})}size(e,t){return this.min(e,t).max(e,t)}nonempty(e){return this.min(1,e)}};Yi.create=(r,e)=>new Yi({valueType:r,minSize:null,maxSize:null,typeName:_.ZodSet,...Y(e)});var sc=class r extends z{constructor(){super(...arguments),this.validate=this.implement}_parse(e){let{ctx:t}=this._processInputParams(e);if(t.parsedType!==O.function)return R(t,{code:C.invalid_type,expected:O.function,received:t.parsedType}),q;function n(a,c){return rc({data:a,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,tc(),zi].filter(l=>!!l),issueData:{code:C.invalid_arguments,argumentsError:c}})}function i(a,c){return rc({data:a,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,tc(),zi].filter(l=>!!l),issueData:{code:C.invalid_return_type,returnTypeError:c}})}let o={errorMap:t.common.contextualErrorMap},s=t.data;if(this._def.returns instanceof Wr){let a=this;return Ye(async function(...c){let l=new yt([]),u=await a._def.args.parseAsync(c,o).catch(p=>{throw l.addIssue(n(c,p)),l}),d=await Reflect.apply(s,this,u);return await a._def.returns._def.type.parseAsync(d,o).catch(p=>{throw l.addIssue(i(d,p)),l})})}else{let a=this;return Ye(function(...c){let l=a._def.args.safeParse(c,o);if(!l.success)throw new yt([n(c,l.error)]);let u=Reflect.apply(s,this,l.data),d=a._def.returns.safeParse(u,o);if(!d.success)throw new yt([i(u,d.error)]);return d.data})}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...e){return new r({...this._def,args:er.create(e).rest(Sr.create())})}returns(e){return new r({...this._def,returns:e})}implement(e){return this.parse(e)}strictImplement(e){return this.parse(e)}static create(e,t,n){return new r({args:e||er.create([]).rest(Sr.create()),returns:t||Sr.create(),typeName:_.ZodFunction,...Y(n)})}},xn=class extends z{get schema(){return this._def.getter()}_parse(e){let{ctx:t}=this._processInputParams(e);return this._def.getter()._parse({data:t.data,path:t.path,parent:t})}};xn.create=(r,e)=>new xn({getter:r,typeName:_.ZodLazy,...Y(e)});var Pn=class extends z{_parse(e){if(e.data!==this._def.value){let t=this._getOrReturnCtx(e);return R(t,{received:t.data,code:C.invalid_literal,expected:this._def.value}),q}return{status:"valid",value:e.data}}get value(){return this._def.value}};Pn.create=(r,e)=>new Pn({value:r,typeName:_.ZodLiteral,...Y(e)});function ug(r,e){return new Nn({values:r,typeName:_.ZodEnum,...Y(e)})}var Nn=class r extends z{constructor(){super(...arguments),ts.set(this,void 0)}_parse(e){if(typeof e.data!="string"){let t=this._getOrReturnCtx(e),n=this._def.values;return R(t,{expected:oe.joinValues(n),received:t.parsedType,code:C.invalid_type}),q}if(nc(this,ts,"f")||sg(this,ts,new Set(this._def.values),"f"),!nc(this,ts,"f").has(e.data)){let t=this._getOrReturnCtx(e),n=this._def.values;return R(t,{received:t.data,code:C.invalid_enum_value,options:n}),q}return Ye(e.data)}get options(){return this._def.values}get enum(){let e={};for(let t of this._def.values)e[t]=t;return e}get Values(){let e={};for(let t of this._def.values)e[t]=t;return e}get Enum(){let e={};for(let t of this._def.values)e[t]=t;return e}extract(e,t=this._def){return r.create(e,{...this._def,...t})}exclude(e,t=this._def){return r.create(this.options.filter(n=>!e.includes(n)),{...this._def,...t})}};ts=new WeakMap;Nn.create=ug;var Mn=class extends z{constructor(){super(...arguments),rs.set(this,void 0)}_parse(e){let t=oe.getValidEnumValues(this._def.values),n=this._getOrReturnCtx(e);if(n.parsedType!==O.string&&n.parsedType!==O.number){let i=oe.objectValues(t);return R(n,{expected:oe.joinValues(i),received:n.parsedType,code:C.invalid_type}),q}if(nc(this,rs,"f")||sg(this,rs,new Set(oe.getValidEnumValues(this._def.values)),"f"),!nc(this,rs,"f").has(e.data)){let i=oe.objectValues(t);return R(n,{received:n.data,code:C.invalid_enum_value,options:i}),q}return Ye(e.data)}get enum(){return this._def.values}};rs=new WeakMap;Mn.create=(r,e)=>new Mn({values:r,typeName:_.ZodNativeEnum,...Y(e)});var Wr=class extends z{unwrap(){return this._def.type}_parse(e){let{ctx:t}=this._processInputParams(e);if(t.parsedType!==O.promise&&t.common.async===!1)return R(t,{code:C.invalid_type,expected:O.promise,received:t.parsedType}),q;let n=t.parsedType===O.promise?t.data:Promise.resolve(t.data);return Ye(n.then(i=>this._def.type.parseAsync(i,{path:t.path,errorMap:t.common.contextualErrorMap})))}};Wr.create=(r,e)=>new Wr({type:r,typeName:_.ZodPromise,...Y(e)});var Et=class extends z{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===_.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){let{status:t,ctx:n}=this._processInputParams(e),i=this._def.effect||null,o={addIssue:s=>{R(n,s),s.fatal?t.abort():t.dirty()},get path(){return n.path}};if(o.addIssue=o.addIssue.bind(o),i.type==="preprocess"){let s=i.transform(n.data,o);if(n.common.async)return Promise.resolve(s).then(async a=>{if(t.value==="aborted")return q;let c=await this._def.schema._parseAsync({data:a,path:n.path,parent:n});return c.status==="aborted"?q:c.status==="dirty"||t.value==="dirty"?Bi(c.value):c});{if(t.value==="aborted")return q;let a=this._def.schema._parseSync({data:s,path:n.path,parent:n});return a.status==="aborted"?q:a.status==="dirty"||t.value==="dirty"?Bi(a.value):a}}if(i.type==="refinement"){let s=a=>{let c=i.refinement(a,o);if(n.common.async)return Promise.resolve(c);if(c instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return a};if(n.common.async===!1){let a=this._def.schema._parseSync({data:n.data,path:n.path,parent:n});return a.status==="aborted"?q:(a.status==="dirty"&&t.dirty(),s(a.value),{status:t.value,value:a.value})}else return this._def.schema._parseAsync({data:n.data,path:n.path,parent:n}).then(a=>a.status==="aborted"?q:(a.status==="dirty"&&t.dirty(),s(a.value).then(()=>({status:t.value,value:a.value}))))}if(i.type==="transform")if(n.common.async===!1){let s=this._def.schema._parseSync({data:n.data,path:n.path,parent:n});if(!_n(s))return s;let a=i.transform(s.value,o);if(a instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:t.value,value:a}}else return this._def.schema._parseAsync({data:n.data,path:n.path,parent:n}).then(s=>_n(s)?Promise.resolve(i.transform(s.value,o)).then(a=>({status:t.value,value:a})):s);oe.assertNever(i)}};Et.create=(r,e,t)=>new Et({schema:r,typeName:_.ZodEffects,effect:e,...Y(t)});Et.createWithPreprocess=(r,e,t)=>new Et({schema:e,effect:{type:"preprocess",transform:r},typeName:_.ZodEffects,...Y(t)});var it=class extends z{_parse(e){return this._getType(e)===O.undefined?Ye(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}};it.create=(r,e)=>new it({innerType:r,typeName:_.ZodOptional,...Y(e)});var tr=class extends z{_parse(e){return this._getType(e)===O.null?Ye(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}};tr.create=(r,e)=>new tr({innerType:r,typeName:_.ZodNullable,...Y(e)});var Dn=class extends z{_parse(e){let{ctx:t}=this._processInputParams(e),n=t.data;return t.parsedType===O.undefined&&(n=this._def.defaultValue()),this._def.innerType._parse({data:n,path:t.path,parent:t})}removeDefault(){return this._def.innerType}};Dn.create=(r,e)=>new Dn({innerType:r,typeName:_.ZodDefault,defaultValue:typeof e.default=="function"?e.default:()=>e.default,...Y(e)});var Ln=class extends z{_parse(e){let{ctx:t}=this._processInputParams(e),n={...t,common:{...t.common,issues:[]}},i=this._def.innerType._parse({data:n.data,path:n.path,parent:{...n}});return ns(i)?i.then(o=>({status:"valid",value:o.status==="valid"?o.value:this._def.catchValue({get error(){return new yt(n.common.issues)},input:n.data})})):{status:"valid",value:i.status==="valid"?i.value:this._def.catchValue({get error(){return new yt(n.common.issues)},input:n.data})}}removeCatch(){return this._def.innerType}};Ln.create=(r,e)=>new Ln({innerType:r,typeName:_.ZodCatch,catchValue:typeof e.catch=="function"?e.catch:()=>e.catch,...Y(e)});var Wi=class extends z{_parse(e){if(this._getType(e)!==O.nan){let n=this._getOrReturnCtx(e);return R(n,{code:C.invalid_type,expected:O.nan,received:n.parsedType}),q}return{status:"valid",value:e.data}}};Wi.create=r=>new Wi({typeName:_.ZodNaN,...Y(r)});var Zw=Symbol("zod_brand"),is=class extends z{_parse(e){let{ctx:t}=this._processInputParams(e),n=t.data;return this._def.type._parse({data:n,path:t.path,parent:t})}unwrap(){return this._def.type}},os=class r extends z{_parse(e){let{status:t,ctx:n}=this._processInputParams(e);if(n.common.async)return(async()=>{let o=await this._def.in._parseAsync({data:n.data,path:n.path,parent:n});return o.status==="aborted"?q:o.status==="dirty"?(t.dirty(),Bi(o.value)):this._def.out._parseAsync({data:o.value,path:n.path,parent:n})})();{let i=this._def.in._parseSync({data:n.data,path:n.path,parent:n});return i.status==="aborted"?q:i.status==="dirty"?(t.dirty(),{status:"dirty",value:i.value}):this._def.out._parseSync({data:i.value,path:n.path,parent:n})}}static create(e,t){return new r({in:e,out:t,typeName:_.ZodPipeline})}},Un=class extends z{_parse(e){let t=this._def.innerType._parse(e),n=i=>(_n(i)&&(i.value=Object.freeze(i.value)),i);return ns(t)?t.then(i=>n(i)):n(t)}unwrap(){return this._def.innerType}};Un.create=(r,e)=>new Un({innerType:r,typeName:_.ZodReadonly,...Y(e)});function ng(r,e){let t=typeof r=="function"?r(e):typeof r=="string"?{message:r}:r;return typeof t=="string"?{message:t}:t}function dg(r,e={},t){return r?Yr.create().superRefine((n,i)=>{var o,s;let a=r(n);if(a instanceof Promise)return a.then(c=>{var l,u;if(!c){let d=ng(e,n),h=(u=(l=d.fatal)!==null&&l!==void 0?l:t)!==null&&u!==void 0?u:!0;i.addIssue({code:"custom",...d,fatal:h})}});if(!a){let c=ng(e,n),l=(s=(o=c.fatal)!==null&&o!==void 0?o:t)!==null&&s!==void 0?s:!0;i.addIssue({code:"custom",...c,fatal:l})}}):Yr.create()}var Xw={object:ot.lazycreate},_;(function(r){r.ZodString="ZodString",r.ZodNumber="ZodNumber",r.ZodNaN="ZodNaN",r.ZodBigInt="ZodBigInt",r.ZodBoolean="ZodBoolean",r.ZodDate="ZodDate",r.ZodSymbol="ZodSymbol",r.ZodUndefined="ZodUndefined",r.ZodNull="ZodNull",r.ZodAny="ZodAny",r.ZodUnknown="ZodUnknown",r.ZodNever="ZodNever",r.ZodVoid="ZodVoid",r.ZodArray="ZodArray",r.ZodObject="ZodObject",r.ZodUnion="ZodUnion",r.ZodDiscriminatedUnion="ZodDiscriminatedUnion",r.ZodIntersection="ZodIntersection",r.ZodTuple="ZodTuple",r.ZodRecord="ZodRecord",r.ZodMap="ZodMap",r.ZodSet="ZodSet",r.ZodFunction="ZodFunction",r.ZodLazy="ZodLazy",r.ZodLiteral="ZodLiteral",r.ZodEnum="ZodEnum",r.ZodEffects="ZodEffects",r.ZodNativeEnum="ZodNativeEnum",r.ZodOptional="ZodOptional",r.ZodNullable="ZodNullable",r.ZodDefault="ZodDefault",r.ZodCatch="ZodCatch",r.ZodPromise="ZodPromise",r.ZodBranded="ZodBranded",r.ZodPipeline="ZodPipeline",r.ZodReadonly="ZodReadonly"})(_||(_={}));var Qw=(r,e={message:`Input not instance of ${r.name}`})=>dg(t=>t instanceof r,e),fg=Kr.create,hg=An.create,Jw=Wi.create,eR=Sn.create,pg=wn.create,tR=Rn.create,rR=Gi.create,nR=In.create,iR=bn.create,oR=Yr.create,sR=Sr.create,aR=zt.create,cR=Vi.create,lR=wr.create,uR=ot.create,dR=ot.strictCreate,fR=On.create,hR=ic.create,pR=kn.create,mR=er.create,gR=oc.create,yR=Ki.create,ER=Yi.create,TR=sc.create,vR=xn.create,CR=Pn.create,_R=Nn.create,AR=Mn.create,SR=Wr.create,ig=Et.create,wR=it.create,RR=tr.create,IR=Et.createWithPreprocess,bR=os.create,OR=()=>fg().optional(),kR=()=>hg().optional(),xR=()=>pg().optional(),PR={string:r=>Kr.create({...r,coerce:!0}),number:r=>An.create({...r,coerce:!0}),boolean:r=>wn.create({...r,coerce:!0}),bigint:r=>Sn.create({...r,coerce:!0}),date:r=>Rn.create({...r,coerce:!0})},NR=q,f=Object.freeze({__proto__:null,defaultErrorMap:zi,setErrorMap:Iw,getErrorMap:tc,makeIssue:rc,EMPTY_PATH:bw,addIssueToContext:R,ParseStatus:Ge,INVALID:q,DIRTY:Bi,OK:Ye,isAborted:Yd,isDirty:Wd,isValid:_n,isAsync:ns,get util(){return oe},get objectUtil(){return Kd},ZodParsedType:O,getParsedType:Ar,ZodType:z,datetimeRegex:lg,ZodString:Kr,ZodNumber:An,ZodBigInt:Sn,ZodBoolean:wn,ZodDate:Rn,ZodSymbol:Gi,ZodUndefined:In,ZodNull:bn,ZodAny:Yr,ZodUnknown:Sr,ZodNever:zt,ZodVoid:Vi,ZodArray:wr,ZodObject:ot,ZodUnion:On,ZodDiscriminatedUnion:ic,ZodIntersection:kn,ZodTuple:er,ZodRecord:oc,ZodMap:Ki,ZodSet:Yi,ZodFunction:sc,ZodLazy:xn,ZodLiteral:Pn,ZodEnum:Nn,ZodNativeEnum:Mn,ZodPromise:Wr,ZodEffects:Et,ZodTransformer:Et,ZodOptional:it,ZodNullable:tr,ZodDefault:Dn,ZodCatch:Ln,ZodNaN:Wi,BRAND:Zw,ZodBranded:is,ZodPipeline:os,ZodReadonly:Un,custom:dg,Schema:z,ZodSchema:z,late:Xw,get ZodFirstPartyTypeKind(){return _},coerce:PR,any:oR,array:lR,bigint:eR,boolean:pg,date:tR,discriminatedUnion:hR,effect:ig,enum:_R,function:TR,instanceof:Qw,intersection:pR,lazy:vR,literal:CR,map:yR,nan:Jw,nativeEnum:AR,never:aR,null:iR,nullable:RR,number:hg,object:uR,oboolean:xR,onumber:kR,optional:wR,ostring:OR,pipeline:bR,preprocess:IR,promise:SR,record:gR,set:ER,strictObject:dR,string:fg,symbol:rR,transformer:ig,tuple:mR,undefined:nR,union:fR,unknown:sR,void:cR,NEVER:NR,ZodIssueCode:C,quotelessJson:Rw,ZodError:yt});var Xd="2024-11-05",mg=[Xd,"2024-10-07"],ac="2.0",gg=f.union([f.string(),f.number().int()]),yg=f.string(),Gt=f.object({_meta:f.optional(f.object({progressToken:f.optional(gg)}).passthrough())}).passthrough(),Tt=f.object({method:f.string(),params:f.optional(Gt)}),ss=f.object({_meta:f.optional(f.object({}).passthrough())}).passthrough(),rr=f.object({method:f.string(),params:f.optional(ss)}),Vt=f.object({_meta:f.optional(f.object({}).passthrough())}).passthrough(),cc=f.union([f.string(),f.number().int()]),Eg=f.object({jsonrpc:f.literal(ac),id:cc}).merge(Tt).strict(),Tg=r=>Eg.safeParse(r).success,vg=f.object({jsonrpc:f.literal(ac)}).merge(rr).strict(),Cg=r=>vg.safeParse(r).success,_g=f.object({jsonrpc:f.literal(ac),id:cc,result:Vt}).strict(),Qd=r=>_g.safeParse(r).success,Re;(function(r){r[r.ConnectionClosed=-32e3]="ConnectionClosed",r[r.RequestTimeout=-32001]="RequestTimeout",r[r.ParseError=-32700]="ParseError",r[r.InvalidRequest=-32600]="InvalidRequest",r[r.MethodNotFound=-32601]="MethodNotFound",r[r.InvalidParams=-32602]="InvalidParams",r[r.InternalError=-32603]="InternalError"})(Re||(Re={}));var Ag=f.object({jsonrpc:f.literal(ac),id:cc,error:f.object({code:f.number().int(),message:f.string(),data:f.optional(f.unknown())})}).strict(),Sg=r=>Ag.safeParse(r).success,wg=f.union([Eg,vg,_g,Ag]),lc=Vt.strict(),uc=rr.extend({method:f.literal("notifications/cancelled"),params:ss.extend({requestId:cc,reason:f.string().optional()})}),Rg=f.object({name:f.string(),version:f.string()}).passthrough(),MR=f.object({experimental:f.optional(f.object({}).passthrough()),sampling:f.optional(f.object({}).passthrough()),roots:f.optional(f.object({listChanged:f.optional(f.boolean())}).passthrough())}).passthrough(),Jd=Tt.extend({method:f.literal("initialize"),params:Gt.extend({protocolVersion:f.string(),capabilities:MR,clientInfo:Rg})});var DR=f.object({experimental:f.optional(f.object({}).passthrough()),logging:f.optional(f.object({}).passthrough()),completions:f.optional(f.object({}).passthrough()),prompts:f.optional(f.object({listChanged:f.optional(f.boolean())}).passthrough()),resources:f.optional(f.object({subscribe:f.optional(f.boolean()),listChanged:f.optional(f.boolean())}).passthrough()),tools:f.optional(f.object({listChanged:f.optional(f.boolean())}).passthrough())}).passthrough(),LR=Vt.extend({protocolVersion:f.string(),capabilities:DR,serverInfo:Rg,instructions:f.optional(f.string())}),ef=rr.extend({method:f.literal("notifications/initialized")});var dc=Tt.extend({method:f.literal("ping")}),UR=f.object({progress:f.number(),total:f.optional(f.number())}).passthrough(),fc=rr.extend({method:f.literal("notifications/progress"),params:ss.merge(UR).extend({progressToken:gg})}),hc=Tt.extend({params:Gt.extend({cursor:f.optional(yg)}).optional()}),pc=Vt.extend({nextCursor:f.optional(yg)}),Ig=f.object({uri:f.string(),mimeType:f.optional(f.string())}).passthrough(),bg=Ig.extend({text:f.string()}),Og=Ig.extend({blob:f.string().base64()}),HR=f.object({uri:f.string(),name:f.string(),description:f.optional(f.string()),mimeType:f.optional(f.string())}).passthrough(),FR=f.object({uriTemplate:f.string(),name:f.string(),description:f.optional(f.string()),mimeType:f.optional(f.string())}).passthrough(),mc=hc.extend({method:f.literal("resources/list")}),$R=pc.extend({resources:f.array(HR)}),gc=hc.extend({method:f.literal("resources/templates/list")}),qR=pc.extend({resourceTemplates:f.array(FR)}),yc=Tt.extend({method:f.literal("resources/read"),params:Gt.extend({uri:f.string()})}),jR=Vt.extend({contents:f.array(f.union([bg,Og]))}),BR=rr.extend({method:f.literal("notifications/resources/list_changed")}),zR=Tt.extend({method:f.literal("resources/subscribe"),params:Gt.extend({uri:f.string()})}),GR=Tt.extend({method:f.literal("resources/unsubscribe"),params:Gt.extend({uri:f.string()})}),VR=rr.extend({method:f.literal("notifications/resources/updated"),params:ss.extend({uri:f.string()})}),KR=f.object({name:f.string(),description:f.optional(f.string()),required:f.optional(f.boolean())}).passthrough(),YR=f.object({name:f.string(),description:f.optional(f.string()),arguments:f.optional(f.array(KR))}).passthrough(),Ec=hc.extend({method:f.literal("prompts/list")}),WR=pc.extend({prompts:f.array(YR)}),Tc=Tt.extend({method:f.literal("prompts/get"),params:Gt.extend({name:f.string(),arguments:f.optional(f.record(f.string()))})}),vc=f.object({type:f.literal("text"),text:f.string()}).passthrough(),Cc=f.object({type:f.literal("image"),data:f.string().base64(),mimeType:f.string()}).passthrough(),_c=f.object({type:f.literal("audio"),data:f.string().base64(),mimeType:f.string()}).passthrough(),kg=f.object({type:f.literal("resource"),resource:f.union([bg,Og])}).passthrough(),ZR=f.object({role:f.enum(["user","assistant"]),content:f.union([vc,Cc,_c,kg])}).passthrough(),XR=Vt.extend({description:f.optional(f.string()),messages:f.array(ZR)}),QR=rr.extend({method:f.literal("notifications/prompts/list_changed")}),JR=f.object({name:f.string(),description:f.optional(f.string()),inputSchema:f.object({type:f.literal("object"),properties:f.optional(f.object({}).passthrough())}).passthrough()}).passthrough(),Ac=hc.extend({method:f.literal("tools/list")}),eI=pc.extend({tools:f.array(JR)}),xg=Vt.extend({content:f.array(f.union([vc,Cc,_c,kg])),isError:f.boolean().default(!1).optional()}),T1=xg.or(Vt.extend({toolResult:f.unknown()})),Sc=Tt.extend({method:f.literal("tools/call"),params:Gt.extend({name:f.string(),arguments:f.optional(f.record(f.unknown()))})}),tI=rr.extend({method:f.literal("notifications/tools/list_changed")}),Pg=f.enum(["debug","info","notice","warning","error","critical","alert","emergency"]),rI=Tt.extend({method:f.literal("logging/setLevel"),params:Gt.extend({level:Pg})}),nI=rr.extend({method:f.literal("notifications/message"),params:ss.extend({level:Pg,logger:f.optional(f.string()),data:f.unknown()})}),iI=f.object({name:f.string().optional()}).passthrough(),oI=f.object({hints:f.optional(f.array(iI)),costPriority:f.optional(f.number().min(0).max(1)),speedPriority:f.optional(f.number().min(0).max(1)),intelligencePriority:f.optional(f.number().min(0).max(1))}).passthrough(),sI=f.object({role:f.enum(["user","assistant"]),content:f.union([vc,Cc,_c])}).passthrough(),aI=Tt.extend({method:f.literal("sampling/createMessage"),params:Gt.extend({messages:f.array(sI),systemPrompt:f.optional(f.string()),includeContext:f.optional(f.enum(["none","thisServer","allServers"])),temperature:f.optional(f.number()),maxTokens:f.number().int(),stopSequences:f.optional(f.array(f.string())),metadata:f.optional(f.object({}).passthrough()),modelPreferences:f.optional(oI)})}),tf=Vt.extend({model:f.string(),stopReason:f.optional(f.enum(["endTurn","stopSequence","maxTokens"]).or(f.string())),role:f.enum(["user","assistant"]),content:f.discriminatedUnion("type",[vc,Cc,_c])}),cI=f.object({type:f.literal("ref/resource"),uri:f.string()}).passthrough(),lI=f.object({type:f.literal("ref/prompt"),name:f.string()}).passthrough(),wc=Tt.extend({method:f.literal("completion/complete"),params:Gt.extend({ref:f.union([lI,cI]),argument:f.object({name:f.string(),value:f.string()}).passthrough()})}),uI=Vt.extend({completion:f.object({values:f.array(f.string()).max(100),total:f.optional(f.number().int()),hasMore:f.optional(f.boolean())}).passthrough()}),dI=f.object({uri:f.string().startsWith("file://"),name:f.optional(f.string())}).passthrough(),fI=Tt.extend({method:f.literal("roots/list")}),rf=Vt.extend({roots:f.array(dI)}),hI=rr.extend({method:f.literal("notifications/roots/list_changed")}),v1=f.union([dc,Jd,wc,rI,Tc,Ec,mc,gc,yc,zR,GR,Sc,Ac]),C1=f.union([uc,fc,ef,hI]),_1=f.union([lc,tf,rf]),A1=f.union([dc,aI,fI]),S1=f.union([uc,fc,nI,VR,BR,tI,QR]),w1=f.union([lc,LR,uI,XR,WR,$R,qR,jR,xg,eI]),Oe=class extends Error{constructor(e,t,n){super(`MCP error ${e}: ${t}`),this.code=e,this.data=n,this.name="McpError"}};var pI=6e4,Rc=class{constructor(e){this._options=e,this._requestMessageId=0,this._requestHandlers=new Map,this._requestHandlerAbortControllers=new Map,this._notificationHandlers=new Map,this._responseHandlers=new Map,this._progressHandlers=new Map,this._timeoutInfo=new Map,this.setNotificationHandler(uc,t=>{let n=this._requestHandlerAbortControllers.get(t.params.requestId);n?.abort(t.params.reason)}),this.setNotificationHandler(fc,t=>{this._onprogress(t)}),this.setRequestHandler(dc,t=>({}))}_setupTimeout(e,t,n,i,o=!1){this._timeoutInfo.set(e,{timeoutId:setTimeout(i,t),startTime:Date.now(),timeout:t,maxTotalTimeout:n,resetTimeoutOnProgress:o,onTimeout:i})}_resetTimeout(e){let t=this._timeoutInfo.get(e);if(!t)return!1;let n=Date.now()-t.startTime;if(t.maxTotalTimeout&&n>=t.maxTotalTimeout)throw this._timeoutInfo.delete(e),new Oe(Re.RequestTimeout,"Maximum total timeout exceeded",{maxTotalTimeout:t.maxTotalTimeout,totalElapsed:n});return clearTimeout(t.timeoutId),t.timeoutId=setTimeout(t.onTimeout,t.timeout),!0}_cleanupTimeout(e){let t=this._timeoutInfo.get(e);t&&(clearTimeout(t.timeoutId),this._timeoutInfo.delete(e))}async connect(e){this._transport=e,this._transport.onclose=()=>{this._onclose()},this._transport.onerror=t=>{this._onerror(t)},this._transport.onmessage=(t,n)=>{Qd(t)||Sg(t)?this._onresponse(t):Tg(t)?this._onrequest(t,n):Cg(t)?this._onnotification(t):this._onerror(new Error(`Unknown message type: ${JSON.stringify(t)}`))},await this._transport.start()}_onclose(){var e;let t=this._responseHandlers;this._responseHandlers=new Map,this._progressHandlers.clear(),this._transport=void 0,(e=this.onclose)===null||e===void 0||e.call(this);let n=new Oe(Re.ConnectionClosed,"Connection closed");for(let i of t.values())i(n)}_onerror(e){var t;(t=this.onerror)===null||t===void 0||t.call(this,e)}_onnotification(e){var t;let n=(t=this._notificationHandlers.get(e.method))!==null&&t!==void 0?t:this.fallbackNotificationHandler;n!==void 0&&Promise.resolve().then(()=>n(e)).catch(i=>this._onerror(new Error(`Uncaught error in notification handler: ${i}`)))}_onrequest(e,t){var n,i,o;let s=(n=this._requestHandlers.get(e.method))!==null&&n!==void 0?n:this.fallbackRequestHandler;if(s===void 0){(i=this._transport)===null||i===void 0||i.send({jsonrpc:"2.0",id:e.id,error:{code:Re.MethodNotFound,message:"Method not found"}}).catch(l=>this._onerror(new Error(`Failed to send an error response: ${l}`)));return}let a=new AbortController;this._requestHandlerAbortControllers.set(e.id,a);let c={signal:a.signal,sessionId:(o=this._transport)===null||o===void 0?void 0:o.sessionId,sendNotification:l=>this.notification(l,{relatedRequestId:e.id}),sendRequest:(l,u,d)=>this.request(l,u,{...d,relatedRequestId:e.id}),authInfo:t?.authInfo};Promise.resolve().then(()=>s(e,c)).then(l=>{var u;if(!a.signal.aborted)return(u=this._transport)===null||u===void 0?void 0:u.send({result:l,jsonrpc:"2.0",id:e.id})},l=>{var u,d;if(!a.signal.aborted)return(u=this._transport)===null||u===void 0?void 0:u.send({jsonrpc:"2.0",id:e.id,error:{code:Number.isSafeInteger(l.code)?l.code:Re.InternalError,message:(d=l.message)!==null&&d!==void 0?d:"Internal error"}})}).catch(l=>this._onerror(new Error(`Failed to send response: ${l}`))).finally(()=>{this._requestHandlerAbortControllers.delete(e.id)})}_onprogress(e){let{progressToken:t,...n}=e.params,i=Number(t),o=this._progressHandlers.get(i);if(!o){this._onerror(new Error(`Received a progress notification for an unknown token: ${JSON.stringify(e)}`));return}let s=this._responseHandlers.get(i),a=this._timeoutInfo.get(i);if(a&&s&&a.resetTimeoutOnProgress)try{this._resetTimeout(i)}catch(c){s(c);return}o(n)}_onresponse(e){let t=Number(e.id),n=this._responseHandlers.get(t);if(n===void 0){this._onerror(new Error(`Received a response for an unknown message ID: ${JSON.stringify(e)}`));return}if(this._responseHandlers.delete(t),this._progressHandlers.delete(t),this._cleanupTimeout(t),Qd(e))n(e);else{let i=new Oe(e.error.code,e.error.message,e.error.data);n(i)}}get transport(){return this._transport}async close(){var e;await((e=this._transport)===null||e===void 0?void 0:e.close())}request(e,t,n){let{relatedRequestId:i,resumptionToken:o,onresumptiontoken:s}=n??{};return new Promise((a,c)=>{var l,u,d,h,p;if(!this._transport){c(new Error("Not connected"));return}((l=this._options)===null||l===void 0?void 0:l.enforceStrictCapabilities)===!0&&this.assertCapabilityForMethod(e.method),(u=n?.signal)===null||u===void 0||u.throwIfAborted();let m=this._requestMessageId++,y={...e,jsonrpc:"2.0",id:m};n?.onprogress&&(this._progressHandlers.set(m,n.onprogress),y.params={...e.params,_meta:{progressToken:m}});let A=U=>{var H;this._responseHandlers.delete(m),this._progressHandlers.delete(m),this._cleanupTimeout(m),(H=this._transport)===null||H===void 0||H.send({jsonrpc:"2.0",method:"notifications/cancelled",params:{requestId:m,reason:String(U)}},{relatedRequestId:i,resumptionToken:o,onresumptiontoken:s}).catch(w=>this._onerror(new Error(`Failed to send cancellation: ${w}`))),c(U)};this._responseHandlers.set(m,U=>{var H;if(!(!((H=n?.signal)===null||H===void 0)&&H.aborted)){if(U instanceof Error)return c(U);try{let w=t.parse(U.result);a(w)}catch(w){c(w)}}}),(d=n?.signal)===null||d===void 0||d.addEventListener("abort",()=>{var U;A((U=n?.signal)===null||U===void 0?void 0:U.reason)});let P=(h=n?.timeout)!==null&&h!==void 0?h:pI,D=()=>A(new Oe(Re.RequestTimeout,"Request timed out",{timeout:P}));this._setupTimeout(m,P,n?.maxTotalTimeout,D,(p=n?.resetTimeoutOnProgress)!==null&&p!==void 0?p:!1),this._transport.send(y,{relatedRequestId:i,resumptionToken:o,onresumptiontoken:s}).catch(U=>{this._cleanupTimeout(m),c(U)})})}async notification(e,t){if(!this._transport)throw new Error("Not connected");this.assertNotificationCapability(e.method);let n={...e,jsonrpc:"2.0"};await this._transport.send(n,t)}setRequestHandler(e,t){let n=e.shape.method.value;this.assertRequestHandlerCapability(n),this._requestHandlers.set(n,(i,o)=>Promise.resolve(t(e.parse(i),o)))}removeRequestHandler(e){this._requestHandlers.delete(e)}assertCanSetRequestHandler(e){if(this._requestHandlers.has(e))throw new Error(`A request handler for ${e} already exists, which would be overridden`)}setNotificationHandler(e,t){this._notificationHandlers.set(e.shape.method.value,n=>Promise.resolve(t(e.parse(n))))}removeNotificationHandler(e){this._notificationHandlers.delete(e)}};function Ng(r,e){return Object.entries(e).reduce((t,[n,i])=>(i&&typeof i=="object"?t[n]=t[n]?{...t[n],...i}:i:t[n]=i,t),{...r})}var Ic=class extends Rc{constructor(e,t){var n;super(t),this._serverInfo=e,this._capabilities=(n=t?.capabilities)!==null&&n!==void 0?n:{},this._instructions=t?.instructions,this.setRequestHandler(Jd,i=>this._oninitialize(i)),this.setNotificationHandler(ef,()=>{var i;return(i=this.oninitialized)===null||i===void 0?void 0:i.call(this)})}registerCapabilities(e){if(this.transport)throw new Error("Cannot register capabilities after connecting to transport");this._capabilities=Ng(this._capabilities,e)}assertCapabilityForMethod(e){var t,n;switch(e){case"sampling/createMessage":if(!(!((t=this._clientCapabilities)===null||t===void 0)&&t.sampling))throw new Error(`Client does not support sampling (required for ${e})`);break;case"roots/list":if(!(!((n=this._clientCapabilities)===null||n===void 0)&&n.roots))throw new Error(`Client does not support listing roots (required for ${e})`);break;case"ping":break}}assertNotificationCapability(e){switch(e){case"notifications/message":if(!this._capabilities.logging)throw new Error(`Server does not support logging (required for ${e})`);break;case"notifications/resources/updated":case"notifications/resources/list_changed":if(!this._capabilities.resources)throw new Error(`Server does not support notifying about resources (required for ${e})`);break;case"notifications/tools/list_changed":if(!this._capabilities.tools)throw new Error(`Server does not support notifying of tool list changes (required for ${e})`);break;case"notifications/prompts/list_changed":if(!this._capabilities.prompts)throw new Error(`Server does not support notifying of prompt list changes (required for ${e})`);break;case"notifications/cancelled":break;case"notifications/progress":break}}assertRequestHandlerCapability(e){switch(e){case"sampling/createMessage":if(!this._capabilities.sampling)throw new Error(`Server does not support sampling (required for ${e})`);break;case"logging/setLevel":if(!this._capabilities.logging)throw new Error(`Server does not support logging (required for ${e})`);break;case"prompts/get":case"prompts/list":if(!this._capabilities.prompts)throw new Error(`Server does not support prompts (required for ${e})`);break;case"resources/list":case"resources/templates/list":case"resources/read":if(!this._capabilities.resources)throw new Error(`Server does not support resources (required for ${e})`);break;case"tools/call":case"tools/list":if(!this._capabilities.tools)throw new Error(`Server does not support tools (required for ${e})`);break;case"ping":case"initialize":break}}async _oninitialize(e){let t=e.params.protocolVersion;return this._clientCapabilities=e.params.capabilities,this._clientVersion=e.params.clientInfo,{protocolVersion:mg.includes(t)?t:Xd,capabilities:this.getCapabilities(),serverInfo:this._serverInfo,...this._instructions&&{instructions:this._instructions}}}getClientCapabilities(){return this._clientCapabilities}getClientVersion(){return this._clientVersion}getCapabilities(){return this._capabilities}async ping(){return this.request({method:"ping"},lc)}async createMessage(e,t){return this.request({method:"sampling/createMessage",params:e},tf,t)}async listRoots(e,t){return this.request({method:"roots/list",params:e},rf,t)}async sendLoggingMessage(e){return this.notification({method:"notifications/message",params:e})}async sendResourceUpdated(e){return this.notification({method:"notifications/resources/updated",params:e})}async sendResourceListChanged(){return this.notification({method:"notifications/resources/list_changed"})}async sendToolListChanged(){return this.notification({method:"notifications/tools/list_changed"})}async sendPromptListChanged(){return this.notification({method:"notifications/prompts/list_changed"})}};var Dg=Symbol("Let zodToJsonSchema decide on which parser to use");var Mg={name:void 0,$refStrategy:"root",basePath:["#"],effectStrategy:"input",pipeStrategy:"all",dateStrategy:"format:date-time",mapStrategy:"entries",removeAdditionalStrategy:"passthrough",allowedAdditionalProperties:!0,rejectedAdditionalProperties:!1,definitionPath:"definitions",target:"jsonSchema7",strictUnions:!1,definitions:{},errorMessages:!1,markdownDescription:!1,patternStrategy:"escape",applyRegexFlags:!1,emailStrategy:"format:email",base64Strategy:"contentEncoding:base64",nameStrategy:"ref"},Lg=r=>typeof r=="string"?{...Mg,name:r}:{...Mg,...r};var Ug=r=>{let e=Lg(r),t=e.name!==void 0?[...e.basePath,e.definitionPath,e.name]:e.basePath;return{...e,currentPath:t,propertyPath:void 0,seen:new Map(Object.entries(e.definitions).map(([n,i])=>[i._def,{def:i._def,path:[...e.basePath,e.definitionPath,n],jsonSchema:void 0}]))}};function nf(r,e,t,n){n?.errorMessages&&t&&(r.errorMessage={...r.errorMessage,[e]:t})}function ne(r,e,t,n,i){r[e]=t,nf(r,e,n,i)}function Hg(){return{}}function Fg(r,e){let t={type:"array"};return r.type?._def&&r.type?._def?.typeName!==_.ZodAny&&(t.items=$(r.type._def,{...e,currentPath:[...e.currentPath,"items"]})),r.minLength&&ne(t,"minItems",r.minLength.value,r.minLength.message,e),r.maxLength&&ne(t,"maxItems",r.maxLength.value,r.maxLength.message,e),r.exactLength&&(ne(t,"minItems",r.exactLength.value,r.exactLength.message,e),ne(t,"maxItems",r.exactLength.value,r.exactLength.message,e)),t}function $g(r,e){let t={type:"integer",format:"int64"};if(!r.checks)return t;for(let n of r.checks)switch(n.kind){case"min":e.target==="jsonSchema7"?n.inclusive?ne(t,"minimum",n.value,n.message,e):ne(t,"exclusiveMinimum",n.value,n.message,e):(n.inclusive||(t.exclusiveMinimum=!0),ne(t,"minimum",n.value,n.message,e));break;case"max":e.target==="jsonSchema7"?n.inclusive?ne(t,"maximum",n.value,n.message,e):ne(t,"exclusiveMaximum",n.value,n.message,e):(n.inclusive||(t.exclusiveMaximum=!0),ne(t,"maximum",n.value,n.message,e));break;case"multipleOf":ne(t,"multipleOf",n.value,n.message,e);break}return t}function qg(){return{type:"boolean"}}function bc(r,e){return $(r.type._def,e)}var jg=(r,e)=>$(r.innerType._def,e);function of(r,e,t){let n=t??e.dateStrategy;if(Array.isArray(n))return{anyOf:n.map((i,o)=>of(r,e,i))};switch(n){case"string":case"format:date-time":return{type:"string",format:"date-time"};case"format:date":return{type:"string",format:"date"};case"integer":return mI(r,e)}}var mI=(r,e)=>{let t={type:"integer",format:"unix-time"};if(e.target==="openApi3")return t;for(let n of r.checks)switch(n.kind){case"min":ne(t,"minimum",n.value,n.message,e);break;case"max":ne(t,"maximum",n.value,n.message,e);break}return t};function Bg(r,e){return{...$(r.innerType._def,e),default:r.defaultValue()}}function zg(r,e){return e.effectStrategy==="input"?$(r.schema._def,e):{}}function Gg(r){return{type:"string",enum:Array.from(r.values)}}var gI=r=>"type"in r&&r.type==="string"?!1:"allOf"in r;function Vg(r,e){let t=[$(r.left._def,{...e,currentPath:[...e.currentPath,"allOf","0"]}),$(r.right._def,{...e,currentPath:[...e.currentPath,"allOf","1"]})].filter(o=>!!o),n=e.target==="jsonSchema2019-09"?{unevaluatedProperties:!1}:void 0,i=[];return t.forEach(o=>{if(gI(o))i.push(...o.allOf),o.unevaluatedProperties===void 0&&(n=void 0);else{let s=o;if("additionalProperties"in o&&o.additionalProperties===!1){let{additionalProperties:a,...c}=o;s=c}else n=void 0;i.push(s)}}),i.length?{allOf:i,...n}:void 0}function Kg(r,e){let t=typeof r.value;return t!=="bigint"&&t!=="number"&&t!=="boolean"&&t!=="string"?{type:Array.isArray(r.value)?"array":"object"}:e.target==="openApi3"?{type:t==="bigint"?"integer":t,enum:[r.value]}:{type:t==="bigint"?"integer":t,const:r.value}}var sf,Kt={cuid:/^[cC][^\s-]{8,}$/,cuid2:/^[0-9a-z]+$/,ulid:/^[0-9A-HJKMNP-TV-Z]{26}$/,email:/^(?!\.)(?!.*\.\.)([a-zA-Z0-9_'+\-\.]*)[a-zA-Z0-9_+-]@([a-zA-Z0-9][a-zA-Z0-9\-]*\.)+[a-zA-Z]{2,}$/,emoji:()=>(sf===void 0&&(sf=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),sf),uuid:/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/,ipv4:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,ipv4Cidr:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,ipv6:/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/,ipv6Cidr:/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,base64:/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,base64url:/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,nanoid:/^[a-zA-Z0-9_-]{21}$/,jwt:/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/};function Oc(r,e){let t={type:"string"};if(r.checks)for(let n of r.checks)switch(n.kind){case"min":ne(t,"minLength",typeof t.minLength=="number"?Math.max(t.minLength,n.value):n.value,n.message,e);break;case"max":ne(t,"maxLength",typeof t.maxLength=="number"?Math.min(t.maxLength,n.value):n.value,n.message,e);break;case"email":switch(e.emailStrategy){case"format:email":Yt(t,"email",n.message,e);break;case"format:idn-email":Yt(t,"idn-email",n.message,e);break;case"pattern:zod":We(t,Kt.email,n.message,e);break}break;case"url":Yt(t,"uri",n.message,e);break;case"uuid":Yt(t,"uuid",n.message,e);break;case"regex":We(t,n.regex,n.message,e);break;case"cuid":We(t,Kt.cuid,n.message,e);break;case"cuid2":We(t,Kt.cuid2,n.message,e);break;case"startsWith":We(t,RegExp(`^${af(n.value,e)}`),n.message,e);break;case"endsWith":We(t,RegExp(`${af(n.value,e)}$`),n.message,e);break;case"datetime":Yt(t,"date-time",n.message,e);break;case"date":Yt(t,"date",n.message,e);break;case"time":Yt(t,"time",n.message,e);break;case"duration":Yt(t,"duration",n.message,e);break;case"length":ne(t,"minLength",typeof t.minLength=="number"?Math.max(t.minLength,n.value):n.value,n.message,e),ne(t,"maxLength",typeof t.maxLength=="number"?Math.min(t.maxLength,n.value):n.value,n.message,e);break;case"includes":{We(t,RegExp(af(n.value,e)),n.message,e);break}case"ip":{n.version!=="v6"&&Yt(t,"ipv4",n.message,e),n.version!=="v4"&&Yt(t,"ipv6",n.message,e);break}case"base64url":We(t,Kt.base64url,n.message,e);break;case"jwt":We(t,Kt.jwt,n.message,e);break;case"cidr":{n.version!=="v6"&&We(t,Kt.ipv4Cidr,n.message,e),n.version!=="v4"&&We(t,Kt.ipv6Cidr,n.message,e);break}case"emoji":We(t,Kt.emoji(),n.message,e);break;case"ulid":{We(t,Kt.ulid,n.message,e);break}case"base64":{switch(e.base64Strategy){case"format:binary":{Yt(t,"binary",n.message,e);break}case"contentEncoding:base64":{ne(t,"contentEncoding","base64",n.message,e);break}case"pattern:zod":{We(t,Kt.base64,n.message,e);break}}break}case"nanoid":We(t,Kt.nanoid,n.message,e);case"toLowerCase":case"toUpperCase":case"trim":break;default:}return t}function af(r,e){return e.patternStrategy==="escape"?EI(r):r}var yI=new Set("ABCDEFGHIJKLMNOPQRSTUVXYZabcdefghijklmnopqrstuvxyz0123456789");function EI(r){let e="";for(let t=0;t<r.length;t++)yI.has(r[t])||(e+="\\"),e+=r[t];return e}function Yt(r,e,t,n){r.format||r.anyOf?.some(i=>i.format)?(r.anyOf||(r.anyOf=[]),r.format&&(r.anyOf.push({format:r.format,...r.errorMessage&&n.errorMessages&&{errorMessage:{format:r.errorMessage.format}}}),delete r.format,r.errorMessage&&(delete r.errorMessage.format,Object.keys(r.errorMessage).length===0&&delete r.errorMessage)),r.anyOf.push({format:e,...t&&n.errorMessages&&{errorMessage:{format:t}}})):ne(r,"format",e,t,n)}function We(r,e,t,n){r.pattern||r.allOf?.some(i=>i.pattern)?(r.allOf||(r.allOf=[]),r.pattern&&(r.allOf.push({pattern:r.pattern,...r.errorMessage&&n.errorMessages&&{errorMessage:{pattern:r.errorMessage.pattern}}}),delete r.pattern,r.errorMessage&&(delete r.errorMessage.pattern,Object.keys(r.errorMessage).length===0&&delete r.errorMessage)),r.allOf.push({pattern:Yg(e,n),...t&&n.errorMessages&&{errorMessage:{pattern:t}}})):ne(r,"pattern",Yg(e,n),t,n)}function Yg(r,e){if(!e.applyRegexFlags||!r.flags)return r.source;let t={i:r.flags.includes("i"),m:r.flags.includes("m"),s:r.flags.includes("s")},n=t.i?r.source.toLowerCase():r.source,i="",o=!1,s=!1,a=!1;for(let c=0;c<n.length;c++){if(o){i+=n[c],o=!1;continue}if(t.i){if(s){if(n[c].match(/[a-z]/)){a?(i+=n[c],i+=`${n[c-2]}-${n[c]}`.toUpperCase(),a=!1):n[c+1]==="-"&&n[c+2]?.match(/[a-z]/)?(i+=n[c],a=!0):i+=`${n[c]}${n[c].toUpperCase()}`;continue}}else if(n[c].match(/[a-z]/)){i+=`[${n[c]}${n[c].toUpperCase()}]`;continue}}if(t.m){if(n[c]==="^"){i+=`(^|(?<=[\r
]))`;continue}else if(n[c]==="$"){i+=`($|(?=[\r
]))`;continue}}if(t.s&&n[c]==="."){i+=s?`${n[c]}\r
`:`[${n[c]}\r
]`;continue}i+=n[c],n[c]==="\\"?o=!0:s&&n[c]==="]"?s=!1:!s&&n[c]==="["&&(s=!0)}try{new RegExp(i)}catch{return console.warn(`Could not convert regex pattern at ${e.currentPath.join("/")} to a flag-independent form! Falling back to the flag-ignorant source`),r.source}return i}function kc(r,e){if(e.target==="openAi"&&console.warn("Warning: OpenAI may not support records in schemas! Try an array of key-value pairs instead."),e.target==="openApi3"&&r.keyType?._def.typeName===_.ZodEnum)return{type:"object",required:r.keyType._def.values,properties:r.keyType._def.values.reduce((n,i)=>({...n,[i]:$(r.valueType._def,{...e,currentPath:[...e.currentPath,"properties",i]})??{}}),{}),additionalProperties:e.rejectedAdditionalProperties};let t={type:"object",additionalProperties:$(r.valueType._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]})??e.allowedAdditionalProperties};if(e.target==="openApi3")return t;if(r.keyType?._def.typeName===_.ZodString&&r.keyType._def.checks?.length){let{type:n,...i}=Oc(r.keyType._def,e);return{...t,propertyNames:i}}else{if(r.keyType?._def.typeName===_.ZodEnum)return{...t,propertyNames:{enum:r.keyType._def.values}};if(r.keyType?._def.typeName===_.ZodBranded&&r.keyType._def.type._def.typeName===_.ZodString&&r.keyType._def.type._def.checks?.length){let{type:n,...i}=bc(r.keyType._def,e);return{...t,propertyNames:i}}}return t}function Wg(r,e){if(e.mapStrategy==="record")return kc(r,e);let t=$(r.keyType._def,{...e,currentPath:[...e.currentPath,"items","items","0"]})||{},n=$(r.valueType._def,{...e,currentPath:[...e.currentPath,"items","items","1"]})||{};return{type:"array",maxItems:125,items:{type:"array",items:[t,n],minItems:2,maxItems:2}}}function Zg(r){let e=r.values,n=Object.keys(r.values).filter(o=>typeof e[e[o]]!="number").map(o=>e[o]),i=Array.from(new Set(n.map(o=>typeof o)));return{type:i.length===1?i[0]==="string"?"string":"number":["string","number"],enum:n}}function Xg(){return{not:{}}}function Qg(r){return r.target==="openApi3"?{enum:["null"],nullable:!0}:{type:"null"}}var as={ZodString:"string",ZodNumber:"number",ZodBigInt:"integer",ZodBoolean:"boolean",ZodNull:"null"};function ey(r,e){if(e.target==="openApi3")return Jg(r,e);let t=r.options instanceof Map?Array.from(r.options.values()):r.options;if(t.every(n=>n._def.typeName in as&&(!n._def.checks||!n._def.checks.length))){let n=t.reduce((i,o)=>{let s=as[o._def.typeName];return s&&!i.includes(s)?[...i,s]:i},[]);return{type:n.length>1?n:n[0]}}else if(t.every(n=>n._def.typeName==="ZodLiteral"&&!n.description)){let n=t.reduce((i,o)=>{let s=typeof o._def.value;switch(s){case"string":case"number":case"boolean":return[...i,s];case"bigint":return[...i,"integer"];case"object":if(o._def.value===null)return[...i,"null"];case"symbol":case"undefined":case"function":default:return i}},[]);if(n.length===t.length){let i=n.filter((o,s,a)=>a.indexOf(o)===s);return{type:i.length>1?i:i[0],enum:t.reduce((o,s)=>o.includes(s._def.value)?o:[...o,s._def.value],[])}}}else if(t.every(n=>n._def.typeName==="ZodEnum"))return{type:"string",enum:t.reduce((n,i)=>[...n,...i._def.values.filter(o=>!n.includes(o))],[])};return Jg(r,e)}var Jg=(r,e)=>{let t=(r.options instanceof Map?Array.from(r.options.values()):r.options).map((n,i)=>$(n._def,{...e,currentPath:[...e.currentPath,"anyOf",`${i}`]})).filter(n=>!!n&&(!e.strictUnions||typeof n=="object"&&Object.keys(n).length>0));return t.length?{anyOf:t}:void 0};function ty(r,e){if(["ZodString","ZodNumber","ZodBigInt","ZodBoolean","ZodNull"].includes(r.innerType._def.typeName)&&(!r.innerType._def.checks||!r.innerType._def.checks.length))return e.target==="openApi3"?{type:as[r.innerType._def.typeName],nullable:!0}:{type:[as[r.innerType._def.typeName],"null"]};if(e.target==="openApi3"){let n=$(r.innerType._def,{...e,currentPath:[...e.currentPath]});return n&&"$ref"in n?{allOf:[n],nullable:!0}:n&&{...n,nullable:!0}}let t=$(r.innerType._def,{...e,currentPath:[...e.currentPath,"anyOf","0"]});return t&&{anyOf:[t,{type:"null"}]}}function ry(r,e){let t={type:"number"};if(!r.checks)return t;for(let n of r.checks)switch(n.kind){case"int":t.type="integer",nf(t,"type",n.message,e);break;case"min":e.target==="jsonSchema7"?n.inclusive?ne(t,"minimum",n.value,n.message,e):ne(t,"exclusiveMinimum",n.value,n.message,e):(n.inclusive||(t.exclusiveMinimum=!0),ne(t,"minimum",n.value,n.message,e));break;case"max":e.target==="jsonSchema7"?n.inclusive?ne(t,"maximum",n.value,n.message,e):ne(t,"exclusiveMaximum",n.value,n.message,e):(n.inclusive||(t.exclusiveMaximum=!0),ne(t,"maximum",n.value,n.message,e));break;case"multipleOf":ne(t,"multipleOf",n.value,n.message,e);break}return t}function ny(r,e){let t=e.target==="openAi",n={type:"object",properties:{}},i=[],o=r.shape();for(let a in o){let c=o[a];if(c===void 0||c._def===void 0)continue;let l=vI(c);l&&t&&(c instanceof it&&(c=c._def.innerType),c.isNullable()||(c=c.nullable()),l=!1);let u=$(c._def,{...e,currentPath:[...e.currentPath,"properties",a],propertyPath:[...e.currentPath,"properties",a]});u!==void 0&&(n.properties[a]=u,l||i.push(a))}i.length&&(n.required=i);let s=TI(r,e);return s!==void 0&&(n.additionalProperties=s),n}function TI(r,e){if(r.catchall._def.typeName!=="ZodNever")return $(r.catchall._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]});switch(r.unknownKeys){case"passthrough":return e.allowedAdditionalProperties;case"strict":return e.rejectedAdditionalProperties;case"strip":return e.removeAdditionalStrategy==="strict"?e.allowedAdditionalProperties:e.rejectedAdditionalProperties}}function vI(r){try{return r.isOptional()}catch{return!0}}var iy=(r,e)=>{if(e.currentPath.toString()===e.propertyPath?.toString())return $(r.innerType._def,e);let t=$(r.innerType._def,{...e,currentPath:[...e.currentPath,"anyOf","1"]});return t?{anyOf:[{not:{}},t]}:{}};var oy=(r,e)=>{if(e.pipeStrategy==="input")return $(r.in._def,e);if(e.pipeStrategy==="output")return $(r.out._def,e);let t=$(r.in._def,{...e,currentPath:[...e.currentPath,"allOf","0"]}),n=$(r.out._def,{...e,currentPath:[...e.currentPath,"allOf",t?"1":"0"]});return{allOf:[t,n].filter(i=>i!==void 0)}};function sy(r,e){return $(r.type._def,e)}function ay(r,e){let n={type:"array",uniqueItems:!0,items:$(r.valueType._def,{...e,currentPath:[...e.currentPath,"items"]})};return r.minSize&&ne(n,"minItems",r.minSize.value,r.minSize.message,e),r.maxSize&&ne(n,"maxItems",r.maxSize.value,r.maxSize.message,e),n}function cy(r,e){return r.rest?{type:"array",minItems:r.items.length,items:r.items.map((t,n)=>$(t._def,{...e,currentPath:[...e.currentPath,"items",`${n}`]})).reduce((t,n)=>n===void 0?t:[...t,n],[]),additionalItems:$(r.rest._def,{...e,currentPath:[...e.currentPath,"additionalItems"]})}:{type:"array",minItems:r.items.length,maxItems:r.items.length,items:r.items.map((t,n)=>$(t._def,{...e,currentPath:[...e.currentPath,"items",`${n}`]})).reduce((t,n)=>n===void 0?t:[...t,n],[])}}function ly(){return{not:{}}}function uy(){return{}}var dy=(r,e)=>$(r.innerType._def,e);var fy=(r,e,t)=>{switch(e){case _.ZodString:return Oc(r,t);case _.ZodNumber:return ry(r,t);case _.ZodObject:return ny(r,t);case _.ZodBigInt:return $g(r,t);case _.ZodBoolean:return qg();case _.ZodDate:return of(r,t);case _.ZodUndefined:return ly();case _.ZodNull:return Qg(t);case _.ZodArray:return Fg(r,t);case _.ZodUnion:case _.ZodDiscriminatedUnion:return ey(r,t);case _.ZodIntersection:return Vg(r,t);case _.ZodTuple:return cy(r,t);case _.ZodRecord:return kc(r,t);case _.ZodLiteral:return Kg(r,t);case _.ZodEnum:return Gg(r);case _.ZodNativeEnum:return Zg(r);case _.ZodNullable:return ty(r,t);case _.ZodOptional:return iy(r,t);case _.ZodMap:return Wg(r,t);case _.ZodSet:return ay(r,t);case _.ZodLazy:return()=>r.getter()._def;case _.ZodPromise:return sy(r,t);case _.ZodNaN:case _.ZodNever:return Xg();case _.ZodEffects:return zg(r,t);case _.ZodAny:return Hg();case _.ZodUnknown:return uy();case _.ZodDefault:return Bg(r,t);case _.ZodBranded:return bc(r,t);case _.ZodReadonly:return dy(r,t);case _.ZodCatch:return jg(r,t);case _.ZodPipeline:return oy(r,t);case _.ZodFunction:case _.ZodVoid:case _.ZodSymbol:return;default:return(n=>{})(e)}};function $(r,e,t=!1){let n=e.seen.get(r);if(e.override){let a=e.override?.(r,e,n,t);if(a!==Dg)return a}if(n&&!t){let a=CI(n,e);if(a!==void 0)return a}let i={def:r,path:e.currentPath,jsonSchema:void 0};e.seen.set(r,i);let o=fy(r,r.typeName,e),s=typeof o=="function"?$(o(),e):o;if(s&&AI(r,e,s),e.postProcess){let a=e.postProcess(s,r,e);return i.jsonSchema=s,a}return i.jsonSchema=s,s}var CI=(r,e)=>{switch(e.$refStrategy){case"root":return{$ref:r.path.join("/")};case"relative":return{$ref:_I(e.currentPath,r.path)};case"none":case"seen":return r.path.length<e.currentPath.length&&r.path.every((t,n)=>e.currentPath[n]===t)?(console.warn(`Recursive reference detected at ${e.currentPath.join("/")}! Defaulting to any`),{}):e.$refStrategy==="seen"?{}:void 0}},_I=(r,e)=>{let t=0;for(;t<r.length&&t<e.length&&r[t]===e[t];t++);return[(r.length-t).toString(),...e.slice(t)].join("/")},AI=(r,e,t)=>(r.description&&(t.description=r.description,e.markdownDescription&&(t.markdownDescription=r.description)),t);var cf=(r,e)=>{let t=Ug(e),n=typeof e=="object"&&e.definitions?Object.entries(e.definitions).reduce((c,[l,u])=>({...c,[l]:$(u._def,{...t,currentPath:[...t.basePath,t.definitionPath,l]},!0)??{}}),{}):void 0,i=typeof e=="string"?e:e?.nameStrategy==="title"?void 0:e?.name,o=$(r._def,i===void 0?t:{...t,currentPath:[...t.basePath,t.definitionPath,i]},!1)??{},s=typeof e=="object"&&e.name!==void 0&&e.nameStrategy==="title"?e.name:void 0;s!==void 0&&(o.title=s);let a=i===void 0?n?{...o,[t.definitionPath]:n}:o:{$ref:[...t.$refStrategy==="relative"?[]:t.basePath,t.definitionPath,i].join("/"),[t.definitionPath]:{...n,[i]:o}};return t.target==="jsonSchema7"?a.$schema="http://json-schema.org/draft-07/schema#":(t.target==="jsonSchema2019-09"||t.target==="openAi")&&(a.$schema="https://json-schema.org/draft/2019-09/schema#"),t.target==="openAi"&&("anyOf"in a||"oneOf"in a||"allOf"in a||"type"in a&&Array.isArray(a.type))&&console.warn("Warning: OpenAI may not support schemas with unions as roots! Try wrapping it in an object property."),a};var lf;(function(r){r.Completable="McpCompletable"})(lf||(lf={}));var Zi=class extends z{_parse(e){let{ctx:t}=this._processInputParams(e),n=t.data;return this._def.type._parse({data:n,path:t.path,parent:t})}unwrap(){return this._def.type}};Zi.create=(r,e)=>new Zi({type:r,typeName:lf.Completable,complete:e.complete,...SI(e)});function SI(r){if(!r)return{};let{errorMap:e,invalid_type_error:t,required_error:n,description:i}=r;if(e&&(t||n))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return e?{errorMap:e,description:i}:{errorMap:(s,a)=>{var c,l;let{message:u}=r;return s.code==="invalid_enum_value"?{message:u??a.defaultError}:typeof a.data>"u"?{message:(c=u??n)!==null&&c!==void 0?c:a.defaultError}:s.code!=="invalid_type"?{message:a.defaultError}:{message:(l=u??t)!==null&&l!==void 0?l:a.defaultError}},description:i}}var Pc=class{constructor(e,t){this._registeredResources={},this._registeredResourceTemplates={},this._registeredTools={},this._registeredPrompts={},this._toolHandlersInitialized=!1,this._completionHandlerInitialized=!1,this._resourceHandlersInitialized=!1,this._promptHandlersInitialized=!1,this.server=new Ic(e,t)}async connect(e){return await this.server.connect(e)}async close(){await this.server.close()}setToolRequestHandlers(){this._toolHandlersInitialized||(this.server.assertCanSetRequestHandler(Ac.shape.method.value),this.server.assertCanSetRequestHandler(Sc.shape.method.value),this.server.registerCapabilities({tools:{listChanged:!0}}),this.server.setRequestHandler(Ac,()=>({tools:Object.entries(this._registeredTools).filter(([,e])=>e.enabled).map(([e,t])=>({name:e,description:t.description,inputSchema:t.inputSchema?cf(t.inputSchema,{strictUnions:!0}):wI}))})),this.server.setRequestHandler(Sc,async(e,t)=>{let n=this._registeredTools[e.params.name];if(!n)throw new Oe(Re.InvalidParams,`Tool ${e.params.name} not found`);if(!n.enabled)throw new Oe(Re.InvalidParams,`Tool ${e.params.name} disabled`);if(n.inputSchema){let i=await n.inputSchema.safeParseAsync(e.params.arguments);if(!i.success)throw new Oe(Re.InvalidParams,`Invalid arguments for tool ${e.params.name}: ${i.error.message}`);let o=i.data,s=n.callback;try{return await Promise.resolve(s(o,t))}catch(a){return{content:[{type:"text",text:a instanceof Error?a.message:String(a)}],isError:!0}}}else{let i=n.callback;try{return await Promise.resolve(i(t))}catch(o){return{content:[{type:"text",text:o instanceof Error?o.message:String(o)}],isError:!0}}}}),this._toolHandlersInitialized=!0)}setCompletionRequestHandler(){this._completionHandlerInitialized||(this.server.assertCanSetRequestHandler(wc.shape.method.value),this.server.setRequestHandler(wc,async e=>{switch(e.params.ref.type){case"ref/prompt":return this.handlePromptCompletion(e,e.params.ref);case"ref/resource":return this.handleResourceCompletion(e,e.params.ref);default:throw new Oe(Re.InvalidParams,`Invalid completion reference: ${e.params.ref}`)}}),this._completionHandlerInitialized=!0)}async handlePromptCompletion(e,t){let n=this._registeredPrompts[t.name];if(!n)throw new Oe(Re.InvalidParams,`Prompt ${t.name} not found`);if(!n.enabled)throw new Oe(Re.InvalidParams,`Prompt ${t.name} disabled`);if(!n.argsSchema)return xc;let i=n.argsSchema.shape[e.params.argument.name];if(!(i instanceof Zi))return xc;let s=await i._def.complete(e.params.argument.value);return hy(s)}async handleResourceCompletion(e,t){let n=Object.values(this._registeredResourceTemplates).find(s=>s.resourceTemplate.uriTemplate.toString()===t.uri);if(!n){if(this._registeredResources[t.uri])return xc;throw new Oe(Re.InvalidParams,`Resource template ${e.params.ref.uri} not found`)}let i=n.resourceTemplate.completeCallback(e.params.argument.name);if(!i)return xc;let o=await i(e.params.argument.value);return hy(o)}setResourceRequestHandlers(){this._resourceHandlersInitialized||(this.server.assertCanSetRequestHandler(mc.shape.method.value),this.server.assertCanSetRequestHandler(gc.shape.method.value),this.server.assertCanSetRequestHandler(yc.shape.method.value),this.server.registerCapabilities({resources:{listChanged:!0}}),this.server.setRequestHandler(mc,async(e,t)=>{let n=Object.entries(this._registeredResources).filter(([o,s])=>s.enabled).map(([o,s])=>({uri:o,name:s.name,...s.metadata})),i=[];for(let o of Object.values(this._registeredResourceTemplates)){if(!o.resourceTemplate.listCallback)continue;let s=await o.resourceTemplate.listCallback(t);for(let a of s.resources)i.push({...a,...o.metadata})}return{resources:[...n,...i]}}),this.server.setRequestHandler(gc,async()=>({resourceTemplates:Object.entries(this._registeredResourceTemplates).map(([t,n])=>({name:t,uriTemplate:n.resourceTemplate.uriTemplate.toString(),...n.metadata}))})),this.server.setRequestHandler(yc,async(e,t)=>{let n=new URL(e.params.uri),i=this._registeredResources[n.toString()];if(i){if(!i.enabled)throw new Oe(Re.InvalidParams,`Resource ${n} disabled`);return i.readCallback(n,t)}for(let o of Object.values(this._registeredResourceTemplates)){let s=o.resourceTemplate.uriTemplate.match(n.toString());if(s)return o.readCallback(n,s,t)}throw new Oe(Re.InvalidParams,`Resource ${n} not found`)}),this.setCompletionRequestHandler(),this._resourceHandlersInitialized=!0)}setPromptRequestHandlers(){this._promptHandlersInitialized||(this.server.assertCanSetRequestHandler(Ec.shape.method.value),this.server.assertCanSetRequestHandler(Tc.shape.method.value),this.server.registerCapabilities({prompts:{listChanged:!0}}),this.server.setRequestHandler(Ec,()=>({prompts:Object.entries(this._registeredPrompts).filter(([,e])=>e.enabled).map(([e,t])=>({name:e,description:t.description,arguments:t.argsSchema?RI(t.argsSchema):void 0}))})),this.server.setRequestHandler(Tc,async(e,t)=>{let n=this._registeredPrompts[e.params.name];if(!n)throw new Oe(Re.InvalidParams,`Prompt ${e.params.name} not found`);if(!n.enabled)throw new Oe(Re.InvalidParams,`Prompt ${e.params.name} disabled`);if(n.argsSchema){let i=await n.argsSchema.safeParseAsync(e.params.arguments);if(!i.success)throw new Oe(Re.InvalidParams,`Invalid arguments for prompt ${e.params.name}: ${i.error.message}`);let o=i.data,s=n.callback;return await Promise.resolve(s(o,t))}else{let i=n.callback;return await Promise.resolve(i(t))}}),this.setCompletionRequestHandler(),this._promptHandlersInitialized=!0)}resource(e,t,...n){let i;typeof n[0]=="object"&&(i=n.shift());let o=n[0];if(typeof t=="string"){if(this._registeredResources[t])throw new Error(`Resource ${t} is already registered`);let s={name:e,metadata:i,readCallback:o,enabled:!0,disable:()=>s.update({enabled:!1}),enable:()=>s.update({enabled:!0}),remove:()=>s.update({uri:null}),update:a=>{typeof a.uri<"u"&&a.uri!==t&&(delete this._registeredResources[t],a.uri&&(this._registeredResources[a.uri]=s)),typeof a.name<"u"&&(s.name=a.name),typeof a.metadata<"u"&&(s.metadata=a.metadata),typeof a.callback<"u"&&(s.readCallback=a.callback),typeof a.enabled<"u"&&(s.enabled=a.enabled),this.sendResourceListChanged()}};return this._registeredResources[t]=s,this.setResourceRequestHandlers(),this.sendResourceListChanged(),s}else{if(this._registeredResourceTemplates[e])throw new Error(`Resource template ${e} is already registered`);let s={resourceTemplate:t,metadata:i,readCallback:o,enabled:!0,disable:()=>s.update({enabled:!1}),enable:()=>s.update({enabled:!0}),remove:()=>s.update({name:null}),update:a=>{typeof a.name<"u"&&a.name!==e&&(delete this._registeredResourceTemplates[e],a.name&&(this._registeredResourceTemplates[a.name]=s)),typeof a.template<"u"&&(s.resourceTemplate=a.template),typeof a.metadata<"u"&&(s.metadata=a.metadata),typeof a.callback<"u"&&(s.readCallback=a.callback),typeof a.enabled<"u"&&(s.enabled=a.enabled),this.sendResourceListChanged()}};return this._registeredResourceTemplates[e]=s,this.setResourceRequestHandlers(),this.sendResourceListChanged(),s}}tool(e,...t){if(this._registeredTools[e])throw new Error(`Tool ${e} is already registered`);let n;typeof t[0]=="string"&&(n=t.shift());let i;t.length>1&&(i=t.shift());let o=t[0],s={description:n,inputSchema:i===void 0?void 0:f.object(i),callback:o,enabled:!0,disable:()=>s.update({enabled:!1}),enable:()=>s.update({enabled:!0}),remove:()=>s.update({name:null}),update:a=>{typeof a.name<"u"&&a.name!==e&&(delete this._registeredTools[e],a.name&&(this._registeredTools[a.name]=s)),typeof a.description<"u"&&(s.description=a.description),typeof a.paramsSchema<"u"&&(s.inputSchema=f.object(a.paramsSchema)),typeof a.callback<"u"&&(s.callback=a.callback),typeof a.enabled<"u"&&(s.enabled=a.enabled),this.sendToolListChanged()}};return this._registeredTools[e]=s,this.setToolRequestHandlers(),this.sendToolListChanged(),s}prompt(e,...t){if(this._registeredPrompts[e])throw new Error(`Prompt ${e} is already registered`);let n;typeof t[0]=="string"&&(n=t.shift());let i;t.length>1&&(i=t.shift());let o=t[0],s={description:n,argsSchema:i===void 0?void 0:f.object(i),callback:o,enabled:!0,disable:()=>s.update({enabled:!1}),enable:()=>s.update({enabled:!0}),remove:()=>s.update({name:null}),update:a=>{typeof a.name<"u"&&a.name!==e&&(delete this._registeredPrompts[e],a.name&&(this._registeredPrompts[a.name]=s)),typeof a.description<"u"&&(s.description=a.description),typeof a.argsSchema<"u"&&(s.argsSchema=f.object(a.argsSchema)),typeof a.callback<"u"&&(s.callback=a.callback),typeof a.enabled<"u"&&(s.enabled=a.enabled),this.sendPromptListChanged()}};return this._registeredPrompts[e]=s,this.setPromptRequestHandlers(),this.sendPromptListChanged(),s}isConnected(){return this.server.transport!==void 0}sendResourceListChanged(){this.isConnected()&&this.server.sendResourceListChanged()}sendToolListChanged(){this.isConnected()&&this.server.sendToolListChanged()}sendPromptListChanged(){this.isConnected()&&this.server.sendPromptListChanged()}};var wI={type:"object"};function RI(r){return Object.entries(r.shape).map(([e,t])=>({name:e,description:t.description,required:!t.isOptional()}))}function hy(r){return{completion:{values:r.slice(0,100),total:r.length,hasMore:r.length>100}}}var xc={completion:{values:[],hasMore:!1}};import my from"node:process";var Nc=class{append(e){this._buffer=this._buffer?Buffer.concat([this._buffer,e]):e}readMessage(){if(!this._buffer)return null;let e=this._buffer.indexOf(`
`);if(e===-1)return null;let t=this._buffer.toString("utf8",0,e).replace(/\r$/,"");return this._buffer=this._buffer.subarray(e+1),II(t)}clear(){this._buffer=void 0}};function II(r){return wg.parse(JSON.parse(r))}function py(r){return JSON.stringify(r)+`
`}var Mc=class{constructor(e=my.stdin,t=my.stdout){this._stdin=e,this._stdout=t,this._readBuffer=new Nc,this._started=!1,this._ondata=n=>{this._readBuffer.append(n),this.processReadBuffer()},this._onerror=n=>{var i;(i=this.onerror)===null||i===void 0||i.call(this,n)}}async start(){if(this._started)throw new Error("StdioServerTransport already started! If using Server class, note that connect() calls start() automatically.");this._started=!0,this._stdin.on("data",this._ondata),this._stdin.on("error",this._onerror)}processReadBuffer(){for(var e,t;;)try{let n=this._readBuffer.readMessage();if(n===null)break;(e=this.onmessage)===null||e===void 0||e.call(this,n)}catch(n){(t=this.onerror)===null||t===void 0||t.call(this,n)}}async close(){var e;this._stdin.off("data",this._ondata),this._stdin.off("error",this._onerror),this._stdin.listenerCount("data")===0&&this._stdin.pause(),this._readBuffer.clear(),(e=this.onclose)===null||e===void 0||e.call(this)}send(e){return new Promise(t=>{let n=py(e);this._stdout.write(n)?t():this._stdout.once("drain",t)})}};var Tw=qi(bE(),1);var Ml="4.9.0",ms="04b07795-8ddb-461a-bbee-02f9e1bf7b46",OE="common",br;(function(r){r.AzureChina="https://login.chinacloudapi.cn",r.AzureGermany="https://login.microsoftonline.de",r.AzureGovernment="https://login.microsoftonline.us",r.AzurePublicCloud="https://login.microsoftonline.com"})(br||(br={}));var gs=br.AzurePublicCloud,kE="login.microsoftonline.com",xE=["*"],PE="cae",NE="nocae",ME="msal.cache";var Mf;var DE;function KO(r){var e,t,n,i,o,s,a;let c={cache:{},broker:{isEnabled:(t=(e=r.brokerOptions)===null||e===void 0?void 0:e.enabled)!==null&&t!==void 0?t:!1,enableMsaPassthrough:(i=(n=r.brokerOptions)===null||n===void 0?void 0:n.legacyEnableMsaPassthrough)!==null&&i!==void 0?i:!1,parentWindowHandle:(o=r.brokerOptions)===null||o===void 0?void 0:o.parentWindowHandle}};if(!((s=r.tokenCachePersistenceOptions)===null||s===void 0)&&s.enabled){if(Mf===void 0)throw new Error(["Persistent token caching was requested, but no persistence provider was configured.","You must install the identity-cache-persistence plugin package (`npm install --save @azure/identity-cache-persistence`)","and enable it by importing `useIdentityPlugin` from `@azure/identity` and calling","`useIdentityPlugin(cachePersistencePlugin)` before using `tokenCachePersistenceOptions`."].join(" "));let l=r.tokenCachePersistenceOptions.name||ME;c.cache.cachePlugin=Mf(Object.assign({name:`${l}.${NE}`},r.tokenCachePersistenceOptions)),c.cache.cachePluginCae=Mf(Object.assign({name:`${l}.${PE}`},r.tokenCachePersistenceOptions))}if(!((a=r.brokerOptions)===null||a===void 0)&&a.enabled){if(DE===void 0)throw new Error(["Broker for WAM was requested to be enabled, but no native broker was configured.","You must install the identity-broker plugin package (`npm install --save @azure/identity-broker`)","and enable it by importing `useIdentityPlugin` from `@azure/identity` and calling","`useIdentityPlugin(createNativeBrokerPlugin())` before using `enableBroker`."].join(" "));c.broker.nativeBrokerPlugin=DE.broker}return c}var LE={generatePluginConfiguration:KO};import{EOL as YO}from"node:os";import WO from"node:util";import*as UE from"node:process";function HE(r,...e){UE.stderr.write(`${WO.format(r,...e)}${YO}`)}var FE=typeof process<"u"&&process.env&&process.env.DEBUG||void 0,$E,Df=[],Lf=[],Dl=[];FE&&Uf(FE);var qE=Object.assign(r=>jE(r),{enable:Uf,enabled:Hf,disable:ZO,log:HE});function Uf(r){$E=r,Df=[],Lf=[];let e=/\*/g,t=r.split(",").map(n=>n.trim().replace(e,".*?"));for(let n of t)n.startsWith("-")?Lf.push(new RegExp(`^${n.substr(1)}$`)):Df.push(new RegExp(`^${n}$`));for(let n of Dl)n.enabled=Hf(n.namespace)}function Hf(r){if(r.endsWith("*"))return!0;for(let e of Lf)if(e.test(r))return!1;for(let e of Df)if(e.test(r))return!0;return!1}function ZO(){let r=$E||"";return Uf(""),r}function jE(r){let e=Object.assign(t,{enabled:Hf(r),destroy:XO,log:qE.log,namespace:r,extend:QO});function t(...n){e.enabled&&(n.length>0&&(n[0]=`${r} ${n[0]}`),e.log(...n))}return Dl.push(e),e}function XO(){let r=Dl.indexOf(this);return r>=0?(Dl.splice(r,1),!0):!1}function QO(r){let e=jE(`${this.namespace}:${r}`);return e.log=this.log,e}var so=qE;var zE=new Set,Ll=typeof process<"u"&&process.env&&process.env.AZURE_LOG_LEVEL||void 0,Hl,Ff=so("azure");Ff.log=(...r)=>{so.log(...r)};var $f=["verbose","info","warning","error"];Ll&&(KE(Ll)?JO(Ll):console.error(`AZURE_LOG_LEVEL set to unknown log level '${Ll}'; logging is not enabled. Acceptable values: ${$f.join(", ")}.`));function JO(r){if(r&&!KE(r))throw new Error(`Unknown log level '${r}'. Acceptable values: ${$f.join(",")}`);Hl=r;let e=[];for(let t of zE)VE(t)&&e.push(t.namespace);so.enable(e.join(","))}function qf(){return Hl}var BE={verbose:400,info:300,warning:200,error:100};function Qr(r){let e=Ff.extend(r);return GE(Ff,e),{error:Ul(e,"error"),warning:Ul(e,"warning"),info:Ul(e,"info"),verbose:Ul(e,"verbose")}}function GE(r,e){e.log=(...t)=>{r.log(...t)}}function Ul(r,e){let t=Object.assign(r.extend(e),{level:e});if(GE(r,t),VE(t)){let n=so.disable();so.enable(n+","+t.namespace)}return zE.add(t),t}function VE(r){return!!(Hl&&BE[r.level]<=BE[Hl])}function KE(r){return $f.includes(r)}var Ct=Qr("identity");function _t(r){return`SUCCESS. Scopes: ${Array.isArray(r)?r.join(", "):r}.`}function He(r,e){let t="ERROR.";return r?.length&&(t+=` Scopes: ${Array.isArray(r)?r.join(", "):r}.`),`${t} Error message: ${typeof e=="string"?e:e.message}.`}function YE(r,e,t=Ct){let n=e?`${e.fullTitle} ${r}`:r;function i(c){t.info(`${n} =>`,c)}function o(c){t.warning(`${n} =>`,c)}function s(c){t.verbose(`${n} =>`,c)}function a(c){t.error(`${n} =>`,c)}return{title:r,fullTitle:n,info:i,warning:o,verbose:s,error:a}}function G(r,e=Ct){let t=YE(r,void 0,e);return Object.assign(Object.assign({},t),{parent:e,getToken:YE("=> getToken()",t,e)})}function e0(r){return r&&typeof r.error=="string"&&typeof r.error_description=="string"}var ZE="CredentialUnavailableError",Te=class extends Error{constructor(e,t){super(e,t),this.name=ZE}},Fl="AuthenticationError",$n=class extends Error{constructor(e,t,n){let i={error:"unknown",errorDescription:"An unknown error occurred and no additional details are available."};if(e0(t))i=WE(t);else if(typeof t=="string")try{let o=JSON.parse(t);i=WE(o)}catch{e===400?i={error:"invalid_request",errorDescription:`The service indicated that the request was invalid.

${t}`}:i={error:"unknown_error",errorDescription:`An unknown error has occurred. Response body:

${t}`}}else i={error:"unknown_error",errorDescription:"An unknown error occurred and no additional details are available."};super(`${i.error} Status code: ${e}
More details:
${i.errorDescription},`,n),this.statusCode=e,this.errorResponse=i,this.name=Fl}};function WE(r){return{error:r.error,errorDescription:r.error_description,correlationId:r.correlation_id,errorCodes:r.error_codes,timestamp:r.timestamp,traceId:r.trace_id}}var nr=class extends Error{constructor(e){super(e.message,e.cause?{cause:e.cause}:void 0),this.scopes=e.scopes,this.getTokenOptions=e.getTokenOptions,this.name="AuthenticationRequiredError"}};function t0(r){return`The current credential is not configured to acquire tokens for tenant ${r}. To enable acquiring tokens for this tenant add it to the AdditionallyAllowedTenants on the credential options, or add "*" to AdditionallyAllowedTenants to allow acquiring tokens for any tenant.`}function at(r,e,t=[],n){var i;let o;if(process.env.AZURE_IDENTITY_DISABLE_MULTITENANTAUTH||r==="adfs"?o=r:o=(i=e?.tenantId)!==null&&i!==void 0?i:r,r&&o!==r&&!t.includes("*")&&!t.some(s=>s.localeCompare(o)===0)){let s=t0(o);throw n?.info(s),new Te(s)}return o}function Or(r,e){if(!e.match(/^[0-9a-zA-Z-.]+$/)){let t=new Error("Invalid tenant id provided. You can locate your tenant id by following the instructions listed here: https://learn.microsoft.com/partner-center/find-ids-and-domain-names.");throw r.info(He("",t)),t}}function $l(r,e,t){return e?(Or(r,e),e):(t||(t=ms),t!==ms?"common":"organizations")}function At(r){return!r||r.length===0?[]:r.includes("*")?xE:r}var ys="$",ao="_";function n0(r,e){return e!=="Composite"&&e!=="Dictionary"&&(typeof r=="string"||typeof r=="number"||typeof r=="boolean"||e?.match(/^(Date|DateTime|DateTimeRfc1123|UnixTime|ByteArray|Base64Url)$/i)!==null||r===void 0||r===null)}function i0(r){let e=Object.assign(Object.assign({},r.headers),r.body);return r.hasNullableType&&Object.getOwnPropertyNames(e).length===0?r.shouldWrapBody?{body:null}:null:r.shouldWrapBody?Object.assign(Object.assign({},r.headers),{body:r.body}):e}function jf(r,e){var t,n;let i=r.parsedHeaders;if(r.request.method==="HEAD")return Object.assign(Object.assign({},i),{body:r.parsedBody});let o=e&&e.bodyMapper,s=!!o?.nullable,a=o?.type.name;if(a==="Stream")return Object.assign(Object.assign({},i),{blobBody:r.blobBody,readableStreamBody:r.readableStreamBody});let c=a==="Composite"&&o.type.modelProperties||{},l=Object.keys(c).some(u=>c[u].serializedName==="");if(a==="Sequence"||l){let u=(t=r.parsedBody)!==null&&t!==void 0?t:[];for(let d of Object.keys(c))c[d].serializedName&&(u[d]=(n=r.parsedBody)===null||n===void 0?void 0:n[d]);if(i)for(let d of Object.keys(i))u[d]=i[d];return s&&!r.parsedBody&&!i&&Object.getOwnPropertyNames(c).length===0?null:u}return i0({body:r.parsedBody,headers:i,hasNullableType:s,shouldWrapBody:n0(r.parsedBody,a)})}var ir={Base64Url:"Base64Url",Boolean:"Boolean",ByteArray:"ByteArray",Composite:"Composite",Date:"Date",DateTime:"DateTime",DateTimeRfc1123:"DateTimeRfc1123",Dictionary:"Dictionary",Enum:"Enum",Number:"Number",Object:"Object",Sequence:"Sequence",String:"String",Stream:"Stream",TimeSpan:"TimeSpan",UnixTime:"UnixTime"};var XE=new Set(["Deserialize","Serialize","Retry","Sign"]),Bf=class r{constructor(e){var t;this._policies=[],this._policies=(t=e?.slice(0))!==null&&t!==void 0?t:[],this._orderedPolicies=void 0}addPolicy(e,t={}){if(t.phase&&t.afterPhase)throw new Error("Policies inside a phase cannot specify afterPhase.");if(t.phase&&!XE.has(t.phase))throw new Error(`Invalid phase name: ${t.phase}`);if(t.afterPhase&&!XE.has(t.afterPhase))throw new Error(`Invalid afterPhase name: ${t.afterPhase}`);this._policies.push({policy:e,options:t}),this._orderedPolicies=void 0}removePolicy(e){let t=[];return this._policies=this._policies.filter(n=>e.name&&n.policy.name===e.name||e.phase&&n.options.phase===e.phase?(t.push(n.policy),!1):!0),this._orderedPolicies=void 0,t}sendRequest(e,t){return this.getOrderedPolicies().reduceRight((o,s)=>a=>s.sendRequest(a,o),o=>e.sendRequest(o))(t)}getOrderedPolicies(){return this._orderedPolicies||(this._orderedPolicies=this.orderPolicies()),this._orderedPolicies}clone(){return new r(this._policies)}static create(){return new r}orderPolicies(){let e=[],t=new Map;function n(m){return{name:m,policies:new Set,hasRun:!1,hasAfterPolicies:!1}}let i=n("Serialize"),o=n("None"),s=n("Deserialize"),a=n("Retry"),c=n("Sign"),l=[i,o,s,a,c];function u(m){return m==="Retry"?a:m==="Serialize"?i:m==="Deserialize"?s:m==="Sign"?c:o}for(let m of this._policies){let y=m.policy,A=m.options,P=y.name;if(t.has(P))throw new Error("Duplicate policy names not allowed in pipeline");let D={policy:y,dependsOn:new Set,dependants:new Set};A.afterPhase&&(D.afterPhase=u(A.afterPhase),D.afterPhase.hasAfterPolicies=!0),t.set(P,D),u(A.phase).policies.add(D)}for(let m of this._policies){let{policy:y,options:A}=m,P=y.name,D=t.get(P);if(!D)throw new Error(`Missing node for policy ${P}`);if(A.afterPolicies)for(let U of A.afterPolicies){let H=t.get(U);H&&(D.dependsOn.add(H),H.dependants.add(D))}if(A.beforePolicies)for(let U of A.beforePolicies){let H=t.get(U);H&&(H.dependsOn.add(D),D.dependants.add(H))}}function d(m){m.hasRun=!0;for(let y of m.policies)if(!(y.afterPhase&&(!y.afterPhase.hasRun||y.afterPhase.policies.size))&&y.dependsOn.size===0){e.push(y.policy);for(let A of y.dependants)A.dependsOn.delete(y);t.delete(y.policy.name),m.policies.delete(y)}}function h(){for(let m of l){if(d(m),m.policies.size>0&&m!==o){o.hasRun||d(o);return}m.hasAfterPolicies&&d(o)}}let p=0;for(;t.size>0;){p++;let m=e.length;if(h(),e.length<=m&&p>1)throw new Error("Cannot satisfy policy dependencies due to requirements cycle.")}return e}};function ql(){return Bf.create()}var xe=Qr("core-rest-pipeline");var St=class extends Error{constructor(e){super(e),this.name="AbortError"}};function zf(r,e){return r=Math.ceil(r),e=Math.floor(e),Math.floor(Math.random()*(e-r+1))+r}function jl(r,e){let t=e.retryDelayInMs*Math.pow(2,r),n=Math.min(e.maxRetryDelayInMs,t);return{retryAfterInMs:n/2+zf(0,n/2)}}function Es(r){return typeof r=="object"&&r!==null&&!Array.isArray(r)&&!(r instanceof RegExp)&&!(r instanceof Date)}function qn(r){if(Es(r)){let e=typeof r.name=="string",t=typeof r.message=="string";return e&&t}return!1}function co(r){if(qn(r))return r.message;{let e;try{typeof r=="object"&&r?e=JSON.stringify(r):e=String(r)}catch{e="[unable to stringify input]"}return`Unknown error ${e}`}}import{randomUUID as s0}from"crypto";var Gf,a0=typeof((Gf=globalThis?.crypto)===null||Gf===void 0?void 0:Gf.randomUUID)=="function"?globalThis.crypto.randomUUID.bind(globalThis.crypto):s0;function lo(){return a0()}var Vf,Kf,Yf,Wf,c0=typeof window<"u"&&typeof window.document<"u",l0=typeof self=="object"&&typeof self?.importScripts=="function"&&(((Vf=self.constructor)===null||Vf===void 0?void 0:Vf.name)==="DedicatedWorkerGlobalScope"||((Kf=self.constructor)===null||Kf===void 0?void 0:Kf.name)==="ServiceWorkerGlobalScope"||((Yf=self.constructor)===null||Yf===void 0?void 0:Yf.name)==="SharedWorkerGlobalScope"),u0=typeof Deno<"u"&&typeof Deno.version<"u"&&typeof Deno.version.deno<"u",d0=typeof Bun<"u"&&typeof Bun.version<"u",or=typeof globalThis.process<"u"&&!!globalThis.process.version&&!!(!((Wf=globalThis.process.versions)===null||Wf===void 0)&&Wf.node),Ts=or;var f0=typeof navigator<"u"&&navigator?.product==="ReactNative";function sr(r,e){return Buffer.from(r,e)}var Zf="REDACTED",h0=["x-ms-client-request-id","x-ms-return-client-request-id","x-ms-useragent","x-ms-correlation-request-id","x-ms-request-id","client-request-id","ms-cv","return-client-request-id","traceparent","Access-Control-Allow-Credentials","Access-Control-Allow-Headers","Access-Control-Allow-Methods","Access-Control-Allow-Origin","Access-Control-Expose-Headers","Access-Control-Max-Age","Access-Control-Request-Headers","Access-Control-Request-Method","Origin","Accept","Accept-Encoding","Cache-Control","Connection","Content-Length","Content-Type","Date","ETag","Expires","If-Match","If-Modified-Since","If-None-Match","If-Unmodified-Since","Last-Modified","Pragma","Request-Id","Retry-After","Server","Transfer-Encoding","User-Agent","WWW-Authenticate"],p0=["api-version"],ar=class{constructor({additionalAllowedHeaderNames:e=[],additionalAllowedQueryParameters:t=[]}={}){e=h0.concat(e),t=p0.concat(t),this.allowedHeaderNames=new Set(e.map(n=>n.toLowerCase())),this.allowedQueryParameters=new Set(t.map(n=>n.toLowerCase()))}sanitize(e){let t=new Set;return JSON.stringify(e,(n,i)=>{if(i instanceof Error)return Object.assign(Object.assign({},i),{name:i.name,message:i.message});if(n==="headers")return this.sanitizeHeaders(i);if(n==="url")return this.sanitizeUrl(i);if(n==="query")return this.sanitizeQuery(i);if(n==="body")return;if(n==="response")return;if(n==="operationSpec")return;if(Array.isArray(i)||Es(i)){if(t.has(i))return"[Circular]";t.add(i)}return i},2)}sanitizeUrl(e){if(typeof e!="string"||e===null||e==="")return e;let t=new URL(e);if(!t.search)return e;for(let[n]of t.searchParams)this.allowedQueryParameters.has(n.toLowerCase())||t.searchParams.set(n,Zf);return t.toString()}sanitizeHeaders(e){let t={};for(let n of Object.keys(e))this.allowedHeaderNames.has(n.toLowerCase())?t[n]=e[n]:t[n]=Zf;return t}sanitizeQuery(e){if(typeof e!="object"||e===null)return e;let t={};for(let n of Object.keys(e))this.allowedQueryParameters.has(n.toLowerCase())?t[n]=e[n]:t[n]=Zf;return t}};var QE="logPolicy";function Xf(r={}){var e;let t=(e=r.logger)!==null&&e!==void 0?e:xe.info,n=new ar({additionalAllowedHeaderNames:r.additionalAllowedHeaderNames,additionalAllowedQueryParameters:r.additionalAllowedQueryParameters});return{name:QE,async sendRequest(i,o){if(!t.enabled)return o(i);t(`Request: ${n.sanitize(i)}`);let s=await o(i);return t(`Response status code: ${s.status}`),t(`Headers: ${n.sanitize(s.headers)}`),s}}}var eT="redirectPolicy",JE=["GET","HEAD"];function Qf(r={}){let{maxRetries:e=20}=r;return{name:eT,async sendRequest(t,n){let i=await n(t);return tT(n,i,e)}}}async function tT(r,e,t,n=0){let{request:i,status:o,headers:s}=e,a=s.get("location");if(a&&(o===300||o===301&&JE.includes(i.method)||o===302&&JE.includes(i.method)||o===303&&i.method==="POST"||o===307)&&n<t){let c=new URL(a,i.url);i.url=c.toString(),o===303&&(i.method="GET",i.headers.delete("Content-Length"),delete i.body),i.headers.delete("Authorization");let l=await r(i);return tT(r,l,t,n+1)}return e}import*as uo from"node:os";import*as Bl from"node:process";function rT(){return"User-Agent"}async function nT(r){if(Bl&&Bl.versions){let e=Bl.versions;e.bun?r.set("Bun",e.bun):e.deno?r.set("Deno",e.deno):e.node&&r.set("Node",e.node)}r.set("OS",`(${uo.arch()}-${uo.type()}-${uo.release()})`)}var zl="1.19.1";function m0(r){let e=[];for(let[t,n]of r){let i=n?`${t}/${n}`:t;e.push(i)}return e.join(" ")}function iT(){return rT()}async function Gl(r){let e=new Map;e.set("core-rest-pipeline",zl),await nT(e);let t=m0(e);return r?`${r} ${t}`:t}var oT=iT(),sT="userAgentPolicy";function Jf(r={}){let e=Gl(r.userAgentPrefix);return{name:sT,async sendRequest(t,n){return t.headers.has(oT)||t.headers.set(oT,await e),n(t)}}}ge();import{Readable as eh}from"node:stream";function Vl(r){return typeof r.stream=="function"}var aT=Symbol("rawContent");function g0(r){return typeof r[aT]=="function"}function cT(r){return g0(r)?r[aT]():r.stream()}function lT(){return cs(this,arguments,function*(){let e=this.getReader();try{for(;;){let{done:t,value:n}=yield vt(e.read());if(t)return yield vt(void 0);yield yield vt(n)}}finally{e.releaseLock()}})}function y0(r){r[Symbol.asyncIterator]||(r[Symbol.asyncIterator]=lT.bind(r)),r.values||(r.values=lT.bind(r))}function E0(r){return r instanceof ReadableStream?(y0(r),eh.fromWeb(r)):r}function uT(r){return r instanceof Uint8Array?eh.from(Buffer.from(r)):Vl(r)?uT(cT(r)):E0(r)}async function dT(r){return function(){let e=r.map(t=>typeof t=="function"?t():t).map(uT);return eh.from(function(){return cs(this,arguments,function*(){var t,n,i,o;for(let l of e)try{for(var s=!0,a=(n=void 0,Hc(l)),c;c=yield vt(a.next()),t=c.done,!t;s=!0)o=c.value,s=!1,yield yield vt(o)}catch(u){n={error:u}}finally{try{!s&&!t&&(i=a.return)&&(yield vt(i.call(a)))}finally{if(n)throw n.error}}})}())}}function T0(){return`----AzSDKFormBoundary${lo()}`}function v0(r){let e="";for(let[t,n]of r)e+=`${t}: ${n}\r
`;return e}function C0(r){return r instanceof Uint8Array?r.byteLength:Vl(r)?r.size===-1?void 0:r.size:void 0}function _0(r){let e=0;for(let t of r){let n=C0(t);if(n===void 0)return;e+=n}return e}async function A0(r,e,t){let n=[sr(`--${t}`,"utf-8"),...e.flatMap(o=>[sr(`\r
`,"utf-8"),sr(v0(o.headers),"utf-8"),sr(`\r
`,"utf-8"),o.body,sr(`\r
--${t}`,"utf-8")]),sr(`--\r
\r
`,"utf-8")],i=_0(n);i&&r.headers.set("Content-Length",i),r.body=await dT(n)}var Kl="multipartPolicy",S0=70,w0=new Set("abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789'()+,-./:=?");function R0(r){if(r.length>S0)throw new Error(`Multipart boundary "${r}" exceeds maximum length of 70 characters`);if(Array.from(r).some(e=>!w0.has(e)))throw new Error(`Multipart boundary "${r}" contains invalid characters`)}function th(){return{name:Kl,async sendRequest(r,e){var t;if(!r.multipartBody)return e(r);if(r.body)throw new Error("multipartBody and regular body cannot be set at the same time");let n=r.multipartBody.boundary,i=(t=r.headers.get("Content-Type"))!==null&&t!==void 0?t:"multipart/mixed",o=i.match(/^(multipart\/[^ ;]+)(?:; *boundary=(.+))?$/);if(!o)throw new Error(`Got multipart request body, but content-type header was not multipart: ${i}`);let[,s,a]=o;if(a&&n&&a!==n)throw new Error(`Multipart boundary was specified as ${a} in the header, but got ${n} in the request body`);return n??(n=a),n?R0(n):n=T0(),r.headers.set("Content-Type",`${s}; boundary=${n}`),await A0(r,r.multipartBody.parts,n),r.multipartBody=void 0,e(r)}}}var fT="decompressResponsePolicy";function rh(){return{name:fT,async sendRequest(r,e){return r.method!=="HEAD"&&r.headers.set("Accept-Encoding","gzip,deflate"),e(r)}}}var I0="The operation was aborted.";function Yl(r,e,t){return new Promise((n,i)=>{let o,s,a=()=>i(new St(t?.abortErrorMsg?t?.abortErrorMsg:I0)),c=()=>{t?.abortSignal&&s&&t.abortSignal.removeEventListener("abort",s)};if(s=()=>(o&&clearTimeout(o),c(),a()),t?.abortSignal&&t.abortSignal.aborted)return a();o=setTimeout(()=>{c(),n(e)},r),t?.abortSignal&&t.abortSignal.addEventListener("abort",s)})}function hT(r,e){let t=r.headers.get(e);if(!t)return;let n=Number(t);if(!Number.isNaN(n))return n}var nh="Retry-After",b0=["retry-after-ms","x-ms-retry-after-ms",nh];function pT(r){if(r&&[429,503].includes(r.status))try{for(let i of b0){let o=hT(r,i);if(o===0||o)return o*(i===nh?1e3:1)}let e=r.headers.get(nh);if(!e)return;let n=Date.parse(e)-Date.now();return Number.isFinite(n)?Math.max(0,n):void 0}catch{return}}function mT(r){return Number.isFinite(pT(r))}function ih(){return{name:"throttlingRetryStrategy",retry({response:r}){let e=pT(r);return Number.isFinite(e)?{retryAfterInMs:e}:{skipStrategy:!0}}}}var O0=1e3,k0=1e3*64;function Wl(r={}){var e,t;let n=(e=r.retryDelayInMs)!==null&&e!==void 0?e:O0,i=(t=r.maxRetryDelayInMs)!==null&&t!==void 0?t:k0;return{name:"exponentialRetryStrategy",retry({retryCount:o,response:s,responseError:a}){let c=P0(a),l=c&&r.ignoreSystemErrors,u=x0(s),d=u&&r.ignoreHttpStatusCodes;return s&&(mT(s)||!u)||d||l?{skipStrategy:!0}:a&&!c&&!u?{errorToThrow:a}:jl(o,{retryDelayInMs:n,maxRetryDelayInMs:i})}}}function x0(r){return!!(r&&r.status!==void 0&&(r.status>=500||r.status===408)&&r.status!==501&&r.status!==505)}function P0(r){return r?r.code==="ETIMEDOUT"||r.code==="ESOCKETTIMEDOUT"||r.code==="ECONNREFUSED"||r.code==="ECONNRESET"||r.code==="ENOENT"||r.code==="ENOTFOUND":!1}var gT=Qr("core-rest-pipeline retryPolicy"),N0="retryPolicy";function Bn(r,e={maxRetries:3}){let t=e.logger||gT;return{name:N0,async sendRequest(n,i){var o,s;let a,c,l=-1;e:for(;;){l+=1,a=void 0,c=void 0;try{t.info(`Retry ${l}: Attempting to send request`,n.requestId),a=await i(n),t.info(`Retry ${l}: Received a response from request`,n.requestId)}catch(u){if(t.error(`Retry ${l}: Received an error from request`,n.requestId),c=u,!u||c.name!=="RestError")throw u;a=c.response}if(!((o=n.abortSignal)===null||o===void 0)&&o.aborted)throw t.error(`Retry ${l}: Request aborted.`),new St;if(l>=((s=e.maxRetries)!==null&&s!==void 0?s:3)){if(t.info(`Retry ${l}: Maximum retries reached. Returning the last received response, or throwing the last received error.`),c)throw c;if(a)return a;throw new Error("Maximum retries reached with no response or error to throw")}t.info(`Retry ${l}: Processing ${r.length} retry strategies.`);t:for(let u of r){let d=u.logger||gT;d.info(`Retry ${l}: Processing retry strategy ${u.name}.`);let h=u.retry({retryCount:l,response:a,responseError:c});if(h.skipStrategy){d.info(`Retry ${l}: Skipped.`);continue t}let{errorToThrow:p,retryAfterInMs:m,redirectTo:y}=h;if(p)throw d.error(`Retry ${l}: Retry strategy ${u.name} throws error:`,p),p;if(m||m===0){d.info(`Retry ${l}: Retry strategy ${u.name} retries after ${m}`),await Yl(m,void 0,{abortSignal:n.abortSignal});continue e}if(y){d.info(`Retry ${l}: Retry strategy ${u.name} redirects to ${y}`),n.url=y;continue e}}if(c)throw t.info("None of the retry strategies could work with the received error. Throwing it."),c;if(a)return t.info("None of the retry strategies could work with the received response. Returning it."),a}}}}var M0="defaultRetryPolicy";function oh(r={}){var e;return{name:M0,sendRequest:Bn([ih(),Wl(r)],{maxRetries:(e=r.maxRetries)!==null&&e!==void 0?e:3}).sendRequest}}function Zl(r){return r.toLowerCase()}function*D0(r){for(let e of r.values())yield[e.name,e.value]}var sh=class{constructor(e){if(this._headersMap=new Map,e)for(let t of Object.keys(e))this.set(t,e[t])}set(e,t){this._headersMap.set(Zl(e),{name:e,value:String(t).trim()})}get(e){var t;return(t=this._headersMap.get(Zl(e)))===null||t===void 0?void 0:t.value}has(e){return this._headersMap.has(Zl(e))}delete(e){this._headersMap.delete(Zl(e))}toJSON(e={}){let t={};if(e.preserveCase)for(let n of this._headersMap.values())t[n.name]=n.value;else for(let[n,i]of this._headersMap)t[n]=i.value;return t}toString(){return JSON.stringify(this.toJSON({preserveCase:!0}))}[Symbol.iterator](){return D0(this._headersMap)}};function ct(r){return new sh(r)}var yT="formDataPolicy";function L0(r){var e;let t={};for(let[n,i]of r.entries())(e=t[n])!==null&&e!==void 0||(t[n]=[]),t[n].push(i);return t}function ah(){return{name:yT,async sendRequest(r,e){if(or&&typeof FormData<"u"&&r.body instanceof FormData&&(r.formData=L0(r.body),r.body=void 0),r.formData){let t=r.headers.get("Content-Type");t&&t.indexOf("application/x-www-form-urlencoded")!==-1?r.body=U0(r.formData):await H0(r.formData,r),r.formData=void 0}return e(r)}}}function U0(r){let e=new URLSearchParams;for(let[t,n]of Object.entries(r))if(Array.isArray(n))for(let i of n)e.append(t,i.toString());else e.append(t,n.toString());return e.toString()}async function H0(r,e){let t=e.headers.get("Content-Type");if(t&&!t.startsWith("multipart/form-data"))return;e.headers.set("Content-Type",t??"multipart/form-data");let n=[];for(let[i,o]of Object.entries(r))for(let s of Array.isArray(o)?o:[o])if(typeof s=="string")n.push({headers:ct({"Content-Disposition":`form-data; name="${i}"`}),body:sr(s,"utf-8")});else{if(s==null||typeof s!="object")throw new Error(`Unexpected value for key ${i}: ${s}. Value should be serialized to string first.`);{let a=s.name||"blob",c=ct();c.set("Content-Disposition",`form-data; name="${i}"; filename="${a}"`),c.set("Content-Type",s.type||"application/octet-stream"),n.push({headers:c,body:s})}}e.multipartBody={parts:n}}var jT=qi(DT(),1),BT=qi(HT(),1);var Dk="HTTPS_PROXY",Lk="HTTP_PROXY",Uk="ALL_PROXY",Hk="NO_PROXY",zT="proxyPolicy",FT=[],GT=!1,Fk=new Map;function su(r){if(process.env[r])return process.env[r];if(process.env[r.toLowerCase()])return process.env[r.toLowerCase()]}function $k(){if(!process)return;let r=su(Dk),e=su(Uk),t=su(Lk);return r||e||t}function qk(r,e,t){if(e.length===0)return!1;let n=new URL(r).hostname;if(t?.has(n))return t.get(n);let i=!1;for(let o of e)o[0]==="."?(n.endsWith(o)||n.length===o.length-1&&n===o.slice(1))&&(i=!0):n===o&&(i=!0);return t?.set(n,i),i}function jk(){let r=su(Hk);return GT=!0,r?r.split(",").map(e=>e.trim()).filter(e=>e.length):[]}function Bk(){let r=$k();return r?new URL(r):void 0}function $T(r){let e;try{e=new URL(r.host)}catch{throw new Error(`Expecting a valid host string in proxy settings, but found "${r.host}".`)}return e.port=String(r.port),r.username&&(e.username=r.username),r.password&&(e.password=r.password),e}function qT(r,e,t){if(r.agent)return;let i=new URL(r.url).protocol!=="https:";r.tlsSettings&&xe.warning("TLS settings are not supported in combination with custom Proxy, certificates provided to the client will be ignored.");let o=r.headers.toJSON();i?(e.httpProxyAgent||(e.httpProxyAgent=new BT.HttpProxyAgent(t,{headers:o})),r.agent=e.httpProxyAgent):(e.httpsProxyAgent||(e.httpsProxyAgent=new jT.HttpsProxyAgent(t,{headers:o})),r.agent=e.httpsProxyAgent)}function hh(r,e){GT||FT.push(...jk());let t=r?$T(r):Bk(),n={};return{name:zT,async sendRequest(i,o){var s;return!i.proxySettings&&t&&!qk(i.url,(s=e?.customNoProxyList)!==null&&s!==void 0?s:FT,e?.customNoProxyList?void 0:Fk)?qT(i,n,t):i.proxySettings&&qT(i,n,$T(i.proxySettings)),o(i)}}}var VT="setClientRequestIdPolicy";function ph(r="x-ms-client-request-id"){return{name:VT,async sendRequest(e,t){return e.headers.has(r)||e.headers.set(r,e.requestId),t(e)}}}var KT="agentPolicy";function mh(r){return{name:KT,sendRequest:async(e,t)=>(e.agent||(e.agent=r),t(e))}}var YT="tlsPolicy";function gh(r){return{name:YT,sendRequest:async(e,t)=>(e.tlsSettings||(e.tlsSettings=r),t(e))}}var yo={span:Symbol.for("@azure/core-tracing span"),namespace:Symbol.for("@azure/core-tracing namespace")};function WT(r={}){let e=new yh(r.parentContext);return r.span&&(e=e.setValue(yo.span,r.span)),r.namespace&&(e=e.setValue(yo.namespace,r.namespace)),e}var yh=class r{constructor(e){this._contextMap=e instanceof r?new Map(e._contextMap):new Map}setValue(e,t){let n=new r(this);return n._contextMap.set(e,t),n}getValue(e){return this._contextMap.get(e)}deleteValue(e){let t=new r(this);return t._contextMap.delete(e),t}};var XT=qi(ZT(),1),cu=XT.state;function zk(){return{end:()=>{},isRecording:()=>!1,recordException:()=>{},setAttribute:()=>{},setStatus:()=>{},addEvent:()=>{}}}function Gk(){return{createRequestHeaders:()=>({}),parseTraceparentHeader:()=>{},startSpan:(r,e)=>({span:zk(),tracingContext:WT({parentContext:e.tracingContext})}),withContext(r,e,...t){return e(...t)}}}function Cs(){return cu.instrumenterImplementation||(cu.instrumenterImplementation=Gk()),cu.instrumenterImplementation}function _s(r){let{namespace:e,packageName:t,packageVersion:n}=r;function i(l,u,d){var h;let p=Cs().startSpan(l,Object.assign(Object.assign({},d),{packageName:t,packageVersion:n,tracingContext:(h=u?.tracingOptions)===null||h===void 0?void 0:h.tracingContext})),m=p.tracingContext,y=p.span;m.getValue(yo.namespace)||(m=m.setValue(yo.namespace,e)),y.setAttribute("az.namespace",m.getValue(yo.namespace));let A=Object.assign({},u,{tracingOptions:Object.assign(Object.assign({},u?.tracingOptions),{tracingContext:m})});return{span:y,updatedOptions:A}}async function o(l,u,d,h){let{span:p,updatedOptions:m}=i(l,u,h);try{let y=await s(m.tracingOptions.tracingContext,()=>Promise.resolve(d(m,p)));return p.setStatus({status:"success"}),y}catch(y){throw p.setStatus({status:"error",error:y}),y}finally{p.end()}}function s(l,u,...d){return Cs().withContext(l,u,...d)}function a(l){return Cs().parseTraceparentHeader(l)}function c(l){return Cs().createRequestHeaders(l)}return{startSpan:i,withSpan:o,withContext:s,parseTraceparentHeader:a,createRequestHeaders:c}}import{inspect as Vk}from"node:util";var QT=Vk.custom;var Kk=new ar,Fe=class r extends Error{constructor(e,t={}){super(e),this.name="RestError",this.code=t.code,this.statusCode=t.statusCode,Object.defineProperty(this,"request",{value:t.request,enumerable:!1}),Object.defineProperty(this,"response",{value:t.response,enumerable:!1}),Object.setPrototypeOf(this,r.prototype)}[QT](){return`RestError: ${this.message} 
 ${Kk.sanitize(Object.assign(Object.assign({},this),{request:this.request,response:this.response}))}`}};Fe.REQUEST_SEND_ERROR="REQUEST_SEND_ERROR";Fe.PARSE_ERROR="PARSE_ERROR";function As(r){return r instanceof Fe?!0:qn(r)&&r.name==="RestError"}var JT="tracingPolicy";function Eh(r={}){let e=Gl(r.userAgentPrefix),t=new ar({additionalAllowedQueryParameters:r.additionalAllowedQueryParameters}),n=Yk();return{name:JT,async sendRequest(i,o){var s;if(!n)return o(i);let a=await e,c={"http.url":t.sanitizeUrl(i.url),"http.method":i.method,"http.user_agent":a,requestId:i.requestId};a&&(c["http.user_agent"]=a);let{span:l,tracingContext:u}=(s=Wk(n,i,c))!==null&&s!==void 0?s:{};if(!l||!u)return o(i);try{let d=await n.withContext(u,o,i);return Xk(l,d),d}catch(d){throw Zk(l,d),d}}}}function Yk(){try{return _s({namespace:"",packageName:"@azure/core-rest-pipeline",packageVersion:zl})}catch(r){xe.warning(`Error when creating the TracingClient: ${co(r)}`);return}}function Wk(r,e,t){try{let{span:n,updatedOptions:i}=r.startSpan(`HTTP ${e.method}`,{tracingOptions:e.tracingOptions},{spanKind:"client",spanAttributes:t});if(!n.isRecording()){n.end();return}let o=r.createRequestHeaders(i.tracingOptions.tracingContext);for(let[s,a]of Object.entries(o))e.headers.set(s,a);return{span:n,tracingContext:i.tracingOptions.tracingContext}}catch(n){xe.warning(`Skipping creating a tracing span due to an error: ${co(n)}`);return}}function Zk(r,e){try{r.setStatus({status:"error",error:qn(e)?e:void 0}),As(e)&&e.statusCode&&r.setAttribute("http.status_code",e.statusCode),r.end()}catch(t){xe.warning(`Skipping tracing span processing due to an error: ${co(t)}`)}}function Xk(r,e){try{r.setAttribute("http.status_code",e.status);let t=e.headers.get("x-ms-request-id");t&&r.setAttribute("serviceRequestId",t),e.status>=400&&r.setStatus({status:"error"}),r.end()}catch(t){xe.warning(`Skipping tracing span processing due to an error: ${co(t)}`)}}function Th(r){var e;let t=ql();return or&&(r.agent&&t.addPolicy(mh(r.agent)),r.tlsOptions&&t.addPolicy(gh(r.tlsOptions)),t.addPolicy(hh(r.proxyOptions)),t.addPolicy(rh())),t.addPolicy(ah(),{beforePolicies:[Kl]}),t.addPolicy(Jf(r.userAgentOptions)),t.addPolicy(ph((e=r.telemetryOptions)===null||e===void 0?void 0:e.clientRequestIdHeaderName)),t.addPolicy(th(),{afterPhase:"Deserialize"}),t.addPolicy(oh(r.retryOptions),{phase:"Retry"}),t.addPolicy(Eh(Object.assign(Object.assign({},r.userAgentOptions),r.loggingOptions)),{afterPhase:"Retry"}),or&&t.addPolicy(Qf(r.redirectOptions),{afterPhase:"Retry"}),t.addPolicy(Xf(r.loggingOptions),{afterPhase:"Sign"}),t}import*as Eo from"node:http";import*as To from"node:https";import*as uu from"node:zlib";import{Transform as Qk}from"node:stream";var Jk={};function Ss(r){return r&&typeof r.pipe=="function"}function ev(r){return r.readable===!1?Promise.resolve():new Promise(e=>{let t=()=>{e(),r.removeListener("close",t),r.removeListener("end",t),r.removeListener("error",t)};r.on("close",t),r.on("end",t),r.on("error",t)})}function tv(r){return r&&typeof r.byteLength=="number"}var lu=class extends Qk{_transform(e,t,n){this.push(e),this.loadedBytes+=e.length;try{this.progressCallback({loadedBytes:this.loadedBytes}),n()}catch(i){n(i)}}constructor(e){super(),this.loadedBytes=0,this.progressCallback=e}},vh=class{constructor(){this.cachedHttpsAgents=new WeakMap}async sendRequest(e){var t,n,i;let o=new AbortController,s;if(e.abortSignal){if(e.abortSignal.aborted)throw new St("The operation was aborted. Request has already been canceled.");s=h=>{h.type==="abort"&&o.abort()},e.abortSignal.addEventListener("abort",s)}let a;e.timeout>0&&(a=setTimeout(()=>{let h=new ar;xe.info(`request to '${h.sanitizeUrl(e.url)}' timed out. canceling...`),o.abort()},e.timeout));let c=e.headers.get("Accept-Encoding"),l=c?.includes("gzip")||c?.includes("deflate"),u=typeof e.body=="function"?e.body():e.body;if(u&&!e.headers.has("Content-Length")){let h=nx(u);h!==null&&e.headers.set("Content-Length",h)}let d;try{if(u&&e.onUploadProgress){let P=e.onUploadProgress,D=new lu(P);D.on("error",U=>{xe.error("Error in upload progress",U)}),Ss(u)?u.pipe(D):D.end(u),u=D}let h=await this.makeRequest(e,o,u);a!==void 0&&clearTimeout(a);let p=ex(h),y={status:(t=h.statusCode)!==null&&t!==void 0?t:0,headers:p,request:e};if(e.method==="HEAD")return h.resume(),y;d=l?tx(h,p):h;let A=e.onDownloadProgress;if(A){let P=new lu(A);P.on("error",D=>{xe.error("Error in download progress",D)}),d.pipe(P),d=P}return!((n=e.streamResponseStatusCodes)===null||n===void 0)&&n.has(Number.POSITIVE_INFINITY)||!((i=e.streamResponseStatusCodes)===null||i===void 0)&&i.has(y.status)?y.readableStreamBody=d:y.bodyAsText=await rx(d),y}finally{if(e.abortSignal&&s){let h=Promise.resolve();Ss(u)&&(h=ev(u));let p=Promise.resolve();Ss(d)&&(p=ev(d)),Promise.all([h,p]).then(()=>{var m;s&&((m=e.abortSignal)===null||m===void 0||m.removeEventListener("abort",s))}).catch(m=>{xe.warning("Error when cleaning up abortListener on httpRequest",m)})}}}makeRequest(e,t,n){var i;let o=new URL(e.url),s=o.protocol!=="https:";if(s&&!e.allowInsecureConnection)throw new Error(`Cannot connect to ${e.url} while allowInsecureConnection is false.`);let c={agent:(i=e.agent)!==null&&i!==void 0?i:this.getOrCreateAgent(e,s),hostname:o.hostname,path:`${o.pathname}${o.search}`,port:o.port,method:e.method,headers:e.headers.toJSON({preserveCase:!0})};return new Promise((l,u)=>{let d=s?Eo.request(c,l):To.request(c,l);d.once("error",h=>{var p;u(new Fe(h.message,{code:(p=h.code)!==null&&p!==void 0?p:Fe.REQUEST_SEND_ERROR,request:e}))}),t.signal.addEventListener("abort",()=>{let h=new St("The operation was aborted. Rejecting from abort signal callback while making request.");d.destroy(h),u(h)}),n&&Ss(n)?n.pipe(d):n?typeof n=="string"||Buffer.isBuffer(n)?d.end(n):tv(n)?d.end(ArrayBuffer.isView(n)?Buffer.from(n.buffer):Buffer.from(n)):(xe.error("Unrecognized body type",n),u(new Fe("Unrecognized body type"))):d.end()})}getOrCreateAgent(e,t){var n;let i=e.disableKeepAlive;if(t)return i?Eo.globalAgent:(this.cachedHttpAgent||(this.cachedHttpAgent=new Eo.Agent({keepAlive:!0})),this.cachedHttpAgent);{if(i&&!e.tlsSettings)return To.globalAgent;let o=(n=e.tlsSettings)!==null&&n!==void 0?n:Jk,s=this.cachedHttpsAgents.get(o);return s&&s.options.keepAlive===!i||(xe.info("No cached TLS Agent exist, creating a new Agent"),s=new To.Agent(Object.assign({keepAlive:!i},o)),this.cachedHttpsAgents.set(o,s)),s}}};function ex(r){let e=ct();for(let t of Object.keys(r.headers)){let n=r.headers[t];Array.isArray(n)?n.length>0&&e.set(t,n[0]):n&&e.set(t,n)}return e}function tx(r,e){let t=e.get("Content-Encoding");if(t==="gzip"){let n=uu.createGunzip();return r.pipe(n),n}else if(t==="deflate"){let n=uu.createInflate();return r.pipe(n),n}return r}function rx(r){return new Promise((e,t)=>{let n=[];r.on("data",i=>{Buffer.isBuffer(i)?n.push(i):n.push(Buffer.from(i))}),r.on("end",()=>{e(Buffer.concat(n).toString("utf8"))}),r.on("error",i=>{i&&i?.name==="AbortError"?t(i):t(new Fe(`Error reading response as text: ${i.message}`,{code:Fe.PARSE_ERROR}))})})}function nx(r){return r?Buffer.isBuffer(r)?r.length:Ss(r)?null:tv(r)?r.byteLength:typeof r=="string"?Buffer.from(r).length:null:0}function rv(){return new vh}function Ch(){return rv()}var _h=class{constructor(e){var t,n,i,o,s,a,c;this.url=e.url,this.body=e.body,this.headers=(t=e.headers)!==null&&t!==void 0?t:ct(),this.method=(n=e.method)!==null&&n!==void 0?n:"GET",this.timeout=(i=e.timeout)!==null&&i!==void 0?i:0,this.multipartBody=e.multipartBody,this.formData=e.formData,this.disableKeepAlive=(o=e.disableKeepAlive)!==null&&o!==void 0?o:!1,this.proxySettings=e.proxySettings,this.streamResponseStatusCodes=e.streamResponseStatusCodes,this.withCredentials=(s=e.withCredentials)!==null&&s!==void 0?s:!1,this.abortSignal=e.abortSignal,this.tracingOptions=e.tracingOptions,this.onUploadProgress=e.onUploadProgress,this.onDownloadProgress=e.onDownloadProgress,this.requestId=e.requestId||lo(),this.allowInsecureConnection=(a=e.allowInsecureConnection)!==null&&a!==void 0?a:!1,this.enableBrowserStreams=(c=e.enableBrowserStreams)!==null&&c!==void 0?c:!1,this.agent=e.agent,this.tlsSettings=e.tlsSettings}};function lr(r){return new _h(r)}var ix={forcedRefreshWindowInMs:1e3,retryIntervalInMs:3e3,refreshWindowInMs:1e3*60*2};async function ox(r,e,t){async function n(){if(Date.now()<t)try{return await r()}catch{return null}else{let o=await r();if(o===null)throw new Error("Failed to refresh access token.");return o}}let i=await n();for(;i===null;)await Yl(e),i=await n();return i}function Ah(r,e){let t=null,n=null,i,o=Object.assign(Object.assign({},ix),e),s={get isRefreshing(){return t!==null},get shouldRefresh(){var c;return s.isRefreshing?!1:n?.refreshAfterTimestamp&&n.refreshAfterTimestamp<Date.now()?!0:((c=n?.expiresOnTimestamp)!==null&&c!==void 0?c:0)-o.refreshWindowInMs<Date.now()},get mustRefresh(){return n===null||n.expiresOnTimestamp-o.forcedRefreshWindowInMs<Date.now()}};function a(c,l){var u;return s.isRefreshing||(t=ox(()=>r.getToken(c,l),o.retryIntervalInMs,(u=n?.expiresOnTimestamp)!==null&&u!==void 0?u:Date.now()).then(h=>(t=null,n=h,i=l.tenantId,n)).catch(h=>{throw t=null,n=null,i=void 0,h})),t}return async(c,l)=>{let u=!!l.claims,d=i!==l.tenantId;return u&&(n=null),d||u||s.mustRefresh?a(c,l):(s.shouldRefresh&&a(c,l),n)}}var sv="bearerTokenAuthenticationPolicy";async function du(r,e){try{return[await e(r),void 0]}catch(t){if(As(t)&&t.response)return[t.response,t];throw t}}async function sx(r){let{scopes:e,getAccessToken:t,request:n}=r,i={abortSignal:n.abortSignal,tracingOptions:n.tracingOptions,enableCae:!0},o=await t(e,i);o&&r.request.headers.set("Authorization",`Bearer ${o.token}`)}function nv(r){return r.status===401&&r.headers.has("WWW-Authenticate")}async function iv(r,e){var t;let{scopes:n}=r,i=await r.getAccessToken(n,{enableCae:!0,claims:e});return i?(r.request.headers.set("Authorization",`${(t=i.tokenType)!==null&&t!==void 0?t:"Bearer"} ${i.token}`),!0):!1}function fu(r){var e,t,n;let{credential:i,scopes:o,challengeCallbacks:s}=r,a=r.logger||xe,c={authorizeRequest:(t=(e=s?.authorizeRequest)===null||e===void 0?void 0:e.bind(s))!==null&&t!==void 0?t:sx,authorizeRequestOnChallenge:(n=s?.authorizeRequestOnChallenge)===null||n===void 0?void 0:n.bind(s)},l=i?Ah(i):()=>Promise.resolve(null);return{name:sv,async sendRequest(u,d){if(!u.url.toLowerCase().startsWith("https://"))throw new Error("Bearer token authentication is not permitted for non-TLS protected (non-https) URLs.");await c.authorizeRequest({scopes:Array.isArray(o)?o:[o],request:u,getAccessToken:l,logger:a});let h,p,m;if([h,p]=await du(u,d),nv(h)){let y=ov(h.headers.get("WWW-Authenticate"));if(y){let A;try{A=atob(y)}catch{return a.warning(`The WWW-Authenticate header contains "claims" that cannot be parsed. Unable to perform the Continuous Access Evaluation authentication flow. Unparsable claims: ${y}`),h}m=await iv({scopes:Array.isArray(o)?o:[o],response:h,request:u,getAccessToken:l,logger:a},A),m&&([h,p]=await du(u,d))}else if(c.authorizeRequestOnChallenge&&(m=await c.authorizeRequestOnChallenge({scopes:Array.isArray(o)?o:[o],request:u,response:h,getAccessToken:l,logger:a}),m&&([h,p]=await du(u,d)),nv(h)&&(y=ov(h.headers.get("WWW-Authenticate")),y))){let A;try{A=atob(y)}catch{return a.warning(`The WWW-Authenticate header contains "claims" that cannot be parsed. Unable to perform the Continuous Access Evaluation authentication flow. Unparsable claims: ${y}`),h}m=await iv({scopes:Array.isArray(o)?o:[o],response:h,request:u,getAccessToken:l,logger:a},A),m&&([h,p]=await du(u,d))}}if(p)throw p;return h}}}function ax(r){let e=/(\w+)\s+((?:\w+=(?:"[^"]*"|[^,]*),?\s*)+)/g,t=/(\w+)="([^"]*)"/g,n=[],i;for(;(i=e.exec(r))!==null;){let o=i[1],s=i[2],a={},c;for(;(c=t.exec(s))!==null;)a[c[1]]=c[2];n.push({scheme:o,params:a})}return n}function ov(r){var e;return r?(e=ax(r).find(n=>n.scheme==="Bearer"&&n.params.claims&&n.params.error==="insufficient_claims"))===null||e===void 0?void 0:e.params.claims:void 0}var cv=qi(av(),1),Sh=cv.state;function Jr(r,e,t){let n=e.parameterPath,i=e.mapper,o;if(typeof n=="string"&&(n=[n]),Array.isArray(n)){if(n.length>0)if(i.isConstant)o=i.defaultValue;else{let s=lv(r,n);!s.propertyFound&&t&&(s=lv(t,n));let a=!1;s.propertyFound||(a=i.required||n[0]==="options"&&n.length===2),o=a?i.defaultValue:s.propertyValue}}else{i.required&&(o={});for(let s in n){let a=i.type.modelProperties[s],c=n[s],l=Jr(r,{parameterPath:c,mapper:a},t);l!==void 0&&(o||(o={}),o[s]=l)}}return o}function lv(r,e){let t={propertyFound:!1},n=0;for(;n<e.length;++n){let i=e[n];if(r&&i in r)r=r[i];else break}return n===e.length&&(t.propertyValue=r,t.propertyFound=!0),t}var uv=Symbol.for("@azure/core-client original request");function cx(r){return uv in r}function kr(r){if(cx(r))return kr(r[uv]);let e=Sh.operationRequestMap.get(r);return e||(e={},Sh.operationRequestMap.set(r,e)),e}var lx=["application/json","text/json"],ux=["application/xml","application/atom+xml"],dv="deserializationPolicy";function wh(r={}){var e,t,n,i,o,s,a;let c=(t=(e=r.expectedContentTypes)===null||e===void 0?void 0:e.json)!==null&&t!==void 0?t:lx,l=(i=(n=r.expectedContentTypes)===null||n===void 0?void 0:n.xml)!==null&&i!==void 0?i:ux,u=r.parseXML,d=r.serializerOptions,h={xml:{rootName:(o=d?.xml.rootName)!==null&&o!==void 0?o:"",includeRoot:(s=d?.xml.includeRoot)!==null&&s!==void 0?s:!1,xmlCharKey:(a=d?.xml.xmlCharKey)!==null&&a!==void 0?a:ao}};return{name:dv,async sendRequest(p,m){let y=await m(p);return hx(c,l,y,h,u)}}}function dx(r){let e,t=r.request,n=kr(t),i=n?.operationSpec;return i&&(n?.operationResponseGetter?e=n?.operationResponseGetter(i,r):e=i.responses[r.status]),e}function fx(r){let e=r.request,t=kr(e),n=t?.shouldDeserialize,i;return n===void 0?i=!0:typeof n=="boolean"?i=n:i=n(r),i}async function hx(r,e,t,n,i){let o=await gx(r,e,t,n,i);if(!fx(o))return o;let s=kr(o.request),a=s?.operationSpec;if(!a||!a.responses)return o;let c=dx(o),{error:l,shouldReturnResponse:u}=mx(o,a,c,n);if(l)throw l;if(u)return o;if(c){if(c.bodyMapper){let d=o.parsedBody;a.isXML&&c.bodyMapper.type.name===ir.Sequence&&(d=typeof d=="object"?d[c.bodyMapper.xmlElementName]:[]);try{o.parsedBody=a.serializer.deserialize(c.bodyMapper,d,"operationRes.parsedBody",n)}catch(h){throw new Fe(`Error ${h} occurred in deserializing the responseBody - ${o.bodyAsText}`,{statusCode:o.status,request:o.request,response:o})}}else a.httpMethod==="HEAD"&&(o.parsedBody=t.status>=200&&t.status<300);c.headersMapper&&(o.parsedHeaders=a.serializer.deserialize(c.headersMapper,o.headers.toJSON(),"operationRes.parsedHeaders",{xml:{},ignoreUnknownProperties:!0}))}return o}function px(r){let e=Object.keys(r.responses);return e.length===0||e.length===1&&e[0]==="default"}function mx(r,e,t,n){var i,o,s,a,c;let l=200<=r.status&&r.status<300;if(px(e)?l:!!t)if(t){if(!t.isError)return{error:null,shouldReturnResponse:!1}}else return{error:null,shouldReturnResponse:!1};let d=t??e.responses.default,h=!((i=r.request.streamResponseStatusCodes)===null||i===void 0)&&i.has(r.status)?`Unexpected status code: ${r.status}`:r.bodyAsText,p=new Fe(h,{statusCode:r.status,request:r.request,response:r});if(!d&&!(!((s=(o=r.parsedBody)===null||o===void 0?void 0:o.error)===null||s===void 0)&&s.code&&(!((c=(a=r.parsedBody)===null||a===void 0?void 0:a.error)===null||c===void 0)&&c.message)))throw p;let m=d?.bodyMapper,y=d?.headersMapper;try{if(r.parsedBody){let A=r.parsedBody,P;if(m){let U=A;if(e.isXML&&m.type.name===ir.Sequence){U=[];let H=m.xmlElementName;typeof A=="object"&&H&&(U=A[H])}P=e.serializer.deserialize(m,U,"error.response.parsedBody",n)}let D=A.error||P||A;p.code=D.code,D.message&&(p.message=D.message),m&&(p.response.parsedBody=P)}r.headers&&y&&(p.response.parsedHeaders=e.serializer.deserialize(y,r.headers.toJSON(),"operationRes.parsedHeaders"))}catch(A){p.message=`Error "${A.message}" occurred in deserializing the responseBody - "${r.bodyAsText}" for the default response.`}return{error:p,shouldReturnResponse:!1}}async function gx(r,e,t,n,i){var o;if(!(!((o=t.request.streamResponseStatusCodes)===null||o===void 0)&&o.has(t.status))&&t.bodyAsText){let s=t.bodyAsText,a=t.headers.get("Content-Type")||"",c=a?a.split(";").map(l=>l.toLowerCase()):[];try{if(c.length===0||c.some(l=>r.indexOf(l)!==-1))return t.parsedBody=JSON.parse(s),t;if(c.some(l=>e.indexOf(l)!==-1)){if(!i)throw new Error("Parsing XML not supported.");let l=await i(s,n.xml);return t.parsedBody=l,t}}catch(l){let u=`Error "${l}" occurred while parsing the response body - ${t.bodyAsText}.`,d=l.code||Fe.PARSE_ERROR;throw new Fe(u,{code:d,statusCode:t.status,request:t.request,response:t})}}return t}function fv(r){let e=new Set;for(let t in r.responses){let n=r.responses[t];n.bodyMapper&&n.bodyMapper.type.name===ir.Stream&&e.add(Number(t))}return e}function ur(r){let{parameterPath:e,mapper:t}=r,n;return typeof e=="string"?n=e:Array.isArray(e)?n=e.join("."):n=t.serializedName,n}var hv="serializationPolicy";function Rh(r={}){let e=r.stringifyXML;return{name:hv,async sendRequest(t,n){let i=kr(t),o=i?.operationSpec,s=i?.operationArguments;return o&&s&&(yx(t,s,o),Ex(t,s,o,e)),n(t)}}}function yx(r,e,t){var n,i;if(t.headerParameters)for(let s of t.headerParameters){let a=Jr(e,s);if(a!=null||s.mapper.required){a=t.serializer.serialize(s.mapper,a,ur(s));let c=s.mapper.headerCollectionPrefix;if(c)for(let l of Object.keys(a))r.headers.set(c+l,a[l]);else r.headers.set(s.mapper.serializedName||ur(s),a)}}let o=(i=(n=e.options)===null||n===void 0?void 0:n.requestOptions)===null||i===void 0?void 0:i.customHeaders;if(o)for(let s of Object.keys(o))r.headers.set(s,o[s])}function Ex(r,e,t,n=function(){throw new Error("XML serialization unsupported!")}){var i,o,s,a,c;let l=(i=e.options)===null||i===void 0?void 0:i.serializerOptions,u={xml:{rootName:(o=l?.xml.rootName)!==null&&o!==void 0?o:"",includeRoot:(s=l?.xml.includeRoot)!==null&&s!==void 0?s:!1,xmlCharKey:(a=l?.xml.xmlCharKey)!==null&&a!==void 0?a:ao}},d=u.xml.xmlCharKey;if(t.requestBody&&t.requestBody.mapper){r.body=Jr(e,t.requestBody);let h=t.requestBody.mapper,{required:p,serializedName:m,xmlName:y,xmlElementName:A,xmlNamespace:P,xmlNamespacePrefix:D,nullable:U}=h,H=h.type.name;try{if(r.body!==void 0&&r.body!==null||U&&r.body===null||p){let w=ur(t.requestBody);r.body=t.serializer.serialize(h,r.body,w,u);let b=H===ir.Stream;if(t.isXML){let S=D?`xmlns:${D}`:"xmlns",L=Tx(P,S,H,r.body,u);H===ir.Sequence?r.body=n(vx(L,A||y||m,S,P),{rootName:y||m,xmlCharKey:d}):b||(r.body=n(L,{rootName:y||m,xmlCharKey:d}))}else{if(H===ir.String&&(!((c=t.contentType)===null||c===void 0)&&c.match("text/plain")||t.mediaType==="text"))return;b||(r.body=JSON.stringify(r.body))}}}catch(w){throw new Error(`Error "${w.message}" occurred in serializing the payload - ${JSON.stringify(m,void 0,"  ")}.`)}}else if(t.formDataParameters&&t.formDataParameters.length>0){r.formData={};for(let h of t.formDataParameters){let p=Jr(e,h);if(p!=null){let m=h.mapper.serializedName||ur(h);r.formData[m]=t.serializer.serialize(h.mapper,p,ur(h),u)}}}}function Tx(r,e,t,n,i){if(r&&!["Composite","Sequence","Dictionary"].includes(t)){let o={};return o[i.xml.xmlCharKey]=n,o[ys]={[e]:r},o}return n}function vx(r,e,t,n){if(Array.isArray(r)||(r=[r]),!t||!n)return{[e]:r};let i={[e]:r};return i[ys]={[t]:n},i}function Ih(r={}){let e=Th(r??{});return r.credentialOptions&&e.addPolicy(fu({credential:r.credentialOptions.credential,scopes:r.credentialOptions.credentialScopes})),e.addPolicy(Rh(r.serializationOptions),{phase:"Serialize"}),e.addPolicy(wh(r.deserializationOptions),{phase:"Deserialize"}),e}var bh;function pv(){return bh||(bh=Ch()),bh}var Cx={CSV:",",SSV:" ",Multi:"Multi",TSV:"	",Pipes:"|"};function gv(r,e,t,n){let i=_x(e,t,n),o=!1,s=mv(r,i);if(e.path){let l=mv(e.path,i);e.path==="/{nextLink}"&&l.startsWith("/")&&(l=l.substring(1)),Ax(l)?(s=l,o=!0):s=Sx(s,l)}let{queryParams:a,sequenceParams:c}=wx(e,t,n);return s=Ix(s,a,c,o),s}function mv(r,e){let t=r;for(let[n,i]of e)t=t.split(n).join(i);return t}function _x(r,e,t){var n;let i=new Map;if(!((n=r.urlParameters)===null||n===void 0)&&n.length)for(let o of r.urlParameters){let s=Jr(e,o,t),a=ur(o);s=r.serializer.serialize(o.mapper,s,a),o.skipEncoding||(s=encodeURIComponent(s)),i.set(`{${o.mapper.serializedName||a}}`,s)}return i}function Ax(r){return r.includes("://")}function Sx(r,e){if(!e)return r;let t=new URL(r),n=t.pathname;n.endsWith("/")||(n=`${n}/`),e.startsWith("/")&&(e=e.substring(1));let i=e.indexOf("?");if(i!==-1){let o=e.substring(0,i),s=e.substring(i+1);n=n+o,s&&(t.search=t.search?`${t.search}&${s}`:s)}else n=n+e;return t.pathname=n,t.toString()}function wx(r,e,t){var n;let i=new Map,o=new Set;if(!((n=r.queryParameters)===null||n===void 0)&&n.length)for(let s of r.queryParameters){s.mapper.type.name==="Sequence"&&s.mapper.serializedName&&o.add(s.mapper.serializedName);let a=Jr(e,s,t);if(a!=null||s.mapper.required){a=r.serializer.serialize(s.mapper,a,ur(s));let c=s.collectionFormat?Cx[s.collectionFormat]:"";if(Array.isArray(a)&&(a=a.map(l=>l??"")),s.collectionFormat==="Multi"&&a.length===0)continue;Array.isArray(a)&&(s.collectionFormat==="SSV"||s.collectionFormat==="TSV")&&(a=a.join(c)),s.skipEncoding||(Array.isArray(a)?a=a.map(l=>encodeURIComponent(l)):a=encodeURIComponent(a)),Array.isArray(a)&&(s.collectionFormat==="CSV"||s.collectionFormat==="Pipes")&&(a=a.join(c)),i.set(s.mapper.serializedName||ur(s),a)}}return{queryParams:i,sequenceParams:o}}function Rx(r){let e=new Map;if(!r||r[0]!=="?")return e;r=r.slice(1);let t=r.split("&");for(let n of t){let[i,o]=n.split("=",2),s=e.get(i);s?Array.isArray(s)?s.push(o):e.set(i,[s,o]):e.set(i,o)}return e}function Ix(r,e,t,n=!1){if(e.size===0)return r;let i=new URL(r),o=Rx(i.search);for(let[a,c]of e){let l=o.get(a);if(Array.isArray(l))if(Array.isArray(c)){l.push(...c);let u=new Set(l);o.set(a,Array.from(u))}else l.push(c);else l?(Array.isArray(c)?c.unshift(l):t.has(a)&&o.set(a,[l,c]),n||o.set(a,c)):o.set(a,c)}let s=[];for(let[a,c]of o)if(typeof c=="string")s.push(`${a}=${c}`);else if(Array.isArray(c))for(let l of c)s.push(`${a}=${l}`);else s.push(`${a}=${c}`);return i.search=s.length?`?${s.join("&")}`:"",i.toString()}var Oh=Qr("core-client");var ws=class{constructor(e={}){var t,n;if(this._requestContentType=e.requestContentType,this._endpoint=(t=e.endpoint)!==null&&t!==void 0?t:e.baseUri,e.baseUri&&Oh.warning("The baseUri option for SDK Clients has been deprecated, please use endpoint instead."),this._allowInsecureConnection=e.allowInsecureConnection,this._httpClient=e.httpClient||pv(),this.pipeline=e.pipeline||bx(e),!((n=e.additionalPolicies)===null||n===void 0)&&n.length)for(let{policy:i,position:o}of e.additionalPolicies){let s=o==="perRetry"?"Sign":void 0;this.pipeline.addPolicy(i,{afterPhase:s})}}async sendRequest(e){return this.pipeline.sendRequest(this._httpClient,e)}async sendOperationRequest(e,t){let n=t.baseUrl||this._endpoint;if(!n)throw new Error("If operationSpec.baseUrl is not specified, then the ServiceClient must have a endpoint string property that contains the base URL to use.");let i=gv(n,t,e,this),o=lr({url:i});o.method=t.httpMethod;let s=kr(o);s.operationSpec=t,s.operationArguments=e;let a=t.contentType||this._requestContentType;a&&t.requestBody&&o.headers.set("Content-Type",a);let c=e.options;if(c){let l=c.requestOptions;l&&(l.timeout&&(o.timeout=l.timeout),l.onUploadProgress&&(o.onUploadProgress=l.onUploadProgress),l.onDownloadProgress&&(o.onDownloadProgress=l.onDownloadProgress),l.shouldDeserialize!==void 0&&(s.shouldDeserialize=l.shouldDeserialize),l.allowInsecureConnection&&(o.allowInsecureConnection=!0)),c.abortSignal&&(o.abortSignal=c.abortSignal),c.tracingOptions&&(o.tracingOptions=c.tracingOptions)}this._allowInsecureConnection&&(o.allowInsecureConnection=!0),o.streamResponseStatusCodes===void 0&&(o.streamResponseStatusCodes=fv(t));try{let l=await this.sendRequest(o),u=jf(l,t.responses[l.status]);return c?.onResponse&&c.onResponse(l,u),u}catch(l){if(typeof l=="object"&&l?.response){let u=l.response,d=jf(u,t.responses[l.statusCode]||t.responses.default);l.details=d,c?.onResponse&&c.onResponse(u,d,l)}throw l}}};function bx(r){let e=Ox(r),t=r.credential&&e?{credentialScopes:e,credential:r.credential}:void 0;return Ih(Object.assign(Object.assign({},r),{credentialOptions:t}))}function Ox(r){if(r.credentialScopes)return r.credentialScopes;if(r.endpoint)return`${r.endpoint}/.default`;if(r.baseUri)return`${r.baseUri}/.default`;if(r.credential&&!r.credentialScopes)throw new Error("When using credentials, the ServiceClientOptions must contain either a endpoint or a credentialScopes. Unable to create a bearerTokenAuthenticationPolicy")}function yv(r){return r==="adfs"?"oauth2/token":"oauth2/v2.0/token"}var Le=_s({namespace:"Microsoft.AAD",packageName:"@azure/identity",packageVersion:Ml});function Ev(r){if(typeof r.expires_on=="number")return r.expires_on*1e3;if(typeof r.expires_on=="string"){let e=+r.expires_on;if(!isNaN(e))return e*1e3;let t=Date.parse(r.expires_on);if(!isNaN(t))return t}if(typeof r.expires_in=="number")return Date.now()+r.expires_in*1e3;throw new Error(`Failed to parse token expiration from body. expires_in="${r.expires_in}", expires_on="${r.expires_on}"`)}function Tv(r){if(r.refresh_on){if(typeof r.refresh_on=="number")return r.refresh_on*1e3;if(typeof r.refresh_on=="string"){let e=+r.refresh_on;if(!isNaN(e))return e*1e3;let t=Date.parse(r.refresh_on);if(!isNaN(t))return t}throw new Error(`Failed to parse refresh_on from body. refresh_on="${r.refresh_on}"`)}else return}var Rs="noCorrelationId";function kx(r){let e=r?.authorityHost;return Ts&&(e=e??process.env.AZURE_AUTHORITY_HOST),e??gs}var Gn=class extends ws{constructor(e){var t,n;let i=`azsdk-js-identity/${Ml}`,o=!((t=e?.userAgentOptions)===null||t===void 0)&&t.userAgentPrefix?`${e.userAgentOptions.userAgentPrefix} ${i}`:`${i}`,s=kx(e);if(!s.startsWith("https:"))throw new Error("The authorityHost address must use the 'https' protocol.");super(Object.assign(Object.assign({requestContentType:"application/json; charset=utf-8",retryOptions:{maxRetries:3}},e),{userAgentOptions:{userAgentPrefix:o},baseUri:s})),this.allowInsecureConnection=!1,this.authorityHost=s,this.abortControllers=new Map,this.allowLoggingAccountIdentifiers=(n=e?.loggingOptions)===null||n===void 0?void 0:n.allowLoggingAccountIdentifiers,this.tokenCredentialOptions=Object.assign({},e),e?.allowInsecureConnection&&(this.allowInsecureConnection=e.allowInsecureConnection)}async sendTokenRequest(e){Ct.info(`IdentityClient: sending token request to [${e.url}]`);let t=await this.sendRequest(e);if(t.bodyAsText&&(t.status===200||t.status===201)){let n=JSON.parse(t.bodyAsText);if(!n.access_token)return null;this.logIdentifiers(t);let i={accessToken:{token:n.access_token,expiresOnTimestamp:Ev(n),refreshAfterTimestamp:Tv(n),tokenType:"Bearer"},refreshToken:n.refresh_token};return Ct.info(`IdentityClient: [${e.url}] token acquired, expires on ${i.accessToken.expiresOnTimestamp}`),i}else{let n=new $n(t.status,t.bodyAsText);throw Ct.warning(`IdentityClient: authentication error. HTTP status: ${t.status}, ${n.errorResponse.errorDescription}`),n}}async refreshAccessToken(e,t,n,i,o,s={}){if(i===void 0)return null;Ct.info(`IdentityClient: refreshing access token with client ID: ${t}, scopes: ${n} started`);let a={grant_type:"refresh_token",client_id:t,refresh_token:i,scope:n};o!==void 0&&(a.client_secret=o);let c=new URLSearchParams(a);return Le.withSpan("IdentityClient.refreshAccessToken",s,async l=>{try{let u=yv(e),d=lr({url:`${this.authorityHost}/${e}/${u}`,method:"POST",body:c.toString(),abortSignal:s.abortSignal,headers:ct({Accept:"application/json","Content-Type":"application/x-www-form-urlencoded"}),tracingOptions:l.tracingOptions}),h=await this.sendTokenRequest(d);return Ct.info(`IdentityClient: refreshed token for client ID: ${t}`),h}catch(u){if(u.name===Fl&&u.errorResponse.error==="interaction_required")return Ct.info(`IdentityClient: interaction required for client ID: ${t}`),null;throw Ct.warning(`IdentityClient: failed refreshing token for client ID: ${t}: ${u}`),u}})}generateAbortSignal(e){let t=new AbortController,n=this.abortControllers.get(e)||[];n.push(t),this.abortControllers.set(e,n);let i=t.signal.onabort;return t.signal.onabort=(...o)=>{this.abortControllers.set(e,void 0),i&&i.apply(t.signal,o)},t.signal}abortRequests(e){let t=e||Rs,n=[...this.abortControllers.get(t)||[],...this.abortControllers.get(Rs)||[]];if(n.length){for(let i of n)i.abort();this.abortControllers.set(t,void 0)}}getCorrelationId(e){var t;let n=(t=e?.body)===null||t===void 0?void 0:t.split("&").map(i=>i.split("=")).find(([i])=>i==="client-request-id");return n&&n.length&&n[1]||Rs}async sendGetRequestAsync(e,t){let n=lr({url:e,method:"GET",body:t?.body,allowInsecureConnection:this.allowInsecureConnection,headers:ct(t?.headers),abortSignal:this.generateAbortSignal(Rs)}),i=await this.sendRequest(n);return this.logIdentifiers(i),{body:i.bodyAsText?JSON.parse(i.bodyAsText):void 0,headers:i.headers.toJSON(),status:i.status}}async sendPostRequestAsync(e,t){let n=lr({url:e,method:"POST",body:t?.body,headers:ct(t?.headers),allowInsecureConnection:this.allowInsecureConnection,abortSignal:this.generateAbortSignal(this.getCorrelationId(t))}),i=await this.sendRequest(n);return this.logIdentifiers(i),{body:i.bodyAsText?JSON.parse(i.bodyAsText):void 0,headers:i.headers.toJSON(),status:i.status}}getTokenCredentialOptions(){return this.tokenCredentialOptions}logIdentifiers(e){if(!this.allowLoggingAccountIdentifiers||!e.bodyAsText)return;let t="No User Principal Name available";try{let i=(e.parsedBody||JSON.parse(e.bodyAsText)).access_token;if(!i)return;let o=i.split(".")[1],{appid:s,upn:a,tid:c,oid:l}=JSON.parse(Buffer.from(o,"base64").toString("utf8"));Ct.info(`[Authenticated account] Client ID: ${s}. Tenant ID: ${c}. User Principal Name: ${a||t}. Object ID (user): ${l}`)}catch(n){Ct.warning("allowLoggingAccountIdentifiers was set, but we couldn't log the account information. Error:",n.message)}}};import yK from"node:fs";import TK from"node:os";import CK from"node:path";var _K=G("VisualStudioCodeCredential");var AK={AzureCloud:br.AzurePublicCloud,AzureChina:br.AzureChina,AzureGermanCloud:br.AzureGermany,AzureUSGovernment:br.AzureGovernment};var Pt={};ze(Pt,{AuthError:()=>Z,AuthErrorCodes:()=>Ao,AuthErrorMessage:()=>xh,AzureCloudInstance:()=>Lr,ClientApplication:()=>vn,ClientAssertion:()=>Gr,ClientAuthError:()=>an,ClientAuthErrorCodes:()=>ce,ClientAuthErrorMessage:()=>Nh,ClientConfigurationError:()=>Oo,ClientConfigurationErrorCodes:()=>bo,ClientConfigurationErrorMessage:()=>Hh,ClientCredentialClient:()=>Cn,ConfidentialClientApplication:()=>Wo,CryptoProvider:()=>gn,DeviceCodeClient:()=>Vo,DistributedCachePlugin:()=>$d,InteractionRequiredAuthError:()=>Ot,InteractionRequiredAuthErrorCodes:()=>Mu,InteractionRequiredAuthErrorMessage:()=>Bp,LogLevel:()=>ve,Logger:()=>It,ManagedIdentityApplication:()=>Ya,ManagedIdentitySourceNames:()=>V,OnBehalfOfClient:()=>Yo,PromptValue:()=>Wt,ProtocolMode:()=>Ve,PublicClientApplication:()=>Ko,ResponseMode:()=>dr,ServerError:()=>Je,TokenCache:()=>Ho,TokenCacheContext:()=>kt,UsernamePasswordClient:()=>Go,internals:()=>zp,version:()=>Jt});var zp={};ze(zp,{Deserializer:()=>Br,Serializer:()=>en});var en=class{static serializeJSONBlob(e){return JSON.stringify(e)}static serializeAccounts(e){let t={};return Object.keys(e).map(function(n){let i=e[n];t[n]={home_account_id:i.homeAccountId,environment:i.environment,realm:i.realm,local_account_id:i.localAccountId,username:i.username,authority_type:i.authorityType,name:i.name,client_info:i.clientInfo,last_modification_time:i.lastModificationTime,last_modification_app:i.lastModificationApp,tenantProfiles:i.tenantProfiles?.map(o=>JSON.stringify(o))}}),t}static serializeIdTokens(e){let t={};return Object.keys(e).map(function(n){let i=e[n];t[n]={home_account_id:i.homeAccountId,environment:i.environment,credential_type:i.credentialType,client_id:i.clientId,secret:i.secret,realm:i.realm}}),t}static serializeAccessTokens(e){let t={};return Object.keys(e).map(function(n){let i=e[n];t[n]={home_account_id:i.homeAccountId,environment:i.environment,credential_type:i.credentialType,client_id:i.clientId,secret:i.secret,realm:i.realm,target:i.target,cached_at:i.cachedAt,expires_on:i.expiresOn,extended_expires_on:i.extendedExpiresOn,refresh_on:i.refreshOn,key_id:i.keyId,token_type:i.tokenType,requestedClaims:i.requestedClaims,requestedClaimsHash:i.requestedClaimsHash,userAssertionHash:i.userAssertionHash}}),t}static serializeRefreshTokens(e){let t={};return Object.keys(e).map(function(n){let i=e[n];t[n]={home_account_id:i.homeAccountId,environment:i.environment,credential_type:i.credentialType,client_id:i.clientId,secret:i.secret,family_id:i.familyId,target:i.target,realm:i.realm}}),t}static serializeAppMetadata(e){let t={};return Object.keys(e).map(function(n){let i=e[n];t[n]={client_id:i.clientId,environment:i.environment,family_id:i.familyId}}),t}static serializeAllCache(e){return{Account:this.serializeAccounts(e.accounts),IdToken:this.serializeIdTokens(e.idTokens),AccessToken:this.serializeAccessTokens(e.accessTokens),RefreshToken:this.serializeRefreshTokens(e.refreshTokens),AppMetadata:this.serializeAppMetadata(e.appMetadata)}}};var E={LIBRARY_NAME:"MSAL.JS",SKU:"msal.js.common",CACHE_PREFIX:"msal",DEFAULT_AUTHORITY:"https://login.microsoftonline.com/common/",DEFAULT_AUTHORITY_HOST:"login.microsoftonline.com",DEFAULT_COMMON_TENANT:"common",ADFS:"adfs",DSTS:"dstsv2",AAD_INSTANCE_DISCOVERY_ENDPT:"https://login.microsoftonline.com/common/discovery/instance?api-version=1.1&authorization_endpoint=",CIAM_AUTH_URL:".ciamlogin.com",AAD_TENANT_DOMAIN_SUFFIX:".onmicrosoft.com",RESOURCE_DELIM:"|",NO_ACCOUNT:"NO_ACCOUNT",CLAIMS:"claims",CONSUMER_UTID:"9188040d-6c67-4c5b-b112-36a304b66dad",OPENID_SCOPE:"openid",PROFILE_SCOPE:"profile",OFFLINE_ACCESS_SCOPE:"offline_access",EMAIL_SCOPE:"email",CODE_GRANT_TYPE:"authorization_code",RT_GRANT_TYPE:"refresh_token",S256_CODE_CHALLENGE_METHOD:"S256",URL_FORM_CONTENT_TYPE:"application/x-www-form-urlencoded;charset=utf-8",AUTHORIZATION_PENDING:"authorization_pending",NOT_DEFINED:"not_defined",EMPTY_STRING:"",NOT_APPLICABLE:"N/A",NOT_AVAILABLE:"Not Available",FORWARD_SLASH:"/",IMDS_ENDPOINT:"http://169.254.169.254/metadata/instance/compute/location",IMDS_VERSION:"2020-06-01",IMDS_TIMEOUT:2e3,AZURE_REGION_AUTO_DISCOVER_FLAG:"TryAutoDetect",REGIONAL_AUTH_PUBLIC_CLOUD_SUFFIX:"login.microsoft.com",KNOWN_PUBLIC_CLOUDS:["login.microsoftonline.com","login.windows.net","login.microsoft.com","sts.windows.net"],SHR_NONCE_VALIDITY:240,INVALID_INSTANCE:"invalid_instance"},W={SUCCESS:200,SUCCESS_RANGE_START:200,SUCCESS_RANGE_END:299,REDIRECT:302,CLIENT_ERROR:400,CLIENT_ERROR_RANGE_START:400,BAD_REQUEST:400,UNAUTHORIZED:401,NOT_FOUND:404,REQUEST_TIMEOUT:408,GONE:410,TOO_MANY_REQUESTS:429,CLIENT_ERROR_RANGE_END:499,SERVER_ERROR:500,SERVER_ERROR_RANGE_START:500,SERVICE_UNAVAILABLE:503,GATEWAY_TIMEOUT:504,SERVER_ERROR_RANGE_END:599,MULTI_SIDED_ERROR:600},ut=[E.OPENID_SCOPE,E.PROFILE_SCOPE,E.OFFLINE_ACCESS_SCOPE],kh=[...ut,E.EMAIL_SCOPE],ue={CONTENT_TYPE:"Content-Type",CONTENT_LENGTH:"Content-Length",RETRY_AFTER:"Retry-After",CCS_HEADER:"X-AnchorMailbox",WWWAuthenticate:"WWW-Authenticate",AuthenticationInfo:"Authentication-Info",X_MS_REQUEST_ID:"x-ms-request-id",X_MS_HTTP_VERSION:"x-ms-httpver"};var dt={COMMON:"common",ORGANIZATIONS:"organizations",CONSUMERS:"consumers"},Vn={ACCESS_TOKEN:"access_token",XMS_CC:"xms_cc"},Wt={LOGIN:"login",SELECT_ACCOUNT:"select_account",CONSENT:"consent",NONE:"none",CREATE:"create",NO_SESSION:"no_session"},Kn={PLAIN:"plain",S256:"S256"},vo={CODE:"code",IDTOKEN_TOKEN:"id_token token",IDTOKEN_TOKEN_REFRESHTOKEN:"id_token token refresh_token"};var dr={QUERY:"query",FRAGMENT:"fragment",FORM_POST:"form_post"},ft={IMPLICIT_GRANT:"implicit",AUTHORIZATION_CODE_GRANT:"authorization_code",CLIENT_CREDENTIALS_GRANT:"client_credentials",RESOURCE_OWNER_PASSWORD_GRANT:"password",REFRESH_TOKEN_GRANT:"refresh_token",DEVICE_CODE_GRANT:"device_code",JWT_BEARER:"urn:ietf:params:oauth:grant-type:jwt-bearer"},Yn={MSSTS_ACCOUNT_TYPE:"MSSTS",ADFS_ACCOUNT_TYPE:"ADFS",MSAV1_ACCOUNT_TYPE:"MSA",GENERIC_ACCOUNT_TYPE:"Generic"},Ae={CACHE_KEY_SEPARATOR:"-",CLIENT_INFO_SEPARATOR:"."},se={ID_TOKEN:"IdToken",ACCESS_TOKEN:"AccessToken",ACCESS_TOKEN_WITH_AUTH_SCHEME:"AccessToken_With_AuthScheme",REFRESH_TOKEN:"RefreshToken"};var Is="appmetadata",vv="client_info",xr="1",Co={CACHE_KEY:"authority-metadata",REFRESH_TIME_SECONDS:3600*24},Ze={CONFIG:"config",CACHE:"cache",NETWORK:"network",HARDCODED_VALUES:"hardcoded_values"},Pe={SCHEMA_VERSION:5,MAX_CUR_HEADER_BYTES:80,MAX_LAST_HEADER_BYTES:330,MAX_CACHED_ERRORS:50,CACHE_KEY:"server-telemetry",CATEGORY_SEPARATOR:"|",VALUE_SEPARATOR:",",OVERFLOW_TRUE:"1",OVERFLOW_FALSE:"0",UNKNOWN_ERROR:"unknown_error"},te={BEARER:"Bearer",POP:"pop",SSH:"ssh-cert"},fr={DEFAULT_THROTTLE_TIME_SECONDS:60,DEFAULT_MAX_THROTTLE_TIME_SECONDS:3600,THROTTLING_PREFIX:"throttling",X_MS_LIB_CAPABILITY_VALUE:"retry-after, h429"},bs={INVALID_GRANT_ERROR:"invalid_grant",CLIENT_MISMATCH_ERROR:"client_mismatch"},Os={username:"username",password:"password"},ks={httpSuccess:200,httpBadRequest:400},Wn={FAILED_AUTO_DETECTION:"1",INTERNAL_CACHE:"2",ENVIRONMENT_VARIABLE:"3",IMDS:"4"},pu={CONFIGURED_MATCHES_DETECTED:"1",CONFIGURED_NO_AUTO_DETECTION:"2",CONFIGURED_NOT_DETECTED:"3",AUTO_DETECTION_REQUESTED_SUCCESSFUL:"4",AUTO_DETECTION_REQUESTED_FAILED:"5"},le={NOT_APPLICABLE:"0",FORCE_REFRESH_OR_CLAIMS:"1",NO_CACHED_ACCESS_TOKEN:"2",CACHED_ACCESS_TOKEN_EXPIRED:"3",PROACTIVELY_REFRESHED:"4"};var _o=300;var Ao={};ze(Ao,{postRequestFailed:()=>Ps,unexpectedError:()=>xs});var xs="unexpected_error",Ps="post_request_failed";var mu={[xs]:"Unexpected error in authentication.",[Ps]:"Post request failed from the network, could be a 4xx/5xx or a network unavailability. Please check the exact error code for details."},xh={unexpectedError:{code:xs,desc:mu[xs]},postRequestFailed:{code:Ps,desc:mu[Ps]}},Z=class r extends Error{constructor(e,t,n){let i=t?`${e}: ${t}`:e;super(i),Object.setPrototypeOf(this,r.prototype),this.errorCode=e||E.EMPTY_STRING,this.errorMessage=t||E.EMPTY_STRING,this.subError=n||E.EMPTY_STRING,this.name="AuthError"}setCorrelationId(e){this.correlationId=e}};function Ph(r,e){return new Z(r,e?`${mu[r]} ${e}`:mu[r])}var ce={};ze(ce,{authTimeNotFound:()=>Pr,authorizationCodeMissingFromServerResponse:()=>ui,bindingKeyNotRemoved:()=>di,cannotAppendScopeSet:()=>ai,cannotRemoveEmptyScope:()=>si,clientInfoDecodingError:()=>tn,clientInfoEmptyError:()=>Zn,deviceCodeExpired:()=>Ls,deviceCodePollingCancelled:()=>Ds,deviceCodeUnknownError:()=>Us,emptyInputScopeSet:()=>on,endSessionEndpointNotSupported:()=>fi,endpointResolutionError:()=>Xe,hashNotDeserialized:()=>ei,invalidAssertion:()=>$s,invalidCacheEnvironment:()=>Mr,invalidCacheRecord:()=>ci,invalidClientCredential:()=>qs,invalidState:()=>Zt,keyIdMissing:()=>hi,maxAgeTranspired:()=>ni,methodNotImplemented:()=>Q,missingTenantIdError:()=>Gs,multipleMatchingAccounts:()=>Ms,multipleMatchingAppMetadata:()=>ii,multipleMatchingTokens:()=>Ns,nestedAppAuthBridgeDisabled:()=>Vs,networkError:()=>Qn,noAccountFound:()=>Hs,noAccountInSilentRequest:()=>Nr,noCryptoObject:()=>sn,noNetworkConnectivity:()=>Bs,nonceMismatch:()=>ri,nullOrEmptyToken:()=>Xn,openIdConfigError:()=>Jn,requestCannotBeMade:()=>oi,stateMismatch:()=>ti,stateNotFound:()=>nn,tokenClaimsCnfRequiredForSignedJwt:()=>li,tokenParsingError:()=>rn,tokenRefreshRequired:()=>Dr,unexpectedCredentialType:()=>Fs,userCanceled:()=>zs,userTimeoutReached:()=>js});var tn="client_info_decoding_error",Zn="client_info_empty_error",rn="token_parsing_error",Xn="null_or_empty_token",Xe="endpoints_resolution_error",Qn="network_error",Jn="openid_config_error",ei="hash_not_deserialized",Zt="invalid_state",ti="state_mismatch",nn="state_not_found",ri="nonce_mismatch",Pr="auth_time_not_found",ni="max_age_transpired",Ns="multiple_matching_tokens",Ms="multiple_matching_accounts",ii="multiple_matching_appMetadata",oi="request_cannot_be_made",si="cannot_remove_empty_scope",ai="cannot_append_scopeset",on="empty_input_scopeset",Ds="device_code_polling_cancelled",Ls="device_code_expired",Us="device_code_unknown_error",Nr="no_account_in_silent_request",ci="invalid_cache_record",Mr="invalid_cache_environment",Hs="no_account_found",sn="no_crypto_object",Fs="unexpected_credential_type",$s="invalid_assertion",qs="invalid_client_credential",Dr="token_refresh_required",js="user_timeout_reached",li="token_claims_cnf_required_for_signedjwt",ui="authorization_code_missing_from_server_response",di="binding_key_not_removed",fi="end_session_endpoint_not_supported",hi="key_id_missing",Bs="no_network_connectivity",zs="user_canceled",Gs="missing_tenant_id_error",Q="method_not_implemented",Vs="nested_app_auth_bridge_disabled";var B={[tn]:"The client info could not be parsed/decoded correctly",[Zn]:"The client info was empty",[rn]:"Token cannot be parsed",[Xn]:"The token is null or empty",[Xe]:"Endpoints cannot be resolved",[Qn]:"Network request failed",[Jn]:"Could not retrieve endpoints. Check your authority and verify the .well-known/openid-configuration endpoint returns the required endpoints.",[ei]:"The hash parameters could not be deserialized",[Zt]:"State was not the expected format",[ti]:"State mismatch error",[nn]:"State not found",[ri]:"Nonce mismatch error",[Pr]:"Max Age was requested and the ID token is missing the auth_time variable. auth_time is an optional claim and is not enabled by default - it must be enabled. See https://aka.ms/msaljs/optional-claims for more information.",[ni]:"Max Age is set to 0, or too much time has elapsed since the last end-user authentication.",[Ns]:"The cache contains multiple tokens satisfying the requirements. Call AcquireToken again providing more requirements such as authority or account.",[Ms]:"The cache contains multiple accounts satisfying the given parameters. Please pass more info to obtain the correct account",[ii]:"The cache contains multiple appMetadata satisfying the given parameters. Please pass more info to obtain the correct appMetadata",[oi]:"Token request cannot be made without authorization code or refresh token.",[si]:"Cannot remove null or empty scope from ScopeSet",[ai]:"Cannot append ScopeSet",[on]:"Empty input ScopeSet cannot be processed",[Ds]:"Caller has cancelled token endpoint polling during device code flow by setting DeviceCodeRequest.cancel = true.",[Ls]:"Device code is expired.",[Us]:"Device code stopped polling for unknown reasons.",[Nr]:"Please pass an account object, silent flow is not supported without account information",[ci]:"Cache record object was null or undefined.",[Mr]:"Invalid environment when attempting to create cache entry",[Hs]:"No account found in cache for given key.",[sn]:"No crypto object detected.",[Fs]:"Unexpected credential type.",[$s]:"Client assertion must meet requirements described in https://tools.ietf.org/html/rfc7515",[qs]:"Client credential (secret, certificate, or assertion) must not be empty when creating a confidential client. An application should at most have one credential",[Dr]:"Cannot return token from cache because it must be refreshed. This may be due to one of the following reasons: forceRefresh parameter is set to true, claims have been requested, there is no cached access token or it is expired.",[js]:"User defined timeout for device code polling reached",[li]:"Cannot generate a POP jwt if the token_claims are not populated",[ui]:"Server response does not contain an authorization code to proceed",[di]:"Could not remove the credential's binding key from storage.",[fi]:"The provided authority does not support logout",[hi]:"A keyId value is missing from the requested bound token's cache record and is required to match the token to it's stored binding key.",[Bs]:"No network connectivity. Check your internet connection.",[zs]:"User cancelled the flow.",[Gs]:"A tenant id - not common, organizations, or consumers - must be specified when using the client_credentials flow.",[Q]:"This method has not been implemented",[Vs]:"The nested app auth bridge is disabled"},Nh={clientInfoDecodingError:{code:tn,desc:B[tn]},clientInfoEmptyError:{code:Zn,desc:B[Zn]},tokenParsingError:{code:rn,desc:B[rn]},nullOrEmptyToken:{code:Xn,desc:B[Xn]},endpointResolutionError:{code:Xe,desc:B[Xe]},networkError:{code:Qn,desc:B[Qn]},unableToGetOpenidConfigError:{code:Jn,desc:B[Jn]},hashNotDeserialized:{code:ei,desc:B[ei]},invalidStateError:{code:Zt,desc:B[Zt]},stateMismatchError:{code:ti,desc:B[ti]},stateNotFoundError:{code:nn,desc:B[nn]},nonceMismatchError:{code:ri,desc:B[ri]},authTimeNotFoundError:{code:Pr,desc:B[Pr]},maxAgeTranspired:{code:ni,desc:B[ni]},multipleMatchingTokens:{code:Ns,desc:B[Ns]},multipleMatchingAccounts:{code:Ms,desc:B[Ms]},multipleMatchingAppMetadata:{code:ii,desc:B[ii]},tokenRequestCannotBeMade:{code:oi,desc:B[oi]},removeEmptyScopeError:{code:si,desc:B[si]},appendScopeSetError:{code:ai,desc:B[ai]},emptyInputScopeSetError:{code:on,desc:B[on]},DeviceCodePollingCancelled:{code:Ds,desc:B[Ds]},DeviceCodeExpired:{code:Ls,desc:B[Ls]},DeviceCodeUnknownError:{code:Us,desc:B[Us]},NoAccountInSilentRequest:{code:Nr,desc:B[Nr]},invalidCacheRecord:{code:ci,desc:B[ci]},invalidCacheEnvironment:{code:Mr,desc:B[Mr]},noAccountFound:{code:Hs,desc:B[Hs]},noCryptoObj:{code:sn,desc:B[sn]},unexpectedCredentialType:{code:Fs,desc:B[Fs]},invalidAssertion:{code:$s,desc:B[$s]},invalidClientCredential:{code:qs,desc:B[qs]},tokenRefreshRequired:{code:Dr,desc:B[Dr]},userTimeoutReached:{code:js,desc:B[js]},tokenClaimsRequired:{code:li,desc:B[li]},noAuthorizationCodeFromServer:{code:ui,desc:B[ui]},bindingKeyNotRemovedError:{code:di,desc:B[di]},logoutNotSupported:{code:fi,desc:B[fi]},keyIdMissing:{code:hi,desc:B[hi]},noNetworkConnectivity:{code:Bs,desc:B[Bs]},userCanceledError:{code:zs,desc:B[zs]},missingTenantIdError:{code:Gs,desc:B[Gs]},nestedAppAuthBridgeDisabled:{code:Vs,desc:B[Vs]}},an=class r extends Z{constructor(e,t){super(e,t?`${B[e]}: ${t}`:B[e]),this.name="ClientAuthError",Object.setPrototypeOf(this,r.prototype)}};function v(r,e){return new an(r,e)}var So={createNewGuid:()=>{throw v(Q)},base64Decode:()=>{throw v(Q)},base64Encode:()=>{throw v(Q)},base64UrlEncode:()=>{throw v(Q)},encodeKid:()=>{throw v(Q)},async getPublicKeyThumbprint(){throw v(Q)},async removeTokenBindingKey(){throw v(Q)},async clearKeystore(){throw v(Q)},async signJwt(){throw v(Q)},async hashString(){throw v(Q)}};var ve;(function(r){r[r.Error=0]="Error",r[r.Warning=1]="Warning",r[r.Info=2]="Info",r[r.Verbose=3]="Verbose",r[r.Trace=4]="Trace"})(ve||(ve={}));var It=class r{constructor(e,t,n){this.level=ve.Info;let i=()=>{},o=e||r.createDefaultLoggerOptions();this.localCallback=o.loggerCallback||i,this.piiLoggingEnabled=o.piiLoggingEnabled||!1,this.level=typeof o.logLevel=="number"?o.logLevel:ve.Info,this.correlationId=o.correlationId||E.EMPTY_STRING,this.packageName=t||E.EMPTY_STRING,this.packageVersion=n||E.EMPTY_STRING}static createDefaultLoggerOptions(){return{loggerCallback:()=>{},piiLoggingEnabled:!1,logLevel:ve.Info}}clone(e,t,n){return new r({loggerCallback:this.localCallback,piiLoggingEnabled:this.piiLoggingEnabled,logLevel:this.level,correlationId:n||this.correlationId},e,t)}logMessage(e,t){if(t.logLevel>this.level||!this.piiLoggingEnabled&&t.containsPii)return;let o=`${`[${new Date().toUTCString()}] : [${t.correlationId||this.correlationId||""}]`} : ${this.packageName}@${this.packageVersion} : ${ve[t.logLevel]} - ${e}`;this.executeCallback(t.logLevel,o,t.containsPii||!1)}executeCallback(e,t,n){this.localCallback&&this.localCallback(e,t,n)}error(e,t){this.logMessage(e,{logLevel:ve.Error,containsPii:!1,correlationId:t||E.EMPTY_STRING})}errorPii(e,t){this.logMessage(e,{logLevel:ve.Error,containsPii:!0,correlationId:t||E.EMPTY_STRING})}warning(e,t){this.logMessage(e,{logLevel:ve.Warning,containsPii:!1,correlationId:t||E.EMPTY_STRING})}warningPii(e,t){this.logMessage(e,{logLevel:ve.Warning,containsPii:!0,correlationId:t||E.EMPTY_STRING})}info(e,t){this.logMessage(e,{logLevel:ve.Info,containsPii:!1,correlationId:t||E.EMPTY_STRING})}infoPii(e,t){this.logMessage(e,{logLevel:ve.Info,containsPii:!0,correlationId:t||E.EMPTY_STRING})}verbose(e,t){this.logMessage(e,{logLevel:ve.Verbose,containsPii:!1,correlationId:t||E.EMPTY_STRING})}verbosePii(e,t){this.logMessage(e,{logLevel:ve.Verbose,containsPii:!0,correlationId:t||E.EMPTY_STRING})}trace(e,t){this.logMessage(e,{logLevel:ve.Trace,containsPii:!1,correlationId:t||E.EMPTY_STRING})}tracePii(e,t){this.logMessage(e,{logLevel:ve.Trace,containsPii:!0,correlationId:t||E.EMPTY_STRING})}isPiiLoggingEnabled(){return this.piiLoggingEnabled||!1}};var gu="@azure/msal-common",wo="15.5.1";var Lr={None:"none",AzurePublic:"https://login.microsoftonline.com",AzurePpe:"https://login.windows-ppe.net",AzureChina:"https://login.chinacloudapi.cn",AzureGermany:"https://login.microsoftonline.de",AzureUsGovernment:"https://login.microsoftonline.us"};var Ne={};ze(Ne,{createAccessTokenEntity:()=>Lh,createIdTokenEntity:()=>Dh,createRefreshTokenEntity:()=>Uh,generateAppMetadataKey:()=>Bx,generateAuthorityMetadataExpiresAt:()=>Tu,generateCredentialKey:()=>Ws,isAccessTokenEntity:()=>Nx,isAppMetadataEntity:()=>zx,isAuthorityMetadataEntity:()=>Gx,isAuthorityMetadataExpired:()=>vu,isCredentialEntity:()=>Eu,isIdTokenEntity:()=>Mx,isRefreshTokenEntity:()=>Dx,isServerTelemetryEntity:()=>qx,isThrottlingEntity:()=>jx,updateAuthorityEndpointMetadata:()=>Io,updateCloudDiscoveryMetadata:()=>Zs});var yu={};ze(yu,{checkMaxAge:()=>Ks,extractTokenClaims:()=>Ur,getJWSPayload:()=>Cv});function Ur(r,e){let t=Cv(r);try{let n=e(t);return JSON.parse(n)}catch{throw v(rn)}}function Cv(r){if(!r)throw v(Xn);let t=/^([^\.\s]*)\.([^\.\s]+)\.([^\.\s]*)$/.exec(r);if(!t||t.length<4)throw v(rn);return t[2]}function Ks(r,e){if(e===0||Date.now()-3e5>r+e)throw v(ni)}var he={};ze(he,{delay:()=>Px,isTokenExpired:()=>Ro,nowSeconds:()=>bt,toDateFromSeconds:()=>Ys,toSecondsFromDate:()=>xx,wasClockTurnedBack:()=>Mh});function bt(){return Math.round(new Date().getTime()/1e3)}function xx(r){return r.getTime()/1e3}function Ys(r){return r?new Date(Number(r)*1e3):new Date}function Ro(r,e){let t=Number(r)||0;return bt()+e>t}function Mh(r){return Number(r)>bt()}function Px(r,e){return new Promise(t=>setTimeout(()=>t(e),r))}function Ws(r){return[Lx(r),Ux(r),Hx(r),Fx(r),$x(r)].join(Ae.CACHE_KEY_SEPARATOR).toLowerCase()}function Dh(r,e,t,n,i){return{credentialType:se.ID_TOKEN,homeAccountId:r,environment:e,clientId:n,secret:t,realm:i}}function Lh(r,e,t,n,i,o,s,a,c,l,u,d,h,p,m){let y={homeAccountId:r,credentialType:se.ACCESS_TOKEN,secret:t,cachedAt:bt().toString(),expiresOn:s.toString(),extendedExpiresOn:a.toString(),environment:e,clientId:n,realm:i,target:o,tokenType:u||te.BEARER};if(d&&(y.userAssertionHash=d),l&&(y.refreshOn=l.toString()),p&&(y.requestedClaims=p,y.requestedClaimsHash=m),y.tokenType?.toLowerCase()!==te.BEARER.toLowerCase())switch(y.credentialType=se.ACCESS_TOKEN_WITH_AUTH_SCHEME,y.tokenType){case te.POP:let A=Ur(t,c);if(!A?.cnf?.kid)throw v(li);y.keyId=A.cnf.kid;break;case te.SSH:y.keyId=h}return y}function Uh(r,e,t,n,i,o,s){let a={credentialType:se.REFRESH_TOKEN,homeAccountId:r,environment:e,clientId:n,secret:t};return o&&(a.userAssertionHash=o),i&&(a.familyId=i),s&&(a.expiresOn=s.toString()),a}function Eu(r){return r.hasOwnProperty("homeAccountId")&&r.hasOwnProperty("environment")&&r.hasOwnProperty("credentialType")&&r.hasOwnProperty("clientId")&&r.hasOwnProperty("secret")}function Nx(r){return r?Eu(r)&&r.hasOwnProperty("realm")&&r.hasOwnProperty("target")&&(r.credentialType===se.ACCESS_TOKEN||r.credentialType===se.ACCESS_TOKEN_WITH_AUTH_SCHEME):!1}function Mx(r){return r?Eu(r)&&r.hasOwnProperty("realm")&&r.credentialType===se.ID_TOKEN:!1}function Dx(r){return r?Eu(r)&&r.credentialType===se.REFRESH_TOKEN:!1}function Lx(r){return[r.homeAccountId,r.environment].join(Ae.CACHE_KEY_SEPARATOR).toLowerCase()}function Ux(r){let e=r.credentialType===se.REFRESH_TOKEN&&r.familyId||r.clientId;return[r.credentialType,e,r.realm||""].join(Ae.CACHE_KEY_SEPARATOR).toLowerCase()}function Hx(r){return(r.target||"").toLowerCase()}function Fx(r){return(r.requestedClaimsHash||"").toLowerCase()}function $x(r){return r.tokenType&&r.tokenType.toLowerCase()!==te.BEARER.toLowerCase()?r.tokenType.toLowerCase():""}function qx(r,e){let t=r.indexOf(Pe.CACHE_KEY)===0,n=!0;return e&&(n=e.hasOwnProperty("failedRequests")&&e.hasOwnProperty("errors")&&e.hasOwnProperty("cacheHits")),t&&n}function jx(r,e){let t=!1;r&&(t=r.indexOf(fr.THROTTLING_PREFIX)===0);let n=!0;return e&&(n=e.hasOwnProperty("throttleTime")),t&&n}function Bx({environment:r,clientId:e}){return[Is,r,e].join(Ae.CACHE_KEY_SEPARATOR).toLowerCase()}function zx(r,e){return e?r.indexOf(Is)===0&&e.hasOwnProperty("clientId")&&e.hasOwnProperty("environment"):!1}function Gx(r,e){return e?r.indexOf(Co.CACHE_KEY)===0&&e.hasOwnProperty("aliases")&&e.hasOwnProperty("preferred_cache")&&e.hasOwnProperty("preferred_network")&&e.hasOwnProperty("canonical_authority")&&e.hasOwnProperty("authorization_endpoint")&&e.hasOwnProperty("token_endpoint")&&e.hasOwnProperty("issuer")&&e.hasOwnProperty("aliasesFromNetwork")&&e.hasOwnProperty("endpointsFromNetwork")&&e.hasOwnProperty("expiresAt")&&e.hasOwnProperty("jwks_uri"):!1}function Tu(){return bt()+Co.REFRESH_TIME_SECONDS}function Io(r,e,t){r.authorization_endpoint=e.authorization_endpoint,r.token_endpoint=e.token_endpoint,r.end_session_endpoint=e.end_session_endpoint,r.issuer=e.issuer,r.endpointsFromNetwork=t,r.jwks_uri=e.jwks_uri}function Zs(r,e,t){r.aliases=e.aliases,r.preferred_cache=e.preferred_cache,r.preferred_network=e.preferred_network,r.aliasesFromNetwork=t}function vu(r){return r.expiresAt<=bt()}var bo={};ze(bo,{authorityMismatch:()=>na,authorityUriInsecure:()=>mi,cannotAllowPlatformBroker:()=>ra,cannotSetOIDCOptions:()=>ta,claimsRequestParsingError:()=>Xs,emptyInputScopesError:()=>yi,invalidAuthenticationHeader:()=>ea,invalidAuthorityMetadata:()=>_i,invalidClaims:()=>pr,invalidCloudDiscoveryMetadata:()=>cn,invalidCodeChallengeMethod:()=>Ci,invalidPromptValue:()=>Ei,logoutRequestEmpty:()=>vi,missingNonceAuthenticationHeader:()=>Js,missingSshJwk:()=>Fr,missingSshKid:()=>Qs,pkceParamsMissing:()=>Hr,redirectUriEmpty:()=>pi,tokenRequestEmpty:()=>Ti,untrustedAuthority:()=>Ai,urlEmptyError:()=>gi,urlParseError:()=>hr});var pi="redirect_uri_empty",Xs="claims_request_parsing_error",mi="authority_uri_insecure",hr="url_parse_error",gi="empty_url_error",yi="empty_input_scopes_error",Ei="invalid_prompt_value",pr="invalid_claims",Ti="token_request_empty",vi="logout_request_empty",Ci="invalid_code_challenge_method",Hr="pkce_params_missing",cn="invalid_cloud_discovery_metadata",_i="invalid_authority_metadata",Ai="untrusted_authority",Fr="missing_ssh_jwk",Qs="missing_ssh_kid",Js="missing_nonce_authentication_header",ea="invalid_authentication_header",ta="cannot_set_OIDCOptions",ra="cannot_allow_platform_broker",na="authority_mismatch";var Ce={[pi]:"A redirect URI is required for all calls, and none has been set.",[Xs]:"Could not parse the given claims request object.",[mi]:"Authority URIs must use https.  Please see here for valid authority configuration options: https://docs.microsoft.com/en-us/azure/active-directory/develop/msal-js-initializing-client-applications#configuration-options",[hr]:"URL could not be parsed into appropriate segments.",[gi]:"URL was empty or null.",[yi]:"Scopes cannot be passed as null, undefined or empty array because they are required to obtain an access token.",[Ei]:"Please see here for valid configuration options: https://azuread.github.io/microsoft-authentication-library-for-js/ref/modules/_azure_msal_common.html#commonauthorizationurlrequest",[pr]:"Given claims parameter must be a stringified JSON object.",[Ti]:"Token request was empty and not found in cache.",[vi]:"The logout request was null or undefined.",[Ci]:'code_challenge_method passed is invalid. Valid values are "plain" and "S256".',[Hr]:"Both params: code_challenge and code_challenge_method are to be passed if to be sent in the request",[cn]:"Invalid cloudDiscoveryMetadata provided. Must be a stringified JSON object containing tenant_discovery_endpoint and metadata fields",[_i]:"Invalid authorityMetadata provided. Must by a stringified JSON object containing authorization_endpoint, token_endpoint, issuer fields.",[Ai]:"The provided authority is not a trusted authority. Please include this authority in the knownAuthorities config parameter.",[Fr]:"Missing sshJwk in SSH certificate request. A stringified JSON Web Key is required when using the SSH authentication scheme.",[Qs]:"Missing sshKid in SSH certificate request. A string that uniquely identifies the public SSH key is required when using the SSH authentication scheme.",[Js]:"Unable to find an authentication header containing server nonce. Either the Authentication-Info or WWW-Authenticate headers must be present in order to obtain a server nonce.",[ea]:"Invalid authentication header provided",[ta]:"Cannot set OIDCOptions parameter. Please change the protocol mode to OIDC or use a non-Microsoft authority.",[ra]:"Cannot set allowPlatformBroker parameter to true when not in AAD protocol mode.",[na]:"Authority mismatch error. Authority provided in login request or PublicClientApplication config does not match the environment of the provided account. Please use a matching account or make an interactive request to login to this authority."},Hh={redirectUriNotSet:{code:pi,desc:Ce[pi]},claimsRequestParsingError:{code:Xs,desc:Ce[Xs]},authorityUriInsecure:{code:mi,desc:Ce[mi]},urlParseError:{code:hr,desc:Ce[hr]},urlEmptyError:{code:gi,desc:Ce[gi]},emptyScopesError:{code:yi,desc:Ce[yi]},invalidPrompt:{code:Ei,desc:Ce[Ei]},invalidClaimsRequest:{code:pr,desc:Ce[pr]},tokenRequestEmptyError:{code:Ti,desc:Ce[Ti]},logoutRequestEmptyError:{code:vi,desc:Ce[vi]},invalidCodeChallengeMethod:{code:Ci,desc:Ce[Ci]},invalidCodeChallengeParams:{code:Hr,desc:Ce[Hr]},invalidCloudDiscoveryMetadata:{code:cn,desc:Ce[cn]},invalidAuthorityMetadata:{code:_i,desc:Ce[_i]},untrustedAuthority:{code:Ai,desc:Ce[Ai]},missingSshJwk:{code:Fr,desc:Ce[Fr]},missingSshKid:{code:Qs,desc:Ce[Qs]},missingNonceAuthenticationHeader:{code:Js,desc:Ce[Js]},invalidAuthenticationHeader:{code:ea,desc:Ce[ea]},cannotSetOIDCOptions:{code:ta,desc:Ce[ta]},cannotAllowPlatformBroker:{code:ra,desc:Ce[ra]},authorityMismatch:{code:na,desc:Ce[na]}},Oo=class r extends Z{constructor(e){super(e,Ce[e]),this.name="ClientConfigurationError",Object.setPrototypeOf(this,r.prototype)}};function ae(r){return new Oo(r)}var ye=class{static isEmptyObj(e){if(e)try{let t=JSON.parse(e);return Object.keys(t).length===0}catch{}return!0}static startsWith(e,t){return e.indexOf(t)===0}static endsWith(e,t){return e.length>=t.length&&e.lastIndexOf(t)===e.length-t.length}static queryStringToObject(e){let t={},n=e.split("&"),i=o=>decodeURIComponent(o.replace(/\+/g," "));return n.forEach(o=>{if(o.trim()){let[s,a]=o.split(/=(.+)/g,2);s&&a&&(t[i(s)]=i(a))}}),t}static trimArrayEntries(e){return e.map(t=>t.trim())}static removeEmptyStringsFromArray(e){return e.filter(t=>!!t)}static jsonParseHelper(e){try{return JSON.parse(e)}catch{return null}}static matchPattern(e,t){return new RegExp(e.replace(/\\/g,"\\\\").replace(/\*/g,"[^ ]*").replace(/\?/g,"\\?")).test(t)}};var ke=class r{constructor(e){let t=e?ye.trimArrayEntries([...e]):[],n=t?ye.removeEmptyStringsFromArray(t):[];if(!n||!n.length)throw ae(yi);this.scopes=new Set,n.forEach(i=>this.scopes.add(i))}static fromString(e){let n=(e||E.EMPTY_STRING).split(" ");return new r(n)}static createSearchScopes(e){let t=new r(e);return t.containsOnlyOIDCScopes()?t.removeScope(E.OFFLINE_ACCESS_SCOPE):t.removeOIDCScopes(),t}containsScope(e){let t=this.printScopesLowerCase().split(" "),n=new r(t);return e?n.scopes.has(e.toLowerCase()):!1}containsScopeSet(e){return!e||e.scopes.size<=0?!1:this.scopes.size>=e.scopes.size&&e.asArray().every(t=>this.containsScope(t))}containsOnlyOIDCScopes(){let e=0;return kh.forEach(t=>{this.containsScope(t)&&(e+=1)}),this.scopes.size===e}appendScope(e){e&&this.scopes.add(e.trim())}appendScopes(e){try{e.forEach(t=>this.appendScope(t))}catch{throw v(ai)}}removeScope(e){if(!e)throw v(si);this.scopes.delete(e.trim())}removeOIDCScopes(){kh.forEach(e=>{this.scopes.delete(e)})}unionScopeSets(e){if(!e)throw v(on);let t=new Set;return e.scopes.forEach(n=>t.add(n.toLowerCase())),this.scopes.forEach(n=>t.add(n.toLowerCase())),t}intersectingScopeSets(e){if(!e)throw v(on);e.containsOnlyOIDCScopes()||e.removeOIDCScopes();let t=this.unionScopeSets(e),n=e.getScopeCount(),i=this.getScopeCount();return t.size<i+n}getScopeCount(){return this.scopes.size}asArray(){let e=[];return this.scopes.forEach(t=>e.push(t)),e}printScopes(){return this.scopes?this.asArray().join(" "):E.EMPTY_STRING}printScopesLowerCase(){return this.printScopes().toLowerCase()}};function ko(r,e){if(!r)throw v(Zn);try{let t=e(r);return JSON.parse(t)}catch{throw v(tn)}}function mr(r){if(!r)throw v(tn);let e=r.split(Ae.CLIENT_INFO_SEPARATOR,2);return{uid:e[0],utid:e.length<2?E.EMPTY_STRING:e[1]}}function _v(r,e){return!!r&&!!e&&r===e.split(".")[1]}function ia(r,e,t,n){if(n){let{oid:i,sub:o,tid:s,name:a,tfp:c,acr:l}=n,u=s||c||l||"";return{tenantId:u,localAccountId:i||o||"",name:a,isHomeTenant:_v(u,r)}}else return{tenantId:t,localAccountId:e,isHomeTenant:_v(t,r)}}function Cu(r,e,t,n){let i=r;if(e){let{isHomeTenant:o,...s}=e;i={...r,...s}}if(t){let{isHomeTenant:o,...s}=ia(r.homeAccountId,r.localAccountId,r.tenantId,t);return i={...i,...s,idTokenClaims:t,idToken:n},i}return i}var Ht={Default:0,Adfs:1,Dsts:2,Ciam:3};function _u(r){return r&&(r.tid||r.tfp||r.acr)||null}var Ve={AAD:"AAD",OIDC:"OIDC",EAR:"EAR"};var $e=class r{generateAccountId(){return[this.homeAccountId,this.environment].join(Ae.CACHE_KEY_SEPARATOR).toLowerCase()}generateAccountKey(){return r.generateAccountCacheKey({homeAccountId:this.homeAccountId,environment:this.environment,tenantId:this.realm,username:this.username,localAccountId:this.localAccountId})}getAccountInfo(){return{homeAccountId:this.homeAccountId,environment:this.environment,tenantId:this.realm,username:this.username,localAccountId:this.localAccountId,name:this.name,nativeAccountId:this.nativeAccountId,authorityType:this.authorityType,tenantProfiles:new Map((this.tenantProfiles||[]).map(e=>[e.tenantId,e]))}}isSingleTenant(){return!this.tenantProfiles}static generateAccountCacheKey(e){let t=e.homeAccountId.split(".")[1];return[e.homeAccountId,e.environment||"",t||e.tenantId||""].join(Ae.CACHE_KEY_SEPARATOR).toLowerCase()}static createAccount(e,t,n){let i=new r;t.authorityType===Ht.Adfs?i.authorityType=Yn.ADFS_ACCOUNT_TYPE:t.protocolMode===Ve.OIDC?i.authorityType=Yn.GENERIC_ACCOUNT_TYPE:i.authorityType=Yn.MSSTS_ACCOUNT_TYPE;let o;e.clientInfo&&n&&(o=ko(e.clientInfo,n)),i.clientInfo=e.clientInfo,i.homeAccountId=e.homeAccountId,i.nativeAccountId=e.nativeAccountId;let s=e.environment||t&&t.getPreferredCache();if(!s)throw v(Mr);i.environment=s,i.realm=o?.utid||_u(e.idTokenClaims)||"",i.localAccountId=o?.uid||e.idTokenClaims?.oid||e.idTokenClaims?.sub||"";let a=e.idTokenClaims?.preferred_username||e.idTokenClaims?.upn,c=e.idTokenClaims?.emails?e.idTokenClaims.emails[0]:null;if(i.username=a||c||"",i.name=e.idTokenClaims?.name||"",i.cloudGraphHostName=e.cloudGraphHostName,i.msGraphHost=e.msGraphHost,e.tenantProfiles)i.tenantProfiles=e.tenantProfiles;else{let l=ia(e.homeAccountId,i.localAccountId,i.realm,e.idTokenClaims);i.tenantProfiles=[l]}return i}static createFromAccountInfo(e,t,n){let i=new r;return i.authorityType=e.authorityType||Yn.GENERIC_ACCOUNT_TYPE,i.homeAccountId=e.homeAccountId,i.localAccountId=e.localAccountId,i.nativeAccountId=e.nativeAccountId,i.realm=e.tenantId,i.environment=e.environment,i.username=e.username,i.name=e.name,i.cloudGraphHostName=t,i.msGraphHost=n,i.tenantProfiles=Array.from(e.tenantProfiles?.values()||[]),i}static generateHomeAccountId(e,t,n,i,o){if(!(t===Ht.Adfs||t===Ht.Dsts)){if(e)try{let s=ko(e,i.base64Decode);if(s.uid&&s.utid)return`${s.uid}.${s.utid}`}catch{}n.warning("No client info in response")}return o?.sub||""}static isAccountEntity(e){return e?e.hasOwnProperty("homeAccountId")&&e.hasOwnProperty("environment")&&e.hasOwnProperty("realm")&&e.hasOwnProperty("localAccountId")&&e.hasOwnProperty("username")&&e.hasOwnProperty("authorityType"):!1}static accountInfoIsEqual(e,t,n){if(!e||!t)return!1;let i=!0;if(n){let o=e.idTokenClaims||{},s=t.idTokenClaims||{};i=o.iat===s.iat&&o.nonce===s.nonce}return e.homeAccountId===t.homeAccountId&&e.localAccountId===t.localAccountId&&e.username===t.username&&e.tenantId===t.tenantId&&e.environment===t.environment&&e.nativeAccountId===t.nativeAccountId&&i}};var qe={};ze(qe,{getDeserializedResponse:()=>Fh,mapToQueryString:()=>gr,stripLeadingHashOrQuery:()=>Av});function Av(r){return r.startsWith("#/")?r.substring(2):r.startsWith("#")||r.startsWith("?")?r.substring(1):r}function Fh(r){if(!r||r.indexOf("=")<0)return null;try{let e=Av(r),t=Object.fromEntries(new URLSearchParams(e));if(t.code||t.ear_jwe||t.error||t.error_description||t.state)return t}catch{throw v(ei)}return null}function gr(r,e=!0,t){let n=new Array;return r.forEach((i,o)=>{!e&&t&&o in t?n.push(`${o}=${i}`):n.push(`${o}=${encodeURIComponent(i)}`)}),n.join("&")}var J=class r{get urlString(){return this._urlString}constructor(e){if(this._urlString=e,!this._urlString)throw ae(gi);e.includes("#")||(this._urlString=r.canonicalizeUri(e))}static canonicalizeUri(e){if(e){let t=e.toLowerCase();return ye.endsWith(t,"?")?t=t.slice(0,-1):ye.endsWith(t,"?/")&&(t=t.slice(0,-2)),ye.endsWith(t,"/")||(t+="/"),t}return e}validateAsUri(){let e;try{e=this.getUrlComponents()}catch{throw ae(hr)}if(!e.HostNameAndPort||!e.PathSegments)throw ae(hr);if(!e.Protocol||e.Protocol.toLowerCase()!=="https:")throw ae(mi)}static appendQueryString(e,t){return t?e.indexOf("?")<0?`${e}?${t}`:`${e}&${t}`:e}static removeHashFromUrl(e){return r.canonicalizeUri(e.split("#")[0])}replaceTenantPath(e){let t=this.getUrlComponents(),n=t.PathSegments;return e&&n.length!==0&&(n[0]===dt.COMMON||n[0]===dt.ORGANIZATIONS)&&(n[0]=e),r.constructAuthorityUriFromObject(t)}getUrlComponents(){let e=RegExp("^(([^:/?#]+):)?(//([^/?#]*))?([^?#]*)(\\?([^#]*))?(#(.*))?"),t=this.urlString.match(e);if(!t)throw ae(hr);let n={Protocol:t[1],HostNameAndPort:t[4],AbsolutePath:t[5],QueryString:t[7]},i=n.AbsolutePath.split("/");return i=i.filter(o=>o&&o.length>0),n.PathSegments=i,n.QueryString&&n.QueryString.endsWith("/")&&(n.QueryString=n.QueryString.substring(0,n.QueryString.length-1)),n}static getDomainFromUrl(e){let t=RegExp("^([^:/?#]+://)?([^/?#]*)"),n=e.match(t);if(!n)throw ae(hr);return n[2]}static getAbsoluteUrl(e,t){if(e[0]===E.FORWARD_SLASH){let i=new r(t).getUrlComponents();return i.Protocol+"//"+i.HostNameAndPort+e}return e}static constructAuthorityUriFromObject(e){return new r(e.Protocol+"//"+e.HostNameAndPort+"/"+e.PathSegments.join("/"))}static hashContainsKnownProperties(e){return!!Fh(e)}};var wv={endpointMetadata:{"login.microsoftonline.com":{token_endpoint:"https://login.microsoftonline.com/{tenantid}/oauth2/v2.0/token",jwks_uri:"https://login.microsoftonline.com/{tenantid}/discovery/v2.0/keys",issuer:"https://login.microsoftonline.com/{tenantid}/v2.0",authorization_endpoint:"https://login.microsoftonline.com/{tenantid}/oauth2/v2.0/authorize",end_session_endpoint:"https://login.microsoftonline.com/{tenantid}/oauth2/v2.0/logout"},"login.chinacloudapi.cn":{token_endpoint:"https://login.chinacloudapi.cn/{tenantid}/oauth2/v2.0/token",jwks_uri:"https://login.chinacloudapi.cn/{tenantid}/discovery/v2.0/keys",issuer:"https://login.partner.microsoftonline.cn/{tenantid}/v2.0",authorization_endpoint:"https://login.chinacloudapi.cn/{tenantid}/oauth2/v2.0/authorize",end_session_endpoint:"https://login.chinacloudapi.cn/{tenantid}/oauth2/v2.0/logout"},"login.microsoftonline.us":{token_endpoint:"https://login.microsoftonline.us/{tenantid}/oauth2/v2.0/token",jwks_uri:"https://login.microsoftonline.us/{tenantid}/discovery/v2.0/keys",issuer:"https://login.microsoftonline.us/{tenantid}/v2.0",authorization_endpoint:"https://login.microsoftonline.us/{tenantid}/oauth2/v2.0/authorize",end_session_endpoint:"https://login.microsoftonline.us/{tenantid}/oauth2/v2.0/logout"}},instanceDiscoveryMetadata:{tenant_discovery_endpoint:"https://{canonicalAuthority}/v2.0/.well-known/openid-configuration",metadata:[{preferred_network:"login.microsoftonline.com",preferred_cache:"login.windows.net",aliases:["login.microsoftonline.com","login.windows.net","login.microsoft.com","sts.windows.net"]},{preferred_network:"login.partner.microsoftonline.cn",preferred_cache:"login.partner.microsoftonline.cn",aliases:["login.partner.microsoftonline.cn","login.chinacloudapi.cn"]},{preferred_network:"login.microsoftonline.de",preferred_cache:"login.microsoftonline.de",aliases:["login.microsoftonline.de"]},{preferred_network:"login.microsoftonline.us",preferred_cache:"login.microsoftonline.us",aliases:["login.microsoftonline.us","login.usgovcloudapi.net"]},{preferred_network:"login-us.microsoftonline.com",preferred_cache:"login-us.microsoftonline.com",aliases:["login-us.microsoftonline.com"]}]}},$h=wv.endpointMetadata,qh=wv.instanceDiscoveryMetadata,jh=new Set;qh.metadata.forEach(r=>{r.aliases.forEach(e=>{jh.add(e)})});function Rv(r,e){let t,n=r.canonicalAuthority;if(n){let i=new J(n).getUrlComponents().HostNameAndPort;t=Sv(i,r.cloudDiscoveryMetadata?.metadata,Ze.CONFIG,e)||Sv(i,qh.metadata,Ze.HARDCODED_VALUES,e)||r.knownAuthorities}return t||[]}function Sv(r,e,t,n){if(n?.trace(`getAliasesFromMetadata called with source: ${t}`),r&&e){let i=oa(e,r);if(i)return n?.trace(`getAliasesFromMetadata: found cloud discovery metadata in ${t}, returning aliases`),i.aliases;n?.trace(`getAliasesFromMetadata: did not find cloud discovery metadata in ${t}`)}return null}function Iv(r){return oa(qh.metadata,r)}function oa(r,e){for(let t=0;t<r.length;t++){let n=r[t];if(n.aliases.includes(e))return n}return null}var Au="cache_quota_exceeded",sa="cache_error_unknown";var Bh={[Au]:"Exceeded cache storage capacity.",[sa]:"Unexpected error occurred when using cache storage."},xo=class r extends Error{constructor(e,t){let n=t||(Bh[e]?Bh[e]:Bh[sa]);super(`${e}: ${n}`),Object.setPrototypeOf(this,r.prototype),this.name="CacheError",this.errorCode=e,this.errorMessage=n}};var ln=class{constructor(e,t,n,i){this.clientId=e,this.cryptoImpl=t,this.commonLogger=n.clone(gu,wo),this.staticAuthorityOptions=i}getAllAccounts(e){return this.buildTenantProfiles(this.getAccountsFilteredBy(e||{}),e)}getAccountInfoFilteredBy(e){let t=this.getAllAccounts(e);return t.length>1?t.sort(i=>i.idTokenClaims?-1:1)[0]:t.length===1?t[0]:null}getBaseAccountInfo(e){let t=this.getAccountsFilteredBy(e);return t.length>0?t[0].getAccountInfo():null}buildTenantProfiles(e,t){return e.flatMap(n=>this.getTenantProfilesFromAccountEntity(n,t?.tenantId,t))}getTenantedAccountInfoByFilter(e,t,n,i){let o=null,s;if(i&&!this.tenantProfileMatchesFilter(n,i))return null;let a=this.getIdToken(e,t,n.tenantId);return a&&(s=Ur(a.secret,this.cryptoImpl.base64Decode),!this.idTokenClaimsMatchTenantProfileFilter(s,i))?null:(o=Cu(e,n,s,a?.secret),o)}getTenantProfilesFromAccountEntity(e,t,n){let i=e.getAccountInfo(),o=i.tenantProfiles||new Map,s=this.getTokenKeys();if(t){let c=o.get(t);if(c)o=new Map([[t,c]]);else return[]}let a=[];return o.forEach(c=>{let l=this.getTenantedAccountInfoByFilter(i,s,c,n);l&&a.push(l)}),a}tenantProfileMatchesFilter(e,t){return!(t.localAccountId&&!this.matchLocalAccountIdFromTenantProfile(e,t.localAccountId)||t.name&&e.name!==t.name||t.isHomeTenant!==void 0&&e.isHomeTenant!==t.isHomeTenant)}idTokenClaimsMatchTenantProfileFilter(e,t){return!(t&&(t.localAccountId&&!this.matchLocalAccountIdFromTokenClaims(e,t.localAccountId)||t.loginHint&&!this.matchLoginHintFromTokenClaims(e,t.loginHint)||t.username&&!this.matchUsername(e.preferred_username,t.username)||t.name&&!this.matchName(e,t.name)||t.sid&&!this.matchSid(e,t.sid)))}async saveCacheRecord(e,t,n){if(!e)throw v(ci);try{e.account&&await this.setAccount(e.account,t),e.idToken&&n?.idToken!==!1&&await this.setIdTokenCredential(e.idToken,t),e.accessToken&&n?.accessToken!==!1&&await this.saveAccessToken(e.accessToken,t),e.refreshToken&&n?.refreshToken!==!1&&await this.setRefreshTokenCredential(e.refreshToken,t),e.appMetadata&&this.setAppMetadata(e.appMetadata)}catch(i){throw this.commonLogger?.error("CacheManager.saveCacheRecord: failed"),i instanceof Error?(this.commonLogger?.errorPii(`CacheManager.saveCacheRecord: ${i.message}`,t),i.name==="QuotaExceededError"||i.name==="NS_ERROR_DOM_QUOTA_REACHED"||i.message.includes("exceeded the quota")?(this.commonLogger?.error("CacheManager.saveCacheRecord: exceeded storage quota",t),new xo(Au)):new xo(i.name,i.message)):(this.commonLogger?.errorPii(`CacheManager.saveCacheRecord: ${i}`,t),new xo(sa))}}async saveAccessToken(e,t){let n={clientId:e.clientId,credentialType:e.credentialType,environment:e.environment,homeAccountId:e.homeAccountId,realm:e.realm,tokenType:e.tokenType,requestedClaimsHash:e.requestedClaimsHash},i=this.getTokenKeys(),o=ke.fromString(e.target),s=[];i.accessToken.forEach(a=>{if(!this.accessTokenKeyMatchesFilter(a,n,!1))return;let c=this.getAccessTokenCredential(a);c&&this.credentialMatchesFilter(c,n)&&ke.fromString(c.target).intersectingScopeSets(o)&&s.push(this.removeAccessToken(a))}),await Promise.all(s),await this.setAccessTokenCredential(e,t)}getAccountsFilteredBy(e){let t=this.getAccountKeys(),n=[];return t.forEach(i=>{if(!this.isAccountKey(i,e.homeAccountId))return;let o=this.getAccount(i,this.commonLogger);if(!o||e.homeAccountId&&!this.matchHomeAccountId(o,e.homeAccountId)||e.username&&!this.matchUsername(o.username,e.username)||e.environment&&!this.matchEnvironment(o,e.environment)||e.realm&&!this.matchRealm(o,e.realm)||e.nativeAccountId&&!this.matchNativeAccountId(o,e.nativeAccountId)||e.authorityType&&!this.matchAuthorityType(o,e.authorityType))return;let s={localAccountId:e?.localAccountId,name:e?.name},a=o.tenantProfiles?.filter(c=>this.tenantProfileMatchesFilter(c,s));a&&a.length===0||n.push(o)}),n}isAccountKey(e,t,n){return!(e.split(Ae.CACHE_KEY_SEPARATOR).length<3||t&&!e.toLowerCase().includes(t.toLowerCase())||n&&!e.toLowerCase().includes(n.toLowerCase()))}isCredentialKey(e){if(e.split(Ae.CACHE_KEY_SEPARATOR).length<6)return!1;let t=e.toLowerCase();if(t.indexOf(se.ID_TOKEN.toLowerCase())===-1&&t.indexOf(se.ACCESS_TOKEN.toLowerCase())===-1&&t.indexOf(se.ACCESS_TOKEN_WITH_AUTH_SCHEME.toLowerCase())===-1&&t.indexOf(se.REFRESH_TOKEN.toLowerCase())===-1)return!1;if(t.indexOf(se.REFRESH_TOKEN.toLowerCase())>-1){let n=`${se.REFRESH_TOKEN}${Ae.CACHE_KEY_SEPARATOR}${this.clientId}${Ae.CACHE_KEY_SEPARATOR}`,i=`${se.REFRESH_TOKEN}${Ae.CACHE_KEY_SEPARATOR}${xr}${Ae.CACHE_KEY_SEPARATOR}`;if(t.indexOf(n.toLowerCase())===-1&&t.indexOf(i.toLowerCase())===-1)return!1}else if(t.indexOf(this.clientId.toLowerCase())===-1)return!1;return!0}credentialMatchesFilter(e,t){return!(t.clientId&&!this.matchClientId(e,t.clientId)||t.userAssertionHash&&!this.matchUserAssertionHash(e,t.userAssertionHash)||typeof t.homeAccountId=="string"&&!this.matchHomeAccountId(e,t.homeAccountId)||t.environment&&!this.matchEnvironment(e,t.environment)||t.realm&&!this.matchRealm(e,t.realm)||t.credentialType&&!this.matchCredentialType(e,t.credentialType)||t.familyId&&!this.matchFamilyId(e,t.familyId)||t.target&&!this.matchTarget(e,t.target)||(t.requestedClaimsHash||e.requestedClaimsHash)&&e.requestedClaimsHash!==t.requestedClaimsHash||e.credentialType===se.ACCESS_TOKEN_WITH_AUTH_SCHEME&&(t.tokenType&&!this.matchTokenType(e,t.tokenType)||t.tokenType===te.SSH&&t.keyId&&!this.matchKeyId(e,t.keyId)))}getAppMetadataFilteredBy(e){let t=this.getKeys(),n={};return t.forEach(i=>{if(!this.isAppMetadata(i))return;let o=this.getAppMetadata(i);o&&(e.environment&&!this.matchEnvironment(o,e.environment)||e.clientId&&!this.matchClientId(o,e.clientId)||(n[i]=o))}),n}getAuthorityMetadataByAlias(e){let t=this.getAuthorityMetadataKeys(),n=null;return t.forEach(i=>{if(!this.isAuthorityMetadata(i)||i.indexOf(this.clientId)===-1)return;let o=this.getAuthorityMetadata(i);o&&o.aliases.indexOf(e)!==-1&&(n=o)}),n}async removeAllAccounts(){let e=this.getAccountKeys(),t=[];e.forEach(n=>{t.push(this.removeAccount(n))}),await Promise.all(t)}async removeAccount(e){let t=this.getAccount(e,this.commonLogger);t&&(await this.removeAccountContext(t),this.removeItem(e))}async removeAccountContext(e){let t=this.getTokenKeys(),n=e.generateAccountId(),i=[];t.idToken.forEach(o=>{o.indexOf(n)===0&&this.removeIdToken(o)}),t.accessToken.forEach(o=>{o.indexOf(n)===0&&i.push(this.removeAccessToken(o))}),t.refreshToken.forEach(o=>{o.indexOf(n)===0&&this.removeRefreshToken(o)}),await Promise.all(i)}async removeAccessToken(e){let t=this.getAccessTokenCredential(e);if(t){if(t.credentialType.toLowerCase()===se.ACCESS_TOKEN_WITH_AUTH_SCHEME.toLowerCase()&&t.tokenType===te.POP){let i=t.keyId;if(i)try{await this.cryptoImpl.removeTokenBindingKey(i)}catch{throw v(di)}}return this.removeItem(e)}}removeAppMetadata(){return this.getKeys().forEach(t=>{this.isAppMetadata(t)&&this.removeItem(t)}),!0}readAccountFromCache(e){let t=$e.generateAccountCacheKey(e);return this.getAccount(t,this.commonLogger)}getIdToken(e,t,n,i,o){this.commonLogger.trace("CacheManager - getIdToken called");let s={homeAccountId:e.homeAccountId,environment:e.environment,credentialType:se.ID_TOKEN,clientId:this.clientId,realm:n},a=this.getIdTokensByFilter(s,t),c=a.size;if(c<1)return this.commonLogger.info("CacheManager:getIdToken - No token found"),null;if(c>1){let l=a;if(!n){let u=new Map;a.forEach((h,p)=>{h.realm===e.tenantId&&u.set(p,h)});let d=u.size;if(d<1)return this.commonLogger.info("CacheManager:getIdToken - Multiple ID tokens found for account but none match account entity tenant id, returning first result"),a.values().next().value;if(d===1)return this.commonLogger.info("CacheManager:getIdToken - Multiple ID tokens found for account, defaulting to home tenant profile"),u.values().next().value;l=u}return this.commonLogger.info("CacheManager:getIdToken - Multiple matching ID tokens found, clearing them"),l.forEach((u,d)=>{this.removeIdToken(d)}),i&&o&&i.addFields({multiMatchedID:a.size},o),null}return this.commonLogger.info("CacheManager:getIdToken - Returning ID token"),a.values().next().value}getIdTokensByFilter(e,t){let n=t&&t.idToken||this.getTokenKeys().idToken,i=new Map;return n.forEach(o=>{if(!this.idTokenKeyMatchesFilter(o,{clientId:this.clientId,...e}))return;let s=this.getIdTokenCredential(o);s&&this.credentialMatchesFilter(s,e)&&i.set(o,s)}),i}idTokenKeyMatchesFilter(e,t){let n=e.toLowerCase();return!(t.clientId&&n.indexOf(t.clientId.toLowerCase())===-1||t.homeAccountId&&n.indexOf(t.homeAccountId.toLowerCase())===-1)}removeIdToken(e){this.removeItem(e)}removeRefreshToken(e){this.removeItem(e)}getAccessToken(e,t,n,i,o,s){this.commonLogger.trace("CacheManager - getAccessToken called");let a=ke.createSearchScopes(t.scopes),c=t.authenticationScheme||te.BEARER,l=c&&c.toLowerCase()!==te.BEARER.toLowerCase()?se.ACCESS_TOKEN_WITH_AUTH_SCHEME:se.ACCESS_TOKEN,u={homeAccountId:e.homeAccountId,environment:e.environment,credentialType:l,clientId:this.clientId,realm:i||e.tenantId,target:a,tokenType:c,keyId:t.sshKid,requestedClaimsHash:t.requestedClaimsHash},d=n&&n.accessToken||this.getTokenKeys().accessToken,h=[];d.forEach(m=>{if(this.accessTokenKeyMatchesFilter(m,u,!0)){let y=this.getAccessTokenCredential(m);y&&this.credentialMatchesFilter(y,u)&&h.push(y)}});let p=h.length;return p<1?(this.commonLogger.info("CacheManager:getAccessToken - No token found"),null):p>1?(this.commonLogger.info("CacheManager:getAccessToken - Multiple access tokens found, clearing them"),h.forEach(m=>{this.removeAccessToken(Ws(m))}),o&&s&&o.addFields({multiMatchedAT:h.length},s),null):(this.commonLogger.info("CacheManager:getAccessToken - Returning access token"),h[0])}accessTokenKeyMatchesFilter(e,t,n){let i=e.toLowerCase();if(t.clientId&&i.indexOf(t.clientId.toLowerCase())===-1||t.homeAccountId&&i.indexOf(t.homeAccountId.toLowerCase())===-1||t.realm&&i.indexOf(t.realm.toLowerCase())===-1||t.requestedClaimsHash&&i.indexOf(t.requestedClaimsHash.toLowerCase())===-1)return!1;if(t.target){let o=t.target.asArray();for(let s=0;s<o.length;s++){if(n&&!i.includes(o[s].toLowerCase()))return!1;if(!n&&i.includes(o[s].toLowerCase()))return!0}}return!0}getAccessTokensByFilter(e){let t=this.getTokenKeys(),n=[];return t.accessToken.forEach(i=>{if(!this.accessTokenKeyMatchesFilter(i,e,!0))return;let o=this.getAccessTokenCredential(i);o&&this.credentialMatchesFilter(o,e)&&n.push(o)}),n}getRefreshToken(e,t,n,i,o){this.commonLogger.trace("CacheManager - getRefreshToken called");let s=t?xr:void 0,a={homeAccountId:e.homeAccountId,environment:e.environment,credentialType:se.REFRESH_TOKEN,clientId:this.clientId,familyId:s},c=n&&n.refreshToken||this.getTokenKeys().refreshToken,l=[];c.forEach(d=>{if(this.refreshTokenKeyMatchesFilter(d,a)){let h=this.getRefreshTokenCredential(d);h&&this.credentialMatchesFilter(h,a)&&l.push(h)}});let u=l.length;return u<1?(this.commonLogger.info("CacheManager:getRefreshToken - No refresh token found."),null):(u>1&&i&&o&&i.addFields({multiMatchedRT:u},o),this.commonLogger.info("CacheManager:getRefreshToken - returning refresh token"),l[0])}refreshTokenKeyMatchesFilter(e,t){let n=e.toLowerCase();return!(t.familyId&&n.indexOf(t.familyId.toLowerCase())===-1||!t.familyId&&t.clientId&&n.indexOf(t.clientId.toLowerCase())===-1||t.homeAccountId&&n.indexOf(t.homeAccountId.toLowerCase())===-1)}readAppMetadataFromCache(e){let t={environment:e,clientId:this.clientId},n=this.getAppMetadataFilteredBy(t),i=Object.keys(n).map(s=>n[s]),o=i.length;if(o<1)return null;if(o>1)throw v(ii);return i[0]}isAppMetadataFOCI(e){let t=this.readAppMetadataFromCache(e);return!!(t&&t.familyId===xr)}matchHomeAccountId(e,t){return typeof e.homeAccountId=="string"&&t===e.homeAccountId}matchLocalAccountIdFromTokenClaims(e,t){let n=e.oid||e.sub;return t===n}matchLocalAccountIdFromTenantProfile(e,t){return e.localAccountId===t}matchName(e,t){return t.toLowerCase()===e.name?.toLowerCase()}matchUsername(e,t){return!!(e&&typeof e=="string"&&t?.toLowerCase()===e.toLowerCase())}matchUserAssertionHash(e,t){return!!(e.userAssertionHash&&t===e.userAssertionHash)}matchEnvironment(e,t){if(this.staticAuthorityOptions){let i=Rv(this.staticAuthorityOptions,this.commonLogger);if(i.includes(t)&&i.includes(e.environment))return!0}let n=this.getAuthorityMetadataByAlias(t);return!!(n&&n.aliases.indexOf(e.environment)>-1)}matchCredentialType(e,t){return e.credentialType&&t.toLowerCase()===e.credentialType.toLowerCase()}matchClientId(e,t){return!!(e.clientId&&t===e.clientId)}matchFamilyId(e,t){return!!(e.familyId&&t===e.familyId)}matchRealm(e,t){return e.realm?.toLowerCase()===t.toLowerCase()}matchNativeAccountId(e,t){return!!(e.nativeAccountId&&t===e.nativeAccountId)}matchLoginHintFromTokenClaims(e,t){return e.login_hint===t||e.preferred_username===t||e.upn===t}matchSid(e,t){return e.sid===t}matchAuthorityType(e,t){return!!(e.authorityType&&t.toLowerCase()===e.authorityType.toLowerCase())}matchTarget(e,t){return e.credentialType!==se.ACCESS_TOKEN&&e.credentialType!==se.ACCESS_TOKEN_WITH_AUTH_SCHEME||!e.target?!1:ke.fromString(e.target).containsScopeSet(t)}matchTokenType(e,t){return!!(e.tokenType&&e.tokenType===t)}matchKeyId(e,t){return!!(e.keyId&&e.keyId===t)}isAppMetadata(e){return e.indexOf(Is)!==-1}isAuthorityMetadata(e){return e.indexOf(Co.CACHE_KEY)!==-1}generateAuthorityMetadataCacheKey(e){return`${Co.CACHE_KEY}-${this.clientId}-${e}`}static toObject(e,t){for(let n in t)e[n]=t[n];return e}},aa=class extends ln{async setAccount(){throw v(Q)}getAccount(){throw v(Q)}async setIdTokenCredential(){throw v(Q)}getIdTokenCredential(){throw v(Q)}async setAccessTokenCredential(){throw v(Q)}getAccessTokenCredential(){throw v(Q)}async setRefreshTokenCredential(){throw v(Q)}getRefreshTokenCredential(){throw v(Q)}setAppMetadata(){throw v(Q)}getAppMetadata(){throw v(Q)}setServerTelemetry(){throw v(Q)}getServerTelemetry(){throw v(Q)}setAuthorityMetadata(){throw v(Q)}getAuthorityMetadata(){throw v(Q)}getAuthorityMetadataKeys(){throw v(Q)}setThrottlingCache(){throw v(Q)}getThrottlingCache(){throw v(Q)}removeItem(){throw v(Q)}getKeys(){throw v(Q)}getAccountKeys(){throw v(Q)}getTokenKeys(){throw v(Q)}};var Vx={tokenRenewalOffsetSeconds:_o,preventCorsPreflight:!1},Kx={loggerCallback:()=>{},piiLoggingEnabled:!1,logLevel:ve.Info,correlationId:E.EMPTY_STRING},Yx={claimsBasedCachingEnabled:!1},Wx={async sendGetRequestAsync(){throw v(Q)},async sendPostRequestAsync(){throw v(Q)}},Zx={sku:E.SKU,version:wo,cpu:E.EMPTY_STRING,os:E.EMPTY_STRING},Xx={clientSecret:E.EMPTY_STRING,clientAssertion:void 0},Qx={azureCloudInstance:Lr.None,tenant:`${E.DEFAULT_COMMON_TENANT}`},Jx={application:{appName:"",appVersion:""}};function bv({authOptions:r,systemOptions:e,loggerOptions:t,cacheOptions:n,storageInterface:i,networkInterface:o,cryptoInterface:s,clientCredentials:a,libraryInfo:c,telemetry:l,serverTelemetryManager:u,persistencePlugin:d,serializableCache:h}){let p={...Kx,...t};return{authOptions:eP(r),systemOptions:{...Vx,...e},loggerOptions:p,cacheOptions:{...Yx,...n},storageInterface:i||new aa(r.clientId,So,new It(p)),networkInterface:o||Wx,cryptoInterface:s||So,clientCredentials:a||Xx,libraryInfo:{...Zx,...c},telemetry:{...Jx,...l},serverTelemetryManager:u||null,persistencePlugin:d||null,serializableCache:h||null}}function eP(r){return{clientCapabilities:[],azureCloudOptions:Qx,skipAuthorityMetadataCache:!1,instanceAware:!1,encodeExtraQueryParams:!1,...r}}function Su(r){return r.authOptions.authority.options.protocolMode===Ve.OIDC}var Qe={HOME_ACCOUNT_ID:"home_account_id",UPN:"UPN"};var I={};ze(I,{addApplicationTelemetry:()=>ua,addAuthorizationCode:()=>Mp,addBrokerParameters:()=>jr,addCcsOid:()=>$r,addCcsUpn:()=>un,addClaims:()=>Oi,addClientAssertion:()=>ha,addClientAssertionType:()=>pa,addClientCapabilitiesToClaims:()=>Ov,addClientId:()=>Ii,addClientInfo:()=>xi,addClientSecret:()=>fa,addCodeChallengeParams:()=>mP,addCodeVerifier:()=>Lp,addCorrelationId:()=>ki,addDeviceCode:()=>gP,addDomainHint:()=>xp,addEARParameters:()=>CP,addExtraQueryParameters:()=>qr,addGrantType:()=>ma,addIdTokenHint:()=>kp,addInstanceAware:()=>ga,addLibraryInfo:()=>la,addLoginHint:()=>No,addLogoutHint:()=>Up,addNativeBroker:()=>pP,addNonce:()=>Np,addOboAssertion:()=>yP,addPassword:()=>vP,addPopToken:()=>ya,addPostLogoutRedirectUri:()=>Op,addPrompt:()=>Pp,addRedirectUri:()=>bi,addRefreshToken:()=>Dp,addRequestTokenUse:()=>EP,addResponseMode:()=>bp,addResponseType:()=>hP,addScopes:()=>Ri,addServerTelemetry:()=>Ta,addSid:()=>ku,addSshJwk:()=>Ea,addState:()=>da,addThrottling:()=>va,addUsername:()=>TP,instrumentBrokerParams:()=>wi});var Si={};ze(Si,{ACCESS_TOKEN:()=>nP,BROKER_CLIENT_ID:()=>ca,BROKER_REDIRECT_URI:()=>Ou,CCS_HEADER:()=>dP,CLAIMS:()=>Kh,CLIENT_ASSERTION:()=>yp,CLIENT_ASSERTION_TYPE:()=>Ep,CLIENT_ID:()=>yr,CLIENT_INFO:()=>cP,CLIENT_REQUEST_ID:()=>np,CLIENT_SECRET:()=>gp,CODE:()=>Jh,CODE_CHALLENGE:()=>ep,CODE_CHALLENGE_METHOD:()=>tp,CODE_VERIFIER:()=>rp,DEVICE_CODE:()=>mp,DOMAIN_HINT:()=>wp,EAR_JWE_CRYPTO:()=>Ip,EAR_JWK:()=>Rp,ERROR:()=>tP,ERROR_DESCRIPTION:()=>rP,EXPIRES_IN:()=>oP,FOCI:()=>uP,GRANT_TYPE:()=>Vh,ID_TOKEN:()=>iP,ID_TOKEN_HINT:()=>pp,INSTANCE_AWARE:()=>Po,LOGIN_HINT:()=>Sp,LOGOUT_HINT:()=>_p,NATIVE_BROKER:()=>Cp,NONCE:()=>Xh,OBO_ASSERTION:()=>Tp,ON_BEHALF_OF:()=>lP,POST_LOGOUT_URI:()=>hp,PROMPT:()=>Qh,REDIRECT_URI:()=>wu,REFRESH_TOKEN:()=>Wh,REFRESH_TOKEN_EXPIRES_IN:()=>sP,REQUESTED_TOKEN_USE:()=>vp,REQ_CNF:()=>Iu,RESPONSE_MODE:()=>Gh,RESPONSE_TYPE:()=>zh,RETURN_SPA_CODE:()=>bu,SCOPE:()=>Yh,SESSION_STATE:()=>aP,SID:()=>Ap,STATE:()=>Zh,TOKEN_TYPE:()=>Ru,X_APP_NAME:()=>dp,X_APP_VER:()=>fp,X_CLIENT_CPU:()=>ap,X_CLIENT_CURR_TELEM:()=>cp,X_CLIENT_EXTRA_SKU:()=>fP,X_CLIENT_LAST_TELEM:()=>lp,X_CLIENT_OS:()=>sp,X_CLIENT_SKU:()=>ip,X_CLIENT_VER:()=>op,X_MS_LIB_CAPABILITY:()=>up});var yr="client_id",wu="redirect_uri",zh="response_type",Gh="response_mode",Vh="grant_type",Kh="claims",Yh="scope",tP="error",rP="error_description",nP="access_token",iP="id_token",Wh="refresh_token",oP="expires_in",sP="refresh_token_expires_in",Zh="state",Xh="nonce",Qh="prompt",aP="session_state",cP="client_info",Jh="code",ep="code_challenge",tp="code_challenge_method",rp="code_verifier",np="client-request-id",ip="x-client-SKU",op="x-client-VER",sp="x-client-OS",ap="x-client-CPU",cp="x-client-current-telemetry",lp="x-client-last-telemetry",up="x-ms-lib-capability",dp="x-app-name",fp="x-app-ver",hp="post_logout_redirect_uri",pp="id_token_hint",mp="device_code",gp="client_secret",yp="client_assertion",Ep="client_assertion_type",Ru="token_type",Iu="req_cnf",Tp="assertion",vp="requested_token_use",lP="on_behalf_of",uP="foci",dP="X-AnchorMailbox",bu="return_spa_code",Cp="nativebroker",_p="logout_hint",Ap="sid",Sp="login_hint",wp="domain_hint",fP="x-client-xtra-sku",ca="brk_client_id",Ou="brk_redirect_uri",Po="instance_aware",Rp="ear_jwk",Ip="ear_jwe_crypto";function wi(r,e,t){if(!e)return;let n=r.get(yr);n&&r.has(ca)&&t?.addFields({embeddedClientId:n,embeddedRedirectUri:r.get(wu)},e)}function hP(r,e){r.set(zh,e)}function bp(r,e){r.set(Gh,e||dr.QUERY)}function pP(r){r.set(Cp,"1")}function Ri(r,e,t=!0,n=ut){t&&!n.includes("openid")&&!e.includes("openid")&&n.push("openid");let i=t?[...e||[],...n]:e||[],o=new ke(i);r.set(Yh,o.printScopes())}function Ii(r,e){r.set(yr,e)}function bi(r,e){r.set(wu,e)}function Op(r,e){r.set(hp,e)}function kp(r,e){r.set(pp,e)}function xp(r,e){r.set(wp,e)}function No(r,e){r.set(Sp,e)}function un(r,e){r.set(ue.CCS_HEADER,`UPN:${e}`)}function $r(r,e){r.set(ue.CCS_HEADER,`Oid:${e.uid}@${e.utid}`)}function ku(r,e){r.set(Ap,e)}function Oi(r,e,t){let n=Ov(e,t);try{JSON.parse(n)}catch{throw ae(pr)}r.set(Kh,n)}function ki(r,e){r.set(np,e)}function la(r,e){r.set(ip,e.sku),r.set(op,e.version),e.os&&r.set(sp,e.os),e.cpu&&r.set(ap,e.cpu)}function ua(r,e){e?.appName&&r.set(dp,e.appName),e?.appVersion&&r.set(fp,e.appVersion)}function Pp(r,e){r.set(Qh,e)}function da(r,e){e&&r.set(Zh,e)}function Np(r,e){r.set(Xh,e)}function mP(r,e,t){if(e&&t)r.set(ep,e),r.set(tp,t);else throw ae(Hr)}function Mp(r,e){r.set(Jh,e)}function gP(r,e){r.set(mp,e)}function Dp(r,e){r.set(Wh,e)}function Lp(r,e){r.set(rp,e)}function fa(r,e){r.set(gp,e)}function ha(r,e){e&&r.set(yp,e)}function pa(r,e){e&&r.set(Ep,e)}function yP(r,e){r.set(Tp,e)}function EP(r,e){r.set(vp,e)}function ma(r,e){r.set(Vh,e)}function xi(r){r.set(vv,"1")}function ga(r){r.has(Po)||r.set(Po,"true")}function qr(r,e){Object.entries(e).forEach(([t,n])=>{!r.has(t)&&n&&r.set(t,n)})}function Ov(r,e){let t;if(!r)t={};else try{t=JSON.parse(r)}catch{throw ae(pr)}return e&&e.length>0&&(t.hasOwnProperty(Vn.ACCESS_TOKEN)||(t[Vn.ACCESS_TOKEN]={}),t[Vn.ACCESS_TOKEN][Vn.XMS_CC]={values:e}),JSON.stringify(t)}function TP(r,e){r.set(Os.username,e)}function vP(r,e){r.set(Os.password,e)}function ya(r,e){e&&(r.set(Ru,te.POP),r.set(Iu,e))}function Ea(r,e){e&&(r.set(Ru,te.SSH),r.set(Iu,e))}function Ta(r,e){r.set(cp,e.generateCurrentRequestHeaderValue()),r.set(lp,e.generateLastRequestHeaderValue())}function va(r){r.set(up,fr.X_MS_LIB_CAPABILITY_VALUE)}function Up(r,e){r.set(_p,e)}function jr(r,e,t){r.has(ca)||r.set(ca,e),r.has(Ou)||r.set(Ou,t)}function CP(r,e){r.set(Rp,encodeURIComponent(e)),r.set(Ip,"eyJhbGciOiJkaXIiLCJlbmMiOiJBMjU2R0NNIn0")}var Pu={};ze(Pu,{createDiscoveredInstance:()=>Fp});function kv(r){return r.hasOwnProperty("authorization_endpoint")&&r.hasOwnProperty("token_endpoint")&&r.hasOwnProperty("issuer")&&r.hasOwnProperty("jwks_uri")}function xv(r){return r.hasOwnProperty("tenant_discovery_endpoint")&&r.hasOwnProperty("metadata")}function Pv(r){return r.hasOwnProperty("error")&&r.hasOwnProperty("error_description")}var g={AcquireTokenByCode:"acquireTokenByCode",AcquireTokenByRefreshToken:"acquireTokenByRefreshToken",AcquireTokenSilent:"acquireTokenSilent",AcquireTokenSilentAsync:"acquireTokenSilentAsync",AcquireTokenPopup:"acquireTokenPopup",AcquireTokenPreRedirect:"acquireTokenPreRedirect",AcquireTokenRedirect:"acquireTokenRedirect",CryptoOptsGetPublicKeyThumbprint:"cryptoOptsGetPublicKeyThumbprint",CryptoOptsSignJwt:"cryptoOptsSignJwt",SilentCacheClientAcquireToken:"silentCacheClientAcquireToken",SilentIframeClientAcquireToken:"silentIframeClientAcquireToken",AwaitConcurrentIframe:"awaitConcurrentIframe",SilentRefreshClientAcquireToken:"silentRefreshClientAcquireToken",SsoSilent:"ssoSilent",StandardInteractionClientGetDiscoveredAuthority:"standardInteractionClientGetDiscoveredAuthority",FetchAccountIdWithNativeBroker:"fetchAccountIdWithNativeBroker",NativeInteractionClientAcquireToken:"nativeInteractionClientAcquireToken",BaseClientCreateTokenRequestHeaders:"baseClientCreateTokenRequestHeaders",NetworkClientSendPostRequestAsync:"networkClientSendPostRequestAsync",RefreshTokenClientExecutePostToTokenEndpoint:"refreshTokenClientExecutePostToTokenEndpoint",AuthorizationCodeClientExecutePostToTokenEndpoint:"authorizationCodeClientExecutePostToTokenEndpoint",BrokerHandhshake:"brokerHandshake",AcquireTokenByRefreshTokenInBroker:"acquireTokenByRefreshTokenInBroker",AcquireTokenByBroker:"acquireTokenByBroker",RefreshTokenClientExecuteTokenRequest:"refreshTokenClientExecuteTokenRequest",RefreshTokenClientAcquireToken:"refreshTokenClientAcquireToken",RefreshTokenClientAcquireTokenWithCachedRefreshToken:"refreshTokenClientAcquireTokenWithCachedRefreshToken",RefreshTokenClientAcquireTokenByRefreshToken:"refreshTokenClientAcquireTokenByRefreshToken",RefreshTokenClientCreateTokenRequestBody:"refreshTokenClientCreateTokenRequestBody",AcquireTokenFromCache:"acquireTokenFromCache",SilentFlowClientAcquireCachedToken:"silentFlowClientAcquireCachedToken",SilentFlowClientGenerateResultFromCacheRecord:"silentFlowClientGenerateResultFromCacheRecord",AcquireTokenBySilentIframe:"acquireTokenBySilentIframe",InitializeBaseRequest:"initializeBaseRequest",InitializeSilentRequest:"initializeSilentRequest",InitializeClientApplication:"initializeClientApplication",InitializeCache:"initializeCache",SilentIframeClientTokenHelper:"silentIframeClientTokenHelper",SilentHandlerInitiateAuthRequest:"silentHandlerInitiateAuthRequest",SilentHandlerMonitorIframeForHash:"silentHandlerMonitorIframeForHash",SilentHandlerLoadFrame:"silentHandlerLoadFrame",SilentHandlerLoadFrameSync:"silentHandlerLoadFrameSync",StandardInteractionClientCreateAuthCodeClient:"standardInteractionClientCreateAuthCodeClient",StandardInteractionClientGetClientConfiguration:"standardInteractionClientGetClientConfiguration",StandardInteractionClientInitializeAuthorizationRequest:"standardInteractionClientInitializeAuthorizationRequest",GetAuthCodeUrl:"getAuthCodeUrl",GetStandardParams:"getStandardParams",HandleCodeResponseFromServer:"handleCodeResponseFromServer",HandleCodeResponse:"handleCodeResponse",HandleResponseEar:"handleResponseEar",HandleResponsePlatformBroker:"handleResponsePlatformBroker",HandleResponseCode:"handleResponseCode",UpdateTokenEndpointAuthority:"updateTokenEndpointAuthority",AuthClientAcquireToken:"authClientAcquireToken",AuthClientExecuteTokenRequest:"authClientExecuteTokenRequest",AuthClientCreateTokenRequestBody:"authClientCreateTokenRequestBody",PopTokenGenerateCnf:"popTokenGenerateCnf",PopTokenGenerateKid:"popTokenGenerateKid",HandleServerTokenResponse:"handleServerTokenResponse",DeserializeResponse:"deserializeResponse",AuthorityFactoryCreateDiscoveredInstance:"authorityFactoryCreateDiscoveredInstance",AuthorityResolveEndpointsAsync:"authorityResolveEndpointsAsync",AuthorityResolveEndpointsFromLocalSources:"authorityResolveEndpointsFromLocalSources",AuthorityGetCloudDiscoveryMetadataFromNetwork:"authorityGetCloudDiscoveryMetadataFromNetwork",AuthorityUpdateCloudDiscoveryMetadata:"authorityUpdateCloudDiscoveryMetadata",AuthorityGetEndpointMetadataFromNetwork:"authorityGetEndpointMetadataFromNetwork",AuthorityUpdateEndpointMetadata:"authorityUpdateEndpointMetadata",AuthorityUpdateMetadataWithRegionalInformation:"authorityUpdateMetadataWithRegionalInformation",RegionDiscoveryDetectRegion:"regionDiscoveryDetectRegion",RegionDiscoveryGetRegionFromIMDS:"regionDiscoveryGetRegionFromIMDS",RegionDiscoveryGetCurrentVersion:"regionDiscoveryGetCurrentVersion",AcquireTokenByCodeAsync:"acquireTokenByCodeAsync",GetEndpointMetadataFromNetwork:"getEndpointMetadataFromNetwork",GetCloudDiscoveryMetadataFromNetworkMeasurement:"getCloudDiscoveryMetadataFromNetworkMeasurement",HandleRedirectPromiseMeasurement:"handleRedirectPromise",HandleNativeRedirectPromiseMeasurement:"handleNativeRedirectPromise",UpdateCloudDiscoveryMetadataMeasurement:"updateCloudDiscoveryMetadataMeasurement",UsernamePasswordClientAcquireToken:"usernamePasswordClientAcquireToken",NativeMessageHandlerHandshake:"nativeMessageHandlerHandshake",NativeGenerateAuthResult:"nativeGenerateAuthResult",RemoveHiddenIframe:"removeHiddenIframe",ClearTokensAndKeysWithClaims:"clearTokensAndKeysWithClaims",CacheManagerGetRefreshToken:"cacheManagerGetRefreshToken",ImportExistingCache:"importExistingCache",SetUserData:"setUserData",LocalStorageUpdated:"localStorageUpdated",GeneratePkceCodes:"generatePkceCodes",GenerateCodeVerifier:"generateCodeVerifier",GenerateCodeChallengeFromVerifier:"generateCodeChallengeFromVerifier",Sha256Digest:"sha256Digest",GetRandomValues:"getRandomValues",GenerateHKDF:"generateHKDF",GenerateBaseKey:"generateBaseKey",Base64Decode:"base64Decode",UrlEncodeArr:"urlEncodeArr",Encrypt:"encrypt",Decrypt:"decrypt",GenerateEarKey:"generateEarKey",DecryptEarResponse:"decryptEarResponse"},TY=new Map([[g.AcquireTokenByCode,"ATByCode"],[g.AcquireTokenByRefreshToken,"ATByRT"],[g.AcquireTokenSilent,"ATS"],[g.AcquireTokenSilentAsync,"ATSAsync"],[g.AcquireTokenPopup,"ATPopup"],[g.AcquireTokenRedirect,"ATRedirect"],[g.CryptoOptsGetPublicKeyThumbprint,"CryptoGetPKThumb"],[g.CryptoOptsSignJwt,"CryptoSignJwt"],[g.SilentCacheClientAcquireToken,"SltCacheClientAT"],[g.SilentIframeClientAcquireToken,"SltIframeClientAT"],[g.SilentRefreshClientAcquireToken,"SltRClientAT"],[g.SsoSilent,"SsoSlt"],[g.StandardInteractionClientGetDiscoveredAuthority,"StdIntClientGetDiscAuth"],[g.FetchAccountIdWithNativeBroker,"FetchAccIdWithNtvBroker"],[g.NativeInteractionClientAcquireToken,"NtvIntClientAT"],[g.BaseClientCreateTokenRequestHeaders,"BaseClientCreateTReqHead"],[g.NetworkClientSendPostRequestAsync,"NetClientSendPost"],[g.RefreshTokenClientExecutePostToTokenEndpoint,"RTClientExecPost"],[g.AuthorizationCodeClientExecutePostToTokenEndpoint,"AuthCodeClientExecPost"],[g.BrokerHandhshake,"BrokerHandshake"],[g.AcquireTokenByRefreshTokenInBroker,"ATByRTInBroker"],[g.AcquireTokenByBroker,"ATByBroker"],[g.RefreshTokenClientExecuteTokenRequest,"RTClientExecTReq"],[g.RefreshTokenClientAcquireToken,"RTClientAT"],[g.RefreshTokenClientAcquireTokenWithCachedRefreshToken,"RTClientATWithCachedRT"],[g.RefreshTokenClientAcquireTokenByRefreshToken,"RTClientATByRT"],[g.RefreshTokenClientCreateTokenRequestBody,"RTClientCreateTReqBody"],[g.AcquireTokenFromCache,"ATFromCache"],[g.SilentFlowClientAcquireCachedToken,"SltFlowClientATCached"],[g.SilentFlowClientGenerateResultFromCacheRecord,"SltFlowClientGenResFromCache"],[g.AcquireTokenBySilentIframe,"ATBySltIframe"],[g.InitializeBaseRequest,"InitBaseReq"],[g.InitializeSilentRequest,"InitSltReq"],[g.InitializeClientApplication,"InitClientApplication"],[g.InitializeCache,"InitCache"],[g.ImportExistingCache,"importCache"],[g.SetUserData,"setUserData"],[g.LocalStorageUpdated,"localStorageUpdated"],[g.SilentIframeClientTokenHelper,"SIClientTHelper"],[g.SilentHandlerInitiateAuthRequest,"SHandlerInitAuthReq"],[g.SilentHandlerMonitorIframeForHash,"SltHandlerMonitorIframeForHash"],[g.SilentHandlerLoadFrame,"SHandlerLoadFrame"],[g.SilentHandlerLoadFrameSync,"SHandlerLoadFrameSync"],[g.StandardInteractionClientCreateAuthCodeClient,"StdIntClientCreateAuthCodeClient"],[g.StandardInteractionClientGetClientConfiguration,"StdIntClientGetClientConf"],[g.StandardInteractionClientInitializeAuthorizationRequest,"StdIntClientInitAuthReq"],[g.GetAuthCodeUrl,"GetAuthCodeUrl"],[g.HandleCodeResponseFromServer,"HandleCodeResFromServer"],[g.HandleCodeResponse,"HandleCodeResp"],[g.HandleResponseEar,"HandleRespEar"],[g.HandleResponseCode,"HandleRespCode"],[g.HandleResponsePlatformBroker,"HandleRespPlatBroker"],[g.UpdateTokenEndpointAuthority,"UpdTEndpointAuth"],[g.AuthClientAcquireToken,"AuthClientAT"],[g.AuthClientExecuteTokenRequest,"AuthClientExecTReq"],[g.AuthClientCreateTokenRequestBody,"AuthClientCreateTReqBody"],[g.PopTokenGenerateCnf,"PopTGenCnf"],[g.PopTokenGenerateKid,"PopTGenKid"],[g.HandleServerTokenResponse,"HandleServerTRes"],[g.DeserializeResponse,"DeserializeRes"],[g.AuthorityFactoryCreateDiscoveredInstance,"AuthFactCreateDiscInst"],[g.AuthorityResolveEndpointsAsync,"AuthResolveEndpointsAsync"],[g.AuthorityResolveEndpointsFromLocalSources,"AuthResolveEndpointsFromLocal"],[g.AuthorityGetCloudDiscoveryMetadataFromNetwork,"AuthGetCDMetaFromNet"],[g.AuthorityUpdateCloudDiscoveryMetadata,"AuthUpdCDMeta"],[g.AuthorityGetEndpointMetadataFromNetwork,"AuthUpdCDMetaFromNet"],[g.AuthorityUpdateEndpointMetadata,"AuthUpdEndpointMeta"],[g.AuthorityUpdateMetadataWithRegionalInformation,"AuthUpdMetaWithRegInfo"],[g.RegionDiscoveryDetectRegion,"RegDiscDetectReg"],[g.RegionDiscoveryGetRegionFromIMDS,"RegDiscGetRegFromIMDS"],[g.RegionDiscoveryGetCurrentVersion,"RegDiscGetCurrentVer"],[g.AcquireTokenByCodeAsync,"ATByCodeAsync"],[g.GetEndpointMetadataFromNetwork,"GetEndpointMetaFromNet"],[g.GetCloudDiscoveryMetadataFromNetworkMeasurement,"GetCDMetaFromNet"],[g.HandleRedirectPromiseMeasurement,"HandleRedirectPromise"],[g.HandleNativeRedirectPromiseMeasurement,"HandleNtvRedirectPromise"],[g.UpdateCloudDiscoveryMetadataMeasurement,"UpdateCDMeta"],[g.UsernamePasswordClientAcquireToken,"UserPassClientAT"],[g.NativeMessageHandlerHandshake,"NtvMsgHandlerHandshake"],[g.NativeGenerateAuthResult,"NtvGenAuthRes"],[g.RemoveHiddenIframe,"RemoveHiddenIframe"],[g.ClearTokensAndKeysWithClaims,"ClearTAndKeysWithClaims"],[g.CacheManagerGetRefreshToken,"CacheManagerGetRT"],[g.GeneratePkceCodes,"GenPkceCodes"],[g.GenerateCodeVerifier,"GenCodeVerifier"],[g.GenerateCodeChallengeFromVerifier,"GenCodeChallengeFromVerifier"],[g.Sha256Digest,"Sha256Digest"],[g.GetRandomValues,"GetRandomValues"],[g.GenerateHKDF,"genHKDF"],[g.GenerateBaseKey,"genBaseKey"],[g.Base64Decode,"b64Decode"],[g.UrlEncodeArr,"urlEncArr"],[g.Encrypt,"encrypt"],[g.Decrypt,"decrypt"],[g.GenerateEarKey,"genEarKey"],[g.DecryptEarResponse,"decryptEarResp"]]);var Nv=(r,e,t,n,i)=>(...o)=>{t.trace(`Executing function ${e}`);let s=n?.startMeasurement(e,i);if(i){let a=e+"CallCount";n?.incrementFields({[a]:1},i)}try{let a=r(...o);return s?.end({success:!0}),t.trace(`Returning result from ${e}`),a}catch(a){t.trace(`Error occurred in ${e}`);try{t.trace(JSON.stringify(a))}catch{t.trace("Unable to print error message.")}throw s?.end({success:!1},a),a}},re=(r,e,t,n,i)=>(...o)=>{t.trace(`Executing function ${e}`);let s=n?.startMeasurement(e,i);if(i){let a=e+"CallCount";n?.incrementFields({[a]:1},i)}return n?.setPreQueueTime(e,i),r(...o).then(a=>(t.trace(`Returning result from ${e}`),s?.end({success:!0}),a)).catch(a=>{t.trace(`Error occurred in ${e}`);try{t.trace(JSON.stringify(a))}catch{t.trace("Unable to print error message.")}throw s?.end({success:!1},a),a})};var Ca=class r{constructor(e,t,n,i){this.networkInterface=e,this.logger=t,this.performanceClient=n,this.correlationId=i}async detectRegion(e,t){this.performanceClient?.addQueueMeasurement(g.RegionDiscoveryDetectRegion,this.correlationId);let n=e;if(n)t.region_source=Wn.ENVIRONMENT_VARIABLE;else{let i=r.IMDS_OPTIONS;try{let o=await re(this.getRegionFromIMDS.bind(this),g.RegionDiscoveryGetRegionFromIMDS,this.logger,this.performanceClient,this.correlationId)(E.IMDS_VERSION,i);if(o.status===ks.httpSuccess&&(n=o.body,t.region_source=Wn.IMDS),o.status===ks.httpBadRequest){let s=await re(this.getCurrentVersion.bind(this),g.RegionDiscoveryGetCurrentVersion,this.logger,this.performanceClient,this.correlationId)(i);if(!s)return t.region_source=Wn.FAILED_AUTO_DETECTION,null;let a=await re(this.getRegionFromIMDS.bind(this),g.RegionDiscoveryGetRegionFromIMDS,this.logger,this.performanceClient,this.correlationId)(s,i);a.status===ks.httpSuccess&&(n=a.body,t.region_source=Wn.IMDS)}}catch{return t.region_source=Wn.FAILED_AUTO_DETECTION,null}}return n||(t.region_source=Wn.FAILED_AUTO_DETECTION),n||null}async getRegionFromIMDS(e,t){return this.performanceClient?.addQueueMeasurement(g.RegionDiscoveryGetRegionFromIMDS,this.correlationId),this.networkInterface.sendGetRequestAsync(`${E.IMDS_ENDPOINT}?api-version=${e}&format=text`,t,E.IMDS_TIMEOUT)}async getCurrentVersion(e){this.performanceClient?.addQueueMeasurement(g.RegionDiscoveryGetCurrentVersion,this.correlationId);try{let t=await this.networkInterface.sendGetRequestAsync(`${E.IMDS_ENDPOINT}?format=json`,e);return t.status===ks.httpBadRequest&&t.body&&t.body["newest-versions"]&&t.body["newest-versions"].length>0?t.body["newest-versions"][0]:null}catch{return null}}};Ca.IMDS_OPTIONS={headers:{Metadata:"true"}};var Xt=class r{constructor(e,t,n,i,o,s,a,c){this.canonicalAuthority=e,this._canonicalAuthority.validateAsUri(),this.networkInterface=t,this.cacheManager=n,this.authorityOptions=i,this.regionDiscoveryMetadata={region_used:void 0,region_source:void 0,region_outcome:void 0},this.logger=o,this.performanceClient=a,this.correlationId=s,this.managedIdentity=c||!1,this.regionDiscovery=new Ca(t,this.logger,this.performanceClient,this.correlationId)}getAuthorityType(e){if(e.HostNameAndPort.endsWith(E.CIAM_AUTH_URL))return Ht.Ciam;let t=e.PathSegments;if(t.length)switch(t[0].toLowerCase()){case E.ADFS:return Ht.Adfs;case E.DSTS:return Ht.Dsts}return Ht.Default}get authorityType(){return this.getAuthorityType(this.canonicalAuthorityUrlComponents)}get protocolMode(){return this.authorityOptions.protocolMode}get options(){return this.authorityOptions}get canonicalAuthority(){return this._canonicalAuthority.urlString}set canonicalAuthority(e){this._canonicalAuthority=new J(e),this._canonicalAuthority.validateAsUri(),this._canonicalAuthorityUrlComponents=null}get canonicalAuthorityUrlComponents(){return this._canonicalAuthorityUrlComponents||(this._canonicalAuthorityUrlComponents=this._canonicalAuthority.getUrlComponents()),this._canonicalAuthorityUrlComponents}get hostnameAndPort(){return this.canonicalAuthorityUrlComponents.HostNameAndPort.toLowerCase()}get tenant(){return this.canonicalAuthorityUrlComponents.PathSegments[0]}get authorizationEndpoint(){if(this.discoveryComplete())return this.replacePath(this.metadata.authorization_endpoint);throw v(Xe)}get tokenEndpoint(){if(this.discoveryComplete())return this.replacePath(this.metadata.token_endpoint);throw v(Xe)}get deviceCodeEndpoint(){if(this.discoveryComplete())return this.replacePath(this.metadata.token_endpoint.replace("/token","/devicecode"));throw v(Xe)}get endSessionEndpoint(){if(this.discoveryComplete()){if(!this.metadata.end_session_endpoint)throw v(fi);return this.replacePath(this.metadata.end_session_endpoint)}else throw v(Xe)}get selfSignedJwtAudience(){if(this.discoveryComplete())return this.replacePath(this.metadata.issuer);throw v(Xe)}get jwksUri(){if(this.discoveryComplete())return this.replacePath(this.metadata.jwks_uri);throw v(Xe)}canReplaceTenant(e){return e.PathSegments.length===1&&!r.reservedTenantDomains.has(e.PathSegments[0])&&this.getAuthorityType(e)===Ht.Default&&this.protocolMode!==Ve.OIDC}replaceTenant(e){return e.replace(/{tenant}|{tenantid}/g,this.tenant)}replacePath(e){let t=e,i=new J(this.metadata.canonical_authority).getUrlComponents(),o=i.PathSegments;return this.canonicalAuthorityUrlComponents.PathSegments.forEach((a,c)=>{let l=o[c];if(c===0&&this.canReplaceTenant(i)){let u=new J(this.metadata.authorization_endpoint).getUrlComponents().PathSegments[0];l!==u&&(this.logger.verbose(`Replacing tenant domain name ${l} with id ${u}`),l=u)}a!==l&&(t=t.replace(`/${l}/`,`/${a}/`))}),this.replaceTenant(t)}get defaultOpenIdConfigurationEndpoint(){let e=this.hostnameAndPort;return this.canonicalAuthority.endsWith("v2.0/")||this.authorityType===Ht.Adfs||this.protocolMode===Ve.OIDC&&!this.isAliasOfKnownMicrosoftAuthority(e)?`${this.canonicalAuthority}.well-known/openid-configuration`:`${this.canonicalAuthority}v2.0/.well-known/openid-configuration`}discoveryComplete(){return!!this.metadata}async resolveEndpointsAsync(){this.performanceClient?.addQueueMeasurement(g.AuthorityResolveEndpointsAsync,this.correlationId);let e=this.getCurrentMetadataEntity(),t=await re(this.updateCloudDiscoveryMetadata.bind(this),g.AuthorityUpdateCloudDiscoveryMetadata,this.logger,this.performanceClient,this.correlationId)(e);this.canonicalAuthority=this.canonicalAuthority.replace(this.hostnameAndPort,e.preferred_network);let n=await re(this.updateEndpointMetadata.bind(this),g.AuthorityUpdateEndpointMetadata,this.logger,this.performanceClient,this.correlationId)(e);this.updateCachedMetadata(e,t,{source:n}),this.performanceClient?.addFields({cloudDiscoverySource:t,authorityEndpointSource:n},this.correlationId)}getCurrentMetadataEntity(){let e=this.cacheManager.getAuthorityMetadataByAlias(this.hostnameAndPort);return e||(e={aliases:[],preferred_cache:this.hostnameAndPort,preferred_network:this.hostnameAndPort,canonical_authority:this.canonicalAuthority,authorization_endpoint:"",token_endpoint:"",end_session_endpoint:"",issuer:"",aliasesFromNetwork:!1,endpointsFromNetwork:!1,expiresAt:Tu(),jwks_uri:""}),e}updateCachedMetadata(e,t,n){t!==Ze.CACHE&&n?.source!==Ze.CACHE&&(e.expiresAt=Tu(),e.canonical_authority=this.canonicalAuthority);let i=this.cacheManager.generateAuthorityMetadataCacheKey(e.preferred_cache);this.cacheManager.setAuthorityMetadata(i,e),this.metadata=e}async updateEndpointMetadata(e){this.performanceClient?.addQueueMeasurement(g.AuthorityUpdateEndpointMetadata,this.correlationId);let t=this.updateEndpointMetadataFromLocalSources(e);if(t){if(t.source===Ze.HARDCODED_VALUES&&this.authorityOptions.azureRegionConfiguration?.azureRegion&&t.metadata){let i=await re(this.updateMetadataWithRegionalInformation.bind(this),g.AuthorityUpdateMetadataWithRegionalInformation,this.logger,this.performanceClient,this.correlationId)(t.metadata);Io(e,i,!1),e.canonical_authority=this.canonicalAuthority}return t.source}let n=await re(this.getEndpointMetadataFromNetwork.bind(this),g.AuthorityGetEndpointMetadataFromNetwork,this.logger,this.performanceClient,this.correlationId)();if(n)return this.authorityOptions.azureRegionConfiguration?.azureRegion&&(n=await re(this.updateMetadataWithRegionalInformation.bind(this),g.AuthorityUpdateMetadataWithRegionalInformation,this.logger,this.performanceClient,this.correlationId)(n)),Io(e,n,!0),Ze.NETWORK;throw v(Jn,this.defaultOpenIdConfigurationEndpoint)}updateEndpointMetadataFromLocalSources(e){this.logger.verbose("Attempting to get endpoint metadata from authority configuration");let t=this.getEndpointMetadataFromConfig();if(t)return this.logger.verbose("Found endpoint metadata in authority configuration"),Io(e,t,!1),{source:Ze.CONFIG};if(this.logger.verbose("Did not find endpoint metadata in the config... Attempting to get endpoint metadata from the hardcoded values."),this.authorityOptions.skipAuthorityMetadataCache)this.logger.verbose("Skipping hardcoded metadata cache since skipAuthorityMetadataCache is set to true. Attempting to get endpoint metadata from the network metadata cache.");else{let i=this.getEndpointMetadataFromHardcodedValues();if(i)return Io(e,i,!1),{source:Ze.HARDCODED_VALUES,metadata:i};this.logger.verbose("Did not find endpoint metadata in hardcoded values... Attempting to get endpoint metadata from the network metadata cache.")}let n=vu(e);return this.isAuthoritySameType(e)&&e.endpointsFromNetwork&&!n?(this.logger.verbose("Found endpoint metadata in the cache."),{source:Ze.CACHE}):(n&&this.logger.verbose("The metadata entity is expired."),null)}isAuthoritySameType(e){return new J(e.canonical_authority).getUrlComponents().PathSegments.length===this.canonicalAuthorityUrlComponents.PathSegments.length}getEndpointMetadataFromConfig(){if(this.authorityOptions.authorityMetadata)try{return JSON.parse(this.authorityOptions.authorityMetadata)}catch{throw ae(_i)}return null}async getEndpointMetadataFromNetwork(){this.performanceClient?.addQueueMeasurement(g.AuthorityGetEndpointMetadataFromNetwork,this.correlationId);let e={},t=this.defaultOpenIdConfigurationEndpoint;this.logger.verbose(`Authority.getEndpointMetadataFromNetwork: attempting to retrieve OAuth endpoints from ${t}`);try{let n=await this.networkInterface.sendGetRequestAsync(t,e);return kv(n.body)?n.body:(this.logger.verbose("Authority.getEndpointMetadataFromNetwork: could not parse response as OpenID configuration"),null)}catch(n){return this.logger.verbose(`Authority.getEndpointMetadataFromNetwork: ${n}`),null}}getEndpointMetadataFromHardcodedValues(){return this.hostnameAndPort in $h?$h[this.hostnameAndPort]:null}async updateMetadataWithRegionalInformation(e){this.performanceClient?.addQueueMeasurement(g.AuthorityUpdateMetadataWithRegionalInformation,this.correlationId);let t=this.authorityOptions.azureRegionConfiguration?.azureRegion;if(t){if(t!==E.AZURE_REGION_AUTO_DISCOVER_FLAG)return this.regionDiscoveryMetadata.region_outcome=pu.CONFIGURED_NO_AUTO_DETECTION,this.regionDiscoveryMetadata.region_used=t,r.replaceWithRegionalInformation(e,t);let n=await re(this.regionDiscovery.detectRegion.bind(this.regionDiscovery),g.RegionDiscoveryDetectRegion,this.logger,this.performanceClient,this.correlationId)(this.authorityOptions.azureRegionConfiguration?.environmentRegion,this.regionDiscoveryMetadata);if(n)return this.regionDiscoveryMetadata.region_outcome=pu.AUTO_DETECTION_REQUESTED_SUCCESSFUL,this.regionDiscoveryMetadata.region_used=n,r.replaceWithRegionalInformation(e,n);this.regionDiscoveryMetadata.region_outcome=pu.AUTO_DETECTION_REQUESTED_FAILED}return e}async updateCloudDiscoveryMetadata(e){this.performanceClient?.addQueueMeasurement(g.AuthorityUpdateCloudDiscoveryMetadata,this.correlationId);let t=this.updateCloudDiscoveryMetadataFromLocalSources(e);if(t)return t;let n=await re(this.getCloudDiscoveryMetadataFromNetwork.bind(this),g.AuthorityGetCloudDiscoveryMetadataFromNetwork,this.logger,this.performanceClient,this.correlationId)();if(n)return Zs(e,n,!0),Ze.NETWORK;throw ae(Ai)}updateCloudDiscoveryMetadataFromLocalSources(e){this.logger.verbose("Attempting to get cloud discovery metadata  from authority configuration"),this.logger.verbosePii(`Known Authorities: ${this.authorityOptions.knownAuthorities||E.NOT_APPLICABLE}`),this.logger.verbosePii(`Authority Metadata: ${this.authorityOptions.authorityMetadata||E.NOT_APPLICABLE}`),this.logger.verbosePii(`Canonical Authority: ${e.canonical_authority||E.NOT_APPLICABLE}`);let t=this.getCloudDiscoveryMetadataFromConfig();if(t)return this.logger.verbose("Found cloud discovery metadata in authority configuration"),Zs(e,t,!1),Ze.CONFIG;if(this.logger.verbose("Did not find cloud discovery metadata in the config... Attempting to get cloud discovery metadata from the hardcoded values."),this.options.skipAuthorityMetadataCache)this.logger.verbose("Skipping hardcoded cloud discovery metadata cache since skipAuthorityMetadataCache is set to true. Attempting to get cloud discovery metadata from the network metadata cache.");else{let i=Iv(this.hostnameAndPort);if(i)return this.logger.verbose("Found cloud discovery metadata from hardcoded values."),Zs(e,i,!1),Ze.HARDCODED_VALUES;this.logger.verbose("Did not find cloud discovery metadata in hardcoded values... Attempting to get cloud discovery metadata from the network metadata cache.")}let n=vu(e);return this.isAuthoritySameType(e)&&e.aliasesFromNetwork&&!n?(this.logger.verbose("Found cloud discovery metadata in the cache."),Ze.CACHE):(n&&this.logger.verbose("The metadata entity is expired."),null)}getCloudDiscoveryMetadataFromConfig(){if(this.authorityType===Ht.Ciam)return this.logger.verbose("CIAM authorities do not support cloud discovery metadata, generate the aliases from authority host."),r.createCloudDiscoveryMetadataFromHost(this.hostnameAndPort);if(this.authorityOptions.cloudDiscoveryMetadata){this.logger.verbose("The cloud discovery metadata has been provided as a network response, in the config.");try{this.logger.verbose("Attempting to parse the cloud discovery metadata.");let e=JSON.parse(this.authorityOptions.cloudDiscoveryMetadata),t=oa(e.metadata,this.hostnameAndPort);if(this.logger.verbose("Parsed the cloud discovery metadata."),t)return this.logger.verbose("There is returnable metadata attached to the parsed cloud discovery metadata."),t;this.logger.verbose("There is no metadata attached to the parsed cloud discovery metadata.")}catch{throw this.logger.verbose("Unable to parse the cloud discovery metadata. Throwing Invalid Cloud Discovery Metadata Error."),ae(cn)}}return this.isInKnownAuthorities()?(this.logger.verbose("The host is included in knownAuthorities. Creating new cloud discovery metadata from the host."),r.createCloudDiscoveryMetadataFromHost(this.hostnameAndPort)):null}async getCloudDiscoveryMetadataFromNetwork(){this.performanceClient?.addQueueMeasurement(g.AuthorityGetCloudDiscoveryMetadataFromNetwork,this.correlationId);let e=`${E.AAD_INSTANCE_DISCOVERY_ENDPT}${this.canonicalAuthority}oauth2/v2.0/authorize`,t={},n=null;try{let i=await this.networkInterface.sendGetRequestAsync(e,t),o,s;if(xv(i.body))o=i.body,s=o.metadata,this.logger.verbosePii(`tenant_discovery_endpoint is: ${o.tenant_discovery_endpoint}`);else if(Pv(i.body)){if(this.logger.warning(`A CloudInstanceDiscoveryErrorResponse was returned. The cloud instance discovery network request's status code is: ${i.status}`),o=i.body,o.error===E.INVALID_INSTANCE)return this.logger.error("The CloudInstanceDiscoveryErrorResponse error is invalid_instance."),null;this.logger.warning(`The CloudInstanceDiscoveryErrorResponse error is ${o.error}`),this.logger.warning(`The CloudInstanceDiscoveryErrorResponse error description is ${o.error_description}`),this.logger.warning("Setting the value of the CloudInstanceDiscoveryMetadata (returned from the network) to []"),s=[]}else return this.logger.error("AAD did not return a CloudInstanceDiscoveryResponse or CloudInstanceDiscoveryErrorResponse"),null;this.logger.verbose("Attempting to find a match between the developer's authority and the CloudInstanceDiscoveryMetadata returned from the network request."),n=oa(s,this.hostnameAndPort)}catch(i){if(i instanceof Z)this.logger.error(`There was a network error while attempting to get the cloud discovery instance metadata.
Error: ${i.errorCode}
Error Description: ${i.errorMessage}`);else{let o=i;this.logger.error(`A non-MSALJS error was thrown while attempting to get the cloud instance discovery metadata.
Error: ${o.name}
Error Description: ${o.message}`)}return null}return n||(this.logger.warning("The developer's authority was not found within the CloudInstanceDiscoveryMetadata returned from the network request."),this.logger.verbose("Creating custom Authority for custom domain scenario."),n=r.createCloudDiscoveryMetadataFromHost(this.hostnameAndPort)),n}isInKnownAuthorities(){return this.authorityOptions.knownAuthorities.filter(t=>t&&J.getDomainFromUrl(t).toLowerCase()===this.hostnameAndPort).length>0}static generateAuthority(e,t){let n;if(t&&t.azureCloudInstance!==Lr.None){let i=t.tenant?t.tenant:E.DEFAULT_COMMON_TENANT;n=`${t.azureCloudInstance}/${i}/`}return n||e}static createCloudDiscoveryMetadataFromHost(e){return{preferred_network:e,preferred_cache:e,aliases:[e]}}getPreferredCache(){if(this.managedIdentity)return E.DEFAULT_AUTHORITY_HOST;if(this.discoveryComplete())return this.metadata.preferred_cache;throw v(Xe)}isAlias(e){return this.metadata.aliases.indexOf(e)>-1}isAliasOfKnownMicrosoftAuthority(e){return jh.has(e)}static isPublicCloudAuthority(e){return E.KNOWN_PUBLIC_CLOUDS.indexOf(e)>=0}static buildRegionalAuthorityString(e,t,n){let i=new J(e);i.validateAsUri();let o=i.getUrlComponents(),s=`${t}.${o.HostNameAndPort}`;this.isPublicCloudAuthority(o.HostNameAndPort)&&(s=`${t}.${E.REGIONAL_AUTH_PUBLIC_CLOUD_SUFFIX}`);let a=J.constructAuthorityUriFromObject({...i.getUrlComponents(),HostNameAndPort:s}).urlString;return n?`${a}?${n}`:a}static replaceWithRegionalInformation(e,t){let n={...e};return n.authorization_endpoint=r.buildRegionalAuthorityString(n.authorization_endpoint,t),n.token_endpoint=r.buildRegionalAuthorityString(n.token_endpoint,t),n.end_session_endpoint&&(n.end_session_endpoint=r.buildRegionalAuthorityString(n.end_session_endpoint,t)),n}static transformCIAMAuthority(e){let t=e,i=new J(e).getUrlComponents();if(i.PathSegments.length===0&&i.HostNameAndPort.endsWith(E.CIAM_AUTH_URL)){let o=i.HostNameAndPort.split(".")[0];t=`${t}${o}${E.AAD_TENANT_DOMAIN_SUFFIX}`}return t}};Xt.reservedTenantDomains=new Set(["{tenant}","{tenantid}",dt.COMMON,dt.CONSUMERS,dt.ORGANIZATIONS]);function Mv(r){let n=new J(r).getUrlComponents().PathSegments.slice(-1)[0]?.toLowerCase();switch(n){case dt.COMMON:case dt.ORGANIZATIONS:case dt.CONSUMERS:return;default:return n}}function xu(r){return r.endsWith(E.FORWARD_SLASH)?r:`${r}${E.FORWARD_SLASH}`}function Hp(r){let e=r.cloudDiscoveryMetadata,t;if(e)try{t=JSON.parse(e)}catch{throw ae(cn)}return{canonicalAuthority:r.authority?xu(r.authority):void 0,knownAuthorities:r.knownAuthorities,cloudDiscoveryMetadata:t}}async function Fp(r,e,t,n,i,o,s){s?.addQueueMeasurement(g.AuthorityFactoryCreateDiscoveredInstance,o);let a=Xt.transformCIAMAuthority(xu(r)),c=new Xt(a,e,t,n,i,o,s);try{return await re(c.resolveEndpointsAsync.bind(c),g.AuthorityResolveEndpointsAsync,i,s,o)(),c}catch{throw v(Xe)}}var Je=class r extends Z{constructor(e,t,n,i,o){super(e,t,n),this.name="ServerError",this.errorNo=i,this.status=o,Object.setPrototypeOf(this,r.prototype)}};function Mo(r,e,t){return{clientId:r,authority:e.authority,scopes:e.scopes,homeAccountIdentifier:t,claims:e.claims,authenticationScheme:e.authenticationScheme,resourceRequestMethod:e.resourceRequestMethod,resourceRequestUri:e.resourceRequestUri,shrClaims:e.shrClaims,sshKid:e.sshKid,embeddedClientId:e.embeddedClientId||e.tokenBodyParameters?.clientId}}var _a=class r{static generateThrottlingStorageKey(e){return`${fr.THROTTLING_PREFIX}.${JSON.stringify(e)}`}static preProcess(e,t){let n=r.generateThrottlingStorageKey(t),i=e.getThrottlingCache(n);if(i){if(i.throttleTime<Date.now()){e.removeItem(n);return}throw new Je(i.errorCodes?.join(" ")||E.EMPTY_STRING,i.errorMessage,i.subError)}}static postProcess(e,t,n){if(r.checkResponseStatus(n)||r.checkResponseForRetryAfter(n)){let i={throttleTime:r.calculateThrottleTime(parseInt(n.headers[ue.RETRY_AFTER])),error:n.body.error,errorCodes:n.body.error_codes,errorMessage:n.body.error_description,subError:n.body.suberror};e.setThrottlingCache(r.generateThrottlingStorageKey(t),i)}}static checkResponseStatus(e){return e.status===429||e.status>=500&&e.status<600}static checkResponseForRetryAfter(e){return e.headers?e.headers.hasOwnProperty(ue.RETRY_AFTER)&&(e.status<200||e.status>=300):!1}static calculateThrottleTime(e){let t=e<=0?0:e,n=Date.now()/1e3;return Math.floor(Math.min(n+(t||fr.DEFAULT_THROTTLE_TIME_SECONDS),n+fr.DEFAULT_MAX_THROTTLE_TIME_SECONDS)*1e3)}static removeThrottle(e,t,n,i){let o=Mo(t,n,i),s=this.generateThrottlingStorageKey(o);e.removeItem(s)}};var Nu=class r extends Z{constructor(e,t,n){super(e.errorCode,e.errorMessage,e.subError),Object.setPrototypeOf(this,r.prototype),this.name="NetworkError",this.error=e,this.httpStatus=t,this.responseHeaders=n}};var je=class{constructor(e,t){this.config=bv(e),this.logger=new It(this.config.loggerOptions,gu,wo),this.cryptoUtils=this.config.cryptoInterface,this.cacheManager=this.config.storageInterface,this.networkClient=this.config.networkInterface,this.serverTelemetryManager=this.config.serverTelemetryManager,this.authority=this.config.authOptions.authority,this.performanceClient=t}createTokenRequestHeaders(e){let t={};if(t[ue.CONTENT_TYPE]=E.URL_FORM_CONTENT_TYPE,!this.config.systemOptions.preventCorsPreflight&&e)switch(e.type){case Qe.HOME_ACCOUNT_ID:try{let n=mr(e.credential);t[ue.CCS_HEADER]=`Oid:${n.uid}@${n.utid}`}catch(n){this.logger.verbose("Could not parse home account ID for CCS Header: "+n)}break;case Qe.UPN:t[ue.CCS_HEADER]=`UPN: ${e.credential}`;break}return t}async executePostToTokenEndpoint(e,t,n,i,o,s){s&&this.performanceClient?.addQueueMeasurement(s,o);let a=await this.sendPostRequest(i,e,{body:t,headers:n},o);return this.config.serverTelemetryManager&&a.status<500&&a.status!==429&&this.config.serverTelemetryManager.clearTelemetryCache(),a}async sendPostRequest(e,t,n,i){_a.preProcess(this.cacheManager,e);let o;try{o=await re(this.networkClient.sendPostRequestAsync.bind(this.networkClient),g.NetworkClientSendPostRequestAsync,this.logger,this.performanceClient,i)(t,n);let s=o.headers||{};this.performanceClient?.addFields({refreshTokenSize:o.body.refresh_token?.length||0,httpVerToken:s[ue.X_MS_HTTP_VERSION]||"",requestId:s[ue.X_MS_REQUEST_ID]||""},i)}catch(s){if(s instanceof Nu){let a=s.responseHeaders;throw a&&this.performanceClient?.addFields({httpVerToken:a[ue.X_MS_HTTP_VERSION]||"",requestId:a[ue.X_MS_REQUEST_ID]||"",contentTypeHeader:a[ue.CONTENT_TYPE]||void 0,contentLengthHeader:a[ue.CONTENT_LENGTH]||void 0,httpStatus:s.httpStatus},i),s.error}throw s instanceof Z?s:v(Qn)}return _a.postProcess(this.cacheManager,e,o),o}async updateAuthority(e,t){this.performanceClient?.addQueueMeasurement(g.UpdateTokenEndpointAuthority,t);let n=`https://${e}/${this.authority.tenant}/`,i=await Fp(n,this.networkClient,this.cacheManager,this.authority.options,this.logger,t,this.performanceClient);this.authority=i}createTokenQueryParameters(e){let t=new Map;return e.embeddedClientId&&jr(t,this.config.authOptions.clientId,this.config.authOptions.redirectUri),e.tokenQueryParameters&&qr(t,e.tokenQueryParameters),ki(t,e.correlationId),wi(t,e.correlationId,this.performanceClient),gr(t)}};var Mu={};ze(Mu,{badToken:()=>fn,consentRequired:()=>qp,interactionRequired:()=>$p,loginRequired:()=>jp,nativeAccountUnavailable:()=>Aa,noTokensFound:()=>dn,refreshTokenExpired:()=>Sa});var dn="no_tokens_found",Aa="native_account_unavailable",Sa="refresh_token_expired",$p="interaction_required",qp="consent_required",jp="login_required",fn="bad_token";var Dv=[$p,qp,jp,fn],_P=["message_only","additional_action","basic_action","user_password_expired","consent_required","bad_token"],Du={[dn]:"No refresh token found in the cache. Please sign-in.",[Aa]:"The requested account is not available in the native broker. It may have been deleted or logged out. Please sign-in again using an interactive API.",[Sa]:"Refresh token has expired.",[fn]:"Identity provider returned bad_token due to an expired or invalid refresh token. Please invoke an interactive API to resolve."},Bp={noTokensFoundError:{code:dn,desc:Du[dn]},native_account_unavailable:{code:Aa,desc:Du[Aa]},bad_token:{code:fn,desc:Du[fn]}},Ot=class r extends Z{constructor(e,t,n,i,o,s,a,c){super(e,t,n),Object.setPrototypeOf(this,r.prototype),this.timestamp=i||E.EMPTY_STRING,this.traceId=o||E.EMPTY_STRING,this.correlationId=s||E.EMPTY_STRING,this.claims=a||E.EMPTY_STRING,this.name="InteractionRequiredAuthError",this.errorNo=c}};function Lu(r,e,t){let n=!!r&&Dv.indexOf(r)>-1,i=!!t&&_P.indexOf(t)>-1,o=!!e&&Dv.some(s=>e.indexOf(s)>-1);return n||o||i}function Uu(r){return new Ot(r,Du[r])}var Hu=class r{static setRequestState(e,t,n){let i=r.generateLibraryState(e,n);return t?`${i}${E.RESOURCE_DELIM}${t}`:i}static generateLibraryState(e,t){if(!e)throw v(sn);let n={id:e.createNewGuid()};t&&(n.meta=t);let i=JSON.stringify(n);return e.base64Encode(i)}static parseRequestState(e,t){if(!e)throw v(sn);if(!t)throw v(Zt);try{let n=t.split(E.RESOURCE_DELIM),i=n[0],o=n.length>1?n.slice(1).join(E.RESOURCE_DELIM):E.EMPTY_STRING,s=e.base64Decode(i),a=JSON.parse(s);return{userRequestState:o||E.EMPTY_STRING,libraryState:a}}catch{throw v(Zt)}}};var AP={SW:"sw",UHW:"uhw"},hn=class{constructor(e,t){this.cryptoUtils=e,this.performanceClient=t}async generateCnf(e,t){this.performanceClient?.addQueueMeasurement(g.PopTokenGenerateCnf,e.correlationId);let n=await re(this.generateKid.bind(this),g.PopTokenGenerateCnf,t,this.performanceClient,e.correlationId)(e),i=this.cryptoUtils.base64UrlEncode(JSON.stringify(n));return{kid:n.kid,reqCnfString:i}}async generateKid(e){return this.performanceClient?.addQueueMeasurement(g.PopTokenGenerateKid,e.correlationId),{kid:await this.cryptoUtils.getPublicKeyThumbprint(e),xms_ksl:AP.SW}}async signPopToken(e,t,n){return this.signPayload(e,t,n)}async signPayload(e,t,n,i){let{resourceRequestMethod:o,resourceRequestUri:s,shrClaims:a,shrNonce:c,shrOptions:l}=n,d=(s?new J(s):void 0)?.getUrlComponents();return this.cryptoUtils.signJwt({at:e,ts:bt(),m:o?.toUpperCase(),u:d?.HostNameAndPort,nonce:c||this.cryptoUtils.createNewGuid(),p:d?.AbsolutePath,q:d?.QueryString?[[],d.QueryString]:void 0,client_claims:a||void 0,...i},t,l,n.correlationId)}};var kt=class{constructor(e,t){this.cache=e,this.hasChanged=t}get cacheHasChanged(){return this.hasChanged}get tokenCache(){return this.cache}};var Ie=class r{constructor(e,t,n,i,o,s,a){this.clientId=e,this.cacheStorage=t,this.cryptoObj=n,this.logger=i,this.serializableCache=o,this.persistencePlugin=s,this.performanceClient=a}validateTokenResponse(e,t){if(e.error||e.error_description||e.suberror){let n=`Error(s): ${e.error_codes||E.NOT_AVAILABLE} - Timestamp: ${e.timestamp||E.NOT_AVAILABLE} - Description: ${e.error_description||E.NOT_AVAILABLE} - Correlation ID: ${e.correlation_id||E.NOT_AVAILABLE} - Trace ID: ${e.trace_id||E.NOT_AVAILABLE}`,i=e.error_codes?.length?e.error_codes[0]:void 0,o=new Je(e.error,n,e.suberror,i,e.status);if(t&&e.status&&e.status>=W.SERVER_ERROR_RANGE_START&&e.status<=W.SERVER_ERROR_RANGE_END){this.logger.warning(`executeTokenRequest:validateTokenResponse - AAD is currently unavailable and the access token is unable to be refreshed.
${o}`);return}else if(t&&e.status&&e.status>=W.CLIENT_ERROR_RANGE_START&&e.status<=W.CLIENT_ERROR_RANGE_END){this.logger.warning(`executeTokenRequest:validateTokenResponse - AAD is currently available but is unable to refresh the access token.
${o}`);return}throw Lu(e.error,e.error_description,e.suberror)?new Ot(e.error,e.error_description,e.suberror,e.timestamp||E.EMPTY_STRING,e.trace_id||E.EMPTY_STRING,e.correlation_id||E.EMPTY_STRING,e.claims||E.EMPTY_STRING,i):o}}async handleServerTokenResponse(e,t,n,i,o,s,a,c,l){this.performanceClient?.addQueueMeasurement(g.HandleServerTokenResponse,e.correlation_id);let u;if(e.id_token){if(u=Ur(e.id_token||E.EMPTY_STRING,this.cryptoObj.base64Decode),o&&o.nonce&&u.nonce!==o.nonce)throw v(ri);if(i.maxAge||i.maxAge===0){let m=u.auth_time;if(!m)throw v(Pr);Ks(m,i.maxAge)}}this.homeAccountIdentifier=$e.generateHomeAccountId(e.client_info||E.EMPTY_STRING,t.authorityType,this.logger,this.cryptoObj,u);let d;o&&o.state&&(d=Hu.parseRequestState(this.cryptoObj,o.state)),e.key_id=e.key_id||i.sshKid||void 0;let h=this.generateCacheRecord(e,t,n,i,u,s,o),p;try{if(this.persistencePlugin&&this.serializableCache&&(this.logger.verbose("Persistence enabled, calling beforeCacheAccess"),p=new kt(this.serializableCache,!0),await this.persistencePlugin.beforeCacheAccess(p)),a&&!c&&h.account){let m=h.account.generateAccountKey();if(!this.cacheStorage.getAccount(m))return this.logger.warning("Account used to refresh tokens not in persistence, refreshed tokens will not be stored in the cache"),await r.generateAuthenticationResult(this.cryptoObj,t,h,!1,i,u,d,void 0,l)}await this.cacheStorage.saveCacheRecord(h,i.correlationId,i.storeInCache)}finally{this.persistencePlugin&&this.serializableCache&&p&&(this.logger.verbose("Persistence enabled, calling afterCacheAccess"),await this.persistencePlugin.afterCacheAccess(p))}return r.generateAuthenticationResult(this.cryptoObj,t,h,!1,i,u,d,e,l)}generateCacheRecord(e,t,n,i,o,s,a){let c=t.getPreferredCache();if(!c)throw v(Mr);let l=_u(o),u,d;e.id_token&&o&&(u=Dh(this.homeAccountIdentifier,c,e.id_token,this.clientId,l||""),d=Lv(this.cacheStorage,t,this.homeAccountIdentifier,this.cryptoObj.base64Decode,o,e.client_info,c,l,a,void 0,this.logger));let h=null;if(e.access_token){let y=e.scope?ke.fromString(e.scope):new ke(i.scopes||[]),A=(typeof e.expires_in=="string"?parseInt(e.expires_in,10):e.expires_in)||0,P=(typeof e.ext_expires_in=="string"?parseInt(e.ext_expires_in,10):e.ext_expires_in)||0,D=(typeof e.refresh_in=="string"?parseInt(e.refresh_in,10):e.refresh_in)||void 0,U=n+A,H=U+P,w=D&&D>0?n+D:void 0;h=Lh(this.homeAccountIdentifier,c,e.access_token,this.clientId,l||t.tenant||"",y.printScopes(),U,H,this.cryptoObj.base64Decode,w,e.token_type,s,e.key_id,i.claims,i.requestedClaimsHash)}let p=null;if(e.refresh_token){let y;if(e.refresh_token_expires_in){let A=typeof e.refresh_token_expires_in=="string"?parseInt(e.refresh_token_expires_in,10):e.refresh_token_expires_in;y=n+A}p=Uh(this.homeAccountIdentifier,c,e.refresh_token,this.clientId,e.foci,s,y)}let m=null;return e.foci&&(m={clientId:this.clientId,environment:c,familyId:e.foci}),{account:d,idToken:u,accessToken:h,refreshToken:p,appMetadata:m}}static async generateAuthenticationResult(e,t,n,i,o,s,a,c,l){let u=E.EMPTY_STRING,d=[],h=null,p,m,y=E.EMPTY_STRING;if(n.accessToken){if(n.accessToken.tokenType===te.POP&&!o.popKid){let U=new hn(e),{secret:H,keyId:w}=n.accessToken;if(!w)throw v(hi);u=await U.signPopToken(H,w,o)}else u=n.accessToken.secret;d=ke.fromString(n.accessToken.target).asArray(),h=Ys(n.accessToken.expiresOn),p=Ys(n.accessToken.extendedExpiresOn),n.accessToken.refreshOn&&(m=Ys(n.accessToken.refreshOn))}n.appMetadata&&(y=n.appMetadata.familyId===xr?xr:"");let A=s?.oid||s?.sub||"",P=s?.tid||"";c?.spa_accountid&&n.account&&(n.account.nativeAccountId=c?.spa_accountid);let D=n.account?Cu(n.account.getAccountInfo(),void 0,s,n.idToken?.secret):null;return{authority:t.canonicalAuthority,uniqueId:A,tenantId:P,scopes:d,account:D,idToken:n?.idToken?.secret||"",idTokenClaims:s||{},accessToken:u,fromCache:i,expiresOn:h,extExpiresOn:p,refreshOn:m,correlationId:o.correlationId,requestId:l||E.EMPTY_STRING,familyId:y,tokenType:n.accessToken?.tokenType||E.EMPTY_STRING,state:a?a.userRequestState:E.EMPTY_STRING,cloudGraphHostName:n.account?.cloudGraphHostName||E.EMPTY_STRING,msGraphHost:n.account?.msGraphHost||E.EMPTY_STRING,code:c?.spa_code,fromNativeBroker:!1}}};function Lv(r,e,t,n,i,o,s,a,c,l,u){u?.verbose("setCachedAccount called");let h=r.getAccountKeys().find(P=>P.startsWith(t)),p=null;h&&(p=r.getAccount(h));let m=p||$e.createAccount({homeAccountId:t,idTokenClaims:i,clientInfo:o,environment:s,cloudGraphHostName:c?.cloud_graph_host_name,msGraphHost:c?.msgraph_host,nativeAccountId:l},e,n),y=m.tenantProfiles||[],A=a||m.realm;if(A&&!y.find(P=>P.tenantId===A)){let P=ia(t,m.localAccountId,A,i);y.push(P)}return m.tenantProfiles=y,m}var Fu=class{static validateRedirectUri(e){if(!e)throw ae(pi)}static validatePrompt(e){let t=[];for(let n in Wt)t.push(Wt[n]);if(t.indexOf(e)<0)throw ae(Ei)}static validateClaims(e){try{JSON.parse(e)}catch{throw ae(pr)}}static validateCodeChallengeParams(e,t){if(!e||!t)throw ae(Hr);this.validateCodeChallengeMethod(t)}static validateCodeChallengeMethod(e){if([Kn.PLAIN,Kn.S256].indexOf(e)<0)throw ae(Ci)}};async function et(r,e,t){return typeof r=="string"?r:r({clientId:e,tokenEndpoint:t})}var wa=class extends je{constructor(e,t){super(e,t),this.includeRedirectUri=!0,this.oidcDefaultScopes=this.config.authOptions.authority.options.OIDCOptions?.defaultScopes}async acquireToken(e,t){if(this.performanceClient?.addQueueMeasurement(g.AuthClientAcquireToken,e.correlationId),!e.code)throw v(oi);let n=bt(),i=await re(this.executeTokenRequest.bind(this),g.AuthClientExecuteTokenRequest,this.logger,this.performanceClient,e.correlationId)(this.authority,e),o=i.headers?.[ue.X_MS_REQUEST_ID],s=new Ie(this.config.authOptions.clientId,this.cacheManager,this.cryptoUtils,this.logger,this.config.serializableCache,this.config.persistencePlugin,this.performanceClient);return s.validateTokenResponse(i.body),re(s.handleServerTokenResponse.bind(s),g.HandleServerTokenResponse,this.logger,this.performanceClient,e.correlationId)(i.body,this.authority,n,e,t,void 0,void 0,void 0,o)}getLogoutUri(e){if(!e)throw ae(vi);let t=this.createLogoutUrlQueryString(e);return J.appendQueryString(this.authority.endSessionEndpoint,t)}async executeTokenRequest(e,t){this.performanceClient?.addQueueMeasurement(g.AuthClientExecuteTokenRequest,t.correlationId);let n=this.createTokenQueryParameters(t),i=J.appendQueryString(e.tokenEndpoint,n),o=await re(this.createTokenRequestBody.bind(this),g.AuthClientCreateTokenRequestBody,this.logger,this.performanceClient,t.correlationId)(t),s;if(t.clientInfo)try{let l=ko(t.clientInfo,this.cryptoUtils.base64Decode);s={credential:`${l.uid}${Ae.CLIENT_INFO_SEPARATOR}${l.utid}`,type:Qe.HOME_ACCOUNT_ID}}catch(l){this.logger.verbose("Could not parse client info for CCS Header: "+l)}let a=this.createTokenRequestHeaders(s||t.ccsCredential),c=Mo(this.config.authOptions.clientId,t);return re(this.executePostToTokenEndpoint.bind(this),g.AuthorizationCodeClientExecutePostToTokenEndpoint,this.logger,this.performanceClient,t.correlationId)(i,o,a,c,t.correlationId,g.AuthorizationCodeClientExecutePostToTokenEndpoint)}async createTokenRequestBody(e){this.performanceClient?.addQueueMeasurement(g.AuthClientCreateTokenRequestBody,e.correlationId);let t=new Map;if(Ii(t,e.embeddedClientId||e.tokenBodyParameters?.[yr]||this.config.authOptions.clientId),this.includeRedirectUri?bi(t,e.redirectUri):Fu.validateRedirectUri(e.redirectUri),Ri(t,e.scopes,!0,this.oidcDefaultScopes),Mp(t,e.code),la(t,this.config.libraryInfo),ua(t,this.config.telemetry.application),va(t),this.serverTelemetryManager&&!Su(this.config)&&Ta(t,this.serverTelemetryManager),e.codeVerifier&&Lp(t,e.codeVerifier),this.config.clientCredentials.clientSecret&&fa(t,this.config.clientCredentials.clientSecret),this.config.clientCredentials.clientAssertion){let i=this.config.clientCredentials.clientAssertion;ha(t,await et(i.assertion,this.config.authOptions.clientId,e.resourceRequestUri)),pa(t,i.assertionType)}if(ma(t,ft.AUTHORIZATION_CODE_GRANT),xi(t),e.authenticationScheme===te.POP){let i=new hn(this.cryptoUtils,this.performanceClient),o;e.popKid?o=this.cryptoUtils.encodeKid(e.popKid):o=(await re(i.generateCnf.bind(i),g.PopTokenGenerateCnf,this.logger,this.performanceClient,e.correlationId)(e,this.logger)).reqCnfString,ya(t,o)}else if(e.authenticationScheme===te.SSH)if(e.sshJwk)Ea(t,e.sshJwk);else throw ae(Fr);(!ye.isEmptyObj(e.claims)||this.config.authOptions.clientCapabilities&&this.config.authOptions.clientCapabilities.length>0)&&Oi(t,e.claims,this.config.authOptions.clientCapabilities);let n;if(e.clientInfo)try{let i=ko(e.clientInfo,this.cryptoUtils.base64Decode);n={credential:`${i.uid}${Ae.CLIENT_INFO_SEPARATOR}${i.utid}`,type:Qe.HOME_ACCOUNT_ID}}catch(i){this.logger.verbose("Could not parse client info for CCS Header: "+i)}else n=e.ccsCredential;if(this.config.systemOptions.preventCorsPreflight&&n)switch(n.type){case Qe.HOME_ACCOUNT_ID:try{let i=mr(n.credential);$r(t,i)}catch(i){this.logger.verbose("Could not parse home account ID for CCS Header: "+i)}break;case Qe.UPN:un(t,n.credential);break}return e.embeddedClientId&&jr(t,this.config.authOptions.clientId,this.config.authOptions.redirectUri),e.tokenBodyParameters&&qr(t,e.tokenBodyParameters),e.enableSpaAuthorizationCode&&(!e.tokenBodyParameters||!e.tokenBodyParameters[bu])&&qr(t,{[bu]:"1"}),wi(t,e.correlationId,this.performanceClient),gr(t)}createLogoutUrlQueryString(e){let t=new Map;return e.postLogoutRedirectUri&&Op(t,e.postLogoutRedirectUri),e.correlationId&&ki(t,e.correlationId),e.idTokenHint&&kp(t,e.idTokenHint),e.state&&da(t,e.state),e.logoutHint&&Up(t,e.logoutHint),e.extraQueryParameters&&qr(t,e.extraQueryParameters),this.config.authOptions.instanceAware&&ga(t),gr(t,this.config.authOptions.encodeExtraQueryParams,e.extraQueryParameters)}};var SP=300,Pi=class extends je{constructor(e,t){super(e,t)}async acquireToken(e){this.performanceClient?.addQueueMeasurement(g.RefreshTokenClientAcquireToken,e.correlationId);let t=bt(),n=await re(this.executeTokenRequest.bind(this),g.RefreshTokenClientExecuteTokenRequest,this.logger,this.performanceClient,e.correlationId)(e,this.authority),i=n.headers?.[ue.X_MS_REQUEST_ID],o=new Ie(this.config.authOptions.clientId,this.cacheManager,this.cryptoUtils,this.logger,this.config.serializableCache,this.config.persistencePlugin);return o.validateTokenResponse(n.body),re(o.handleServerTokenResponse.bind(o),g.HandleServerTokenResponse,this.logger,this.performanceClient,e.correlationId)(n.body,this.authority,t,e,void 0,void 0,!0,e.forceCache,i)}async acquireTokenByRefreshToken(e){if(!e)throw ae(Ti);if(this.performanceClient?.addQueueMeasurement(g.RefreshTokenClientAcquireTokenByRefreshToken,e.correlationId),!e.account)throw v(Nr);if(this.cacheManager.isAppMetadataFOCI(e.account.environment))try{return await re(this.acquireTokenWithCachedRefreshToken.bind(this),g.RefreshTokenClientAcquireTokenWithCachedRefreshToken,this.logger,this.performanceClient,e.correlationId)(e,!0)}catch(n){let i=n instanceof Ot&&n.errorCode===dn,o=n instanceof Je&&n.errorCode===bs.INVALID_GRANT_ERROR&&n.subError===bs.CLIENT_MISMATCH_ERROR;if(i||o)return re(this.acquireTokenWithCachedRefreshToken.bind(this),g.RefreshTokenClientAcquireTokenWithCachedRefreshToken,this.logger,this.performanceClient,e.correlationId)(e,!1);throw n}return re(this.acquireTokenWithCachedRefreshToken.bind(this),g.RefreshTokenClientAcquireTokenWithCachedRefreshToken,this.logger,this.performanceClient,e.correlationId)(e,!1)}async acquireTokenWithCachedRefreshToken(e,t){this.performanceClient?.addQueueMeasurement(g.RefreshTokenClientAcquireTokenWithCachedRefreshToken,e.correlationId);let n=Nv(this.cacheManager.getRefreshToken.bind(this.cacheManager),g.CacheManagerGetRefreshToken,this.logger,this.performanceClient,e.correlationId)(e.account,t,void 0,this.performanceClient,e.correlationId);if(!n)throw Uu(dn);if(n.expiresOn&&Ro(n.expiresOn,e.refreshTokenExpirationOffsetSeconds||SP))throw this.performanceClient?.addFields({rtExpiresOnMs:Number(n.expiresOn)},e.correlationId),Uu(Sa);let i={...e,refreshToken:n.secret,authenticationScheme:e.authenticationScheme||te.BEARER,ccsCredential:{credential:e.account.homeAccountId,type:Qe.HOME_ACCOUNT_ID}};try{return await re(this.acquireToken.bind(this),g.RefreshTokenClientAcquireToken,this.logger,this.performanceClient,e.correlationId)(i)}catch(o){if(o instanceof Ot&&(this.performanceClient?.addFields({rtExpiresOnMs:Number(n.expiresOn)},e.correlationId),o.subError===fn)){this.logger.verbose("acquireTokenWithRefreshToken: bad refresh token, removing from cache");let s=Ws(n);this.cacheManager.removeRefreshToken(s)}throw o}}async executeTokenRequest(e,t){this.performanceClient?.addQueueMeasurement(g.RefreshTokenClientExecuteTokenRequest,e.correlationId);let n=this.createTokenQueryParameters(e),i=J.appendQueryString(t.tokenEndpoint,n),o=await re(this.createTokenRequestBody.bind(this),g.RefreshTokenClientCreateTokenRequestBody,this.logger,this.performanceClient,e.correlationId)(e),s=this.createTokenRequestHeaders(e.ccsCredential),a=Mo(this.config.authOptions.clientId,e);return re(this.executePostToTokenEndpoint.bind(this),g.RefreshTokenClientExecutePostToTokenEndpoint,this.logger,this.performanceClient,e.correlationId)(i,o,s,a,e.correlationId,g.RefreshTokenClientExecutePostToTokenEndpoint)}async createTokenRequestBody(e){this.performanceClient?.addQueueMeasurement(g.RefreshTokenClientCreateTokenRequestBody,e.correlationId);let t=new Map;if(Ii(t,e.embeddedClientId||e.tokenBodyParameters?.[yr]||this.config.authOptions.clientId),e.redirectUri&&bi(t,e.redirectUri),Ri(t,e.scopes,!0,this.config.authOptions.authority.options.OIDCOptions?.defaultScopes),ma(t,ft.REFRESH_TOKEN_GRANT),xi(t),la(t,this.config.libraryInfo),ua(t,this.config.telemetry.application),va(t),this.serverTelemetryManager&&!Su(this.config)&&Ta(t,this.serverTelemetryManager),Dp(t,e.refreshToken),this.config.clientCredentials.clientSecret&&fa(t,this.config.clientCredentials.clientSecret),this.config.clientCredentials.clientAssertion){let n=this.config.clientCredentials.clientAssertion;ha(t,await et(n.assertion,this.config.authOptions.clientId,e.resourceRequestUri)),pa(t,n.assertionType)}if(e.authenticationScheme===te.POP){let n=new hn(this.cryptoUtils,this.performanceClient),i;e.popKid?i=this.cryptoUtils.encodeKid(e.popKid):i=(await re(n.generateCnf.bind(n),g.PopTokenGenerateCnf,this.logger,this.performanceClient,e.correlationId)(e,this.logger)).reqCnfString,ya(t,i)}else if(e.authenticationScheme===te.SSH)if(e.sshJwk)Ea(t,e.sshJwk);else throw ae(Fr);if((!ye.isEmptyObj(e.claims)||this.config.authOptions.clientCapabilities&&this.config.authOptions.clientCapabilities.length>0)&&Oi(t,e.claims,this.config.authOptions.clientCapabilities),this.config.systemOptions.preventCorsPreflight&&e.ccsCredential)switch(e.ccsCredential.type){case Qe.HOME_ACCOUNT_ID:try{let n=mr(e.ccsCredential.credential);$r(t,n)}catch(n){this.logger.verbose("Could not parse home account ID for CCS Header: "+n)}break;case Qe.UPN:un(t,e.ccsCredential.credential);break}return e.embeddedClientId&&jr(t,this.config.authOptions.clientId,this.config.authOptions.redirectUri),e.tokenBodyParameters&&qr(t,e.tokenBodyParameters),wi(t,e.correlationId,this.performanceClient),gr(t)}};var Ra=class extends je{constructor(e,t){super(e,t)}async acquireCachedToken(e){this.performanceClient?.addQueueMeasurement(g.SilentFlowClientAcquireCachedToken,e.correlationId);let t=le.NOT_APPLICABLE;if(e.forceRefresh||!this.config.cacheOptions.claimsBasedCachingEnabled&&!ye.isEmptyObj(e.claims))throw this.setCacheOutcome(le.FORCE_REFRESH_OR_CLAIMS,e.correlationId),v(Dr);if(!e.account)throw v(Nr);let n=e.account.tenantId||Mv(e.authority),i=this.cacheManager.getTokenKeys(),o=this.cacheManager.getAccessToken(e.account,e,i,n,this.performanceClient,e.correlationId);if(o){if(Mh(o.cachedAt)||Ro(o.expiresOn,this.config.systemOptions.tokenRenewalOffsetSeconds))throw this.setCacheOutcome(le.CACHED_ACCESS_TOKEN_EXPIRED,e.correlationId),v(Dr);o.refreshOn&&Ro(o.refreshOn,0)&&(t=le.PROACTIVELY_REFRESHED)}else throw this.setCacheOutcome(le.NO_CACHED_ACCESS_TOKEN,e.correlationId),v(Dr);let s=e.authority||this.authority.getPreferredCache(),a={account:this.cacheManager.readAccountFromCache(e.account),accessToken:o,idToken:this.cacheManager.getIdToken(e.account,i,n,this.performanceClient,e.correlationId),refreshToken:null,appMetadata:this.cacheManager.readAppMetadataFromCache(s)};return this.setCacheOutcome(t,e.correlationId),this.config.serverTelemetryManager&&this.config.serverTelemetryManager.incrementCacheHits(),[await re(this.generateResultFromCacheRecord.bind(this),g.SilentFlowClientGenerateResultFromCacheRecord,this.logger,this.performanceClient,e.correlationId)(a,e),t]}setCacheOutcome(e,t){this.serverTelemetryManager?.setCacheOutcome(e),this.performanceClient?.addFields({cacheOutcome:e},t),e!==le.NOT_APPLICABLE&&this.logger.info(`Token refresh is required due to cache outcome: ${e}`)}async generateResultFromCacheRecord(e,t){this.performanceClient?.addQueueMeasurement(g.SilentFlowClientGenerateResultFromCacheRecord,t.correlationId);let n;if(e.idToken&&(n=Ur(e.idToken.secret,this.config.cryptoInterface.base64Decode)),t.maxAge||t.maxAge===0){let i=n?.auth_time;if(!i)throw v(Pr);Ks(i,t.maxAge)}return Ie.generateAuthenticationResult(this.cryptoUtils,this.authority,e,!0,t,n)}};var Ia={};ze(Ia,{getAuthorizationCodePayload:()=>IP,getAuthorizeUrl:()=>RP,getStandardAuthorizeRequestParameters:()=>wP,validateAuthorizationResponse:()=>Uv});function wP(r,e,t,n){let i=e.correlationId,o=new Map;Ii(o,e.embeddedClientId||e.extraQueryParameters?.[yr]||r.clientId);let s=[...e.scopes||[],...e.extraScopesToConsent||[]];if(Ri(o,s,!0,r.authority.options.OIDCOptions?.defaultScopes),bi(o,e.redirectUri),ki(o,i),bp(o,e.responseMode),xi(o),e.prompt&&(Pp(o,e.prompt),n?.addFields({prompt:e.prompt},i)),e.domainHint&&(xp(o,e.domainHint),n?.addFields({domainHintFromRequest:!0},i)),e.prompt!==Wt.SELECT_ACCOUNT)if(e.sid&&e.prompt===Wt.NONE)t.verbose("createAuthCodeUrlQueryString: Prompt is none, adding sid from request"),ku(o,e.sid),n?.addFields({sidFromRequest:!0},i);else if(e.account){let a=OP(e.account),c=kP(e.account);if(c&&e.domainHint&&(t.warning('AuthorizationCodeClient.createAuthCodeUrlQueryString: "domainHint" param is set, skipping opaque "login_hint" claim. Please consider not passing domainHint'),c=null),c){t.verbose("createAuthCodeUrlQueryString: login_hint claim present on account"),No(o,c),n?.addFields({loginHintFromClaim:!0},i);try{let l=mr(e.account.homeAccountId);$r(o,l)}catch{t.verbose("createAuthCodeUrlQueryString: Could not parse home account ID for CCS Header")}}else if(a&&e.prompt===Wt.NONE){t.verbose("createAuthCodeUrlQueryString: Prompt is none, adding sid from account"),ku(o,a),n?.addFields({sidFromClaim:!0},i);try{let l=mr(e.account.homeAccountId);$r(o,l)}catch{t.verbose("createAuthCodeUrlQueryString: Could not parse home account ID for CCS Header")}}else if(e.loginHint)t.verbose("createAuthCodeUrlQueryString: Adding login_hint from request"),No(o,e.loginHint),un(o,e.loginHint),n?.addFields({loginHintFromRequest:!0},i);else if(e.account.username){t.verbose("createAuthCodeUrlQueryString: Adding login_hint from account"),No(o,e.account.username),n?.addFields({loginHintFromUpn:!0},i);try{let l=mr(e.account.homeAccountId);$r(o,l)}catch{t.verbose("createAuthCodeUrlQueryString: Could not parse home account ID for CCS Header")}}}else e.loginHint&&(t.verbose("createAuthCodeUrlQueryString: No account, adding login_hint from request"),No(o,e.loginHint),un(o,e.loginHint),n?.addFields({loginHintFromRequest:!0},i));else t.verbose("createAuthCodeUrlQueryString: Prompt is select_account, ignoring account hints");return e.nonce&&Np(o,e.nonce),e.state&&da(o,e.state),(e.claims||r.clientCapabilities&&r.clientCapabilities.length>0)&&Oi(o,e.claims,r.clientCapabilities),e.embeddedClientId&&jr(o,r.clientId,r.redirectUri),r.instanceAware&&(!e.extraQueryParameters||!Object.keys(e.extraQueryParameters).includes(Po))&&ga(o),o}function RP(r,e,t,n){let i=gr(e,t,n);return J.appendQueryString(r.authorizationEndpoint,i)}function IP(r,e){if(Uv(r,e),!r.code)throw v(ui);return r}function Uv(r,e){if(!r.state||!e)throw r.state?v(nn,"Cached State"):v(nn,"Server State");let t,n;try{t=decodeURIComponent(r.state)}catch{throw v(Zt,r.state)}try{n=decodeURIComponent(e)}catch{throw v(Zt,r.state)}if(t!==n)throw v(ti);if(r.error||r.error_description||r.suberror){let i=bP(r);throw Lu(r.error,r.error_description,r.suberror)?new Ot(r.error||"",r.error_description,r.suberror,r.timestamp||"",r.trace_id||"",r.correlation_id||"",r.claims||"",i):new Je(r.error||"",r.error_description,r.suberror,i)}}function bP(r){let e="code=",t=r.error_uri?.lastIndexOf(e);return t&&t>=0?r.error_uri?.substring(t+e.length):void 0}function OP(r){return r.idTokenClaims?.sid||null}function kP(r){return r.idTokenClaims?.login_hint||null}var Hv=",",Fv="|";function xP(r){let{skus:e,libraryName:t,libraryVersion:n,extensionName:i,extensionVersion:o}=r,s=new Map([[0,[t,n]],[2,[i,o]]]),a=[];if(e?.length){if(a=e.split(Hv),a.length<4)return e}else a=Array.from({length:4},()=>Fv);return s.forEach((c,l)=>{c.length===2&&c[0]?.length&&c[1]?.length&&PP({skuArr:a,index:l,skuName:c[0],skuVersion:c[1]})}),a.join(Hv)}function PP(r){let{skuArr:e,index:t,skuName:n,skuVersion:i}=r;t>=e.length||(e[t]=[n,i].join(Fv))}var Ni=class r{constructor(e,t){this.cacheOutcome=le.NOT_APPLICABLE,this.cacheManager=t,this.apiId=e.apiId,this.correlationId=e.correlationId,this.wrapperSKU=e.wrapperSKU||E.EMPTY_STRING,this.wrapperVer=e.wrapperVer||E.EMPTY_STRING,this.telemetryCacheKey=Pe.CACHE_KEY+Ae.CACHE_KEY_SEPARATOR+e.clientId}generateCurrentRequestHeaderValue(){let e=`${this.apiId}${Pe.VALUE_SEPARATOR}${this.cacheOutcome}`,t=[this.wrapperSKU,this.wrapperVer],n=this.getNativeBrokerErrorCode();n?.length&&t.push(`broker_error=${n}`);let i=t.join(Pe.VALUE_SEPARATOR),o=this.getRegionDiscoveryFields(),s=[e,o].join(Pe.VALUE_SEPARATOR);return[Pe.SCHEMA_VERSION,s,i].join(Pe.CATEGORY_SEPARATOR)}generateLastRequestHeaderValue(){let e=this.getLastRequests(),t=r.maxErrorsToSend(e),n=e.failedRequests.slice(0,2*t).join(Pe.VALUE_SEPARATOR),i=e.errors.slice(0,t).join(Pe.VALUE_SEPARATOR),o=e.errors.length,s=t<o?Pe.OVERFLOW_TRUE:Pe.OVERFLOW_FALSE,a=[o,s].join(Pe.VALUE_SEPARATOR);return[Pe.SCHEMA_VERSION,e.cacheHits,n,i,a].join(Pe.CATEGORY_SEPARATOR)}cacheFailedRequest(e){let t=this.getLastRequests();t.errors.length>=Pe.MAX_CACHED_ERRORS&&(t.failedRequests.shift(),t.failedRequests.shift(),t.errors.shift()),t.failedRequests.push(this.apiId,this.correlationId),e instanceof Error&&e&&e.toString()?e instanceof Z?e.subError?t.errors.push(e.subError):e.errorCode?t.errors.push(e.errorCode):t.errors.push(e.toString()):t.errors.push(e.toString()):t.errors.push(Pe.UNKNOWN_ERROR),this.cacheManager.setServerTelemetry(this.telemetryCacheKey,t)}incrementCacheHits(){let e=this.getLastRequests();return e.cacheHits+=1,this.cacheManager.setServerTelemetry(this.telemetryCacheKey,e),e.cacheHits}getLastRequests(){let e={failedRequests:[],errors:[],cacheHits:0};return this.cacheManager.getServerTelemetry(this.telemetryCacheKey)||e}clearTelemetryCache(){let e=this.getLastRequests(),t=r.maxErrorsToSend(e),n=e.errors.length;if(t===n)this.cacheManager.removeItem(this.telemetryCacheKey);else{let i={failedRequests:e.failedRequests.slice(t*2),errors:e.errors.slice(t),cacheHits:0};this.cacheManager.setServerTelemetry(this.telemetryCacheKey,i)}}static maxErrorsToSend(e){let t,n=0,i=0,o=e.errors.length;for(t=0;t<o;t++){let s=e.failedRequests[2*t]||E.EMPTY_STRING,a=e.failedRequests[2*t+1]||E.EMPTY_STRING,c=e.errors[t]||E.EMPTY_STRING;if(i+=s.toString().length+a.toString().length+c.length+3,i<Pe.MAX_LAST_HEADER_BYTES)n+=1;else break}return n}getRegionDiscoveryFields(){let e=[];return e.push(this.regionUsed||E.EMPTY_STRING),e.push(this.regionSource||E.EMPTY_STRING),e.push(this.regionOutcome||E.EMPTY_STRING),e.join(",")}updateRegionDiscoveryMetadata(e){this.regionUsed=e.region_used,this.regionSource=e.region_source,this.regionOutcome=e.region_outcome}setCacheOutcome(e){this.cacheOutcome=e}setNativeBrokerErrorCode(e){let t=this.getLastRequests();t.nativeBrokerErrorCode=e,this.cacheManager.setServerTelemetry(this.telemetryCacheKey,t)}getNativeBrokerErrorCode(){return this.getLastRequests().nativeBrokerErrorCode}clearNativeBrokerErrorCode(){let e=this.getLastRequests();delete e.nativeBrokerErrorCode,this.cacheManager.setServerTelemetry(this.telemetryCacheKey,e)}static makeExtraSkuString(e){return xP(e)}};var Br=class{static deserializeJSONBlob(e){return e?JSON.parse(e):{}}static deserializeAccounts(e){let t={};return e&&Object.keys(e).map(function(n){let i=e[n],o={homeAccountId:i.home_account_id,environment:i.environment,realm:i.realm,localAccountId:i.local_account_id,username:i.username,authorityType:i.authority_type,name:i.name,clientInfo:i.client_info,lastModificationTime:i.last_modification_time,lastModificationApp:i.last_modification_app,tenantProfiles:i.tenantProfiles?.map(a=>JSON.parse(a))},s=new $e;ln.toObject(s,o),t[n]=s}),t}static deserializeIdTokens(e){let t={};return e&&Object.keys(e).map(function(n){let i=e[n],o={homeAccountId:i.home_account_id,environment:i.environment,credentialType:i.credential_type,clientId:i.client_id,secret:i.secret,realm:i.realm};t[n]=o}),t}static deserializeAccessTokens(e){let t={};return e&&Object.keys(e).map(function(n){let i=e[n],o={homeAccountId:i.home_account_id,environment:i.environment,credentialType:i.credential_type,clientId:i.client_id,secret:i.secret,realm:i.realm,target:i.target,cachedAt:i.cached_at,expiresOn:i.expires_on,extendedExpiresOn:i.extended_expires_on,refreshOn:i.refresh_on,keyId:i.key_id,tokenType:i.token_type,requestedClaims:i.requestedClaims,requestedClaimsHash:i.requestedClaimsHash,userAssertionHash:i.userAssertionHash};t[n]=o}),t}static deserializeRefreshTokens(e){let t={};return e&&Object.keys(e).map(function(n){let i=e[n],o={homeAccountId:i.home_account_id,environment:i.environment,credentialType:i.credential_type,clientId:i.client_id,secret:i.secret,familyId:i.family_id,target:i.target,realm:i.realm};t[n]=o}),t}static deserializeAppMetadata(e){let t={};return e&&Object.keys(e).map(function(n){let i=e[n];t[n]={clientId:i.client_id,environment:i.environment,familyId:i.family_id}}),t}static deserializeAllCache(e){return{accounts:e.Account?this.deserializeAccounts(e.Account):{},idTokens:e.IdToken?this.deserializeIdTokens(e.IdToken):{},accessTokens:e.AccessToken?this.deserializeAccessTokens(e.AccessToken):{},refreshTokens:e.RefreshToken?this.deserializeRefreshTokens(e.RefreshToken):{},appMetadata:e.AppMetadata?this.deserializeAppMetadata(e.AppMetadata):{}}}};var $v="Authorization",pn="Metadata",qv="X-IDENTITY-HEADER",$u="secret",Er="api-version",Ft="resource",jv="system_assigned_managed_identity",HP="managed_identity",Gp=`https://login.microsoftonline.com/${HP}/`,j={AZURE_POD_IDENTITY_AUTHORITY_HOST:"AZURE_POD_IDENTITY_AUTHORITY_HOST",IDENTITY_ENDPOINT:"IDENTITY_ENDPOINT",IDENTITY_HEADER:"IDENTITY_HEADER",IDENTITY_SERVER_THUMBPRINT:"IDENTITY_SERVER_THUMBPRINT",IMDS_ENDPOINT:"IMDS_ENDPOINT",MSI_ENDPOINT:"MSI_ENDPOINT",MSI_SECRET:"MSI_SECRET"},V={APP_SERVICE:"AppService",AZURE_ARC:"AzureArc",CLOUD_SHELL:"CloudShell",DEFAULT_TO_IMDS:"DefaultToImds",IMDS:"Imds",MACHINE_LEARNING:"MachineLearning",SERVICE_FABRIC:"ServiceFabric"},Se={SYSTEM_ASSIGNED:"system-assigned",USER_ASSIGNED_CLIENT_ID:"user-assigned-client-id",USER_ASSIGNED_RESOURCE_ID:"user-assigned-resource-id",USER_ASSIGNED_OBJECT_ID:"user-assigned-object-id"},pe={GET:"get",POST:"post"},qu={SUCCESS:W.SUCCESS,SUCCESS_RANGE_START:W.SUCCESS_RANGE_START,SUCCESS_RANGE_END:W.SUCCESS_RANGE_END,SERVER_ERROR:W.SERVER_ERROR},Bv="REGION_NAME",zv="MSAL_FORCE_REGION",Gv=32,Vv={SHA256:"sha256"},ju={CV_CHARSET:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~"},Me={MSAL_SKU:"msal.js.node",JWT_BEARER_ASSERTION_TYPE:"urn:ietf:params:oauth:client-assertion-type:jwt-bearer",AUTHORIZATION_PENDING:"authorization_pending",HTTP_PROTOCOL:"http://",LOCALHOST:"localhost"},zr={acquireTokenSilent:62,acquireTokenByUsernamePassword:371,acquireTokenByDeviceCode:671,acquireTokenByClientCredential:771,acquireTokenByCode:871,acquireTokenByRefreshToken:872},$t={ALGORITHM:"alg",RSA_256:"RS256",PSS_256:"PS256",X5T_256:"x5t#S256",X5T:"x5t",X5C:"x5c",AUDIENCE:"aud",EXPIRATION_TIME:"exp",ISSUER:"iss",SUBJECT:"sub",NOT_BEFORE:"nbf",JWT_ID:"jti"},Bu={INTERVAL_MS:100,TIMEOUT_MS:5e3},Kv=4096;var Do=class{static getNetworkResponse(e,t,n){return{headers:e,body:t,status:n}}static urlToHttpOptions(e){let t={protocol:e.protocol,hostname:e.hostname&&e.hostname.startsWith("[")?e.hostname.slice(1,-1):e.hostname,hash:e.hash,search:e.search,pathname:e.pathname,path:`${e.pathname||""}${e.search||""}`,href:e.href};return e.port!==""&&(t.port=Number(e.port)),(e.username||e.password)&&(t.auth=`${decodeURIComponent(e.username)}:${decodeURIComponent(e.password)}`),t}};import Vp from"http";import Yv from"https";var Lo=class{constructor(e,t){this.proxyUrl=e||"",this.customAgentOptions=t||{}}async sendGetRequestAsync(e,t,n){return this.proxyUrl?Wv(e,this.proxyUrl,pe.GET,t,this.customAgentOptions,n):Zv(e,pe.GET,t,this.customAgentOptions,n)}async sendPostRequestAsync(e,t){return this.proxyUrl?Wv(e,this.proxyUrl,pe.POST,t,this.customAgentOptions):Zv(e,pe.POST,t,this.customAgentOptions)}},Wv=(r,e,t,n,i,o)=>{let s=new URL(r),a=new URL(e),c=n?.headers||{},l={host:a.hostname,port:a.port,method:"CONNECT",path:s.hostname,headers:c};i&&Object.keys(i).length&&(l.agent=new Vp.Agent(i));let u="";if(t===pe.POST){let h=n?.body||"";u=`Content-Type: application/x-www-form-urlencoded\r
Content-Length: ${h.length}\r
\r
${h}`}else o&&(l.timeout=o);let d=`${t.toUpperCase()} ${s.href} HTTP/1.1\r
Host: ${s.host}\r
Connection: close\r
`+u+`\r
`;return new Promise((h,p)=>{let m=Vp.request(l);o&&m.on("timeout",()=>{m.destroy(),p(new Error("Request time out"))}),m.end(),m.on("connect",(y,A)=>{let P=y?.statusCode||qu.SERVER_ERROR;(P<qu.SUCCESS_RANGE_START||P>qu.SUCCESS_RANGE_END)&&(m.destroy(),A.destroy(),p(new Error(`Error connecting to proxy. Http status code: ${y.statusCode}. Http status message: ${y?.statusMessage||"Unknown"}`))),A.write(d);let D=[];A.on("data",U=>{D.push(U)}),A.on("end",()=>{let H=Buffer.concat([...D]).toString().split(`\r
`),w=parseInt(H[0].split(" ")[1]),b=H[0].split(" ").slice(2).join(" "),S=H[H.length-1],L=H.slice(1,H.length-2),ee=new Map;L.forEach(es=>{let eg=es.split(new RegExp(/:\s(.*)/s)),vw=eg[0],Gd=eg[1];try{let Ja=JSON.parse(Gd);Ja&&typeof Ja=="object"&&(Gd=Ja)}catch{}ee.set(vw,Gd)});let X=Object.fromEntries(ee),we=Do.getNetworkResponse(X,Xv(w,b,X,S),w);(w<W.SUCCESS_RANGE_START||w>W.SUCCESS_RANGE_END)&&we.body.error!==Me.AUTHORIZATION_PENDING&&m.destroy(),h(we)}),A.on("error",U=>{m.destroy(),A.destroy(),p(new Error(U.toString()))})}),m.on("error",y=>{m.destroy(),p(new Error(y.toString()))})})},Zv=(r,e,t,n,i)=>{let o=e===pe.POST,s=t?.body||"",a=new URL(r),c=t?.headers||{},l={method:e,headers:c,...Do.urlToHttpOptions(a)};return n&&Object.keys(n).length&&(l.agent=new Yv.Agent(n)),o?l.headers={...l.headers,"Content-Length":s.length}:i&&(l.timeout=i),new Promise((u,d)=>{let h;l.protocol==="http:"?h=Vp.request(l):h=Yv.request(l),o&&h.write(s),i&&h.on("timeout",()=>{h.destroy(),d(new Error("Request time out"))}),h.end(),h.on("response",p=>{let m=p.headers,y=p.statusCode,A=p.statusMessage,P=[];p.on("data",D=>{P.push(D)}),p.on("end",()=>{let D=Buffer.concat([...P]).toString(),U=m,H=Do.getNetworkResponse(U,Xv(y,A,U,D),y);(y<W.SUCCESS_RANGE_START||y>W.SUCCESS_RANGE_END)&&H.body.error!==Me.AUTHORIZATION_PENDING&&h.destroy(),u(H)})}),h.on("error",p=>{h.destroy(),d(new Error(p.toString()))})})},Xv=(r,e,t,n)=>{let i;try{i=JSON.parse(n)}catch{let s,a;r>=W.CLIENT_ERROR_RANGE_START&&r<=W.CLIENT_ERROR_RANGE_END?(s="client_error",a="A client"):r>=W.SERVER_ERROR_RANGE_START&&r<=W.SERVER_ERROR_RANGE_END?(s="server_error",a="A server"):(s="unknown_error",a="An unknown"),i={error:s,error_description:`${a} error occured.
Http status code: ${r}
Http status message: ${e||"Unknown"}
Headers: ${JSON.stringify(t)}`}}return i};var zu="invalid_file_extension",Gu="invalid_file_path",mn="invalid_managed_identity_id_type",Vu="invalid_secret",Qv="missing_client_id",Jv="network_unavailable",Ku="platform_not_supported",Yu="unable_to_create_azure_arc",Wu="unable_to_create_cloud_shell",Zu="unable_to_create_source",ba="unable_to_read_secret_file",eC="user_assigned_not_available_at_runtime",Xu="www_authenticate_header_missing",Qu="www_authenticate_header_unsupported_format",Mi={[j.AZURE_POD_IDENTITY_AUTHORITY_HOST]:"azure_pod_identity_authority_host_url_malformed",[j.IDENTITY_ENDPOINT]:"identity_endpoint_url_malformed",[j.IMDS_ENDPOINT]:"imds_endpoint_url_malformed",[j.MSI_ENDPOINT]:"msi_endpoint_url_malformed"};var FP={[zu]:"The file path in the WWW-Authenticate header does not contain a .key file.",[Gu]:"The file path in the WWW-Authenticate header is not in a valid Windows or Linux Format.",[mn]:"More than one ManagedIdentityIdType was provided.",[Vu]:"The secret in the file on the file path in the WWW-Authenticate header is greater than 4096 bytes.",[Ku]:"The platform is not supported by Azure Arc. Azure Arc only supports Windows and Linux.",[Qv]:"A ManagedIdentityId id was not provided.",[Mi.AZURE_POD_IDENTITY_AUTHORITY_HOST]:`The Managed Identity's '${j.AZURE_POD_IDENTITY_AUTHORITY_HOST}' environment variable is malformed.`,[Mi.IDENTITY_ENDPOINT]:`The Managed Identity's '${j.IDENTITY_ENDPOINT}' environment variable is malformed.`,[Mi.IMDS_ENDPOINT]:`The Managed Identity's '${j.IMDS_ENDPOINT}' environment variable is malformed.`,[Mi.MSI_ENDPOINT]:`The Managed Identity's '${j.MSI_ENDPOINT}' environment variable is malformed.`,[Jv]:"Authentication unavailable. The request to the managed identity endpoint timed out.",[Yu]:"Azure Arc Managed Identities can only be system assigned.",[Wu]:"Cloud Shell Managed Identities can only be system assigned.",[Zu]:"Unable to create a Managed Identity source based on environment variables.",[ba]:"Unable to read the secret file.",[eC]:"Service Fabric user assigned managed identity ClientId or ResourceId is not configurable at runtime.",[Xu]:"A 401 response was received form the Azure Arc Managed Identity, but the www-authenticate header is missing.",[Qu]:"A 401 response was received form the Azure Arc Managed Identity, but the www-authenticate header is in an unsupported format."},Kp=class r extends Z{constructor(e){super(e,FP[e]),this.name="ManagedIdentityError",Object.setPrototypeOf(this,r.prototype)}};function be(r){return new Kp(r)}var Ju=class{get id(){return this._id}set id(e){this._id=e}get idType(){return this._idType}set idType(e){this._idType=e}constructor(e){let t=e?.userAssignedClientId,n=e?.userAssignedResourceId,i=e?.userAssignedObjectId;if(t){if(n||i)throw be(mn);this.id=t,this.idType=Se.USER_ASSIGNED_CLIENT_ID}else if(n){if(t||i)throw be(mn);this.id=n,this.idType=Se.USER_ASSIGNED_RESOURCE_ID}else if(i){if(t||n)throw be(mn);this.id=i,this.idType=Se.USER_ASSIGNED_OBJECT_ID}else this.id=jv,this.idType=Se.SYSTEM_ASSIGNED}};var Ue={invalidLoopbackAddressType:{code:"invalid_loopback_server_address_type",desc:"Loopback server address is not type string. This is unexpected."},unableToLoadRedirectUri:{code:"unable_to_load_redirectUrl",desc:"Loopback server callback was invoked without a url. This is unexpected."},noAuthCodeInResponse:{code:"no_auth_code_in_response",desc:"No auth code found in the server response. Please check your network trace to determine what happened."},noLoopbackServerExists:{code:"no_loopback_server_exists",desc:"No loopback server exists yet."},loopbackServerAlreadyExists:{code:"loopback_server_already_exists",desc:"Loopback server already exists. Cannot create another."},loopbackServerTimeout:{code:"loopback_server_timeout",desc:"Timed out waiting for auth code listener to be registered."},stateNotFoundError:{code:"state_not_found",desc:"State not found. Please verify that the request originated from msal."},thumbprintMissing:{code:"thumbprint_missing_from_client_certificate",desc:"Client certificate does not contain a SHA-1 or SHA-256 thumbprint."}},ht=class r extends Z{constructor(e,t){super(e,t),this.name="NodeAuthError"}static createInvalidLoopbackAddressTypeError(){return new r(Ue.invalidLoopbackAddressType.code,`${Ue.invalidLoopbackAddressType.desc}`)}static createUnableToLoadRedirectUrlError(){return new r(Ue.unableToLoadRedirectUri.code,`${Ue.unableToLoadRedirectUri.desc}`)}static createNoAuthCodeInResponseError(){return new r(Ue.noAuthCodeInResponse.code,`${Ue.noAuthCodeInResponse.desc}`)}static createNoLoopbackServerExistsError(){return new r(Ue.noLoopbackServerExists.code,`${Ue.noLoopbackServerExists.desc}`)}static createLoopbackServerAlreadyExistsError(){return new r(Ue.loopbackServerAlreadyExists.code,`${Ue.loopbackServerAlreadyExists.desc}`)}static createLoopbackServerTimeoutError(){return new r(Ue.loopbackServerTimeout.code,`${Ue.loopbackServerTimeout.desc}`)}static createStateNotFoundError(){return new r(Ue.stateNotFoundError.code,Ue.stateNotFoundError.desc)}static createThumbprintMissingError(){return new r(Ue.thumbprintMissing.code,Ue.thumbprintMissing.desc)}};var $P={clientId:E.EMPTY_STRING,authority:E.DEFAULT_AUTHORITY,clientSecret:E.EMPTY_STRING,clientAssertion:E.EMPTY_STRING,clientCertificate:{thumbprint:E.EMPTY_STRING,thumbprintSha256:E.EMPTY_STRING,privateKey:E.EMPTY_STRING,x5c:E.EMPTY_STRING},knownAuthorities:[],cloudDiscoveryMetadata:E.EMPTY_STRING,authorityMetadata:E.EMPTY_STRING,clientCapabilities:[],protocolMode:Ve.AAD,azureCloudOptions:{azureCloudInstance:Lr.None,tenant:E.EMPTY_STRING},skipAuthorityMetadataCache:!1,encodeExtraQueryParams:!1},qP={claimsBasedCachingEnabled:!1},Yp={loggerCallback:()=>{},piiLoggingEnabled:!1,logLevel:ve.Info},jP={loggerOptions:Yp,networkClient:new Lo,proxyUrl:E.EMPTY_STRING,customAgentOptions:{},disableInternalRetries:!1},BP={application:{appName:E.EMPTY_STRING,appVersion:E.EMPTY_STRING}};function tC({auth:r,broker:e,cache:t,system:n,telemetry:i}){let o={...jP,networkClient:new Lo(n?.proxyUrl,n?.customAgentOptions),loggerOptions:n?.loggerOptions||Yp,disableInternalRetries:n?.disableInternalRetries||!1};if(r.clientCertificate&&!r.clientCertificate.thumbprint&&!r.clientCertificate.thumbprintSha256)throw ht.createStateNotFoundError();return{auth:{...$P,...r},broker:{...e},cache:{...qP,...t},system:{...o,...n},telemetry:{...BP,...i}}}function rC({managedIdentityIdParams:r,system:e}){let t=new Ju(r),n=e?.loggerOptions||Yp,i;return e?.networkClient?i=e.networkClient:i=new Lo(e?.proxyUrl,e?.customAgentOptions),{managedIdentityId:t,system:{loggerOptions:n,networkClient:i},disableInternalRetries:e?.disableInternalRetries||!1}}import zP from"crypto";var td=new Uint8Array(256),ed=td.length;function Wp(){return ed>td.length-16&&(zP.randomFillSync(td),ed=0),td.slice(ed,ed+=16)}var nC=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function GP(r){return typeof r=="string"&&nC.test(r)}var iC=GP;var Be=[];for(let r=0;r<256;++r)Be.push((r+256).toString(16).substr(1));function VP(r,e=0){let t=(Be[r[e+0]]+Be[r[e+1]]+Be[r[e+2]]+Be[r[e+3]]+"-"+Be[r[e+4]]+Be[r[e+5]]+"-"+Be[r[e+6]]+Be[r[e+7]]+"-"+Be[r[e+8]]+Be[r[e+9]]+"-"+Be[r[e+10]]+Be[r[e+11]]+Be[r[e+12]]+Be[r[e+13]]+Be[r[e+14]]+Be[r[e+15]]).toLowerCase();if(!iC(t))throw TypeError("Stringified UUID is invalid");return t}var oC=VP;function KP(r,e,t){r=r||{};let n=r.random||(r.rng||Wp)();if(n[6]=n[6]&15|64,n[8]=n[8]&63|128,e){t=t||0;for(let i=0;i<16;++i)e[t+i]=n[i];return e}return oC(n)}var Zp=KP;var rd=class{generateGuid(){return Zp()}isGuid(e){return/^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(e)}};var xt=class r{static base64Encode(e,t){return Buffer.from(e,t).toString("base64")}static base64EncodeUrl(e,t){return r.base64Encode(e,t).replace(/=/g,E.EMPTY_STRING).replace(/\+/g,"-").replace(/\//g,"_")}static base64Decode(e){return Buffer.from(e,"base64").toString("utf8")}static base64DecodeUrl(e){let t=e.replace(/-/g,"+").replace(/_/g,"/");for(;t.length%4;)t+="=";return r.base64Decode(t)}};import YP from"crypto";var Uo=class{sha256(e){return YP.createHash(Vv.SHA256).update(e).digest()}};import WP from"crypto";var nd=class{constructor(){this.hashUtils=new Uo}async generatePkceCodes(){let e=this.generateCodeVerifier(),t=this.generateCodeChallengeFromVerifier(e);return{verifier:e,challenge:t}}generateCodeVerifier(){let e=[],t=256-256%ju.CV_CHARSET.length;for(;e.length<=Gv;){let i=WP.randomBytes(1)[0];if(i>=t)continue;let o=i%ju.CV_CHARSET.length;e.push(ju.CV_CHARSET[o])}let n=e.join(E.EMPTY_STRING);return xt.base64EncodeUrl(n)}generateCodeChallengeFromVerifier(e){return xt.base64EncodeUrl(this.hashUtils.sha256(e).toString("base64"),"base64")}};var gn=class{constructor(){this.pkceGenerator=new nd,this.guidGenerator=new rd,this.hashUtils=new Uo}base64UrlEncode(){throw new Error("Method not implemented.")}encodeKid(){throw new Error("Method not implemented.")}createNewGuid(){return this.guidGenerator.generateGuid()}base64Encode(e){return xt.base64Encode(e)}base64Decode(e){return xt.base64Decode(e)}generatePkceCodes(){return this.pkceGenerator.generatePkceCodes()}getPublicKeyThumbprint(){throw new Error("Method not implemented.")}removeTokenBindingKey(){throw new Error("Method not implemented.")}clearKeystore(){throw new Error("Method not implemented.")}signJwt(){throw new Error("Method not implemented.")}async hashString(e){return xt.base64EncodeUrl(this.hashUtils.sha256(e).toString("base64"),"base64")}};var yn=class extends ln{constructor(e,t,n,i){super(t,n,e,i),this.cache={},this.changeEmitters=[],this.logger=e}registerChangeEmitter(e){this.changeEmitters.push(e)}emitChange(){this.changeEmitters.forEach(e=>e.call(null))}cacheToInMemoryCache(e){let t={accounts:{},idTokens:{},accessTokens:{},refreshTokens:{},appMetadata:{}};for(let n in e){let i=e[n];if(typeof i=="object")if(i instanceof $e)t.accounts[n]=i;else if(Ne.isIdTokenEntity(i))t.idTokens[n]=i;else if(Ne.isAccessTokenEntity(i))t.accessTokens[n]=i;else if(Ne.isRefreshTokenEntity(i))t.refreshTokens[n]=i;else if(Ne.isAppMetadataEntity(n,i))t.appMetadata[n]=i;else continue}return t}inMemoryCacheToCache(e){let t=this.getCache();return t={...t,...e.accounts,...e.idTokens,...e.accessTokens,...e.refreshTokens,...e.appMetadata},t}getInMemoryCache(){return this.logger.trace("Getting in-memory cache"),this.cacheToInMemoryCache(this.getCache())}setInMemoryCache(e){this.logger.trace("Setting in-memory cache");let t=this.inMemoryCacheToCache(e);this.setCache(t),this.emitChange()}getCache(){return this.logger.trace("Getting cache key-value store"),this.cache}setCache(e){this.logger.trace("Setting cache key value store"),this.cache=e,this.emitChange()}getItem(e){return this.logger.tracePii(`Item key: ${e}`),this.getCache()[e]}setItem(e,t){this.logger.tracePii(`Item key: ${e}`);let n=this.getCache();n[e]=t,this.setCache(n)}getAccountKeys(){let e=this.getInMemoryCache();return Object.keys(e.accounts)}getTokenKeys(){let e=this.getInMemoryCache();return{idToken:Object.keys(e.idTokens),accessToken:Object.keys(e.accessTokens),refreshToken:Object.keys(e.refreshTokens)}}getAccount(e){return this.getItem(e)?Object.assign(new $e,this.getItem(e)):null}async setAccount(e){let t=e.generateAccountKey();this.setItem(t,e)}getIdTokenCredential(e){let t=this.getItem(e);return Ne.isIdTokenEntity(t)?t:null}async setIdTokenCredential(e){let t=Ne.generateCredentialKey(e);this.setItem(t,e)}getAccessTokenCredential(e){let t=this.getItem(e);return Ne.isAccessTokenEntity(t)?t:null}async setAccessTokenCredential(e){let t=Ne.generateCredentialKey(e);this.setItem(t,e)}getRefreshTokenCredential(e){let t=this.getItem(e);return Ne.isRefreshTokenEntity(t)?t:null}async setRefreshTokenCredential(e){let t=Ne.generateCredentialKey(e);this.setItem(t,e)}getAppMetadata(e){let t=this.getItem(e);return Ne.isAppMetadataEntity(e,t)?t:null}setAppMetadata(e){let t=Ne.generateAppMetadataKey(e);this.setItem(t,e)}getServerTelemetry(e){let t=this.getItem(e);return t&&Ne.isServerTelemetryEntity(e,t)?t:null}setServerTelemetry(e,t){this.setItem(e,t)}getAuthorityMetadata(e){let t=this.getItem(e);return t&&Ne.isAuthorityMetadataEntity(e,t)?t:null}getAuthorityMetadataKeys(){return this.getKeys().filter(e=>this.isAuthorityMetadata(e))}setAuthorityMetadata(e,t){this.setItem(e,t)}getThrottlingCache(e){let t=this.getItem(e);return t&&Ne.isThrottlingEntity(e,t)?t:null}setThrottlingCache(e,t){this.setItem(e,t)}removeItem(e){this.logger.tracePii(`Item key: ${e}`);let t=!1,n=this.getCache();return n[e]&&(delete n[e],t=!0),t&&(this.setCache(n),this.emitChange()),t}removeOutdatedAccount(e){this.removeItem(e)}containsKey(e){return this.getKeys().includes(e)}getKeys(){this.logger.trace("Retrieving all cache keys");let e=this.getCache();return[...Object.keys(e)]}clear(){this.logger.trace("Clearing cache entries created by MSAL"),this.getKeys().forEach(t=>{this.removeItem(t)}),this.emitChange()}static generateInMemoryCache(e){return Br.deserializeAllCache(Br.deserializeJSONBlob(e))}static generateJsonCache(e){return en.serializeAllCache(e)}updateCredentialCacheKey(e,t){let n=Ne.generateCredentialKey(t);if(e!==n){let i=this.getItem(e);if(i)return this.removeItem(e),this.setItem(n,i),this.logger.verbose(`Updated an outdated ${t.credentialType} cache key`),n;this.logger.error(`Attempted to update an outdated ${t.credentialType} cache key but no item matching the outdated key was found in storage`)}return e}};var Oa={Account:{},IdToken:{},AccessToken:{},RefreshToken:{},AppMetadata:{}},Ho=class{constructor(e,t,n){this.cacheHasChanged=!1,this.storage=e,this.storage.registerChangeEmitter(this.handleChangeEvent.bind(this)),n&&(this.persistence=n),this.logger=t}hasChanged(){return this.cacheHasChanged}serialize(){this.logger.trace("Serializing in-memory cache");let e=en.serializeAllCache(this.storage.getInMemoryCache());return this.cacheSnapshot?(this.logger.trace("Reading cache snapshot from disk"),e=this.mergeState(JSON.parse(this.cacheSnapshot),e)):this.logger.trace("No cache snapshot to merge"),this.cacheHasChanged=!1,JSON.stringify(e)}deserialize(e){if(this.logger.trace("Deserializing JSON to in-memory cache"),this.cacheSnapshot=e,this.cacheSnapshot){this.logger.trace("Reading cache snapshot from disk");let t=Br.deserializeAllCache(this.overlayDefaults(JSON.parse(this.cacheSnapshot)));this.storage.setInMemoryCache(t)}else this.logger.trace("No cache snapshot to deserialize")}getKVStore(){return this.storage.getCache()}getCacheSnapshot(){let e=yn.generateInMemoryCache(this.cacheSnapshot);return this.storage.inMemoryCacheToCache(e)}async getAllAccounts(){this.logger.trace("getAllAccounts called");let e;try{return this.persistence&&(e=new kt(this,!1),await this.persistence.beforeCacheAccess(e)),this.storage.getAllAccounts()}finally{this.persistence&&e&&await this.persistence.afterCacheAccess(e)}}async getAccountByHomeId(e){let t=await this.getAllAccounts();return e&&t&&t.length&&t.filter(n=>n.homeAccountId===e)[0]||null}async getAccountByLocalId(e){let t=await this.getAllAccounts();return e&&t&&t.length&&t.filter(n=>n.localAccountId===e)[0]||null}async removeAccount(e){this.logger.trace("removeAccount called");let t;try{this.persistence&&(t=new kt(this,!0),await this.persistence.beforeCacheAccess(t)),await this.storage.removeAccount($e.generateAccountCacheKey(e))}finally{this.persistence&&t&&await this.persistence.afterCacheAccess(t)}}async overwriteCache(){if(!this.persistence){this.logger.info("No persistence layer specified, cache cannot be overwritten");return}this.logger.info("Overwriting in-memory cache with persistent cache"),this.storage.clear();let e=new kt(this,!1);await this.persistence.beforeCacheAccess(e);let t=this.getCacheSnapshot();this.storage.setCache(t),await this.persistence.afterCacheAccess(e)}handleChangeEvent(){this.cacheHasChanged=!0}mergeState(e,t){this.logger.trace("Merging in-memory cache with cache snapshot");let n=this.mergeRemovals(e,t);return this.mergeUpdates(n,t)}mergeUpdates(e,t){return Object.keys(t).forEach(n=>{let i=t[n];if(!e.hasOwnProperty(n))i!==null&&(e[n]=i);else{let o=i!==null,s=typeof i=="object",a=!Array.isArray(i),c=typeof e[n]<"u"&&e[n]!==null;o&&s&&a&&c?this.mergeUpdates(e[n],i):e[n]=i}}),e}mergeRemovals(e,t){this.logger.trace("Remove updated entries in cache");let n=e.Account?this.mergeRemovalsDict(e.Account,t.Account):e.Account,i=e.AccessToken?this.mergeRemovalsDict(e.AccessToken,t.AccessToken):e.AccessToken,o=e.RefreshToken?this.mergeRemovalsDict(e.RefreshToken,t.RefreshToken):e.RefreshToken,s=e.IdToken?this.mergeRemovalsDict(e.IdToken,t.IdToken):e.IdToken,a=e.AppMetadata?this.mergeRemovalsDict(e.AppMetadata,t.AppMetadata):e.AppMetadata;return{...e,Account:n,AccessToken:i,RefreshToken:o,IdToken:s,AppMetadata:a}}mergeRemovalsDict(e,t){let n={...e};return Object.keys(e).forEach(i=>{(!t||!t.hasOwnProperty(i))&&delete n[i]}),n}overlayDefaults(e){return this.logger.trace("Overlaying input cache with the default cache"),{Account:{...Oa.Account,...e.Account},IdToken:{...Oa.IdToken,...e.IdToken},AccessToken:{...Oa.AccessToken,...e.AccessToken},RefreshToken:{...Oa.RefreshToken,...e.RefreshToken},AppMetadata:{...Oa.AppMetadata,...e.AppMetadata}}}};var LS=qi(DS(),1);var Gr=class r{static fromAssertion(e){let t=new r;return t.jwt=e,t}static fromCertificate(e,t,n){let i=new r;return i.privateKey=t,i.thumbprint=e,i.useSha256=!1,n&&(i.publicCertificate=this.parseCertificate(n)),i}static fromCertificateWithSha256Thumbprint(e,t,n){let i=new r;return i.privateKey=t,i.thumbprint=e,i.useSha256=!0,n&&(i.publicCertificate=this.parseCertificate(n)),i}getJwt(e,t,n){if(this.privateKey&&this.thumbprint)return this.jwt&&!this.isExpired()&&t===this.issuer&&n===this.jwtAudience?this.jwt:this.createJwt(e,t,n);if(this.jwt)return this.jwt;throw v(ce.invalidAssertion)}createJwt(e,t,n){this.issuer=t,this.jwtAudience=n;let i=he.nowSeconds();this.expirationTime=i+600;let s={alg:this.useSha256?$t.PSS_256:$t.RSA_256},a=this.useSha256?$t.X5T_256:$t.X5T;Object.assign(s,{[a]:xt.base64EncodeUrl(this.thumbprint,"hex")}),this.publicCertificate&&Object.assign(s,{[$t.X5C]:this.publicCertificate});let c={[$t.AUDIENCE]:this.jwtAudience,[$t.EXPIRATION_TIME]:this.expirationTime,[$t.ISSUER]:this.issuer,[$t.SUBJECT]:this.issuer,[$t.NOT_BEFORE]:i,[$t.JWT_ID]:e.createNewGuid()};return this.jwt=LS.default.sign(c,this.privateKey,{header:s}),this.jwt}isExpired(){return this.expirationTime<he.nowSeconds()}static parseCertificate(e){let t=/-----BEGIN CERTIFICATE-----\r*\n(.+?)\r*\n-----END CERTIFICATE-----/gs,n=[],i;for(;(i=t.exec(e))!==null;)n.push(i[1].replace(/\r*\n/g,E.EMPTY_STRING));return n}};var Pd="@azure/msal-node",Jt="3.5.1";var Go=class extends je{constructor(e){super(e)}async acquireToken(e){this.logger.info("in acquireToken call in username-password client");let t=he.nowSeconds(),n=await this.executeTokenRequest(this.authority,e),i=new Ie(this.config.authOptions.clientId,this.cacheManager,this.cryptoUtils,this.logger,this.config.serializableCache,this.config.persistencePlugin);return i.validateTokenResponse(n.body),i.handleServerTokenResponse(n.body,this.authority,t,e)}async executeTokenRequest(e,t){let n=this.createTokenQueryParameters(t),i=J.appendQueryString(e.tokenEndpoint,n),o=await this.createTokenRequestBody(t),s=this.createTokenRequestHeaders({credential:t.username,type:Qe.UPN}),a={clientId:this.config.authOptions.clientId,authority:e.canonicalAuthority,scopes:t.scopes,claims:t.claims,authenticationScheme:t.authenticationScheme,resourceRequestMethod:t.resourceRequestMethod,resourceRequestUri:t.resourceRequestUri,shrClaims:t.shrClaims,sshKid:t.sshKid};return this.executePostToTokenEndpoint(i,o,s,a,t.correlationId)}async createTokenRequestBody(e){let t=new Map;I.addClientId(t,this.config.authOptions.clientId),I.addUsername(t,e.username),I.addPassword(t,e.password),I.addScopes(t,e.scopes),I.addResponseType(t,vo.IDTOKEN_TOKEN),I.addGrantType(t,ft.RESOURCE_OWNER_PASSWORD_GRANT),I.addClientInfo(t),I.addLibraryInfo(t,this.config.libraryInfo),I.addApplicationTelemetry(t,this.config.telemetry.application),I.addThrottling(t),this.serverTelemetryManager&&I.addServerTelemetry(t,this.serverTelemetryManager);let n=e.correlationId||this.config.cryptoInterface.createNewGuid();I.addCorrelationId(t,n),this.config.clientCredentials.clientSecret&&I.addClientSecret(t,this.config.clientCredentials.clientSecret);let i=this.config.clientCredentials.clientAssertion;return i&&(I.addClientAssertion(t,await et(i.assertion,this.config.authOptions.clientId,e.resourceRequestUri)),I.addClientAssertionType(t,i.assertionType)),(!ye.isEmptyObj(e.claims)||this.config.authOptions.clientCapabilities&&this.config.authOptions.clientCapabilities.length>0)&&I.addClaims(t,e.claims,this.config.authOptions.clientCapabilities),this.config.systemOptions.preventCorsPreflight&&e.username&&I.addCcsUpn(t,e.username),qe.mapToQueryString(t)}};function US(r,e,t,n){let i=Ia.getStandardAuthorizeRequestParameters({...r.auth,authority:e,redirectUri:t.redirectUri||""},t,n);return I.addLibraryInfo(i,{sku:Me.MSAL_SKU,version:Jt,cpu:process.arch||"",os:process.platform||""}),r.auth.protocolMode!==Ve.OIDC&&I.addApplicationTelemetry(i,r.telemetry.application),I.addResponseType(i,vo.CODE),t.codeChallenge&&t.codeChallengeMethod&&I.addCodeChallengeParams(i,t.codeChallenge,t.codeChallengeMethod),I.addExtraQueryParameters(i,t.extraQueryParameters||{}),Ia.getAuthorizeUrl(e,i,r.auth.encodeExtraQueryParams,t.extraQueryParameters)}var vn=class{constructor(e){this.config=tC(e),this.cryptoProvider=new gn,this.logger=new It(this.config.system.loggerOptions,Pd,Jt),this.storage=new yn(this.logger,this.config.auth.clientId,this.cryptoProvider,Hp(this.config.auth)),this.tokenCache=new Ho(this.storage,this.logger,this.config.cache.cachePlugin)}async getAuthCodeUrl(e){this.logger.info("getAuthCodeUrl called",e.correlationId);let t={...e,...await this.initializeBaseRequest(e),responseMode:e.responseMode||dr.QUERY,authenticationScheme:te.BEARER,state:e.state||"",nonce:e.nonce||""},n=await this.createAuthority(t.authority,t.correlationId,void 0,e.azureCloudOptions);return US(this.config,n,t,this.logger)}async acquireTokenByCode(e,t){this.logger.info("acquireTokenByCode called"),e.state&&t&&(this.logger.info("acquireTokenByCode - validating state"),this.validateState(e.state,t.state||""),t={...t,state:""});let n={...e,...await this.initializeBaseRequest(e),authenticationScheme:te.BEARER},i=this.initializeServerTelemetryManager(zr.acquireTokenByCode,n.correlationId);try{let o=await this.createAuthority(n.authority,n.correlationId,void 0,e.azureCloudOptions),s=await this.buildOauthClientConfiguration(o,n.correlationId,n.redirectUri,i),a=new wa(s);return this.logger.verbose("Auth code client created",n.correlationId),await a.acquireToken(n,t)}catch(o){throw o instanceof Z&&o.setCorrelationId(n.correlationId),i.cacheFailedRequest(o),o}}async acquireTokenByRefreshToken(e){this.logger.info("acquireTokenByRefreshToken called",e.correlationId);let t={...e,...await this.initializeBaseRequest(e),authenticationScheme:te.BEARER},n=this.initializeServerTelemetryManager(zr.acquireTokenByRefreshToken,t.correlationId);try{let i=await this.createAuthority(t.authority,t.correlationId,void 0,e.azureCloudOptions),o=await this.buildOauthClientConfiguration(i,t.correlationId,t.redirectUri||"",n),s=new Pi(o);return this.logger.verbose("Refresh token client created",t.correlationId),await s.acquireToken(t)}catch(i){throw i instanceof Z&&i.setCorrelationId(t.correlationId),n.cacheFailedRequest(i),i}}async acquireTokenSilent(e){let t={...e,...await this.initializeBaseRequest(e),forceRefresh:e.forceRefresh||!1},n=this.initializeServerTelemetryManager(zr.acquireTokenSilent,t.correlationId,t.forceRefresh);try{let i=await this.createAuthority(t.authority,t.correlationId,void 0,e.azureCloudOptions),o=await this.buildOauthClientConfiguration(i,t.correlationId,t.redirectUri||"",n),s=new Ra(o);this.logger.verbose("Silent flow client created",t.correlationId);try{return await this.tokenCache.overwriteCache(),await this.acquireCachedTokenSilent(t,s,o)}catch(a){if(a instanceof an&&a.errorCode===ce.tokenRefreshRequired)return new Pi(o).acquireTokenByRefreshToken(t);throw a}}catch(i){throw i instanceof Z&&i.setCorrelationId(t.correlationId),n.cacheFailedRequest(i),i}}async acquireCachedTokenSilent(e,t,n){let[i,o]=await t.acquireCachedToken({...e,scopes:e.scopes?.length?e.scopes:[...ut]});if(o===le.PROACTIVELY_REFRESHED){this.logger.info("ClientApplication:acquireCachedTokenSilent - Cached access token's refreshOn property has been exceeded'. It's not expired, but must be refreshed.");let s=new Pi(n);try{await s.acquireTokenByRefreshToken(e)}catch{}}return i}async acquireTokenByUsernamePassword(e){this.logger.info("acquireTokenByUsernamePassword called",e.correlationId);let t={...e,...await this.initializeBaseRequest(e)},n=this.initializeServerTelemetryManager(zr.acquireTokenByUsernamePassword,t.correlationId);try{let i=await this.createAuthority(t.authority,t.correlationId,void 0,e.azureCloudOptions),o=await this.buildOauthClientConfiguration(i,t.correlationId,"",n),s=new Go(o);return this.logger.verbose("Username password client created",t.correlationId),await s.acquireToken(t)}catch(i){throw i instanceof Z&&i.setCorrelationId(t.correlationId),n.cacheFailedRequest(i),i}}getTokenCache(){return this.logger.info("getTokenCache called"),this.tokenCache}validateState(e,t){if(!e)throw ht.createStateNotFoundError();if(e!==t)throw v(ce.stateMismatch)}getLogger(){return this.logger}setLogger(e){this.logger=e}async buildOauthClientConfiguration(e,t,n,i){return this.logger.verbose("buildOauthClientConfiguration called",t),this.logger.info(`Building oauth client configuration with the following authority: ${e.tokenEndpoint}.`,t),i?.updateRegionDiscoveryMetadata(e.regionDiscoveryMetadata),{authOptions:{clientId:this.config.auth.clientId,authority:e,clientCapabilities:this.config.auth.clientCapabilities,redirectUri:n},loggerOptions:{logLevel:this.config.system.loggerOptions.logLevel,loggerCallback:this.config.system.loggerOptions.loggerCallback,piiLoggingEnabled:this.config.system.loggerOptions.piiLoggingEnabled,correlationId:t},cacheOptions:{claimsBasedCachingEnabled:this.config.cache.claimsBasedCachingEnabled},cryptoInterface:this.cryptoProvider,networkInterface:this.config.system.networkClient,storageInterface:this.storage,serverTelemetryManager:i,clientCredentials:{clientSecret:this.clientSecret,clientAssertion:await this.getClientAssertion(e)},libraryInfo:{sku:Me.MSAL_SKU,version:Jt,cpu:process.arch||E.EMPTY_STRING,os:process.platform||E.EMPTY_STRING},telemetry:this.config.telemetry,persistencePlugin:this.config.cache.cachePlugin,serializableCache:this.tokenCache}}async getClientAssertion(e){return this.developerProvidedClientAssertion&&(this.clientAssertion=Gr.fromAssertion(await et(this.developerProvidedClientAssertion,this.config.auth.clientId,e.tokenEndpoint))),this.clientAssertion&&{assertion:this.clientAssertion.getJwt(this.cryptoProvider,this.config.auth.clientId,e.tokenEndpoint),assertionType:Me.JWT_BEARER_ASSERTION_TYPE}}async initializeBaseRequest(e){return this.logger.verbose("initializeRequestScopes called",e.correlationId),e.authenticationScheme&&e.authenticationScheme===te.POP&&this.logger.verbose("Authentication Scheme 'pop' is not supported yet, setting Authentication Scheme to 'Bearer' for request",e.correlationId),e.authenticationScheme=te.BEARER,this.config.cache.claimsBasedCachingEnabled&&e.claims&&!ye.isEmptyObj(e.claims)&&(e.requestedClaimsHash=await this.cryptoProvider.hashString(e.claims)),{...e,scopes:[...e&&e.scopes||[],...ut],correlationId:e&&e.correlationId||this.cryptoProvider.createNewGuid(),authority:e.authority||this.config.auth.authority}}initializeServerTelemetryManager(e,t,n){let i={clientId:this.config.auth.clientId,correlationId:t,apiId:e,forceRefresh:n||!1};return new Ni(i,this.storage)}async createAuthority(e,t,n,i){this.logger.verbose("createAuthority called",t);let o=Xt.generateAuthority(e,i||this.config.auth.azureCloudOptions),s={protocolMode:this.config.auth.protocolMode,knownAuthorities:this.config.auth.knownAuthorities,cloudDiscoveryMetadata:this.config.auth.cloudDiscoveryMetadata,authorityMetadata:this.config.auth.authorityMetadata,azureRegionConfiguration:n,skipAuthorityMetadataCache:this.config.auth.skipAuthorityMetadataCache};return Pu.createDiscoveredInstance(o,this.config.system.networkClient,this.storage,s,this.logger,t)}clearCache(){this.storage.clear()}};import WH from"http";var Nd=class{async listenForAuthCode(e,t){if(this.server)throw ht.createLoopbackServerAlreadyExistsError();return new Promise((n,i)=>{this.server=WH.createServer((o,s)=>{let a=o.url;if(a){if(a===E.FORWARD_SLASH){s.end(e||"Auth code was successfully acquired. You can close this window now.");return}}else{s.end(t||"Error occurred loading redirectUrl"),i(ht.createUnableToLoadRedirectUrlError());return}let c=this.getRedirectUri(),l=new URL(a,c),u=qe.getDeserializedResponse(l.search)||{};u.code&&(s.writeHead(W.REDIRECT,{location:c}),s.end()),u.error&&s.end(t||`Error occurred: ${u.error}`),n(u)}),this.server.listen(0,"127.0.0.1")})}getRedirectUri(){if(!this.server||!this.server.listening)throw ht.createNoLoopbackServerExistsError();let e=this.server.address();if(!e||typeof e=="string"||!e.port)throw this.closeServer(),ht.createInvalidLoopbackAddressTypeError();let t=e&&e.port;return`${Me.HTTP_PROTOCOL}${Me.LOCALHOST}:${t}`}closeServer(){this.server&&(this.server.close(),typeof this.server.closeAllConnections=="function"&&this.server.closeAllConnections(),this.server.unref(),this.server=void 0)}};var Vo=class extends je{constructor(e){super(e)}async acquireToken(e){let t=await this.getDeviceCode(e);e.deviceCodeCallback(t);let n=he.nowSeconds(),i=await this.acquireTokenWithDeviceCode(e,t),o=new Ie(this.config.authOptions.clientId,this.cacheManager,this.cryptoUtils,this.logger,this.config.serializableCache,this.config.persistencePlugin);return o.validateTokenResponse(i),o.handleServerTokenResponse(i,this.authority,n,e)}async getDeviceCode(e){let t=this.createExtraQueryParameters(e),n=J.appendQueryString(this.authority.deviceCodeEndpoint,t),i=this.createQueryString(e),o=this.createTokenRequestHeaders(),s={clientId:this.config.authOptions.clientId,authority:e.authority,scopes:e.scopes,claims:e.claims,authenticationScheme:e.authenticationScheme,resourceRequestMethod:e.resourceRequestMethod,resourceRequestUri:e.resourceRequestUri,shrClaims:e.shrClaims,sshKid:e.sshKid};return this.executePostRequestToDeviceCodeEndpoint(n,i,o,s,e.correlationId)}createExtraQueryParameters(e){let t=new Map;return e.extraQueryParameters&&I.addExtraQueryParameters(t,e.extraQueryParameters),qe.mapToQueryString(t)}async executePostRequestToDeviceCodeEndpoint(e,t,n,i,o){let{body:{user_code:s,device_code:a,verification_uri:c,expires_in:l,interval:u,message:d}}=await this.sendPostRequest(i,e,{body:t,headers:n},o);return{userCode:s,deviceCode:a,verificationUri:c,expiresIn:l,interval:u,message:d}}createQueryString(e){let t=new Map;return I.addScopes(t,e.scopes),I.addClientId(t,this.config.authOptions.clientId),e.extraQueryParameters&&I.addExtraQueryParameters(t,e.extraQueryParameters),(e.claims||this.config.authOptions.clientCapabilities&&this.config.authOptions.clientCapabilities.length>0)&&I.addClaims(t,e.claims,this.config.authOptions.clientCapabilities),qe.mapToQueryString(t)}continuePolling(e,t,n){if(n)throw this.logger.error("Token request cancelled by setting DeviceCodeRequest.cancel = true"),v(ce.deviceCodePollingCancelled);if(t&&t<e&&he.nowSeconds()>t)throw this.logger.error(`User defined timeout for device code polling reached. The timeout was set for ${t}`),v(ce.userTimeoutReached);if(he.nowSeconds()>e)throw t&&this.logger.verbose(`User specified timeout ignored as the device code has expired before the timeout elapsed. The user specified timeout was set for ${t}`),this.logger.error(`Device code expired. Expiration time of device code was ${e}`),v(ce.deviceCodeExpired);return!0}async acquireTokenWithDeviceCode(e,t){let n=this.createTokenQueryParameters(e),i=J.appendQueryString(this.authority.tokenEndpoint,n),o=this.createTokenRequestBody(e,t),s=this.createTokenRequestHeaders(),a=e.timeout?he.nowSeconds()+e.timeout:void 0,c=he.nowSeconds()+t.expiresIn,l=t.interval*1e3;for(;this.continuePolling(c,a,e.cancel);){let u={clientId:this.config.authOptions.clientId,authority:e.authority,scopes:e.scopes,claims:e.claims,authenticationScheme:e.authenticationScheme,resourceRequestMethod:e.resourceRequestMethod,resourceRequestUri:e.resourceRequestUri,shrClaims:e.shrClaims,sshKid:e.sshKid},d=await this.executePostToTokenEndpoint(i,o,s,u,e.correlationId);if(d.body&&d.body.error)if(d.body.error===E.AUTHORIZATION_PENDING)this.logger.info("Authorization pending. Continue polling."),await he.delay(l);else throw this.logger.info("Unexpected error in polling from the server"),Ph(Ao.postRequestFailed,d.body.error);else return this.logger.verbose("Authorization completed successfully. Polling stopped."),d.body}throw this.logger.error("Polling stopped for unknown reasons."),v(ce.deviceCodeUnknownError)}createTokenRequestBody(e,t){let n=new Map;I.addScopes(n,e.scopes),I.addClientId(n,this.config.authOptions.clientId),I.addGrantType(n,ft.DEVICE_CODE_GRANT),I.addDeviceCode(n,t.deviceCode);let i=e.correlationId||this.config.cryptoInterface.createNewGuid();return I.addCorrelationId(n,i),I.addClientInfo(n),I.addLibraryInfo(n,this.config.libraryInfo),I.addApplicationTelemetry(n,this.config.telemetry.application),I.addThrottling(n),this.serverTelemetryManager&&I.addServerTelemetry(n,this.serverTelemetryManager),(!ye.isEmptyObj(e.claims)||this.config.authOptions.clientCapabilities&&this.config.authOptions.clientCapabilities.length>0)&&I.addClaims(n,e.claims,this.config.authOptions.clientCapabilities),qe.mapToQueryString(n)}};var Ko=class extends vn{constructor(e){super(e),this.config.broker.nativeBrokerPlugin&&(this.config.broker.nativeBrokerPlugin.isBrokerAvailable?(this.nativeBrokerPlugin=this.config.broker.nativeBrokerPlugin,this.nativeBrokerPlugin.setLogger(this.config.system.loggerOptions)):this.logger.warning("NativeBroker implementation was provided but the broker is unavailable.")),this.skus=Ni.makeExtraSkuString({libraryName:Me.MSAL_SKU,libraryVersion:Jt})}async acquireTokenByDeviceCode(e){this.logger.info("acquireTokenByDeviceCode called",e.correlationId);let t=Object.assign(e,await this.initializeBaseRequest(e)),n=this.initializeServerTelemetryManager(zr.acquireTokenByDeviceCode,t.correlationId);try{let i=await this.createAuthority(t.authority,t.correlationId,void 0,e.azureCloudOptions),o=await this.buildOauthClientConfiguration(i,t.correlationId,"",n),s=new Vo(o);return this.logger.verbose("Device code client created",t.correlationId),await s.acquireToken(t)}catch(i){throw i instanceof Z&&i.setCorrelationId(t.correlationId),n.cacheFailedRequest(i),i}}async acquireTokenInteractive(e){let t=e.correlationId||this.cryptoProvider.createNewGuid();this.logger.trace("acquireTokenInteractive called",t);let{openBrowser:n,successTemplate:i,errorTemplate:o,windowHandle:s,loopbackClient:a,...c}=e;if(this.nativeBrokerPlugin){let m={...c,clientId:this.config.auth.clientId,scopes:e.scopes||ut,redirectUri:`${Me.HTTP_PROTOCOL}${Me.LOCALHOST}`,authority:e.authority||this.config.auth.authority,correlationId:t,extraParameters:{...c.extraQueryParameters,...c.tokenQueryParameters,[Si.X_CLIENT_EXTRA_SKU]:this.skus},accountId:c.account?.nativeAccountId};return this.nativeBrokerPlugin.acquireTokenInteractive(m,s)}let{verifier:l,challenge:u}=await this.cryptoProvider.generatePkceCodes(),d=a||new Nd,h={},p=null;try{let m=d.listenForAuthCode(i,o).then(H=>{h=H}).catch(H=>{p=H}),y=await this.waitForRedirectUri(d),A={...c,correlationId:t,scopes:e.scopes||ut,redirectUri:y,responseMode:dr.QUERY,codeChallenge:u,codeChallengeMethod:Kn.S256},P=await this.getAuthCodeUrl(A);if(await n(P),await m,p)throw p;if(h.error)throw new Je(h.error,h.error_description,h.suberror);if(!h.code)throw ht.createNoAuthCodeInResponseError();let D=h.client_info,U={code:h.code,codeVerifier:l,clientInfo:D||E.EMPTY_STRING,...A};return await this.acquireTokenByCode(U)}finally{d.closeServer()}}async acquireTokenSilent(e){let t=e.correlationId||this.cryptoProvider.createNewGuid();if(this.logger.trace("acquireTokenSilent called",t),this.nativeBrokerPlugin){let n={...e,clientId:this.config.auth.clientId,scopes:e.scopes||ut,redirectUri:`${Me.HTTP_PROTOCOL}${Me.LOCALHOST}`,authority:e.authority||this.config.auth.authority,correlationId:t,extraParameters:{...e.tokenQueryParameters,[Si.X_CLIENT_EXTRA_SKU]:this.skus},accountId:e.account.nativeAccountId,forceRefresh:e.forceRefresh||!1};return this.nativeBrokerPlugin.acquireTokenSilent(n)}return super.acquireTokenSilent(e)}async signOut(e){if(this.nativeBrokerPlugin&&e.account.nativeAccountId){let t={clientId:this.config.auth.clientId,accountId:e.account.nativeAccountId,correlationId:e.correlationId||this.cryptoProvider.createNewGuid()};await this.nativeBrokerPlugin.signOut(t)}await this.getTokenCache().removeAccount(e.account)}async getAllAccounts(){if(this.nativeBrokerPlugin){let e=this.cryptoProvider.createNewGuid();return this.nativeBrokerPlugin.getAllAccounts(this.config.auth.clientId,e)}return this.getTokenCache().getAllAccounts()}async waitForRedirectUri(e){return new Promise((t,n)=>{let i=0,o=setInterval(()=>{if(Bu.TIMEOUT_MS/Bu.INTERVAL_MS<i){clearInterval(o),n(ht.createLoopbackServerTimeoutError());return}try{let s=e.getRedirectUri();clearInterval(o),t(s);return}catch(s){if(s instanceof Z&&s.errorCode===Ue.noLoopbackServerExists.code){i++;return}clearInterval(o),n(s);return}},Bu.INTERVAL_MS)})}};var Cn=class extends je{constructor(e,t){super(e),this.appTokenProvider=t}async acquireToken(e){if(e.skipCache||e.claims)return this.executeTokenRequest(e,this.authority);let[t,n]=await this.getCachedAuthenticationResult(e,this.config,this.cryptoUtils,this.authority,this.cacheManager,this.serverTelemetryManager);return t?(n===le.PROACTIVELY_REFRESHED&&(this.logger.info("ClientCredentialClient:getCachedAuthenticationResult - Cached access token's refreshOn property has been exceeded'. It's not expired, but must be refreshed."),await this.executeTokenRequest(e,this.authority,!0)),t):this.executeTokenRequest(e,this.authority)}async getCachedAuthenticationResult(e,t,n,i,o,s){let a=t,c=t,l=le.NOT_APPLICABLE,u;a.serializableCache&&a.persistencePlugin&&(u=new kt(a.serializableCache,!1),await a.persistencePlugin.beforeCacheAccess(u));let d=this.readAccessTokenFromCache(i,c.managedIdentityId?.id||a.authOptions.clientId,new ke(e.scopes||[]),o);return a.serializableCache&&a.persistencePlugin&&u&&await a.persistencePlugin.afterCacheAccess(u),d?he.isTokenExpired(d.expiresOn,a.systemOptions?.tokenRenewalOffsetSeconds||_o)?(s?.setCacheOutcome(le.CACHED_ACCESS_TOKEN_EXPIRED),[null,le.CACHED_ACCESS_TOKEN_EXPIRED]):(d.refreshOn&&he.isTokenExpired(d.refreshOn.toString(),0)&&(l=le.PROACTIVELY_REFRESHED,s?.setCacheOutcome(le.PROACTIVELY_REFRESHED)),[await Ie.generateAuthenticationResult(n,i,{account:null,idToken:null,accessToken:d,refreshToken:null,appMetadata:null},!0,e),l]):(s?.setCacheOutcome(le.NO_CACHED_ACCESS_TOKEN),[null,le.NO_CACHED_ACCESS_TOKEN])}readAccessTokenFromCache(e,t,n,i){let o={homeAccountId:E.EMPTY_STRING,environment:e.canonicalAuthorityUrlComponents.HostNameAndPort,credentialType:se.ACCESS_TOKEN,clientId:t,realm:e.tenant,target:ke.createSearchScopes(n.asArray())},s=i.getAccessTokensByFilter(o);if(s.length<1)return null;if(s.length>1)throw v(ce.multipleMatchingTokens);return s[0]}async executeTokenRequest(e,t,n){let i,o;if(this.appTokenProvider){this.logger.info("Using appTokenProvider extensibility.");let c={correlationId:e.correlationId,tenantId:this.config.authOptions.authority.tenant,scopes:e.scopes,claims:e.claims};o=he.nowSeconds();let l=await this.appTokenProvider(c);i={access_token:l.accessToken,expires_in:l.expiresInSeconds,refresh_in:l.refreshInSeconds,token_type:te.BEARER}}else{let c=this.createTokenQueryParameters(e),l=J.appendQueryString(t.tokenEndpoint,c),u=await this.createTokenRequestBody(e),d=this.createTokenRequestHeaders(),h={clientId:this.config.authOptions.clientId,authority:e.authority,scopes:e.scopes,claims:e.claims,authenticationScheme:e.authenticationScheme,resourceRequestMethod:e.resourceRequestMethod,resourceRequestUri:e.resourceRequestUri,shrClaims:e.shrClaims,sshKid:e.sshKid};this.logger.info("Sending token request to endpoint: "+t.tokenEndpoint),o=he.nowSeconds();let p=await this.executePostToTokenEndpoint(l,u,d,h,e.correlationId);i=p.body,i.status=p.status}let s=new Ie(this.config.authOptions.clientId,this.cacheManager,this.cryptoUtils,this.logger,this.config.serializableCache,this.config.persistencePlugin);return s.validateTokenResponse(i,n),await s.handleServerTokenResponse(i,this.authority,o,e)}async createTokenRequestBody(e){let t=new Map;I.addClientId(t,this.config.authOptions.clientId),I.addScopes(t,e.scopes,!1),I.addGrantType(t,ft.CLIENT_CREDENTIALS_GRANT),I.addLibraryInfo(t,this.config.libraryInfo),I.addApplicationTelemetry(t,this.config.telemetry.application),I.addThrottling(t),this.serverTelemetryManager&&I.addServerTelemetry(t,this.serverTelemetryManager);let n=e.correlationId||this.config.cryptoInterface.createNewGuid();I.addCorrelationId(t,n),this.config.clientCredentials.clientSecret&&I.addClientSecret(t,this.config.clientCredentials.clientSecret);let i=e.clientAssertion||this.config.clientCredentials.clientAssertion;return i&&(I.addClientAssertion(t,await et(i.assertion,this.config.authOptions.clientId,e.resourceRequestUri)),I.addClientAssertionType(t,i.assertionType)),(!ye.isEmptyObj(e.claims)||this.config.authOptions.clientCapabilities&&this.config.authOptions.clientCapabilities.length>0)&&I.addClaims(t,e.claims,this.config.authOptions.clientCapabilities),qe.mapToQueryString(t)}};var Yo=class extends je{constructor(e){super(e)}async acquireToken(e){if(this.scopeSet=new ke(e.scopes||[]),this.userAssertionHash=await this.cryptoUtils.hashString(e.oboAssertion),e.skipCache||e.claims)return this.executeTokenRequest(e,this.authority,this.userAssertionHash);try{return await this.getCachedAuthenticationResult(e)}catch{return await this.executeTokenRequest(e,this.authority,this.userAssertionHash)}}async getCachedAuthenticationResult(e){let t=this.readAccessTokenFromCacheForOBO(this.config.authOptions.clientId,e);if(t){if(he.isTokenExpired(t.expiresOn,this.config.systemOptions.tokenRenewalOffsetSeconds))throw this.serverTelemetryManager?.setCacheOutcome(le.CACHED_ACCESS_TOKEN_EXPIRED),this.logger.info(`OnbehalfofFlow:getCachedAuthenticationResult - Cached access token is expired or will expire within ${this.config.systemOptions.tokenRenewalOffsetSeconds} seconds.`),v(ce.tokenRefreshRequired)}else throw this.serverTelemetryManager?.setCacheOutcome(le.NO_CACHED_ACCESS_TOKEN),this.logger.info("SilentFlowClient:acquireCachedToken - No access token found in cache for the given properties."),v(ce.tokenRefreshRequired);let n=this.readIdTokenFromCacheForOBO(t.homeAccountId),i,o=null;if(n){i=yu.extractTokenClaims(n.secret,xt.base64Decode);let s=i.oid||i.sub,a={homeAccountId:n.homeAccountId,environment:n.environment,tenantId:n.realm,username:E.EMPTY_STRING,localAccountId:s||E.EMPTY_STRING};o=this.cacheManager.readAccountFromCache(a)}return this.config.serverTelemetryManager&&this.config.serverTelemetryManager.incrementCacheHits(),Ie.generateAuthenticationResult(this.cryptoUtils,this.authority,{account:o,accessToken:t,idToken:n,refreshToken:null,appMetadata:null},!0,e,i)}readIdTokenFromCacheForOBO(e){let t={homeAccountId:e,environment:this.authority.canonicalAuthorityUrlComponents.HostNameAndPort,credentialType:se.ID_TOKEN,clientId:this.config.authOptions.clientId,realm:this.authority.tenant},n=this.cacheManager.getIdTokensByFilter(t);return Object.values(n).length<1?null:Object.values(n)[0]}readAccessTokenFromCacheForOBO(e,t){let n=t.authenticationScheme||te.BEARER,o={credentialType:n&&n.toLowerCase()!==te.BEARER.toLowerCase()?se.ACCESS_TOKEN_WITH_AUTH_SCHEME:se.ACCESS_TOKEN,clientId:e,target:ke.createSearchScopes(this.scopeSet.asArray()),tokenType:n,keyId:t.sshKid,requestedClaimsHash:t.requestedClaimsHash,userAssertionHash:this.userAssertionHash},s=this.cacheManager.getAccessTokensByFilter(o),a=s.length;if(a<1)return null;if(a>1)throw v(ce.multipleMatchingTokens);return s[0]}async executeTokenRequest(e,t,n){let i=this.createTokenQueryParameters(e),o=J.appendQueryString(t.tokenEndpoint,i),s=await this.createTokenRequestBody(e),a=this.createTokenRequestHeaders(),c={clientId:this.config.authOptions.clientId,authority:e.authority,scopes:e.scopes,claims:e.claims,authenticationScheme:e.authenticationScheme,resourceRequestMethod:e.resourceRequestMethod,resourceRequestUri:e.resourceRequestUri,shrClaims:e.shrClaims,sshKid:e.sshKid},l=he.nowSeconds(),u=await this.executePostToTokenEndpoint(o,s,a,c,e.correlationId),d=new Ie(this.config.authOptions.clientId,this.cacheManager,this.cryptoUtils,this.logger,this.config.serializableCache,this.config.persistencePlugin);return d.validateTokenResponse(u.body),await d.handleServerTokenResponse(u.body,this.authority,l,e,void 0,n)}async createTokenRequestBody(e){let t=new Map;I.addClientId(t,this.config.authOptions.clientId),I.addScopes(t,e.scopes),I.addGrantType(t,ft.JWT_BEARER),I.addClientInfo(t),I.addLibraryInfo(t,this.config.libraryInfo),I.addApplicationTelemetry(t,this.config.telemetry.application),I.addThrottling(t),this.serverTelemetryManager&&I.addServerTelemetry(t,this.serverTelemetryManager);let n=e.correlationId||this.config.cryptoInterface.createNewGuid();I.addCorrelationId(t,n),I.addRequestTokenUse(t,Si.ON_BEHALF_OF),I.addOboAssertion(t,e.oboAssertion),this.config.clientCredentials.clientSecret&&I.addClientSecret(t,this.config.clientCredentials.clientSecret);let i=this.config.clientCredentials.clientAssertion;return i&&(I.addClientAssertion(t,await et(i.assertion,this.config.authOptions.clientId,e.resourceRequestUri)),I.addClientAssertionType(t,i.assertionType)),(e.claims||this.config.authOptions.clientCapabilities&&this.config.authOptions.clientCapabilities.length>0)&&I.addClaims(t,e.claims,this.config.authOptions.clientCapabilities),qe.mapToQueryString(t)}};var Wo=class extends vn{constructor(e){super(e);let t=!!this.config.auth.clientSecret,n=!!this.config.auth.clientAssertion,i=(!!this.config.auth.clientCertificate?.thumbprint||!!this.config.auth.clientCertificate?.thumbprintSha256)&&!!this.config.auth.clientCertificate?.privateKey;if(!this.appTokenProvider){if(t&&n||n&&i||t&&i)throw v(ce.invalidClientCredential);if(this.config.auth.clientSecret){this.clientSecret=this.config.auth.clientSecret;return}if(this.config.auth.clientAssertion){this.developerProvidedClientAssertion=this.config.auth.clientAssertion;return}if(i)this.clientAssertion=this.config.auth.clientCertificate.thumbprintSha256?Gr.fromCertificateWithSha256Thumbprint(this.config.auth.clientCertificate.thumbprintSha256,this.config.auth.clientCertificate.privateKey,this.config.auth.clientCertificate.x5c):Gr.fromCertificate(this.config.auth.clientCertificate.thumbprint,this.config.auth.clientCertificate.privateKey,this.config.auth.clientCertificate.x5c);else throw v(ce.invalidClientCredential);this.appTokenProvider=void 0}}SetAppTokenProvider(e){this.appTokenProvider=e}async acquireTokenByClientCredential(e){this.logger.info("acquireTokenByClientCredential called",e.correlationId);let t;e.clientAssertion&&(t={assertion:await et(e.clientAssertion,this.config.auth.clientId),assertionType:Me.JWT_BEARER_ASSERTION_TYPE});let n=await this.initializeBaseRequest(e),i={...n,scopes:n.scopes.filter(h=>!ut.includes(h))},o={...e,...i,clientAssertion:t},a=new J(o.authority).getUrlComponents().PathSegments[0];if(Object.values(dt).includes(a))throw v(ce.missingTenantIdError);let c=process.env[zv],l;o.azureRegion!=="DisableMsalForceRegion"&&(!o.azureRegion&&c?l=c:l=o.azureRegion);let u={azureRegion:l,environmentRegion:process.env[Bv]},d=this.initializeServerTelemetryManager(zr.acquireTokenByClientCredential,o.correlationId,o.skipCache);try{let h=await this.createAuthority(o.authority,o.correlationId,u,e.azureCloudOptions),p=await this.buildOauthClientConfiguration(h,o.correlationId,"",d),m=new Cn(p,this.appTokenProvider);return this.logger.verbose("Client credential client created",o.correlationId),await m.acquireToken(o)}catch(h){throw h instanceof Z&&h.setCorrelationId(o.correlationId),d.cacheFailedRequest(h),h}}async acquireTokenOnBehalfOf(e){this.logger.info("acquireTokenOnBehalfOf called",e.correlationId);let t={...e,...await this.initializeBaseRequest(e)};try{let n=await this.createAuthority(t.authority,t.correlationId,void 0,e.azureCloudOptions),i=await this.buildOauthClientConfiguration(n,t.correlationId,"",void 0),o=new Yo(i);return this.logger.verbose("On behalf of client created",t.correlationId),await o.acquireToken(t)}catch(n){throw n instanceof Z&&n.setCorrelationId(t.correlationId),n}}};function HS(r){if(typeof r!="string")return!1;let e=new Date(r);return!isNaN(e.getTime())&&e.toISOString()===r}var Md=class{constructor(e,t,n){this.httpClientNoRetries=e,this.retryPolicy=t,this.logger=n}async sendNetworkRequestAsyncHelper(e,t,n){return e===pe.GET?this.httpClientNoRetries.sendGetRequestAsync(t,n):this.httpClientNoRetries.sendPostRequestAsync(t,n)}async sendNetworkRequestAsync(e,t,n){let i=await this.sendNetworkRequestAsyncHelper(e,t,n);"isNewRequest"in this.retryPolicy&&(this.retryPolicy.isNewRequest=!0);let o=0;for(;await this.retryPolicy.pauseForRetry(i.status,o,this.logger,i.headers[ue.RETRY_AFTER]);)i=await this.sendNetworkRequestAsyncHelper(e,t,n),o++;return i}async sendGetRequestAsync(e,t){return this.sendNetworkRequestAsync(pe.GET,e,t)}async sendPostRequestAsync(e,t){return this.sendNetworkRequestAsync(pe.POST,e,t)}};var qa={MANAGED_IDENTITY_CLIENT_ID_2017:"clientid",MANAGED_IDENTITY_CLIENT_ID:"client_id",MANAGED_IDENTITY_OBJECT_ID:"object_id",MANAGED_IDENTITY_RESOURCE_ID_IMDS:"msi_res_id",MANAGED_IDENTITY_RESOURCE_ID_NON_IMDS:"mi_res_id"},nt=class{constructor(e,t,n,i,o){this.logger=e,this.nodeStorage=t,this.networkClient=n,this.cryptoProvider=i,this.disableInternalRetries=o}async getServerTokenResponseAsync(e,t,n,i){return this.getServerTokenResponse(e)}getServerTokenResponse(e){let t,n;return e.body.expires_on&&(HS(e.body.expires_on)&&(e.body.expires_on=new Date(e.body.expires_on).getTime()/1e3),n=e.body.expires_on-he.nowSeconds(),n>2*3600&&(t=n/2)),{status:e.status,access_token:e.body.access_token,expires_in:n,scope:e.body.resource,token_type:e.body.token_type,refresh_in:t,correlation_id:e.body.correlation_id||e.body.correlationId,error:typeof e.body.error=="string"?e.body.error:e.body.error?.code,error_description:e.body.message||(typeof e.body.error=="string"?e.body.error_description:e.body.error?.message),error_codes:e.body.error_codes,timestamp:e.body.timestamp,trace_id:e.body.trace_id}}async acquireTokenWithManagedIdentity(e,t,n,i){let o=this.createRequest(e.resource,t),s=o.headers;s[ue.CONTENT_TYPE]=E.URL_FORM_CONTENT_TYPE;let a={headers:s};Object.keys(o.bodyParameters).length&&(a.body=o.computeParametersBodyString());let c=this.disableInternalRetries?this.networkClient:new Md(this.networkClient,o.retryPolicy,this.logger),l=he.nowSeconds(),u;try{o.httpMethod===pe.POST?u=await c.sendPostRequestAsync(o.computeUri(),a):u=await c.sendGetRequestAsync(o.computeUri(),a)}catch(p){throw p instanceof Z?p:v(ce.networkError)}let d=new Ie(t.id,this.nodeStorage,this.cryptoProvider,this.logger,null,null),h=await this.getServerTokenResponseAsync(u,c,o,a);return d.validateTokenResponse(h,i),d.handleServerTokenResponse(h,n,l,e)}getManagedIdentityUserAssignedIdQueryParameterKey(e,t,n){switch(e){case Se.USER_ASSIGNED_CLIENT_ID:return this.logger.info(`[Managed Identity] [API version ${n?"2017+":"2019+"}] Adding user assigned client id to the request.`),n?qa.MANAGED_IDENTITY_CLIENT_ID_2017:qa.MANAGED_IDENTITY_CLIENT_ID;case Se.USER_ASSIGNED_RESOURCE_ID:return this.logger.info("[Managed Identity] Adding user assigned resource id to the request."),t?qa.MANAGED_IDENTITY_RESOURCE_ID_IMDS:qa.MANAGED_IDENTITY_RESOURCE_ID_NON_IMDS;case Se.USER_ASSIGNED_OBJECT_ID:return this.logger.info("[Managed Identity] Adding user assigned object id to the request."),qa.MANAGED_IDENTITY_OBJECT_ID;default:throw be(mn)}}};nt.getValidatedEnvVariableUrlString=(r,e,t,n)=>{try{return new J(e).urlString}catch{throw n.info(`[Managed Identity] ${t} managed identity is unavailable because the '${r}' environment variable is malformed.`),be(Mi[r])}};var Dd=class{calculateDelay(e,t){if(!e)return t;let n=Math.round(parseFloat(e)*1e3);return isNaN(n)&&(n=new Date(e).valueOf()-new Date().valueOf()),Math.max(t,n)}};var ZH=3,XH=1e3,QH=[W.NOT_FOUND,W.REQUEST_TIMEOUT,W.TOO_MANY_REQUESTS,W.SERVER_ERROR,W.SERVICE_UNAVAILABLE,W.GATEWAY_TIMEOUT],Ld=class r{constructor(){this.linearRetryStrategy=new Dd}static get DEFAULT_MANAGED_IDENTITY_RETRY_DELAY_MS(){return XH}async pauseForRetry(e,t,n,i){if(QH.includes(e)&&t<ZH){let o=this.linearRetryStrategy.calculateDelay(i,r.DEFAULT_MANAGED_IDENTITY_RETRY_DELAY_MS);return n.verbose(`Retrying request in ${o}ms (retry attempt: ${t+1})`),await new Promise(s=>setTimeout(s,o)),!0}return!1}};var mt=class{constructor(e,t,n){this.httpMethod=e,this._baseEndpoint=t,this.headers={},this.bodyParameters={},this.queryParameters={},this.retryPolicy=n||new Ld}computeUri(){let e=new Map;this.queryParameters&&I.addExtraQueryParameters(e,this.queryParameters);let t=qe.mapToQueryString(e);return J.appendQueryString(this._baseEndpoint,t)}computeParametersBodyString(){let e=new Map;return this.bodyParameters&&I.addExtraQueryParameters(e,this.bodyParameters),qe.mapToQueryString(e)}};var JH="2019-08-01",ja=class r extends nt{constructor(e,t,n,i,o,s,a){super(e,t,n,i,o),this.identityEndpoint=s,this.identityHeader=a}static getEnvironmentVariables(){let e=process.env[j.IDENTITY_ENDPOINT],t=process.env[j.IDENTITY_HEADER];return[e,t]}static tryCreate(e,t,n,i,o){let[s,a]=r.getEnvironmentVariables();if(!s||!a)return e.info(`[Managed Identity] ${V.APP_SERVICE} managed identity is unavailable because one or both of the '${j.IDENTITY_HEADER}' and '${j.IDENTITY_ENDPOINT}' environment variables are not defined.`),null;let c=r.getValidatedEnvVariableUrlString(j.IDENTITY_ENDPOINT,s,V.APP_SERVICE,e);return e.info(`[Managed Identity] Environment variables validation passed for ${V.APP_SERVICE} managed identity. Endpoint URI: ${c}. Creating ${V.APP_SERVICE} managed identity.`),new r(e,t,n,i,o,s,a)}createRequest(e,t){let n=new mt(pe.GET,this.identityEndpoint);return n.headers[qv]=this.identityHeader,n.queryParameters[Er]=JH,n.queryParameters[Ft]=e,t.idType!==Se.SYSTEM_ASSIGNED&&(n.queryParameters[this.getManagedIdentityUserAssignedIdQueryParameterKey(t.idType)]=t.id),n}};import{accessSync as eF,constants as FS,statSync as tF,readFileSync as rF}from"fs";import nF from"path";var iF="2019-11-01",$S="http://127.0.0.1:40342/metadata/identity/oauth2/token",qS="N/A: himds executable exists",jS={win32:`${process.env.ProgramData}\\AzureConnectedMachineAgent\\Tokens\\`,linux:"/var/opt/azcmagent/tokens/"},oF={win32:`${process.env.ProgramFiles}\\AzureConnectedMachineAgent\\himds.exe`,linux:"/opt/azcmagent/bin/himds"},Ba=class r extends nt{constructor(e,t,n,i,o,s){super(e,t,n,i,o),this.identityEndpoint=s}static getEnvironmentVariables(){let e=process.env[j.IDENTITY_ENDPOINT],t=process.env[j.IMDS_ENDPOINT];if(!e||!t){let n=oF[process.platform];try{eF(n,FS.F_OK|FS.R_OK),e=$S,t=qS}catch{}}return[e,t]}static tryCreate(e,t,n,i,o,s){let[a,c]=r.getEnvironmentVariables();if(!a||!c)return e.info(`[Managed Identity] ${V.AZURE_ARC} managed identity is unavailable through environment variables because one or both of '${j.IDENTITY_ENDPOINT}' and '${j.IMDS_ENDPOINT}' are not defined. ${V.AZURE_ARC} managed identity is also unavailable through file detection.`),null;if(c===qS)e.info(`[Managed Identity] ${V.AZURE_ARC} managed identity is available through file detection. Defaulting to known ${V.AZURE_ARC} endpoint: ${$S}. Creating ${V.AZURE_ARC} managed identity.`);else{let l=r.getValidatedEnvVariableUrlString(j.IDENTITY_ENDPOINT,a,V.AZURE_ARC,e);l.endsWith("/")&&l.slice(0,-1),r.getValidatedEnvVariableUrlString(j.IMDS_ENDPOINT,c,V.AZURE_ARC,e),e.info(`[Managed Identity] Environment variables validation passed for ${V.AZURE_ARC} managed identity. Endpoint URI: ${l}. Creating ${V.AZURE_ARC} managed identity.`)}if(s.idType!==Se.SYSTEM_ASSIGNED)throw be(Yu);return new r(e,t,n,i,o,a)}createRequest(e){let t=new mt(pe.GET,this.identityEndpoint.replace("localhost","127.0.0.1"));return t.headers[pn]="true",t.queryParameters[Er]=iF,t.queryParameters[Ft]=e,t}async getServerTokenResponseAsync(e,t,n,i){let o;if(e.status===W.UNAUTHORIZED){let s=e.headers["www-authenticate"];if(!s)throw be(Xu);if(!s.includes("Basic realm="))throw be(Qu);let a=s.split("Basic realm=")[1];if(!jS.hasOwnProperty(process.platform))throw be(Ku);let c=jS[process.platform],l=nF.basename(a);if(!l.endsWith(".key"))throw be(zu);if(c+l!==a)throw be(Gu);let u;try{u=await tF(a).size}catch{throw be(ba)}if(u>Kv)throw be(Vu);let d;try{d=rF(a,"utf-8")}catch{throw be(ba)}let h=`Basic ${d}`;this.logger.info("[Managed Identity] Adding authorization header to the request."),n.headers[$v]=h;try{o=await t.sendGetRequestAsync(n.computeUri(),i)}catch(p){throw p instanceof Z?p:v(ce.networkError)}}return this.getServerTokenResponse(o||e)}};var za=class r extends nt{constructor(e,t,n,i,o,s){super(e,t,n,i,o),this.msiEndpoint=s}static getEnvironmentVariables(){return[process.env[j.MSI_ENDPOINT]]}static tryCreate(e,t,n,i,o,s){let[a]=r.getEnvironmentVariables();if(!a)return e.info(`[Managed Identity] ${V.CLOUD_SHELL} managed identity is unavailable because the '${j.MSI_ENDPOINT} environment variable is not defined.`),null;let c=r.getValidatedEnvVariableUrlString(j.MSI_ENDPOINT,a,V.CLOUD_SHELL,e);if(e.info(`[Managed Identity] Environment variable validation passed for ${V.CLOUD_SHELL} managed identity. Endpoint URI: ${c}. Creating ${V.CLOUD_SHELL} managed identity.`),s.idType!==Se.SYSTEM_ASSIGNED)throw be(Wu);return new r(e,t,n,i,o,a)}createRequest(e){let t=new mt(pe.POST,this.msiEndpoint);return t.headers[pn]="true",t.bodyParameters[Ft]=e,t}};var Ud=class{constructor(e,t,n){this.minExponentialBackoff=e,this.maxExponentialBackoff=t,this.exponentialDeltaBackoff=n}calculateDelay(e){return e===0?this.minExponentialBackoff:Math.min(Math.pow(2,e-1)*this.exponentialDeltaBackoff,this.maxExponentialBackoff)}};var sF=[W.NOT_FOUND,W.REQUEST_TIMEOUT,W.GONE,W.TOO_MANY_REQUESTS],aF=3,cF=7,lF=1e3,uF=4e3,dF=2e3,fF=10*1e3,Hd=class r{constructor(){this.exponentialRetryStrategy=new Ud(r.MIN_EXPONENTIAL_BACKOFF_MS,r.MAX_EXPONENTIAL_BACKOFF_MS,r.EXPONENTIAL_DELTA_BACKOFF_MS)}static get MIN_EXPONENTIAL_BACKOFF_MS(){return lF}static get MAX_EXPONENTIAL_BACKOFF_MS(){return uF}static get EXPONENTIAL_DELTA_BACKOFF_MS(){return dF}static get HTTP_STATUS_GONE_RETRY_AFTER_MS(){return fF}set isNewRequest(e){this._isNewRequest=e}async pauseForRetry(e,t,n){if(this._isNewRequest&&(this._isNewRequest=!1,this.maxRetries=e===W.GONE?cF:aF),(sF.includes(e)||e>=W.SERVER_ERROR_RANGE_START&&e<=W.SERVER_ERROR_RANGE_END&&t<this.maxRetries)&&t<this.maxRetries){let i=e===W.GONE?r.HTTP_STATUS_GONE_RETRY_AFTER_MS:this.exponentialRetryStrategy.calculateDelay(t);return n.verbose(`Retrying request in ${i}ms (retry attempt: ${t+1})`),await new Promise(o=>setTimeout(o,i)),!0}return!1}};var BS="/metadata/identity/oauth2/token",hF=`http://169.254.169.254${BS}`,pF="2018-02-01",Fd=class r extends nt{constructor(e,t,n,i,o,s){super(e,t,n,i,o),this.identityEndpoint=s}static tryCreate(e,t,n,i,o){let s;return process.env[j.AZURE_POD_IDENTITY_AUTHORITY_HOST]?(e.info(`[Managed Identity] Environment variable ${j.AZURE_POD_IDENTITY_AUTHORITY_HOST} for ${V.IMDS} returned endpoint: ${process.env[j.AZURE_POD_IDENTITY_AUTHORITY_HOST]}`),s=r.getValidatedEnvVariableUrlString(j.AZURE_POD_IDENTITY_AUTHORITY_HOST,`${process.env[j.AZURE_POD_IDENTITY_AUTHORITY_HOST]}${BS}`,V.IMDS,e)):(e.info(`[Managed Identity] Unable to find ${j.AZURE_POD_IDENTITY_AUTHORITY_HOST} environment variable for ${V.IMDS}, using the default endpoint.`),s=hF),new r(e,t,n,i,o,s)}createRequest(e,t){let n=new mt(pe.GET,this.identityEndpoint);return n.headers[pn]="true",n.queryParameters[Er]=pF,n.queryParameters[Ft]=e,t.idType!==Se.SYSTEM_ASSIGNED&&(n.queryParameters[this.getManagedIdentityUserAssignedIdQueryParameterKey(t.idType,!0)]=t.id),n.retryPolicy=new Hd,n}};var mF="2019-07-01-preview",Ga=class r extends nt{constructor(e,t,n,i,o,s,a){super(e,t,n,i,o),this.identityEndpoint=s,this.identityHeader=a}static getEnvironmentVariables(){let e=process.env[j.IDENTITY_ENDPOINT],t=process.env[j.IDENTITY_HEADER],n=process.env[j.IDENTITY_SERVER_THUMBPRINT];return[e,t,n]}static tryCreate(e,t,n,i,o,s){let[a,c,l]=r.getEnvironmentVariables();if(!a||!c||!l)return e.info(`[Managed Identity] ${V.SERVICE_FABRIC} managed identity is unavailable because one or all of the '${j.IDENTITY_HEADER}', '${j.IDENTITY_ENDPOINT}' or '${j.IDENTITY_SERVER_THUMBPRINT}' environment variables are not defined.`),null;let u=r.getValidatedEnvVariableUrlString(j.IDENTITY_ENDPOINT,a,V.SERVICE_FABRIC,e);return e.info(`[Managed Identity] Environment variables validation passed for ${V.SERVICE_FABRIC} managed identity. Endpoint URI: ${u}. Creating ${V.SERVICE_FABRIC} managed identity.`),s.idType!==Se.SYSTEM_ASSIGNED&&e.warning(`[Managed Identity] ${V.SERVICE_FABRIC} user assigned managed identity is configured in the cluster, not during runtime. See also: https://learn.microsoft.com/en-us/azure/service-fabric/configure-existing-cluster-enable-managed-identity-token-service.`),new r(e,t,n,i,o,a,c)}createRequest(e,t){let n=new mt(pe.GET,this.identityEndpoint);return n.headers[$u]=this.identityHeader,n.queryParameters[Er]=mF,n.queryParameters[Ft]=e,t.idType!==Se.SYSTEM_ASSIGNED&&(n.queryParameters[this.getManagedIdentityUserAssignedIdQueryParameterKey(t.idType)]=t.id),n}};var gF="2017-09-01",Va=class r extends nt{constructor(e,t,n,i,o,s,a){super(e,t,n,i,o),this.msiEndpoint=s,this.secret=a}static getEnvironmentVariables(){let e=process.env[j.MSI_ENDPOINT],t=process.env[j.MSI_SECRET];return[e,t]}static tryCreate(e,t,n,i,o){let[s,a]=r.getEnvironmentVariables();if(!s||!a)return e.info(`[Managed Identity] ${V.MACHINE_LEARNING} managed identity is unavailable because one or both of the '${j.MSI_ENDPOINT}' and '${j.MSI_SECRET}' environment variables are not defined.`),null;let c=r.getValidatedEnvVariableUrlString(j.MSI_ENDPOINT,s,V.MACHINE_LEARNING,e);return e.info(`[Managed Identity] Environment variables validation passed for ${V.MACHINE_LEARNING} managed identity. Endpoint URI: ${c}. Creating ${V.MACHINE_LEARNING} managed identity.`),new r(e,t,n,i,o,s,a)}createRequest(e,t){let n=new mt(pe.GET,this.msiEndpoint);return n.headers[pn]="true",n.headers[$u]=this.secret,n.queryParameters[Er]=gF,n.queryParameters[Ft]=e,t.idType!==Se.SYSTEM_ASSIGNED&&(n.queryParameters[this.getManagedIdentityUserAssignedIdQueryParameterKey(t.idType,!1,!0)]=t.id),n}};var Ka=class r{constructor(e,t,n,i,o){this.logger=e,this.nodeStorage=t,this.networkClient=n,this.cryptoProvider=i,this.disableInternalRetries=o}async sendManagedIdentityTokenRequest(e,t,n,i){return r.identitySource||(r.identitySource=this.selectManagedIdentitySource(this.logger,this.nodeStorage,this.networkClient,this.cryptoProvider,this.disableInternalRetries,t)),r.identitySource.acquireTokenWithManagedIdentity(e,t,n,i)}allEnvironmentVariablesAreDefined(e){return Object.values(e).every(t=>t!==void 0)}getManagedIdentitySource(){return r.sourceName=this.allEnvironmentVariablesAreDefined(Ga.getEnvironmentVariables())?V.SERVICE_FABRIC:this.allEnvironmentVariablesAreDefined(ja.getEnvironmentVariables())?V.APP_SERVICE:this.allEnvironmentVariablesAreDefined(Va.getEnvironmentVariables())?V.MACHINE_LEARNING:this.allEnvironmentVariablesAreDefined(za.getEnvironmentVariables())?V.CLOUD_SHELL:this.allEnvironmentVariablesAreDefined(Ba.getEnvironmentVariables())?V.AZURE_ARC:V.DEFAULT_TO_IMDS,r.sourceName}selectManagedIdentitySource(e,t,n,i,o,s){let a=Ga.tryCreate(e,t,n,i,o,s)||ja.tryCreate(e,t,n,i,o)||Va.tryCreate(e,t,n,i,o)||za.tryCreate(e,t,n,i,o,s)||Ba.tryCreate(e,t,n,i,o,s)||Fd.tryCreate(e,t,n,i,o);if(!a)throw be(Zu);return a}};var Ya=class r{constructor(e){this.config=rC(e||{}),this.logger=new It(this.config.system.loggerOptions,Pd,Jt);let t={canonicalAuthority:E.DEFAULT_AUTHORITY};r.nodeStorage||(r.nodeStorage=new yn(this.logger,this.config.managedIdentityId.id,So,t)),this.networkClient=this.config.system.networkClient,this.cryptoProvider=new gn;let n={protocolMode:Ve.AAD,knownAuthorities:[Gp],cloudDiscoveryMetadata:"",authorityMetadata:""};this.fakeAuthority=new Xt(Gp,this.networkClient,r.nodeStorage,n,this.logger,this.cryptoProvider.createNewGuid(),void 0,!0),this.fakeClientCredentialClient=new Cn({authOptions:{clientId:this.config.managedIdentityId.id,authority:this.fakeAuthority}}),this.managedIdentityClient=new Ka(this.logger,r.nodeStorage,this.networkClient,this.cryptoProvider,this.config.disableInternalRetries)}async acquireToken(e){if(!e.resource)throw ae(bo.urlEmptyError);let t={forceRefresh:e.forceRefresh,resource:e.resource.replace("/.default",""),scopes:[e.resource.replace("/.default","")],authority:this.fakeAuthority.canonicalAuthority,correlationId:this.cryptoProvider.createNewGuid()};if(e.claims||t.forceRefresh)return this.managedIdentityClient.sendManagedIdentityTokenRequest(t,this.config.managedIdentityId,this.fakeAuthority);let[n,i]=await this.fakeClientCredentialClient.getCachedAuthenticationResult(t,this.config,this.cryptoProvider,this.fakeAuthority,r.nodeStorage);return n?(i===le.PROACTIVELY_REFRESHED&&(this.logger.info("ClientCredentialClient:getCachedAuthenticationResult - Cached access token's refreshOn property has been exceeded'. It's not expired, but must be refreshed."),await this.managedIdentityClient.sendManagedIdentityTokenRequest(t,this.config.managedIdentityId,this.fakeAuthority,!0)),n):this.managedIdentityClient.sendManagedIdentityTokenRequest(t,this.config.managedIdentityId,this.fakeAuthority)}getManagedIdentitySource(){return Ka.sourceName||this.managedIdentityClient.getManagedIdentitySource()}};var $d=class{constructor(e,t){this.client=e,this.partitionManager=t}async beforeCacheAccess(e){let t=await this.partitionManager.getKey(),n=await this.client.get(t);e.tokenCache.deserialize(n)}async afterCacheAccess(e){if(e.cacheHasChanged){let t=e.tokenCache.getKVStore(),n=Object.values(t).filter(o=>$e.isAccountEntity(o)),i;if(n.length>0){let o=n[0];i=await this.partitionManager.extractKey(o)}else i=await this.partitionManager.getKey();await this.client.set(i,e.tokenCache.serialize())}}};var Wa=G("IdentityUtils"),yF="1.0";function Zo(r,e,t){let n=i=>(Wa.getToken.info(i),new nr({scopes:Array.isArray(r)?r:[r],getTokenOptions:t,message:i}));if(!e)throw n("No response");if(!e.expiresOn)throw n('Response had no "expiresOn" property.');if(!e.accessToken)throw n('Response had no "accessToken" property.')}function Um(r){let e=r?.authorityHost;return!e&&or&&(e=process.env.AZURE_AUTHORITY_HOST),e??gs}function Hm(r,e){return e||(e=gs),new RegExp(`${r}/?$`).test(e)?e:e.endsWith("/")?e+r:`${e}/${r}`}function zS(r,e,t){return r==="adfs"&&e||t?[e]:[]}var Fm=(r,e=Ts?"Node":"Browser")=>(t,n,i)=>{if(!i)switch(t){case Pt.LogLevel.Error:r.info(`MSAL ${e} V2 error: ${n}`);return;case Pt.LogLevel.Info:r.info(`MSAL ${e} V2 info message: ${n}`);return;case Pt.LogLevel.Verbose:r.info(`MSAL ${e} V2 verbose message: ${n}`);return;case Pt.LogLevel.Warning:r.info(`MSAL ${e} V2 warning: ${n}`);return}};function $m(r){switch(r){case"error":return Pt.LogLevel.Error;case"info":return Pt.LogLevel.Info;case"verbose":return Pt.LogLevel.Verbose;case"warning":return Pt.LogLevel.Warning;default:return Pt.LogLevel.Info}}function Ui(r,e,t){if(e.name==="AuthError"||e.name==="ClientAuthError"||e.name==="BrowserAuthError"){let n=e;switch(n.errorCode){case"endpoints_resolution_error":return Wa.info(He(r,e.message)),new Te(e.message);case"device_code_polling_cancelled":return new St("The authentication has been aborted by the caller.");case"consent_required":case"interaction_required":case"login_required":Wa.info(He(r,`Authentication returned errorCode ${n.errorCode}`));break;default:Wa.info(He(r,`Failed to acquire token: ${e.message}`));break}}return e.name==="ClientConfigurationError"||e.name==="BrowserConfigurationAuthError"||e.name==="AbortError"||e.name==="AuthenticationError"?e:e.name==="NativeAuthError"?(Wa.info(He(r,`Error from the native broker: ${e.message} with status code: ${e.statusCode}`)),e):new nr({scopes:r,getTokenOptions:t,message:e.message})}function GS(r){return{localAccountId:r.homeAccountId,environment:r.authority,username:r.username,homeAccountId:r.homeAccountId,tenantId:r.tenantId}}function VS(r,e){var t;return{authority:(t=e.environment)!==null&&t!==void 0?t:kE,homeAccountId:e.homeAccountId,tenantId:e.tenantId||OE,username:e.username,clientId:r,version:yF}}var T8=1e3*64;var TF="ManagedIdentityCredential - IMDS",R8=G(TF);var qm;(function(r){r.AutoDiscoverRegion="AutoDiscoverRegion",r.USWest="westus",r.USWest2="westus2",r.USCentral="centralus",r.USEast="eastus",r.USEast2="eastus2",r.USNorthCentral="northcentralus",r.USSouthCentral="southcentralus",r.USWestCentral="westcentralus",r.CanadaCentral="canadacentral",r.CanadaEast="canadaeast",r.BrazilSouth="brazilsouth",r.EuropeNorth="northeurope",r.EuropeWest="westeurope",r.UKSouth="uksouth",r.UKWest="ukwest",r.FranceCentral="francecentral",r.FranceSouth="francesouth",r.SwitzerlandNorth="switzerlandnorth",r.SwitzerlandWest="switzerlandwest",r.GermanyNorth="germanynorth",r.GermanyWestCentral="germanywestcentral",r.NorwayWest="norwaywest",r.NorwayEast="norwayeast",r.AsiaEast="eastasia",r.AsiaSouthEast="southeastasia",r.JapanEast="japaneast",r.JapanWest="japanwest",r.AustraliaEast="australiaeast",r.AustraliaSouthEast="australiasoutheast",r.AustraliaCentral="australiacentral",r.AustraliaCentral2="australiacentral2",r.IndiaCentral="centralindia",r.IndiaSouth="southindia",r.IndiaWest="westindia",r.KoreaSouth="koreasouth",r.KoreaCentral="koreacentral",r.UAECentral="uaecentral",r.UAENorth="uaenorth",r.SouthAfricaNorth="southafricanorth",r.SouthAfricaWest="southafricawest",r.ChinaNorth="chinanorth",r.ChinaEast="chinaeast",r.ChinaNorth2="chinanorth2",r.ChinaEast2="chinaeast2",r.GermanyCentral="germanycentral",r.GermanyNorthEast="germanynortheast",r.GovernmentUSVirginia="usgovvirginia",r.GovernmentUSIowa="usgoviowa",r.GovernmentUSArizona="usgovarizona",r.GovernmentUSTexas="usgovtexas",r.GovernmentUSDodEast="usdodeast",r.GovernmentUSDodCentral="usdodcentral"})(qm||(qm={}));function qd(r){var e,t;let n=r;return n===void 0&&((t=(e=globalThis.process)===null||e===void 0?void 0:e.env)===null||t===void 0?void 0:t.AZURE_REGIONAL_AUTHORITY_NAME)!==void 0&&(n=process.env.AZURE_REGIONAL_AUTHORITY_NAME),n===qm.AutoDiscoverRegion?"AUTO_DISCOVER":n}var gt=G("MsalClient");function WF(r,e,t={}){var n,i,o;let s=$l((n=t.logger)!==null&&n!==void 0?n:gt,e,r),a=Hm(s,Um(t)),c=new Gn(Object.assign(Object.assign({},t.tokenCredentialOptions),{authorityHost:a,loggingOptions:t.loggingOptions}));return{auth:{clientId:r,authority:a,knownAuthorities:zS(s,a,t.disableInstanceDiscovery)},system:{networkClient:c,loggerOptions:{loggerCallback:Fm((i=t.logger)!==null&&i!==void 0?i:gt),logLevel:$m(qf()),piiLoggingEnabled:(o=t.loggingOptions)===null||o===void 0?void 0:o.enableUnsafeSupportLogging}}}}function Vr(r,e,t={}){var n;let i={msalConfig:WF(r,e,t),cachedAccount:t.authenticationRecord?GS(t.authenticationRecord):null,pluginConfiguration:LE.generatePluginConfiguration(t),logger:(n=t.logger)!==null&&n!==void 0?n:gt},o=new Map;async function s(w={}){let b=w.enableCae?"CAE":"default",S=o.get(b);if(S)return i.logger.getToken.info("Existing PublicClientApplication found in cache, returning it."),S;i.logger.getToken.info(`Creating new PublicClientApplication with CAE ${w.enableCae?"enabled":"disabled"}.`);let L=w.enableCae?i.pluginConfiguration.cache.cachePluginCae:i.pluginConfiguration.cache.cachePlugin;return i.msalConfig.auth.clientCapabilities=w.enableCae?["cp1"]:void 0,S=new Ko(Object.assign(Object.assign({},i.msalConfig),{broker:{nativeBrokerPlugin:i.pluginConfiguration.broker.nativeBrokerPlugin},cache:{cachePlugin:await L}})),o.set(b,S),S}let a=new Map;async function c(w={}){let b=w.enableCae?"CAE":"default",S=a.get(b);if(S)return i.logger.getToken.info("Existing ConfidentialClientApplication found in cache, returning it."),S;i.logger.getToken.info(`Creating new ConfidentialClientApplication with CAE ${w.enableCae?"enabled":"disabled"}.`);let L=w.enableCae?i.pluginConfiguration.cache.cachePluginCae:i.pluginConfiguration.cache.cachePlugin;return i.msalConfig.auth.clientCapabilities=w.enableCae?["cp1"]:void 0,S=new Wo(Object.assign(Object.assign({},i.msalConfig),{broker:{nativeBrokerPlugin:i.pluginConfiguration.broker.nativeBrokerPlugin},cache:{cachePlugin:await L}})),a.set(b,S),S}async function l(w,b,S={}){if(i.cachedAccount===null)throw i.logger.getToken.info("No cached account found in local state."),new nr({scopes:b});S.claims&&(i.cachedClaims=S.claims);let L={account:i.cachedAccount,scopes:b,claims:i.cachedClaims};i.pluginConfiguration.broker.isEnabled&&(L.tokenQueryParameters||(L.tokenQueryParameters={}),i.pluginConfiguration.broker.enableMsaPassthrough&&(L.tokenQueryParameters.msal_request_type="consumer_passthrough")),S.proofOfPossessionOptions&&(L.shrNonce=S.proofOfPossessionOptions.nonce,L.authenticationScheme="pop",L.resourceRequestMethod=S.proofOfPossessionOptions.resourceRequestMethod,L.resourceRequestUri=S.proofOfPossessionOptions.resourceRequestUrl),i.logger.getToken.info("Attempting to acquire token silently");try{return await w.acquireTokenSilent(L)}catch(ee){throw Ui(b,ee,S)}}function u(w){return w?.tenantId?Hm(w.tenantId,Um(t)):i.msalConfig.auth.authority}async function d(w,b,S,L){var ee,F;let X=null;try{X=await l(w,b,S)}catch(we){if(we.name!=="AuthenticationRequiredError")throw we;if(S.disableAutomaticAuthentication)throw new nr({scopes:b,getTokenOptions:S,message:"Automatic authentication has been disabled. You may call the authentication() method."})}if(X===null)try{X=await L()}catch(we){throw Ui(b,we,S)}return Zo(b,X,S),i.cachedAccount=(ee=X?.account)!==null&&ee!==void 0?ee:null,i.logger.getToken.info(_t(b)),{token:X.accessToken,expiresOnTimestamp:X.expiresOn.getTime(),refreshAfterTimestamp:(F=X.refreshOn)===null||F===void 0?void 0:F.getTime(),tokenType:X.tokenType}}async function h(w,b,S={}){var L;i.logger.getToken.info("Attempting to acquire token using client secret"),i.msalConfig.auth.clientSecret=b;let ee=await c(S);try{let F=await ee.acquireTokenByClientCredential({scopes:w,authority:u(S),azureRegion:qd(),claims:S?.claims});return Zo(w,F,S),i.logger.getToken.info(_t(w)),{token:F.accessToken,expiresOnTimestamp:F.expiresOn.getTime(),refreshAfterTimestamp:(L=F.refreshOn)===null||L===void 0?void 0:L.getTime(),tokenType:F.tokenType}}catch(F){throw Ui(w,F,S)}}async function p(w,b,S={}){var L;i.logger.getToken.info("Attempting to acquire token using client assertion"),i.msalConfig.auth.clientAssertion=b;let ee=await c(S);try{let F=await ee.acquireTokenByClientCredential({scopes:w,authority:u(S),azureRegion:qd(),claims:S?.claims,clientAssertion:b});return Zo(w,F,S),i.logger.getToken.info(_t(w)),{token:F.accessToken,expiresOnTimestamp:F.expiresOn.getTime(),refreshAfterTimestamp:(L=F.refreshOn)===null||L===void 0?void 0:L.getTime(),tokenType:F.tokenType}}catch(F){throw Ui(w,F,S)}}async function m(w,b,S={}){var L;i.logger.getToken.info("Attempting to acquire token using client certificate"),i.msalConfig.auth.clientCertificate=b;let ee=await c(S);try{let F=await ee.acquireTokenByClientCredential({scopes:w,authority:u(S),azureRegion:qd(),claims:S?.claims});return Zo(w,F,S),i.logger.getToken.info(_t(w)),{token:F.accessToken,expiresOnTimestamp:F.expiresOn.getTime(),refreshAfterTimestamp:(L=F.refreshOn)===null||L===void 0?void 0:L.getTime(),tokenType:F.tokenType}}catch(F){throw Ui(w,F,S)}}async function y(w,b,S={}){i.logger.getToken.info("Attempting to acquire token using device code");let L=await s(S);return d(L,w,S,()=>{var ee,F;let X={scopes:w,cancel:(F=(ee=S?.abortSignal)===null||ee===void 0?void 0:ee.aborted)!==null&&F!==void 0?F:!1,deviceCodeCallback:b,authority:u(S),claims:S?.claims},we=L.acquireTokenByDeviceCode(X);return S.abortSignal&&S.abortSignal.addEventListener("abort",()=>{X.cancel=!0}),we})}async function A(w,b,S,L={}){i.logger.getToken.info("Attempting to acquire token using username and password");let ee=await s(L);return d(ee,w,L,()=>{let F={scopes:w,username:b,password:S,authority:u(L),claims:L?.claims};return ee.acquireTokenByUsernamePassword(F)})}function P(){if(i.cachedAccount)return VS(r,i.cachedAccount)}async function D(w,b,S,L,ee={}){i.logger.getToken.info("Attempting to acquire token using authorization code");let F;return L?(i.msalConfig.auth.clientSecret=L,F=await c(ee)):F=await s(ee),d(F,w,ee,()=>F.acquireTokenByCode({scopes:w,redirectUri:b,code:S,authority:u(ee),claims:ee?.claims}))}async function U(w,b,S,L={}){var ee;gt.getToken.info("Attempting to acquire token on behalf of another user"),typeof S=="string"?(gt.getToken.info("Using client secret for on behalf of flow"),i.msalConfig.auth.clientSecret=S):typeof S=="function"?(gt.getToken.info("Using client assertion callback for on behalf of flow"),i.msalConfig.auth.clientAssertion=S):(gt.getToken.info("Using client certificate for on behalf of flow"),i.msalConfig.auth.clientCertificate=S);let F=await c(L);try{let X=await F.acquireTokenOnBehalfOf({scopes:w,authority:u(L),claims:L.claims,oboAssertion:b});return Zo(w,X,L),gt.getToken.info(_t(w)),{token:X.accessToken,expiresOnTimestamp:X.expiresOn.getTime(),refreshAfterTimestamp:(ee=X.refreshOn)===null||ee===void 0?void 0:ee.getTime(),tokenType:X.tokenType}}catch(X){throw Ui(w,X,L)}}async function H(w,b={}){gt.getToken.info("Attempting to acquire token interactively");let S=await s(b);async function L(F){var X;gt.verbose("Authentication will resume through the broker");let we=ee();i.pluginConfiguration.broker.parentWindowHandle?we.windowHandle=Buffer.from(i.pluginConfiguration.broker.parentWindowHandle):gt.warning("Parent window handle is not specified for the broker. This may cause unexpected behavior. Please provide the parentWindowHandle."),i.pluginConfiguration.broker.enableMsaPassthrough&&(((X=we.tokenQueryParameters)!==null&&X!==void 0?X:we.tokenQueryParameters={}).msal_request_type="consumer_passthrough"),F?(we.prompt="none",gt.verbose("Attempting broker authentication using the default broker account")):gt.verbose("Attempting broker authentication without the default broker account"),b.proofOfPossessionOptions&&(we.shrNonce=b.proofOfPossessionOptions.nonce,we.authenticationScheme="pop",we.resourceRequestMethod=b.proofOfPossessionOptions.resourceRequestMethod,we.resourceRequestUri=b.proofOfPossessionOptions.resourceRequestUrl);try{return await S.acquireTokenInteractive(we)}catch(es){if(gt.verbose(`Failed to authenticate through the broker: ${es.message}`),F)return L(!1);throw es}}function ee(){var F,X;return{openBrowser:async we=>{await(await Promise.resolve().then(()=>(fw(),dw))).default(we,{wait:!0,newInstance:!0})},scopes:w,authority:u(b),claims:b?.claims,loginHint:b?.loginHint,errorTemplate:(F=b?.browserCustomizationOptions)===null||F===void 0?void 0:F.errorMessage,successTemplate:(X=b?.browserCustomizationOptions)===null||X===void 0?void 0:X.successMessage,prompt:b?.loginHint?"login":"select_account"}}return d(S,w,b,async()=>{var F;let X=ee();return i.pluginConfiguration.broker.isEnabled?L((F=i.pluginConfiguration.broker.useDefaultBrokerAccount)!==null&&F!==void 0?F:!1):(b.proofOfPossessionOptions&&(X.shrNonce=b.proofOfPossessionOptions.nonce,X.authenticationScheme="pop",X.resourceRequestMethod=b.proofOfPossessionOptions.resourceRequestMethod,X.resourceRequestUri=b.proofOfPossessionOptions.resourceRequestUrl),S.acquireTokenInteractive(X))})}return{getActiveAccount:P,getTokenByClientSecret:h,getTokenByClientAssertion:p,getTokenByClientCertificate:m,getTokenByDeviceCode:y,getTokenByUsernamePassword:A,getTokenByAuthorizationCode:D,getTokenOnBehalfOf:U,getTokenByInteractiveRequest:H}}var x7=G("ClientAssertionCredential");import{readFile as H7}from"node:fs/promises";var XF="WorkloadIdentityCredential";var F7=G(XF);var QF="ManagedIdentityCredential - Token Exchange",B7=G(QF);var see=G("ManagedIdentityCredential");function $i(r){return Array.isArray(r)?r:[r]}var Tee=G("AzureCliCredential");var Ree=G("AzureDeveloperCliCredential");var Lee=G("AzurePowerShellCredential"),gw=process.platform==="win32";function yw(r){return gw?`${r}.exe`:r}var e1=[yw("pwsh")];gw&&e1.push(yw("powershell"));var qee=G("ChainedTokenCredential");import{createHash as Gee,createPrivateKey as Vee}from"node:crypto";import{readFile as Zee}from"node:fs/promises";var r1="ClientCertificateCredential",Qee=G(r1);var Ew=G("ClientSecretCredential"),Jo=class{constructor(e,t,n,i={}){if(!e)throw new Te("ClientSecretCredential: tenantId is a required parameter. To troubleshoot, visit https://aka.ms/azsdk/js/identity/serviceprincipalauthentication/troubleshoot.");if(!t)throw new Te("ClientSecretCredential: clientId is a required parameter. To troubleshoot, visit https://aka.ms/azsdk/js/identity/serviceprincipalauthentication/troubleshoot.");if(!n)throw new Te("ClientSecretCredential: clientSecret is a required parameter. To troubleshoot, visit https://aka.ms/azsdk/js/identity/serviceprincipalauthentication/troubleshoot.");this.clientSecret=n,this.tenantId=e,this.additionallyAllowedTenantIds=At(i?.additionallyAllowedTenants),this.msalClient=Vr(t,e,Object.assign(Object.assign({},i),{logger:Ew,tokenCredentialOptions:i}))}async getToken(e,t={}){return Le.withSpan(`${this.constructor.name}.getToken`,t,async n=>{n.tenantId=at(this.tenantId,n,this.additionallyAllowedTenantIds,Ew);let i=$i(e);return this.msalClient.getTokenByClientSecret(i,this.clientSecret,n)})}};var hte=G("UsernamePasswordCredential");var o1="EnvironmentCredential",_te=G(o1);var Pte=G("DefaultAzureCredential");var $te=G("InteractiveBrowserCredential");var Yte=G("DeviceCodeCredential");var f1="AzurePipelinesCredential",rre=G(f1);var ure=G("AuthorizationCodeCredential");import{createHash as yre}from"node:crypto";import{readFile as vre}from"node:fs/promises";var h1="OnBehalfOfCredential",_re=G(h1);var Qa=new Pc({name:"EntraAware",version:"1.0.0",capabilities:{resources:{},tools:{}}});function zd(){let r=process.env.TENANT_ID,e=process.env.CLIENT_ID,t=process.env.CLIENT_SECRET;if(!r||!e||!t)throw new Error("Missing required Entra environment variables.");let n=new Jo(r,e,t);return Tw.Client.initWithMiddleware({authProvider:{getAccessToken:async()=>(await n.getToken("https://graph.microsoft.com/.default"))?.token||""}})}Qa.tool("get-entra-user","Get user info from Microsoft Entra by UPN",{upn:f.string().describe("User Principal Name (email)")},async({upn:r})=>{try{let t=await zd().api(`/users/${r}`).get();return{content:[{type:"text",text:JSON.stringify(t,null,2)}]}}catch(e){return{content:[{type:"text",text:`Error: ${e instanceof Error?e.message:String(e)}`}]}}});Qa.tool("list-entra-users","List users from Microsoft Entra with optional filter",{filter:f.string().optional().describe("OData filter expression (e.g. startsWith(displayName,'John'))")},async({filter:r})=>{try{let t=zd().api("/users");r&&(t=t.filter(r));let n=await t.select("id,displayName,userPrincipalName,jobTitle,department").top(25).get();return{content:[{type:"text",text:JSON.stringify(n,null,2)}]}}catch(e){return{content:[{type:"text",text:`Error: ${e instanceof Error?e.message:String(e)}`}]}}});Qa.tool("get-user-groups","Get groups that a user is a member of",{upn:f.string().describe("User Principal Name (email)")},async({upn:r})=>{try{let t=await zd().api(`/users/${r}/memberOf`).get();return{content:[{type:"text",text:JSON.stringify(t,null,2)}]}}catch(e){return{content:[{type:"text",text:`Error: ${e instanceof Error?e.message:String(e)}`}]}}});Qa.tool("get-organization","Get details about the organization",{},async()=>{try{let e=await zd().api("/organization").get();return{content:[{type:"text",text:JSON.stringify(e,null,2)}]}}catch(r){return{content:[{type:"text",text:`Error: ${r instanceof Error?r.message:String(r)}`}]}}});async function m1(){let r=new Mc;await Qa.connect(r),console.error("EntraAware MCP Server running on stdio")}m1().catch(r=>{console.error("Fatal error in main():",r),process.exit(1)});
/*! Bundled license information:

safe-buffer/index.js:
  (*! safe-buffer. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> *)

@azure/msal-node/dist/cache/serializer/Serializer.mjs:
  (*! @azure/msal-node v3.5.1 2025-04-16 *)

@azure/msal-common/dist/utils/Constants.mjs:
  (*! @azure/msal-common v15.5.1 2025-04-15 *)

@azure/msal-common/dist/error/AuthErrorCodes.mjs:
  (*! @azure/msal-common v15.5.1 2025-04-15 *)

@azure/msal-common/dist/error/AuthError.mjs:
  (*! @azure/msal-common v15.5.1 2025-04-15 *)

@azure/msal-common/dist/error/ClientAuthErrorCodes.mjs:
  (*! @azure/msal-common v15.5.1 2025-04-15 *)

@azure/msal-common/dist/error/ClientAuthError.mjs:
  (*! @azure/msal-common v15.5.1 2025-04-15 *)

@azure/msal-common/dist/crypto/ICrypto.mjs:
  (*! @azure/msal-common v15.5.1 2025-04-15 *)

@azure/msal-common/dist/logger/Logger.mjs:
  (*! @azure/msal-common v15.5.1 2025-04-15 *)

@azure/msal-common/dist/packageMetadata.mjs:
  (*! @azure/msal-common v15.5.1 2025-04-15 *)

@azure/msal-common/dist/authority/AuthorityOptions.mjs:
  (*! @azure/msal-common v15.5.1 2025-04-15 *)

@azure/msal-common/dist/account/AuthToken.mjs:
  (*! @azure/msal-common v15.5.1 2025-04-15 *)

@azure/msal-common/dist/utils/TimeUtils.mjs:
  (*! @azure/msal-common v15.5.1 2025-04-15 *)

@azure/msal-common/dist/cache/utils/CacheHelpers.mjs:
  (*! @azure/msal-common v15.5.1 2025-04-15 *)

@azure/msal-common/dist/error/ClientConfigurationErrorCodes.mjs:
  (*! @azure/msal-common v15.5.1 2025-04-15 *)

@azure/msal-common/dist/error/ClientConfigurationError.mjs:
  (*! @azure/msal-common v15.5.1 2025-04-15 *)

@azure/msal-common/dist/utils/StringUtils.mjs:
  (*! @azure/msal-common v15.5.1 2025-04-15 *)

@azure/msal-common/dist/request/ScopeSet.mjs:
  (*! @azure/msal-common v15.5.1 2025-04-15 *)

@azure/msal-common/dist/account/ClientInfo.mjs:
  (*! @azure/msal-common v15.5.1 2025-04-15 *)

@azure/msal-common/dist/account/AccountInfo.mjs:
  (*! @azure/msal-common v15.5.1 2025-04-15 *)

@azure/msal-common/dist/authority/AuthorityType.mjs:
  (*! @azure/msal-common v15.5.1 2025-04-15 *)

@azure/msal-common/dist/account/TokenClaims.mjs:
  (*! @azure/msal-common v15.5.1 2025-04-15 *)

@azure/msal-common/dist/authority/ProtocolMode.mjs:
  (*! @azure/msal-common v15.5.1 2025-04-15 *)

@azure/msal-common/dist/cache/entities/AccountEntity.mjs:
  (*! @azure/msal-common v15.5.1 2025-04-15 *)

@azure/msal-common/dist/utils/UrlUtils.mjs:
  (*! @azure/msal-common v15.5.1 2025-04-15 *)

@azure/msal-common/dist/url/UrlString.mjs:
  (*! @azure/msal-common v15.5.1 2025-04-15 *)

@azure/msal-common/dist/authority/AuthorityMetadata.mjs:
  (*! @azure/msal-common v15.5.1 2025-04-15 *)

@azure/msal-common/dist/error/CacheErrorCodes.mjs:
  (*! @azure/msal-common v15.5.1 2025-04-15 *)

@azure/msal-common/dist/error/CacheError.mjs:
  (*! @azure/msal-common v15.5.1 2025-04-15 *)

@azure/msal-common/dist/cache/CacheManager.mjs:
  (*! @azure/msal-common v15.5.1 2025-04-15 *)

@azure/msal-common/dist/config/ClientConfiguration.mjs:
  (*! @azure/msal-common v15.5.1 2025-04-15 *)

@azure/msal-common/dist/account/CcsCredential.mjs:
  (*! @azure/msal-common v15.5.1 2025-04-15 *)

@azure/msal-common/dist/constants/AADServerParamKeys.mjs:
  (*! @azure/msal-common v15.5.1 2025-04-15 *)

@azure/msal-common/dist/request/RequestParameterBuilder.mjs:
  (*! @azure/msal-common v15.5.1 2025-04-15 *)

@azure/msal-common/dist/authority/OpenIdConfigResponse.mjs:
  (*! @azure/msal-common v15.5.1 2025-04-15 *)

@azure/msal-common/dist/authority/CloudInstanceDiscoveryResponse.mjs:
  (*! @azure/msal-common v15.5.1 2025-04-15 *)

@azure/msal-common/dist/authority/CloudInstanceDiscoveryErrorResponse.mjs:
  (*! @azure/msal-common v15.5.1 2025-04-15 *)

@azure/msal-common/dist/telemetry/performance/PerformanceEvent.mjs:
  (*! @azure/msal-common v15.5.1 2025-04-15 *)

@azure/msal-common/dist/utils/FunctionWrappers.mjs:
  (*! @azure/msal-common v15.5.1 2025-04-15 *)

@azure/msal-common/dist/authority/RegionDiscovery.mjs:
  (*! @azure/msal-common v15.5.1 2025-04-15 *)

@azure/msal-common/dist/authority/Authority.mjs:
  (*! @azure/msal-common v15.5.1 2025-04-15 *)

@azure/msal-common/dist/authority/AuthorityFactory.mjs:
  (*! @azure/msal-common v15.5.1 2025-04-15 *)

@azure/msal-common/dist/error/ServerError.mjs:
  (*! @azure/msal-common v15.5.1 2025-04-15 *)

@azure/msal-common/dist/network/RequestThumbprint.mjs:
  (*! @azure/msal-common v15.5.1 2025-04-15 *)

@azure/msal-common/dist/network/ThrottlingUtils.mjs:
  (*! @azure/msal-common v15.5.1 2025-04-15 *)

@azure/msal-common/dist/error/NetworkError.mjs:
  (*! @azure/msal-common v15.5.1 2025-04-15 *)

@azure/msal-common/dist/client/BaseClient.mjs:
  (*! @azure/msal-common v15.5.1 2025-04-15 *)

@azure/msal-common/dist/error/InteractionRequiredAuthErrorCodes.mjs:
  (*! @azure/msal-common v15.5.1 2025-04-15 *)

@azure/msal-common/dist/error/InteractionRequiredAuthError.mjs:
  (*! @azure/msal-common v15.5.1 2025-04-15 *)

@azure/msal-common/dist/utils/ProtocolUtils.mjs:
  (*! @azure/msal-common v15.5.1 2025-04-15 *)

@azure/msal-common/dist/crypto/PopTokenGenerator.mjs:
  (*! @azure/msal-common v15.5.1 2025-04-15 *)

@azure/msal-common/dist/cache/persistence/TokenCacheContext.mjs:
  (*! @azure/msal-common v15.5.1 2025-04-15 *)

@azure/msal-common/dist/response/ResponseHandler.mjs:
  (*! @azure/msal-common v15.5.1 2025-04-15 *)

@azure/msal-common/dist/request/RequestValidator.mjs:
  (*! @azure/msal-common v15.5.1 2025-04-15 *)

@azure/msal-common/dist/utils/ClientAssertionUtils.mjs:
  (*! @azure/msal-common v15.5.1 2025-04-15 *)

@azure/msal-common/dist/client/AuthorizationCodeClient.mjs:
  (*! @azure/msal-common v15.5.1 2025-04-15 *)

@azure/msal-common/dist/client/RefreshTokenClient.mjs:
  (*! @azure/msal-common v15.5.1 2025-04-15 *)

@azure/msal-common/dist/client/SilentFlowClient.mjs:
  (*! @azure/msal-common v15.5.1 2025-04-15 *)

@azure/msal-common/dist/protocol/Authorize.mjs:
  (*! @azure/msal-common v15.5.1 2025-04-15 *)

@azure/msal-common/dist/telemetry/server/ServerTelemetryManager.mjs:
  (*! @azure/msal-common v15.5.1 2025-04-15 *)

@azure/msal-common/dist/index-node.mjs:
  (*! @azure/msal-common v15.5.1 2025-04-15 *)

@azure/msal-node/dist/cache/serializer/Deserializer.mjs:
  (*! @azure/msal-node v3.5.1 2025-04-16 *)

@azure/msal-node/dist/internals.mjs:
  (*! @azure/msal-node v3.5.1 2025-04-16 *)

@azure/msal-node/dist/utils/Constants.mjs:
  (*! @azure/msal-node v3.5.1 2025-04-16 *)

@azure/msal-node/dist/utils/NetworkUtils.mjs:
  (*! @azure/msal-node v3.5.1 2025-04-16 *)

@azure/msal-node/dist/network/HttpClient.mjs:
  (*! @azure/msal-node v3.5.1 2025-04-16 *)

@azure/msal-node/dist/error/ManagedIdentityErrorCodes.mjs:
  (*! @azure/msal-node v3.5.1 2025-04-16 *)

@azure/msal-node/dist/error/ManagedIdentityError.mjs:
  (*! @azure/msal-node v3.5.1 2025-04-16 *)

@azure/msal-node/dist/config/ManagedIdentityId.mjs:
  (*! @azure/msal-node v3.5.1 2025-04-16 *)

@azure/msal-node/dist/error/NodeAuthError.mjs:
  (*! @azure/msal-node v3.5.1 2025-04-16 *)

@azure/msal-node/dist/config/Configuration.mjs:
  (*! @azure/msal-node v3.5.1 2025-04-16 *)

@azure/msal-node/dist/crypto/GuidGenerator.mjs:
  (*! @azure/msal-node v3.5.1 2025-04-16 *)

@azure/msal-node/dist/utils/EncodingUtils.mjs:
  (*! @azure/msal-node v3.5.1 2025-04-16 *)

@azure/msal-node/dist/crypto/HashUtils.mjs:
  (*! @azure/msal-node v3.5.1 2025-04-16 *)

@azure/msal-node/dist/crypto/PkceGenerator.mjs:
  (*! @azure/msal-node v3.5.1 2025-04-16 *)

@azure/msal-node/dist/crypto/CryptoProvider.mjs:
  (*! @azure/msal-node v3.5.1 2025-04-16 *)

@azure/msal-node/dist/cache/NodeStorage.mjs:
  (*! @azure/msal-node v3.5.1 2025-04-16 *)

@azure/msal-node/dist/cache/TokenCache.mjs:
  (*! @azure/msal-node v3.5.1 2025-04-16 *)

@azure/msal-node/dist/client/ClientAssertion.mjs:
  (*! @azure/msal-node v3.5.1 2025-04-16 *)

@azure/msal-node/dist/packageMetadata.mjs:
  (*! @azure/msal-node v3.5.1 2025-04-16 *)

@azure/msal-node/dist/client/UsernamePasswordClient.mjs:
  (*! @azure/msal-node v3.5.1 2025-04-16 *)

@azure/msal-node/dist/protocol/Authorize.mjs:
  (*! @azure/msal-node v3.5.1 2025-04-16 *)

@azure/msal-node/dist/client/ClientApplication.mjs:
  (*! @azure/msal-node v3.5.1 2025-04-16 *)

@azure/msal-node/dist/network/LoopbackClient.mjs:
  (*! @azure/msal-node v3.5.1 2025-04-16 *)

@azure/msal-node/dist/client/DeviceCodeClient.mjs:
  (*! @azure/msal-node v3.5.1 2025-04-16 *)

@azure/msal-node/dist/client/PublicClientApplication.mjs:
  (*! @azure/msal-node v3.5.1 2025-04-16 *)

@azure/msal-node/dist/client/ClientCredentialClient.mjs:
  (*! @azure/msal-node v3.5.1 2025-04-16 *)

@azure/msal-node/dist/client/OnBehalfOfClient.mjs:
  (*! @azure/msal-node v3.5.1 2025-04-16 *)

@azure/msal-node/dist/client/ConfidentialClientApplication.mjs:
  (*! @azure/msal-node v3.5.1 2025-04-16 *)

@azure/msal-node/dist/utils/TimeUtils.mjs:
  (*! @azure/msal-node v3.5.1 2025-04-16 *)

@azure/msal-node/dist/network/HttpClientWithRetries.mjs:
  (*! @azure/msal-node v3.5.1 2025-04-16 *)

@azure/msal-node/dist/client/ManagedIdentitySources/BaseManagedIdentitySource.mjs:
  (*! @azure/msal-node v3.5.1 2025-04-16 *)

@azure/msal-common/dist/index.mjs:
  (*! @azure/msal-common v15.5.1 2025-04-15 *)

@azure/msal-node/dist/retry/LinearRetryStrategy.mjs:
  (*! @azure/msal-node v3.5.1 2025-04-16 *)

@azure/msal-node/dist/retry/DefaultManagedIdentityRetryPolicy.mjs:
  (*! @azure/msal-node v3.5.1 2025-04-16 *)

@azure/msal-node/dist/config/ManagedIdentityRequestParameters.mjs:
  (*! @azure/msal-node v3.5.1 2025-04-16 *)

@azure/msal-node/dist/client/ManagedIdentitySources/AppService.mjs:
  (*! @azure/msal-node v3.5.1 2025-04-16 *)

@azure/msal-node/dist/client/ManagedIdentitySources/AzureArc.mjs:
  (*! @azure/msal-node v3.5.1 2025-04-16 *)

@azure/msal-node/dist/client/ManagedIdentitySources/CloudShell.mjs:
  (*! @azure/msal-node v3.5.1 2025-04-16 *)

@azure/msal-node/dist/retry/ExponentialRetryStrategy.mjs:
  (*! @azure/msal-node v3.5.1 2025-04-16 *)

@azure/msal-node/dist/retry/ImdsRetryPolicy.mjs:
  (*! @azure/msal-node v3.5.1 2025-04-16 *)

@azure/msal-node/dist/client/ManagedIdentitySources/Imds.mjs:
  (*! @azure/msal-node v3.5.1 2025-04-16 *)

@azure/msal-node/dist/client/ManagedIdentitySources/ServiceFabric.mjs:
  (*! @azure/msal-node v3.5.1 2025-04-16 *)

@azure/msal-node/dist/client/ManagedIdentitySources/MachineLearning.mjs:
  (*! @azure/msal-node v3.5.1 2025-04-16 *)

@azure/msal-node/dist/client/ManagedIdentityClient.mjs:
  (*! @azure/msal-node v3.5.1 2025-04-16 *)

@azure/msal-node/dist/client/ManagedIdentityApplication.mjs:
  (*! @azure/msal-node v3.5.1 2025-04-16 *)

@azure/msal-node/dist/cache/distributed/DistributedCachePlugin.mjs:
  (*! @azure/msal-node v3.5.1 2025-04-16 *)

@azure/msal-node/dist/index.mjs:
  (*! @azure/msal-node v3.5.1 2025-04-16 *)
*/
